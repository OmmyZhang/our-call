var C7=Object.defineProperty;var y7=(s,c,h)=>c in s?C7(s,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):s[c]=h;var uh=(s,c,h)=>(y7(s,typeof c!="symbol"?c+"":c,h),h);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))_(g);new MutationObserver(g=>{for(const v of g)if(v.type==="childList")for(const b of v.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&_(b)}).observe(document,{childList:!0,subtree:!0});function h(g){const v={};return g.integrity&&(v.integrity=g.integrity),g.referrerPolicy&&(v.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?v.credentials="include":g.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function _(g){if(g.ep)return;g.ep=!0;const v=h(g);fetch(g.href,v)}})();function I7(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var QU={exports:{}},Uf={},ZU={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zh=Symbol.for("react.element"),w7=Symbol.for("react.portal"),A7=Symbol.for("react.fragment"),O7=Symbol.for("react.strict_mode"),b7=Symbol.for("react.profiler"),N7=Symbol.for("react.provider"),D7=Symbol.for("react.context"),P7=Symbol.for("react.forward_ref"),k7=Symbol.for("react.suspense"),L7=Symbol.for("react.memo"),M7=Symbol.for("react.lazy"),BM=Symbol.iterator;function U7(s){return s===null||typeof s!="object"?null:(s=BM&&s[BM]||s["@@iterator"],typeof s=="function"?s:null)}var $U={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e2=Object.assign,t2={};function Fd(s,c,h){this.props=s,this.context=c,this.refs=t2,this.updater=h||$U}Fd.prototype.isReactComponent={};Fd.prototype.setState=function(s,c){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,c,"setState")};Fd.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function i2(){}i2.prototype=Fd.prototype;function hC(s,c,h){this.props=s,this.context=c,this.refs=t2,this.updater=h||$U}var pC=hC.prototype=new i2;pC.constructor=hC;e2(pC,Fd.prototype);pC.isPureReactComponent=!0;var GM=Array.isArray,r2=Object.prototype.hasOwnProperty,mC={current:null},n2={key:!0,ref:!0,__self:!0,__source:!0};function o2(s,c,h){var _,g={},v=null,b=null;if(c!=null)for(_ in c.ref!==void 0&&(b=c.ref),c.key!==void 0&&(v=""+c.key),c)r2.call(c,_)&&!n2.hasOwnProperty(_)&&(g[_]=c[_]);var L=arguments.length-2;if(L===1)g.children=h;else if(1<L){for(var x=Array(L),W=0;W<L;W++)x[W]=arguments[W+2];g.children=x}if(s&&s.defaultProps)for(_ in L=s.defaultProps,L)g[_]===void 0&&(g[_]=L[_]);return{$$typeof:Zh,type:s,key:v,ref:b,props:g,_owner:mC.current}}function x7(s,c){return{$$typeof:Zh,type:s.type,key:c,ref:s.ref,props:s.props,_owner:s._owner}}function _C(s){return typeof s=="object"&&s!==null&&s.$$typeof===Zh}function V7(s){var c={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(h){return c[h]})}var WM=/\/+/g;function zv(s,c){return typeof s=="object"&&s!==null&&s.key!=null?V7(""+s.key):c.toString(36)}function Q_(s,c,h,_,g){var v=typeof s;(v==="undefined"||v==="boolean")&&(s=null);var b=!1;if(s===null)b=!0;else switch(v){case"string":case"number":b=!0;break;case"object":switch(s.$$typeof){case Zh:case w7:b=!0}}if(b)return b=s,g=g(b),s=_===""?"."+zv(b,0):_,GM(g)?(h="",s!=null&&(h=s.replace(WM,"$&/")+"/"),Q_(g,c,h,"",function(W){return W})):g!=null&&(_C(g)&&(g=x7(g,h+(!g.key||b&&b.key===g.key?"":(""+g.key).replace(WM,"$&/")+"/")+s)),c.push(g)),1;if(b=0,_=_===""?".":_+":",GM(s))for(var L=0;L<s.length;L++){v=s[L];var x=_+zv(v,L);b+=Q_(v,c,h,x,g)}else if(x=U7(s),typeof x=="function")for(s=x.call(s),L=0;!(v=s.next()).done;)v=v.value,x=_+zv(v,L++),b+=Q_(v,c,h,x,g);else if(v==="object")throw c=String(s),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.");return b}function L_(s,c,h){if(s==null)return s;var _=[],g=0;return Q_(s,_,"","",function(v){return c.call(h,v,g++)}),_}function F7(s){if(s._status===-1){var c=s._result;c=c(),c.then(function(h){(s._status===0||s._status===-1)&&(s._status=1,s._result=h)},function(h){(s._status===0||s._status===-1)&&(s._status=2,s._result=h)}),s._status===-1&&(s._status=0,s._result=c)}if(s._status===1)return s._result.default;throw s._result}var Hr={current:null},Z_={transition:null},j7={ReactCurrentDispatcher:Hr,ReactCurrentBatchConfig:Z_,ReactCurrentOwner:mC};function s2(){throw Error("act(...) is not supported in production builds of React.")}It.Children={map:L_,forEach:function(s,c,h){L_(s,function(){c.apply(this,arguments)},h)},count:function(s){var c=0;return L_(s,function(){c++}),c},toArray:function(s){return L_(s,function(c){return c})||[]},only:function(s){if(!_C(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};It.Component=Fd;It.Fragment=A7;It.Profiler=b7;It.PureComponent=hC;It.StrictMode=O7;It.Suspense=k7;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j7;It.act=s2;It.cloneElement=function(s,c,h){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var _=e2({},s.props),g=s.key,v=s.ref,b=s._owner;if(c!=null){if(c.ref!==void 0&&(v=c.ref,b=mC.current),c.key!==void 0&&(g=""+c.key),s.type&&s.type.defaultProps)var L=s.type.defaultProps;for(x in c)r2.call(c,x)&&!n2.hasOwnProperty(x)&&(_[x]=c[x]===void 0&&L!==void 0?L[x]:c[x])}var x=arguments.length-2;if(x===1)_.children=h;else if(1<x){L=Array(x);for(var W=0;W<x;W++)L[W]=arguments[W+2];_.children=L}return{$$typeof:Zh,type:s.type,key:g,ref:v,props:_,_owner:b}};It.createContext=function(s){return s={$$typeof:D7,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:N7,_context:s},s.Consumer=s};It.createElement=o2;It.createFactory=function(s){var c=o2.bind(null,s);return c.type=s,c};It.createRef=function(){return{current:null}};It.forwardRef=function(s){return{$$typeof:P7,render:s}};It.isValidElement=_C;It.lazy=function(s){return{$$typeof:M7,_payload:{_status:-1,_result:s},_init:F7}};It.memo=function(s,c){return{$$typeof:L7,type:s,compare:c===void 0?null:c}};It.startTransition=function(s){var c=Z_.transition;Z_.transition={};try{s()}finally{Z_.transition=c}};It.unstable_act=s2;It.useCallback=function(s,c){return Hr.current.useCallback(s,c)};It.useContext=function(s){return Hr.current.useContext(s)};It.useDebugValue=function(){};It.useDeferredValue=function(s){return Hr.current.useDeferredValue(s)};It.useEffect=function(s,c){return Hr.current.useEffect(s,c)};It.useId=function(){return Hr.current.useId()};It.useImperativeHandle=function(s,c,h){return Hr.current.useImperativeHandle(s,c,h)};It.useInsertionEffect=function(s,c){return Hr.current.useInsertionEffect(s,c)};It.useLayoutEffect=function(s,c){return Hr.current.useLayoutEffect(s,c)};It.useMemo=function(s,c){return Hr.current.useMemo(s,c)};It.useReducer=function(s,c,h){return Hr.current.useReducer(s,c,h)};It.useRef=function(s){return Hr.current.useRef(s)};It.useState=function(s){return Hr.current.useState(s)};It.useSyncExternalStore=function(s,c,h){return Hr.current.useSyncExternalStore(s,c,h)};It.useTransition=function(){return Hr.current.useTransition()};It.version="18.3.1";ZU.exports=It;var we=ZU.exports;const B7=I7(we);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G7=we,W7=Symbol.for("react.element"),H7=Symbol.for("react.fragment"),K7=Object.prototype.hasOwnProperty,z7=G7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y7={key:!0,ref:!0,__self:!0,__source:!0};function a2(s,c,h){var _,g={},v=null,b=null;h!==void 0&&(v=""+h),c.key!==void 0&&(v=""+c.key),c.ref!==void 0&&(b=c.ref);for(_ in c)K7.call(c,_)&&!Y7.hasOwnProperty(_)&&(g[_]=c[_]);if(s&&s.defaultProps)for(_ in c=s.defaultProps,c)g[_]===void 0&&(g[_]=c[_]);return{$$typeof:W7,type:s,key:v,ref:b,props:g,_owner:z7.current}}Uf.Fragment=H7;Uf.jsx=a2;Uf.jsxs=a2;QU.exports=Uf;var $e=QU.exports,gR={},c2={exports:{}},On={},l2={exports:{}},d2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function c(Pe,Me){var dt=Pe.length;Pe.push(Me);e:for(;0<dt;){var Ti=dt-1>>>1,Vi=Pe[Ti];if(0<g(Vi,Me))Pe[Ti]=Me,Pe[dt]=Vi,dt=Ti;else break e}}function h(Pe){return Pe.length===0?null:Pe[0]}function _(Pe){if(Pe.length===0)return null;var Me=Pe[0],dt=Pe.pop();if(dt!==Me){Pe[0]=dt;e:for(var Ti=0,Vi=Pe.length,Jc=Vi>>>1;Ti<Jc;){var Sr=2*(Ti+1)-1,Us=Pe[Sr],Tr=Sr+1,Xc=Pe[Tr];if(0>g(Us,dt))Tr<Vi&&0>g(Xc,Us)?(Pe[Ti]=Xc,Pe[Tr]=dt,Ti=Tr):(Pe[Ti]=Us,Pe[Sr]=dt,Ti=Sr);else if(Tr<Vi&&0>g(Xc,dt))Pe[Ti]=Xc,Pe[Tr]=dt,Ti=Tr;else break e}}return Me}function g(Pe,Me){var dt=Pe.sortIndex-Me.sortIndex;return dt!==0?dt:Pe.id-Me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;s.unstable_now=function(){return v.now()}}else{var b=Date,L=b.now();s.unstable_now=function(){return b.now()-L}}var x=[],W=[],$=1,K=null,Q=3,Ee=!1,ce=!1,te=!1,ve=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Y(Pe){for(var Me=h(W);Me!==null;){if(Me.callback===null)_(W);else if(Me.startTime<=Pe)_(W),Me.sortIndex=Me.expirationTime,c(x,Me);else break;Me=h(W)}}function ge(Pe){if(te=!1,Y(Pe),!ce)if(h(x)!==null)ce=!0,ur(Te);else{var Me=h(W);Me!==null&&Gd(ge,Me.startTime-Pe)}}function Te(Pe,Me){ce=!1,te&&(te=!1,H(Ve),Ve=-1),Ee=!0;var dt=Q;try{for(Y(Me),K=h(x);K!==null&&(!(K.expirationTime>Me)||Pe&&!dr());){var Ti=K.callback;if(typeof Ti=="function"){K.callback=null,Q=K.priorityLevel;var Vi=Ti(K.expirationTime<=Me);Me=s.unstable_now(),typeof Vi=="function"?K.callback=Vi:K===h(x)&&_(x),Y(Me)}else _(x);K=h(x)}if(K!==null)var Jc=!0;else{var Sr=h(W);Sr!==null&&Gd(ge,Sr.startTime-Me),Jc=!1}return Jc}finally{K=null,Q=dt,Ee=!1}}var be=!1,Ae=null,Ve=-1,Bt=5,et=-1;function dr(){return!(s.unstable_now()-et<Bt)}function Po(){if(Ae!==null){var Pe=s.unstable_now();et=Pe;var Me=!0;try{Me=Ae(!0,Pe)}finally{Me?Ha():(be=!1,Ae=null)}}else be=!1}var Ha;if(typeof j=="function")Ha=function(){j(Po)};else if(typeof MessageChannel<"u"){var hi=new MessageChannel,Ka=hi.port2;hi.port1.onmessage=Po,Ha=function(){Ka.postMessage(null)}}else Ha=function(){ve(Po,0)};function ur(Pe){Ae=Pe,be||(be=!0,Ha())}function Gd(Pe,Me){Ve=ve(function(){Pe(s.unstable_now())},Me)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Pe){Pe.callback=null},s.unstable_continueExecution=function(){ce||Ee||(ce=!0,ur(Te))},s.unstable_forceFrameRate=function(Pe){0>Pe||125<Pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bt=0<Pe?Math.floor(1e3/Pe):5},s.unstable_getCurrentPriorityLevel=function(){return Q},s.unstable_getFirstCallbackNode=function(){return h(x)},s.unstable_next=function(Pe){switch(Q){case 1:case 2:case 3:var Me=3;break;default:Me=Q}var dt=Q;Q=Me;try{return Pe()}finally{Q=dt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(Pe,Me){switch(Pe){case 1:case 2:case 3:case 4:case 5:break;default:Pe=3}var dt=Q;Q=Pe;try{return Me()}finally{Q=dt}},s.unstable_scheduleCallback=function(Pe,Me,dt){var Ti=s.unstable_now();switch(typeof dt=="object"&&dt!==null?(dt=dt.delay,dt=typeof dt=="number"&&0<dt?Ti+dt:Ti):dt=Ti,Pe){case 1:var Vi=-1;break;case 2:Vi=250;break;case 5:Vi=1073741823;break;case 4:Vi=1e4;break;default:Vi=5e3}return Vi=dt+Vi,Pe={id:$++,callback:Me,priorityLevel:Pe,startTime:dt,expirationTime:Vi,sortIndex:-1},dt>Ti?(Pe.sortIndex=dt,c(W,Pe),h(x)===null&&Pe===h(W)&&(te?(H(Ve),Ve=-1):te=!0,Gd(ge,dt-Ti))):(Pe.sortIndex=Vi,c(x,Pe),ce||Ee||(ce=!0,ur(Te))),Pe},s.unstable_shouldYield=dr,s.unstable_wrapCallback=function(Pe){var Me=Q;return function(){var dt=Q;Q=Me;try{return Pe.apply(this,arguments)}finally{Q=dt}}}})(d2);l2.exports=d2;var q7=l2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J7=we,An=q7;function Re(s){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+s,h=1;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+s+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u2=new Set,Mh={};function Wc(s,c){Pd(s,c),Pd(s+"Capture",c)}function Pd(s,c){for(Mh[s]=c,s=0;s<c.length;s++)u2.add(c[s])}var Ds=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),SR=Object.prototype.hasOwnProperty,X7=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,HM={},KM={};function Q7(s){return SR.call(KM,s)?!0:SR.call(HM,s)?!1:X7.test(s)?KM[s]=!0:(HM[s]=!0,!1)}function Z7(s,c,h,_){if(h!==null&&h.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function $7(s,c,h,_){if(c===null||typeof c>"u"||Z7(s,c,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function Kr(s,c,h,_,g,v,b){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=_,this.attributeNamespace=g,this.mustUseProperty=h,this.propertyName=s,this.type=c,this.sanitizeURL=v,this.removeEmptyString=b}var gr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){gr[s]=new Kr(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var c=s[0];gr[c]=new Kr(c,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){gr[s]=new Kr(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){gr[s]=new Kr(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){gr[s]=new Kr(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){gr[s]=new Kr(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){gr[s]=new Kr(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){gr[s]=new Kr(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){gr[s]=new Kr(s,5,!1,s.toLowerCase(),null,!1,!1)});var fC=/[\-:]([a-z])/g;function EC(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var c=s.replace(fC,EC);gr[c]=new Kr(c,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var c=s.replace(fC,EC);gr[c]=new Kr(c,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var c=s.replace(fC,EC);gr[c]=new Kr(c,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){gr[s]=new Kr(s,1,!1,s.toLowerCase(),null,!1,!1)});gr.xlinkHref=new Kr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){gr[s]=new Kr(s,1,!1,s.toLowerCase(),null,!0,!0)});function gC(s,c,h,_){var g=gr.hasOwnProperty(c)?gr[c]:null;(g!==null?g.type!==0:_||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&($7(c,h,g,_)&&(h=null),_||g===null?Q7(c)&&(h===null?s.removeAttribute(c):s.setAttribute(c,""+h)):g.mustUseProperty?s[g.propertyName]=h===null?g.type===3?!1:"":h:(c=g.attributeName,_=g.attributeNamespace,h===null?s.removeAttribute(c):(g=g.type,h=g===3||g===4&&h===!0?"":""+h,_?s.setAttributeNS(_,c,h):s.setAttribute(c,h))))}var Ms=J7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M_=Symbol.for("react.element"),md=Symbol.for("react.portal"),_d=Symbol.for("react.fragment"),SC=Symbol.for("react.strict_mode"),TR=Symbol.for("react.profiler"),h2=Symbol.for("react.provider"),p2=Symbol.for("react.context"),TC=Symbol.for("react.forward_ref"),vR=Symbol.for("react.suspense"),RR=Symbol.for("react.suspense_list"),vC=Symbol.for("react.memo"),ya=Symbol.for("react.lazy"),m2=Symbol.for("react.offscreen"),zM=Symbol.iterator;function hh(s){return s===null||typeof s!="object"?null:(s=zM&&s[zM]||s["@@iterator"],typeof s=="function"?s:null)}var Di=Object.assign,Yv;function Th(s){if(Yv===void 0)try{throw Error()}catch(h){var c=h.stack.trim().match(/\n( *(at )?)/);Yv=c&&c[1]||""}return`
`+Yv+s}var qv=!1;function Jv(s,c){if(!s||qv)return"";qv=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(W){var _=W}Reflect.construct(s,[],c)}else{try{c.call()}catch(W){_=W}s.call(c.prototype)}else{try{throw Error()}catch(W){_=W}s()}}catch(W){if(W&&_&&typeof W.stack=="string"){for(var g=W.stack.split(`
`),v=_.stack.split(`
`),b=g.length-1,L=v.length-1;1<=b&&0<=L&&g[b]!==v[L];)L--;for(;1<=b&&0<=L;b--,L--)if(g[b]!==v[L]){if(b!==1||L!==1)do if(b--,L--,0>L||g[b]!==v[L]){var x=`
`+g[b].replace(" at new "," at ");return s.displayName&&x.includes("<anonymous>")&&(x=x.replace("<anonymous>",s.displayName)),x}while(1<=b&&0<=L);break}}}finally{qv=!1,Error.prepareStackTrace=h}return(s=s?s.displayName||s.name:"")?Th(s):""}function eJ(s){switch(s.tag){case 5:return Th(s.type);case 16:return Th("Lazy");case 13:return Th("Suspense");case 19:return Th("SuspenseList");case 0:case 2:case 15:return s=Jv(s.type,!1),s;case 11:return s=Jv(s.type.render,!1),s;case 1:return s=Jv(s.type,!0),s;default:return""}}function CR(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case _d:return"Fragment";case md:return"Portal";case TR:return"Profiler";case SC:return"StrictMode";case vR:return"Suspense";case RR:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case p2:return(s.displayName||"Context")+".Consumer";case h2:return(s._context.displayName||"Context")+".Provider";case TC:var c=s.render;return s=s.displayName,s||(s=c.displayName||c.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case vC:return c=s.displayName||null,c!==null?c:CR(s.type)||"Memo";case ya:c=s._payload,s=s._init;try{return CR(s(c))}catch{}}return null}function tJ(s){var c=s.type;switch(s.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=c.render,s=s.displayName||s.name||"",c.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return CR(c);case 8:return c===SC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function Va(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function _2(s){var c=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function iJ(s){var c=_2(s)?"checked":"value",h=Object.getOwnPropertyDescriptor(s.constructor.prototype,c),_=""+s[c];if(!s.hasOwnProperty(c)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,v=h.set;return Object.defineProperty(s,c,{configurable:!0,get:function(){return g.call(this)},set:function(b){_=""+b,v.call(this,b)}}),Object.defineProperty(s,c,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(b){_=""+b},stopTracking:function(){s._valueTracker=null,delete s[c]}}}}function U_(s){s._valueTracker||(s._valueTracker=iJ(s))}function f2(s){if(!s)return!1;var c=s._valueTracker;if(!c)return!0;var h=c.getValue(),_="";return s&&(_=_2(s)?s.checked?"true":"false":s.value),s=_,s!==h?(c.setValue(s),!0):!1}function hf(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function yR(s,c){var h=c.checked;return Di({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??s._wrapperState.initialChecked})}function YM(s,c){var h=c.defaultValue==null?"":c.defaultValue,_=c.checked!=null?c.checked:c.defaultChecked;h=Va(c.value!=null?c.value:h),s._wrapperState={initialChecked:_,initialValue:h,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function E2(s,c){c=c.checked,c!=null&&gC(s,"checked",c,!1)}function IR(s,c){E2(s,c);var h=Va(c.value),_=c.type;if(h!=null)_==="number"?(h===0&&s.value===""||s.value!=h)&&(s.value=""+h):s.value!==""+h&&(s.value=""+h);else if(_==="submit"||_==="reset"){s.removeAttribute("value");return}c.hasOwnProperty("value")?wR(s,c.type,h):c.hasOwnProperty("defaultValue")&&wR(s,c.type,Va(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(s.defaultChecked=!!c.defaultChecked)}function qM(s,c,h){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var _=c.type;if(!(_!=="submit"&&_!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+s._wrapperState.initialValue,h||c===s.value||(s.value=c),s.defaultValue=c}h=s.name,h!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,h!==""&&(s.name=h)}function wR(s,c,h){(c!=="number"||hf(s.ownerDocument)!==s)&&(h==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+h&&(s.defaultValue=""+h))}var vh=Array.isArray;function wd(s,c,h,_){if(s=s.options,c){c={};for(var g=0;g<h.length;g++)c["$"+h[g]]=!0;for(h=0;h<s.length;h++)g=c.hasOwnProperty("$"+s[h].value),s[h].selected!==g&&(s[h].selected=g),g&&_&&(s[h].defaultSelected=!0)}else{for(h=""+Va(h),c=null,g=0;g<s.length;g++){if(s[g].value===h){s[g].selected=!0,_&&(s[g].defaultSelected=!0);return}c!==null||s[g].disabled||(c=s[g])}c!==null&&(c.selected=!0)}}function AR(s,c){if(c.dangerouslySetInnerHTML!=null)throw Error(Re(91));return Di({},c,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function JM(s,c){var h=c.value;if(h==null){if(h=c.children,c=c.defaultValue,h!=null){if(c!=null)throw Error(Re(92));if(vh(h)){if(1<h.length)throw Error(Re(93));h=h[0]}c=h}c==null&&(c=""),h=c}s._wrapperState={initialValue:Va(h)}}function g2(s,c){var h=Va(c.value),_=Va(c.defaultValue);h!=null&&(h=""+h,h!==s.value&&(s.value=h),c.defaultValue==null&&s.defaultValue!==h&&(s.defaultValue=h)),_!=null&&(s.defaultValue=""+_)}function XM(s){var c=s.textContent;c===s._wrapperState.initialValue&&c!==""&&c!==null&&(s.value=c)}function S2(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function OR(s,c){return s==null||s==="http://www.w3.org/1999/xhtml"?S2(c):s==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var x_,T2=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,h,_,g){MSApp.execUnsafeLocalFunction(function(){return s(c,h,_,g)})}:s}(function(s,c){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=c;else{for(x_=x_||document.createElement("div"),x_.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=x_.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;c.firstChild;)s.appendChild(c.firstChild)}});function Uh(s,c){if(c){var h=s.firstChild;if(h&&h===s.lastChild&&h.nodeType===3){h.nodeValue=c;return}}s.textContent=c}var wh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rJ=["Webkit","ms","Moz","O"];Object.keys(wh).forEach(function(s){rJ.forEach(function(c){c=c+s.charAt(0).toUpperCase()+s.substring(1),wh[c]=wh[s]})});function v2(s,c,h){return c==null||typeof c=="boolean"||c===""?"":h||typeof c!="number"||c===0||wh.hasOwnProperty(s)&&wh[s]?(""+c).trim():c+"px"}function R2(s,c){s=s.style;for(var h in c)if(c.hasOwnProperty(h)){var _=h.indexOf("--")===0,g=v2(h,c[h],_);h==="float"&&(h="cssFloat"),_?s.setProperty(h,g):s[h]=g}}var nJ=Di({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bR(s,c){if(c){if(nJ[s]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(Re(137,s));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(Re(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(Re(61))}if(c.style!=null&&typeof c.style!="object")throw Error(Re(62))}}function NR(s,c){if(s.indexOf("-")===-1)return typeof c.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DR=null;function RC(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var PR=null,Ad=null,Od=null;function QM(s){if(s=tp(s)){if(typeof PR!="function")throw Error(Re(280));var c=s.stateNode;c&&(c=Bf(c),PR(s.stateNode,s.type,c))}}function C2(s){Ad?Od?Od.push(s):Od=[s]:Ad=s}function y2(){if(Ad){var s=Ad,c=Od;if(Od=Ad=null,QM(s),c)for(s=0;s<c.length;s++)QM(c[s])}}function I2(s,c){return s(c)}function w2(){}var Xv=!1;function A2(s,c,h){if(Xv)return s(c,h);Xv=!0;try{return I2(s,c,h)}finally{Xv=!1,(Ad!==null||Od!==null)&&(w2(),y2())}}function xh(s,c){var h=s.stateNode;if(h===null)return null;var _=Bf(h);if(_===null)return null;h=_[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(s=s.type,_=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!_;break e;default:s=!1}if(s)return null;if(h&&typeof h!="function")throw Error(Re(231,c,typeof h));return h}var kR=!1;if(Ds)try{var ph={};Object.defineProperty(ph,"passive",{get:function(){kR=!0}}),window.addEventListener("test",ph,ph),window.removeEventListener("test",ph,ph)}catch{kR=!1}function oJ(s,c,h,_,g,v,b,L,x){var W=Array.prototype.slice.call(arguments,3);try{c.apply(h,W)}catch($){this.onError($)}}var Ah=!1,pf=null,mf=!1,LR=null,sJ={onError:function(s){Ah=!0,pf=s}};function aJ(s,c,h,_,g,v,b,L,x){Ah=!1,pf=null,oJ.apply(sJ,arguments)}function cJ(s,c,h,_,g,v,b,L,x){if(aJ.apply(this,arguments),Ah){if(Ah){var W=pf;Ah=!1,pf=null}else throw Error(Re(198));mf||(mf=!0,LR=W)}}function Hc(s){var c=s,h=s;if(s.alternate)for(;c.return;)c=c.return;else{s=c;do c=s,c.flags&4098&&(h=c.return),s=c.return;while(s)}return c.tag===3?h:null}function O2(s){if(s.tag===13){var c=s.memoizedState;if(c===null&&(s=s.alternate,s!==null&&(c=s.memoizedState)),c!==null)return c.dehydrated}return null}function ZM(s){if(Hc(s)!==s)throw Error(Re(188))}function lJ(s){var c=s.alternate;if(!c){if(c=Hc(s),c===null)throw Error(Re(188));return c!==s?null:s}for(var h=s,_=c;;){var g=h.return;if(g===null)break;var v=g.alternate;if(v===null){if(_=g.return,_!==null){h=_;continue}break}if(g.child===v.child){for(v=g.child;v;){if(v===h)return ZM(g),s;if(v===_)return ZM(g),c;v=v.sibling}throw Error(Re(188))}if(h.return!==_.return)h=g,_=v;else{for(var b=!1,L=g.child;L;){if(L===h){b=!0,h=g,_=v;break}if(L===_){b=!0,_=g,h=v;break}L=L.sibling}if(!b){for(L=v.child;L;){if(L===h){b=!0,h=v,_=g;break}if(L===_){b=!0,_=v,h=g;break}L=L.sibling}if(!b)throw Error(Re(189))}}if(h.alternate!==_)throw Error(Re(190))}if(h.tag!==3)throw Error(Re(188));return h.stateNode.current===h?s:c}function b2(s){return s=lJ(s),s!==null?N2(s):null}function N2(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var c=N2(s);if(c!==null)return c;s=s.sibling}return null}var D2=An.unstable_scheduleCallback,$M=An.unstable_cancelCallback,dJ=An.unstable_shouldYield,uJ=An.unstable_requestPaint,Wi=An.unstable_now,hJ=An.unstable_getCurrentPriorityLevel,CC=An.unstable_ImmediatePriority,P2=An.unstable_UserBlockingPriority,_f=An.unstable_NormalPriority,pJ=An.unstable_LowPriority,k2=An.unstable_IdlePriority,xf=null,ss=null;function mJ(s){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(xf,s,void 0,(s.current.flags&128)===128)}catch{}}var Oo=Math.clz32?Math.clz32:EJ,_J=Math.log,fJ=Math.LN2;function EJ(s){return s>>>=0,s===0?32:31-(_J(s)/fJ|0)|0}var V_=64,F_=4194304;function Rh(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function ff(s,c){var h=s.pendingLanes;if(h===0)return 0;var _=0,g=s.suspendedLanes,v=s.pingedLanes,b=h&268435455;if(b!==0){var L=b&~g;L!==0?_=Rh(L):(v&=b,v!==0&&(_=Rh(v)))}else b=h&~g,b!==0?_=Rh(b):v!==0&&(_=Rh(v));if(_===0)return 0;if(c!==0&&c!==_&&!(c&g)&&(g=_&-_,v=c&-c,g>=v||g===16&&(v&4194240)!==0))return c;if(_&4&&(_|=h&16),c=s.entangledLanes,c!==0)for(s=s.entanglements,c&=_;0<c;)h=31-Oo(c),g=1<<h,_|=s[h],c&=~g;return _}function gJ(s,c){switch(s){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function SJ(s,c){for(var h=s.suspendedLanes,_=s.pingedLanes,g=s.expirationTimes,v=s.pendingLanes;0<v;){var b=31-Oo(v),L=1<<b,x=g[b];x===-1?(!(L&h)||L&_)&&(g[b]=gJ(L,c)):x<=c&&(s.expiredLanes|=L),v&=~L}}function MR(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function L2(){var s=V_;return V_<<=1,!(V_&4194240)&&(V_=64),s}function Qv(s){for(var c=[],h=0;31>h;h++)c.push(s);return c}function $h(s,c,h){s.pendingLanes|=c,c!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,c=31-Oo(c),s[c]=h}function TJ(s,c){var h=s.pendingLanes&~c;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=c,s.mutableReadLanes&=c,s.entangledLanes&=c,c=s.entanglements;var _=s.eventTimes;for(s=s.expirationTimes;0<h;){var g=31-Oo(h),v=1<<g;c[g]=0,_[g]=-1,s[g]=-1,h&=~v}}function yC(s,c){var h=s.entangledLanes|=c;for(s=s.entanglements;h;){var _=31-Oo(h),g=1<<_;g&c|s[_]&c&&(s[_]|=c),h&=~g}}var ei=0;function M2(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var U2,IC,x2,V2,F2,UR=!1,j_=[],Na=null,Da=null,Pa=null,Vh=new Map,Fh=new Map,wa=[],vJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eU(s,c){switch(s){case"focusin":case"focusout":Na=null;break;case"dragenter":case"dragleave":Da=null;break;case"mouseover":case"mouseout":Pa=null;break;case"pointerover":case"pointerout":Vh.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fh.delete(c.pointerId)}}function mh(s,c,h,_,g,v){return s===null||s.nativeEvent!==v?(s={blockedOn:c,domEventName:h,eventSystemFlags:_,nativeEvent:v,targetContainers:[g]},c!==null&&(c=tp(c),c!==null&&IC(c)),s):(s.eventSystemFlags|=_,c=s.targetContainers,g!==null&&c.indexOf(g)===-1&&c.push(g),s)}function RJ(s,c,h,_,g){switch(c){case"focusin":return Na=mh(Na,s,c,h,_,g),!0;case"dragenter":return Da=mh(Da,s,c,h,_,g),!0;case"mouseover":return Pa=mh(Pa,s,c,h,_,g),!0;case"pointerover":var v=g.pointerId;return Vh.set(v,mh(Vh.get(v)||null,s,c,h,_,g)),!0;case"gotpointercapture":return v=g.pointerId,Fh.set(v,mh(Fh.get(v)||null,s,c,h,_,g)),!0}return!1}function j2(s){var c=kc(s.target);if(c!==null){var h=Hc(c);if(h!==null){if(c=h.tag,c===13){if(c=O2(h),c!==null){s.blockedOn=c,F2(s.priority,function(){x2(h)});return}}else if(c===3&&h.stateNode.current.memoizedState.isDehydrated){s.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}s.blockedOn=null}function $_(s){if(s.blockedOn!==null)return!1;for(var c=s.targetContainers;0<c.length;){var h=xR(s.domEventName,s.eventSystemFlags,c[0],s.nativeEvent);if(h===null){h=s.nativeEvent;var _=new h.constructor(h.type,h);DR=_,h.target.dispatchEvent(_),DR=null}else return c=tp(h),c!==null&&IC(c),s.blockedOn=h,!1;c.shift()}return!0}function tU(s,c,h){$_(s)&&h.delete(c)}function CJ(){UR=!1,Na!==null&&$_(Na)&&(Na=null),Da!==null&&$_(Da)&&(Da=null),Pa!==null&&$_(Pa)&&(Pa=null),Vh.forEach(tU),Fh.forEach(tU)}function _h(s,c){s.blockedOn===c&&(s.blockedOn=null,UR||(UR=!0,An.unstable_scheduleCallback(An.unstable_NormalPriority,CJ)))}function jh(s){function c(g){return _h(g,s)}if(0<j_.length){_h(j_[0],s);for(var h=1;h<j_.length;h++){var _=j_[h];_.blockedOn===s&&(_.blockedOn=null)}}for(Na!==null&&_h(Na,s),Da!==null&&_h(Da,s),Pa!==null&&_h(Pa,s),Vh.forEach(c),Fh.forEach(c),h=0;h<wa.length;h++)_=wa[h],_.blockedOn===s&&(_.blockedOn=null);for(;0<wa.length&&(h=wa[0],h.blockedOn===null);)j2(h),h.blockedOn===null&&wa.shift()}var bd=Ms.ReactCurrentBatchConfig,Ef=!0;function yJ(s,c,h,_){var g=ei,v=bd.transition;bd.transition=null;try{ei=1,wC(s,c,h,_)}finally{ei=g,bd.transition=v}}function IJ(s,c,h,_){var g=ei,v=bd.transition;bd.transition=null;try{ei=4,wC(s,c,h,_)}finally{ei=g,bd.transition=v}}function wC(s,c,h,_){if(Ef){var g=xR(s,c,h,_);if(g===null)aR(s,c,_,gf,h),eU(s,_);else if(RJ(g,s,c,h,_))_.stopPropagation();else if(eU(s,_),c&4&&-1<vJ.indexOf(s)){for(;g!==null;){var v=tp(g);if(v!==null&&U2(v),v=xR(s,c,h,_),v===null&&aR(s,c,_,gf,h),v===g)break;g=v}g!==null&&_.stopPropagation()}else aR(s,c,_,null,h)}}var gf=null;function xR(s,c,h,_){if(gf=null,s=RC(_),s=kc(s),s!==null)if(c=Hc(s),c===null)s=null;else if(h=c.tag,h===13){if(s=O2(c),s!==null)return s;s=null}else if(h===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;s=null}else c!==s&&(s=null);return gf=s,null}function B2(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hJ()){case CC:return 1;case P2:return 4;case _f:case pJ:return 16;case k2:return 536870912;default:return 16}default:return 16}}var Oa=null,AC=null,ef=null;function G2(){if(ef)return ef;var s,c=AC,h=c.length,_,g="value"in Oa?Oa.value:Oa.textContent,v=g.length;for(s=0;s<h&&c[s]===g[s];s++);var b=h-s;for(_=1;_<=b&&c[h-_]===g[v-_];_++);return ef=g.slice(s,1<_?1-_:void 0)}function tf(s){var c=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&c===13&&(s=13)):s=c,s===10&&(s=13),32<=s||s===13?s:0}function B_(){return!0}function iU(){return!1}function bn(s){function c(h,_,g,v,b){this._reactName=h,this._targetInst=g,this.type=_,this.nativeEvent=v,this.target=b,this.currentTarget=null;for(var L in s)s.hasOwnProperty(L)&&(h=s[L],this[L]=h?h(v):v[L]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?B_:iU,this.isPropagationStopped=iU,this}return Di(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=B_)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=B_)},persist:function(){},isPersistent:B_}),c}var jd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},OC=bn(jd),ep=Di({},jd,{view:0,detail:0}),wJ=bn(ep),Zv,$v,fh,Vf=Di({},ep,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bC,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==fh&&(fh&&s.type==="mousemove"?(Zv=s.screenX-fh.screenX,$v=s.screenY-fh.screenY):$v=Zv=0,fh=s),Zv)},movementY:function(s){return"movementY"in s?s.movementY:$v}}),rU=bn(Vf),AJ=Di({},Vf,{dataTransfer:0}),OJ=bn(AJ),bJ=Di({},ep,{relatedTarget:0}),eR=bn(bJ),NJ=Di({},jd,{animationName:0,elapsedTime:0,pseudoElement:0}),DJ=bn(NJ),PJ=Di({},jd,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),kJ=bn(PJ),LJ=Di({},jd,{data:0}),nU=bn(LJ),MJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VJ(s){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(s):(s=xJ[s])?!!c[s]:!1}function bC(){return VJ}var FJ=Di({},ep,{key:function(s){if(s.key){var c=MJ[s.key]||s.key;if(c!=="Unidentified")return c}return s.type==="keypress"?(s=tf(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?UJ[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bC,charCode:function(s){return s.type==="keypress"?tf(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?tf(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),jJ=bn(FJ),BJ=Di({},Vf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oU=bn(BJ),GJ=Di({},ep,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bC}),WJ=bn(GJ),HJ=Di({},jd,{propertyName:0,elapsedTime:0,pseudoElement:0}),KJ=bn(HJ),zJ=Di({},Vf,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),YJ=bn(zJ),qJ=[9,13,27,32],NC=Ds&&"CompositionEvent"in window,Oh=null;Ds&&"documentMode"in document&&(Oh=document.documentMode);var JJ=Ds&&"TextEvent"in window&&!Oh,W2=Ds&&(!NC||Oh&&8<Oh&&11>=Oh),sU=String.fromCharCode(32),aU=!1;function H2(s,c){switch(s){case"keyup":return qJ.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function K2(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var fd=!1;function XJ(s,c){switch(s){case"compositionend":return K2(c);case"keypress":return c.which!==32?null:(aU=!0,sU);case"textInput":return s=c.data,s===sU&&aU?null:s;default:return null}}function QJ(s,c){if(fd)return s==="compositionend"||!NC&&H2(s,c)?(s=G2(),ef=AC=Oa=null,fd=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return W2&&c.locale!=="ko"?null:c.data;default:return null}}var ZJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cU(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c==="input"?!!ZJ[s.type]:c==="textarea"}function z2(s,c,h,_){C2(_),c=Sf(c,"onChange"),0<c.length&&(h=new OC("onChange","change",null,h,_),s.push({event:h,listeners:c}))}var bh=null,Bh=null;function $J(s){rx(s,0)}function Ff(s){var c=Sd(s);if(f2(c))return s}function eX(s,c){if(s==="change")return c}var Y2=!1;if(Ds){var tR;if(Ds){var iR="oninput"in document;if(!iR){var lU=document.createElement("div");lU.setAttribute("oninput","return;"),iR=typeof lU.oninput=="function"}tR=iR}else tR=!1;Y2=tR&&(!document.documentMode||9<document.documentMode)}function dU(){bh&&(bh.detachEvent("onpropertychange",q2),Bh=bh=null)}function q2(s){if(s.propertyName==="value"&&Ff(Bh)){var c=[];z2(c,Bh,s,RC(s)),A2($J,c)}}function tX(s,c,h){s==="focusin"?(dU(),bh=c,Bh=h,bh.attachEvent("onpropertychange",q2)):s==="focusout"&&dU()}function iX(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Ff(Bh)}function rX(s,c){if(s==="click")return Ff(c)}function nX(s,c){if(s==="input"||s==="change")return Ff(c)}function oX(s,c){return s===c&&(s!==0||1/s===1/c)||s!==s&&c!==c}var No=typeof Object.is=="function"?Object.is:oX;function Gh(s,c){if(No(s,c))return!0;if(typeof s!="object"||s===null||typeof c!="object"||c===null)return!1;var h=Object.keys(s),_=Object.keys(c);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var g=h[_];if(!SR.call(c,g)||!No(s[g],c[g]))return!1}return!0}function uU(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function hU(s,c){var h=uU(s);s=0;for(var _;h;){if(h.nodeType===3){if(_=s+h.textContent.length,s<=c&&_>=c)return{node:h,offset:c-s};s=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=uU(h)}}function J2(s,c){return s&&c?s===c?!0:s&&s.nodeType===3?!1:c&&c.nodeType===3?J2(s,c.parentNode):"contains"in s?s.contains(c):s.compareDocumentPosition?!!(s.compareDocumentPosition(c)&16):!1:!1}function X2(){for(var s=window,c=hf();c instanceof s.HTMLIFrameElement;){try{var h=typeof c.contentWindow.location.href=="string"}catch{h=!1}if(h)s=c.contentWindow;else break;c=hf(s.document)}return c}function DC(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c&&(c==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||c==="textarea"||s.contentEditable==="true")}function sX(s){var c=X2(),h=s.focusedElem,_=s.selectionRange;if(c!==h&&h&&h.ownerDocument&&J2(h.ownerDocument.documentElement,h)){if(_!==null&&DC(h)){if(c=_.start,s=_.end,s===void 0&&(s=c),"selectionStart"in h)h.selectionStart=c,h.selectionEnd=Math.min(s,h.value.length);else if(s=(c=h.ownerDocument||document)&&c.defaultView||window,s.getSelection){s=s.getSelection();var g=h.textContent.length,v=Math.min(_.start,g);_=_.end===void 0?v:Math.min(_.end,g),!s.extend&&v>_&&(g=_,_=v,v=g),g=hU(h,v);var b=hU(h,_);g&&b&&(s.rangeCount!==1||s.anchorNode!==g.node||s.anchorOffset!==g.offset||s.focusNode!==b.node||s.focusOffset!==b.offset)&&(c=c.createRange(),c.setStart(g.node,g.offset),s.removeAllRanges(),v>_?(s.addRange(c),s.extend(b.node,b.offset)):(c.setEnd(b.node,b.offset),s.addRange(c)))}}for(c=[],s=h;s=s.parentNode;)s.nodeType===1&&c.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<c.length;h++)s=c[h],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var aX=Ds&&"documentMode"in document&&11>=document.documentMode,Ed=null,VR=null,Nh=null,FR=!1;function pU(s,c,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;FR||Ed==null||Ed!==hf(_)||(_=Ed,"selectionStart"in _&&DC(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Nh&&Gh(Nh,_)||(Nh=_,_=Sf(VR,"onSelect"),0<_.length&&(c=new OC("onSelect","select",null,c,h),s.push({event:c,listeners:_}),c.target=Ed)))}function G_(s,c){var h={};return h[s.toLowerCase()]=c.toLowerCase(),h["Webkit"+s]="webkit"+c,h["Moz"+s]="moz"+c,h}var gd={animationend:G_("Animation","AnimationEnd"),animationiteration:G_("Animation","AnimationIteration"),animationstart:G_("Animation","AnimationStart"),transitionend:G_("Transition","TransitionEnd")},rR={},Q2={};Ds&&(Q2=document.createElement("div").style,"AnimationEvent"in window||(delete gd.animationend.animation,delete gd.animationiteration.animation,delete gd.animationstart.animation),"TransitionEvent"in window||delete gd.transitionend.transition);function jf(s){if(rR[s])return rR[s];if(!gd[s])return s;var c=gd[s],h;for(h in c)if(c.hasOwnProperty(h)&&h in Q2)return rR[s]=c[h];return s}var Z2=jf("animationend"),$2=jf("animationiteration"),ex=jf("animationstart"),tx=jf("transitionend"),ix=new Map,mU="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ja(s,c){ix.set(s,c),Wc(c,[s])}for(var nR=0;nR<mU.length;nR++){var oR=mU[nR],cX=oR.toLowerCase(),lX=oR[0].toUpperCase()+oR.slice(1);ja(cX,"on"+lX)}ja(Z2,"onAnimationEnd");ja($2,"onAnimationIteration");ja(ex,"onAnimationStart");ja("dblclick","onDoubleClick");ja("focusin","onFocus");ja("focusout","onBlur");ja(tx,"onTransitionEnd");Pd("onMouseEnter",["mouseout","mouseover"]);Pd("onMouseLeave",["mouseout","mouseover"]);Pd("onPointerEnter",["pointerout","pointerover"]);Pd("onPointerLeave",["pointerout","pointerover"]);Wc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dX=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ch));function _U(s,c,h){var _=s.type||"unknown-event";s.currentTarget=h,cJ(_,c,void 0,s),s.currentTarget=null}function rx(s,c){c=(c&4)!==0;for(var h=0;h<s.length;h++){var _=s[h],g=_.event;_=_.listeners;e:{var v=void 0;if(c)for(var b=_.length-1;0<=b;b--){var L=_[b],x=L.instance,W=L.currentTarget;if(L=L.listener,x!==v&&g.isPropagationStopped())break e;_U(g,L,W),v=x}else for(b=0;b<_.length;b++){if(L=_[b],x=L.instance,W=L.currentTarget,L=L.listener,x!==v&&g.isPropagationStopped())break e;_U(g,L,W),v=x}}}if(mf)throw s=LR,mf=!1,LR=null,s}function gi(s,c){var h=c[HR];h===void 0&&(h=c[HR]=new Set);var _=s+"__bubble";h.has(_)||(nx(c,s,2,!1),h.add(_))}function sR(s,c,h){var _=0;c&&(_|=4),nx(h,s,_,c)}var W_="_reactListening"+Math.random().toString(36).slice(2);function Wh(s){if(!s[W_]){s[W_]=!0,u2.forEach(function(h){h!=="selectionchange"&&(dX.has(h)||sR(h,!1,s),sR(h,!0,s))});var c=s.nodeType===9?s:s.ownerDocument;c===null||c[W_]||(c[W_]=!0,sR("selectionchange",!1,c))}}function nx(s,c,h,_){switch(B2(c)){case 1:var g=yJ;break;case 4:g=IJ;break;default:g=wC}h=g.bind(null,c,h,s),g=void 0,!kR||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(g=!0),_?g!==void 0?s.addEventListener(c,h,{capture:!0,passive:g}):s.addEventListener(c,h,!0):g!==void 0?s.addEventListener(c,h,{passive:g}):s.addEventListener(c,h,!1)}function aR(s,c,h,_,g){var v=_;if(!(c&1)&&!(c&2)&&_!==null)e:for(;;){if(_===null)return;var b=_.tag;if(b===3||b===4){var L=_.stateNode.containerInfo;if(L===g||L.nodeType===8&&L.parentNode===g)break;if(b===4)for(b=_.return;b!==null;){var x=b.tag;if((x===3||x===4)&&(x=b.stateNode.containerInfo,x===g||x.nodeType===8&&x.parentNode===g))return;b=b.return}for(;L!==null;){if(b=kc(L),b===null)return;if(x=b.tag,x===5||x===6){_=v=b;continue e}L=L.parentNode}}_=_.return}A2(function(){var W=v,$=RC(h),K=[];e:{var Q=ix.get(s);if(Q!==void 0){var Ee=OC,ce=s;switch(s){case"keypress":if(tf(h)===0)break e;case"keydown":case"keyup":Ee=jJ;break;case"focusin":ce="focus",Ee=eR;break;case"focusout":ce="blur",Ee=eR;break;case"beforeblur":case"afterblur":Ee=eR;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=rU;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=OJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=WJ;break;case Z2:case $2:case ex:Ee=DJ;break;case tx:Ee=KJ;break;case"scroll":Ee=wJ;break;case"wheel":Ee=YJ;break;case"copy":case"cut":case"paste":Ee=kJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=oU}var te=(c&4)!==0,ve=!te&&s==="scroll",H=te?Q!==null?Q+"Capture":null:Q;te=[];for(var j=W,Y;j!==null;){Y=j;var ge=Y.stateNode;if(Y.tag===5&&ge!==null&&(Y=ge,H!==null&&(ge=xh(j,H),ge!=null&&te.push(Hh(j,ge,Y)))),ve)break;j=j.return}0<te.length&&(Q=new Ee(Q,ce,null,h,$),K.push({event:Q,listeners:te}))}}if(!(c&7)){e:{if(Q=s==="mouseover"||s==="pointerover",Ee=s==="mouseout"||s==="pointerout",Q&&h!==DR&&(ce=h.relatedTarget||h.fromElement)&&(kc(ce)||ce[Ps]))break e;if((Ee||Q)&&(Q=$.window===$?$:(Q=$.ownerDocument)?Q.defaultView||Q.parentWindow:window,Ee?(ce=h.relatedTarget||h.toElement,Ee=W,ce=ce?kc(ce):null,ce!==null&&(ve=Hc(ce),ce!==ve||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(Ee=null,ce=W),Ee!==ce)){if(te=rU,ge="onMouseLeave",H="onMouseEnter",j="mouse",(s==="pointerout"||s==="pointerover")&&(te=oU,ge="onPointerLeave",H="onPointerEnter",j="pointer"),ve=Ee==null?Q:Sd(Ee),Y=ce==null?Q:Sd(ce),Q=new te(ge,j+"leave",Ee,h,$),Q.target=ve,Q.relatedTarget=Y,ge=null,kc($)===W&&(te=new te(H,j+"enter",ce,h,$),te.target=Y,te.relatedTarget=ve,ge=te),ve=ge,Ee&&ce)t:{for(te=Ee,H=ce,j=0,Y=te;Y;Y=hd(Y))j++;for(Y=0,ge=H;ge;ge=hd(ge))Y++;for(;0<j-Y;)te=hd(te),j--;for(;0<Y-j;)H=hd(H),Y--;for(;j--;){if(te===H||H!==null&&te===H.alternate)break t;te=hd(te),H=hd(H)}te=null}else te=null;Ee!==null&&fU(K,Q,Ee,te,!1),ce!==null&&ve!==null&&fU(K,ve,ce,te,!0)}}e:{if(Q=W?Sd(W):window,Ee=Q.nodeName&&Q.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&Q.type==="file")var Te=eX;else if(cU(Q))if(Y2)Te=nX;else{Te=iX;var be=tX}else(Ee=Q.nodeName)&&Ee.toLowerCase()==="input"&&(Q.type==="checkbox"||Q.type==="radio")&&(Te=rX);if(Te&&(Te=Te(s,W))){z2(K,Te,h,$);break e}be&&be(s,Q,W),s==="focusout"&&(be=Q._wrapperState)&&be.controlled&&Q.type==="number"&&wR(Q,"number",Q.value)}switch(be=W?Sd(W):window,s){case"focusin":(cU(be)||be.contentEditable==="true")&&(Ed=be,VR=W,Nh=null);break;case"focusout":Nh=VR=Ed=null;break;case"mousedown":FR=!0;break;case"contextmenu":case"mouseup":case"dragend":FR=!1,pU(K,h,$);break;case"selectionchange":if(aX)break;case"keydown":case"keyup":pU(K,h,$)}var Ae;if(NC)e:{switch(s){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else fd?H2(s,h)&&(Ve="onCompositionEnd"):s==="keydown"&&h.keyCode===229&&(Ve="onCompositionStart");Ve&&(W2&&h.locale!=="ko"&&(fd||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&fd&&(Ae=G2()):(Oa=$,AC="value"in Oa?Oa.value:Oa.textContent,fd=!0)),be=Sf(W,Ve),0<be.length&&(Ve=new nU(Ve,s,null,h,$),K.push({event:Ve,listeners:be}),Ae?Ve.data=Ae:(Ae=K2(h),Ae!==null&&(Ve.data=Ae)))),(Ae=JJ?XJ(s,h):QJ(s,h))&&(W=Sf(W,"onBeforeInput"),0<W.length&&($=new nU("onBeforeInput","beforeinput",null,h,$),K.push({event:$,listeners:W}),$.data=Ae))}rx(K,c)})}function Hh(s,c,h){return{instance:s,listener:c,currentTarget:h}}function Sf(s,c){for(var h=c+"Capture",_=[];s!==null;){var g=s,v=g.stateNode;g.tag===5&&v!==null&&(g=v,v=xh(s,h),v!=null&&_.unshift(Hh(s,v,g)),v=xh(s,c),v!=null&&_.push(Hh(s,v,g))),s=s.return}return _}function hd(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function fU(s,c,h,_,g){for(var v=c._reactName,b=[];h!==null&&h!==_;){var L=h,x=L.alternate,W=L.stateNode;if(x!==null&&x===_)break;L.tag===5&&W!==null&&(L=W,g?(x=xh(h,v),x!=null&&b.unshift(Hh(h,x,L))):g||(x=xh(h,v),x!=null&&b.push(Hh(h,x,L)))),h=h.return}b.length!==0&&s.push({event:c,listeners:b})}var uX=/\r\n?/g,hX=/\u0000|\uFFFD/g;function EU(s){return(typeof s=="string"?s:""+s).replace(uX,`
`).replace(hX,"")}function H_(s,c,h){if(c=EU(c),EU(s)!==c&&h)throw Error(Re(425))}function Tf(){}var jR=null,BR=null;function GR(s,c){return s==="textarea"||s==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var WR=typeof setTimeout=="function"?setTimeout:void 0,pX=typeof clearTimeout=="function"?clearTimeout:void 0,gU=typeof Promise=="function"?Promise:void 0,mX=typeof queueMicrotask=="function"?queueMicrotask:typeof gU<"u"?function(s){return gU.resolve(null).then(s).catch(_X)}:WR;function _X(s){setTimeout(function(){throw s})}function cR(s,c){var h=c,_=0;do{var g=h.nextSibling;if(s.removeChild(h),g&&g.nodeType===8)if(h=g.data,h==="/$"){if(_===0){s.removeChild(g),jh(c);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=g}while(h);jh(c)}function ka(s){for(;s!=null;s=s.nextSibling){var c=s.nodeType;if(c===1||c===3)break;if(c===8){if(c=s.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return s}function SU(s){s=s.previousSibling;for(var c=0;s;){if(s.nodeType===8){var h=s.data;if(h==="$"||h==="$!"||h==="$?"){if(c===0)return s;c--}else h==="/$"&&c++}s=s.previousSibling}return null}var Bd=Math.random().toString(36).slice(2),os="__reactFiber$"+Bd,Kh="__reactProps$"+Bd,Ps="__reactContainer$"+Bd,HR="__reactEvents$"+Bd,fX="__reactListeners$"+Bd,EX="__reactHandles$"+Bd;function kc(s){var c=s[os];if(c)return c;for(var h=s.parentNode;h;){if(c=h[Ps]||h[os]){if(h=c.alternate,c.child!==null||h!==null&&h.child!==null)for(s=SU(s);s!==null;){if(h=s[os])return h;s=SU(s)}return c}s=h,h=s.parentNode}return null}function tp(s){return s=s[os]||s[Ps],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Sd(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(Re(33))}function Bf(s){return s[Kh]||null}var KR=[],Td=-1;function Ba(s){return{current:s}}function Si(s){0>Td||(s.current=KR[Td],KR[Td]=null,Td--)}function ui(s,c){Td++,KR[Td]=s.current,s.current=c}var Fa={},kr=Ba(Fa),ln=Ba(!1),Vc=Fa;function kd(s,c){var h=s.type.contextTypes;if(!h)return Fa;var _=s.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===c)return _.__reactInternalMemoizedMaskedChildContext;var g={},v;for(v in h)g[v]=c[v];return _&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=c,s.__reactInternalMemoizedMaskedChildContext=g),g}function dn(s){return s=s.childContextTypes,s!=null}function vf(){Si(ln),Si(kr)}function TU(s,c,h){if(kr.current!==Fa)throw Error(Re(168));ui(kr,c),ui(ln,h)}function ox(s,c,h){var _=s.stateNode;if(c=c.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var g in _)if(!(g in c))throw Error(Re(108,tJ(s)||"Unknown",g));return Di({},h,_)}function Rf(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Fa,Vc=kr.current,ui(kr,s),ui(ln,ln.current),!0}function vU(s,c,h){var _=s.stateNode;if(!_)throw Error(Re(169));h?(s=ox(s,c,Vc),_.__reactInternalMemoizedMergedChildContext=s,Si(ln),Si(kr),ui(kr,s)):Si(ln),ui(ln,h)}var As=null,Gf=!1,lR=!1;function sx(s){As===null?As=[s]:As.push(s)}function gX(s){Gf=!0,sx(s)}function Ga(){if(!lR&&As!==null){lR=!0;var s=0,c=ei;try{var h=As;for(ei=1;s<h.length;s++){var _=h[s];do _=_(!0);while(_!==null)}As=null,Gf=!1}catch(g){throw As!==null&&(As=As.slice(s+1)),D2(CC,Ga),g}finally{ei=c,lR=!1}}return null}var vd=[],Rd=0,Cf=null,yf=0,eo=[],to=0,Fc=null,Os=1,bs="";function Dc(s,c){vd[Rd++]=yf,vd[Rd++]=Cf,Cf=s,yf=c}function ax(s,c,h){eo[to++]=Os,eo[to++]=bs,eo[to++]=Fc,Fc=s;var _=Os;s=bs;var g=32-Oo(_)-1;_&=~(1<<g),h+=1;var v=32-Oo(c)+g;if(30<v){var b=g-g%5;v=(_&(1<<b)-1).toString(32),_>>=b,g-=b,Os=1<<32-Oo(c)+g|h<<g|_,bs=v+s}else Os=1<<v|h<<g|_,bs=s}function PC(s){s.return!==null&&(Dc(s,1),ax(s,1,0))}function kC(s){for(;s===Cf;)Cf=vd[--Rd],vd[Rd]=null,yf=vd[--Rd],vd[Rd]=null;for(;s===Fc;)Fc=eo[--to],eo[to]=null,bs=eo[--to],eo[to]=null,Os=eo[--to],eo[to]=null}var wn=null,In=null,wi=!1,Ao=null;function cx(s,c){var h=io(5,null,null,0);h.elementType="DELETED",h.stateNode=c,h.return=s,c=s.deletions,c===null?(s.deletions=[h],s.flags|=16):c.push(h)}function RU(s,c){switch(s.tag){case 5:var h=s.type;return c=c.nodeType!==1||h.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(s.stateNode=c,wn=s,In=ka(c.firstChild),!0):!1;case 6:return c=s.pendingProps===""||c.nodeType!==3?null:c,c!==null?(s.stateNode=c,wn=s,In=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(h=Fc!==null?{id:Os,overflow:bs}:null,s.memoizedState={dehydrated:c,treeContext:h,retryLane:1073741824},h=io(18,null,null,0),h.stateNode=c,h.return=s,s.child=h,wn=s,In=null,!0):!1;default:return!1}}function zR(s){return(s.mode&1)!==0&&(s.flags&128)===0}function YR(s){if(wi){var c=In;if(c){var h=c;if(!RU(s,c)){if(zR(s))throw Error(Re(418));c=ka(h.nextSibling);var _=wn;c&&RU(s,c)?cx(_,h):(s.flags=s.flags&-4097|2,wi=!1,wn=s)}}else{if(zR(s))throw Error(Re(418));s.flags=s.flags&-4097|2,wi=!1,wn=s}}}function CU(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;wn=s}function K_(s){if(s!==wn)return!1;if(!wi)return CU(s),wi=!0,!1;var c;if((c=s.tag!==3)&&!(c=s.tag!==5)&&(c=s.type,c=c!=="head"&&c!=="body"&&!GR(s.type,s.memoizedProps)),c&&(c=In)){if(zR(s))throw lx(),Error(Re(418));for(;c;)cx(s,c),c=ka(c.nextSibling)}if(CU(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Re(317));e:{for(s=s.nextSibling,c=0;s;){if(s.nodeType===8){var h=s.data;if(h==="/$"){if(c===0){In=ka(s.nextSibling);break e}c--}else h!=="$"&&h!=="$!"&&h!=="$?"||c++}s=s.nextSibling}In=null}}else In=wn?ka(s.stateNode.nextSibling):null;return!0}function lx(){for(var s=In;s;)s=ka(s.nextSibling)}function Ld(){In=wn=null,wi=!1}function LC(s){Ao===null?Ao=[s]:Ao.push(s)}var SX=Ms.ReactCurrentBatchConfig;function Eh(s,c,h){if(s=h.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Re(309));var _=h.stateNode}if(!_)throw Error(Re(147,s));var g=_,v=""+s;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===v?c.ref:(c=function(b){var L=g.refs;b===null?delete L[v]:L[v]=b},c._stringRef=v,c)}if(typeof s!="string")throw Error(Re(284));if(!h._owner)throw Error(Re(290,s))}return s}function z_(s,c){throw s=Object.prototype.toString.call(c),Error(Re(31,s==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":s))}function yU(s){var c=s._init;return c(s._payload)}function dx(s){function c(H,j){if(s){var Y=H.deletions;Y===null?(H.deletions=[j],H.flags|=16):Y.push(j)}}function h(H,j){if(!s)return null;for(;j!==null;)c(H,j),j=j.sibling;return null}function _(H,j){for(H=new Map;j!==null;)j.key!==null?H.set(j.key,j):H.set(j.index,j),j=j.sibling;return H}function g(H,j){return H=xa(H,j),H.index=0,H.sibling=null,H}function v(H,j,Y){return H.index=Y,s?(Y=H.alternate,Y!==null?(Y=Y.index,Y<j?(H.flags|=2,j):Y):(H.flags|=2,j)):(H.flags|=1048576,j)}function b(H){return s&&H.alternate===null&&(H.flags|=2),H}function L(H,j,Y,ge){return j===null||j.tag!==6?(j=fR(Y,H.mode,ge),j.return=H,j):(j=g(j,Y),j.return=H,j)}function x(H,j,Y,ge){var Te=Y.type;return Te===_d?$(H,j,Y.props.children,ge,Y.key):j!==null&&(j.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===ya&&yU(Te)===j.type)?(ge=g(j,Y.props),ge.ref=Eh(H,j,Y),ge.return=H,ge):(ge=lf(Y.type,Y.key,Y.props,null,H.mode,ge),ge.ref=Eh(H,j,Y),ge.return=H,ge)}function W(H,j,Y,ge){return j===null||j.tag!==4||j.stateNode.containerInfo!==Y.containerInfo||j.stateNode.implementation!==Y.implementation?(j=ER(Y,H.mode,ge),j.return=H,j):(j=g(j,Y.children||[]),j.return=H,j)}function $(H,j,Y,ge,Te){return j===null||j.tag!==7?(j=xc(Y,H.mode,ge,Te),j.return=H,j):(j=g(j,Y),j.return=H,j)}function K(H,j,Y){if(typeof j=="string"&&j!==""||typeof j=="number")return j=fR(""+j,H.mode,Y),j.return=H,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case M_:return Y=lf(j.type,j.key,j.props,null,H.mode,Y),Y.ref=Eh(H,null,j),Y.return=H,Y;case md:return j=ER(j,H.mode,Y),j.return=H,j;case ya:var ge=j._init;return K(H,ge(j._payload),Y)}if(vh(j)||hh(j))return j=xc(j,H.mode,Y,null),j.return=H,j;z_(H,j)}return null}function Q(H,j,Y,ge){var Te=j!==null?j.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Te!==null?null:L(H,j,""+Y,ge);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case M_:return Y.key===Te?x(H,j,Y,ge):null;case md:return Y.key===Te?W(H,j,Y,ge):null;case ya:return Te=Y._init,Q(H,j,Te(Y._payload),ge)}if(vh(Y)||hh(Y))return Te!==null?null:$(H,j,Y,ge,null);z_(H,Y)}return null}function Ee(H,j,Y,ge,Te){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return H=H.get(Y)||null,L(j,H,""+ge,Te);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case M_:return H=H.get(ge.key===null?Y:ge.key)||null,x(j,H,ge,Te);case md:return H=H.get(ge.key===null?Y:ge.key)||null,W(j,H,ge,Te);case ya:var be=ge._init;return Ee(H,j,Y,be(ge._payload),Te)}if(vh(ge)||hh(ge))return H=H.get(Y)||null,$(j,H,ge,Te,null);z_(j,ge)}return null}function ce(H,j,Y,ge){for(var Te=null,be=null,Ae=j,Ve=j=0,Bt=null;Ae!==null&&Ve<Y.length;Ve++){Ae.index>Ve?(Bt=Ae,Ae=null):Bt=Ae.sibling;var et=Q(H,Ae,Y[Ve],ge);if(et===null){Ae===null&&(Ae=Bt);break}s&&Ae&&et.alternate===null&&c(H,Ae),j=v(et,j,Ve),be===null?Te=et:be.sibling=et,be=et,Ae=Bt}if(Ve===Y.length)return h(H,Ae),wi&&Dc(H,Ve),Te;if(Ae===null){for(;Ve<Y.length;Ve++)Ae=K(H,Y[Ve],ge),Ae!==null&&(j=v(Ae,j,Ve),be===null?Te=Ae:be.sibling=Ae,be=Ae);return wi&&Dc(H,Ve),Te}for(Ae=_(H,Ae);Ve<Y.length;Ve++)Bt=Ee(Ae,H,Ve,Y[Ve],ge),Bt!==null&&(s&&Bt.alternate!==null&&Ae.delete(Bt.key===null?Ve:Bt.key),j=v(Bt,j,Ve),be===null?Te=Bt:be.sibling=Bt,be=Bt);return s&&Ae.forEach(function(dr){return c(H,dr)}),wi&&Dc(H,Ve),Te}function te(H,j,Y,ge){var Te=hh(Y);if(typeof Te!="function")throw Error(Re(150));if(Y=Te.call(Y),Y==null)throw Error(Re(151));for(var be=Te=null,Ae=j,Ve=j=0,Bt=null,et=Y.next();Ae!==null&&!et.done;Ve++,et=Y.next()){Ae.index>Ve?(Bt=Ae,Ae=null):Bt=Ae.sibling;var dr=Q(H,Ae,et.value,ge);if(dr===null){Ae===null&&(Ae=Bt);break}s&&Ae&&dr.alternate===null&&c(H,Ae),j=v(dr,j,Ve),be===null?Te=dr:be.sibling=dr,be=dr,Ae=Bt}if(et.done)return h(H,Ae),wi&&Dc(H,Ve),Te;if(Ae===null){for(;!et.done;Ve++,et=Y.next())et=K(H,et.value,ge),et!==null&&(j=v(et,j,Ve),be===null?Te=et:be.sibling=et,be=et);return wi&&Dc(H,Ve),Te}for(Ae=_(H,Ae);!et.done;Ve++,et=Y.next())et=Ee(Ae,H,Ve,et.value,ge),et!==null&&(s&&et.alternate!==null&&Ae.delete(et.key===null?Ve:et.key),j=v(et,j,Ve),be===null?Te=et:be.sibling=et,be=et);return s&&Ae.forEach(function(Po){return c(H,Po)}),wi&&Dc(H,Ve),Te}function ve(H,j,Y,ge){if(typeof Y=="object"&&Y!==null&&Y.type===_d&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case M_:e:{for(var Te=Y.key,be=j;be!==null;){if(be.key===Te){if(Te=Y.type,Te===_d){if(be.tag===7){h(H,be.sibling),j=g(be,Y.props.children),j.return=H,H=j;break e}}else if(be.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===ya&&yU(Te)===be.type){h(H,be.sibling),j=g(be,Y.props),j.ref=Eh(H,be,Y),j.return=H,H=j;break e}h(H,be);break}else c(H,be);be=be.sibling}Y.type===_d?(j=xc(Y.props.children,H.mode,ge,Y.key),j.return=H,H=j):(ge=lf(Y.type,Y.key,Y.props,null,H.mode,ge),ge.ref=Eh(H,j,Y),ge.return=H,H=ge)}return b(H);case md:e:{for(be=Y.key;j!==null;){if(j.key===be)if(j.tag===4&&j.stateNode.containerInfo===Y.containerInfo&&j.stateNode.implementation===Y.implementation){h(H,j.sibling),j=g(j,Y.children||[]),j.return=H,H=j;break e}else{h(H,j);break}else c(H,j);j=j.sibling}j=ER(Y,H.mode,ge),j.return=H,H=j}return b(H);case ya:return be=Y._init,ve(H,j,be(Y._payload),ge)}if(vh(Y))return ce(H,j,Y,ge);if(hh(Y))return te(H,j,Y,ge);z_(H,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,j!==null&&j.tag===6?(h(H,j.sibling),j=g(j,Y),j.return=H,H=j):(h(H,j),j=fR(Y,H.mode,ge),j.return=H,H=j),b(H)):h(H,j)}return ve}var Md=dx(!0),ux=dx(!1),If=Ba(null),wf=null,Cd=null,MC=null;function UC(){MC=Cd=wf=null}function xC(s){var c=If.current;Si(If),s._currentValue=c}function qR(s,c,h){for(;s!==null;){var _=s.alternate;if((s.childLanes&c)!==c?(s.childLanes|=c,_!==null&&(_.childLanes|=c)):_!==null&&(_.childLanes&c)!==c&&(_.childLanes|=c),s===h)break;s=s.return}}function Nd(s,c){wf=s,MC=Cd=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&c&&(cn=!0),s.firstContext=null)}function no(s){var c=s._currentValue;if(MC!==s)if(s={context:s,memoizedValue:c,next:null},Cd===null){if(wf===null)throw Error(Re(308));Cd=s,wf.dependencies={lanes:0,firstContext:s}}else Cd=Cd.next=s;return c}var Lc=null;function VC(s){Lc===null?Lc=[s]:Lc.push(s)}function hx(s,c,h,_){var g=c.interleaved;return g===null?(h.next=h,VC(c)):(h.next=g.next,g.next=h),c.interleaved=h,ks(s,_)}function ks(s,c){s.lanes|=c;var h=s.alternate;for(h!==null&&(h.lanes|=c),h=s,s=s.return;s!==null;)s.childLanes|=c,h=s.alternate,h!==null&&(h.childLanes|=c),h=s,s=s.return;return h.tag===3?h.stateNode:null}var Ia=!1;function FC(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function px(s,c){s=s.updateQueue,c.updateQueue===s&&(c.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Ns(s,c){return{eventTime:s,lane:c,tag:0,payload:null,callback:null,next:null}}function La(s,c,h){var _=s.updateQueue;if(_===null)return null;if(_=_.shared,Ft&2){var g=_.pending;return g===null?c.next=c:(c.next=g.next,g.next=c),_.pending=c,ks(s,h)}return g=_.interleaved,g===null?(c.next=c,VC(_)):(c.next=g.next,g.next=c),_.interleaved=c,ks(s,h)}function rf(s,c,h){if(c=c.updateQueue,c!==null&&(c=c.shared,(h&4194240)!==0)){var _=c.lanes;_&=s.pendingLanes,h|=_,c.lanes=h,yC(s,h)}}function IU(s,c){var h=s.updateQueue,_=s.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var g=null,v=null;if(h=h.firstBaseUpdate,h!==null){do{var b={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};v===null?g=v=b:v=v.next=b,h=h.next}while(h!==null);v===null?g=v=c:v=v.next=c}else g=v=c;h={baseState:_.baseState,firstBaseUpdate:g,lastBaseUpdate:v,shared:_.shared,effects:_.effects},s.updateQueue=h;return}s=h.lastBaseUpdate,s===null?h.firstBaseUpdate=c:s.next=c,h.lastBaseUpdate=c}function Af(s,c,h,_){var g=s.updateQueue;Ia=!1;var v=g.firstBaseUpdate,b=g.lastBaseUpdate,L=g.shared.pending;if(L!==null){g.shared.pending=null;var x=L,W=x.next;x.next=null,b===null?v=W:b.next=W,b=x;var $=s.alternate;$!==null&&($=$.updateQueue,L=$.lastBaseUpdate,L!==b&&(L===null?$.firstBaseUpdate=W:L.next=W,$.lastBaseUpdate=x))}if(v!==null){var K=g.baseState;b=0,$=W=x=null,L=v;do{var Q=L.lane,Ee=L.eventTime;if((_&Q)===Q){$!==null&&($=$.next={eventTime:Ee,lane:0,tag:L.tag,payload:L.payload,callback:L.callback,next:null});e:{var ce=s,te=L;switch(Q=c,Ee=h,te.tag){case 1:if(ce=te.payload,typeof ce=="function"){K=ce.call(Ee,K,Q);break e}K=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=te.payload,Q=typeof ce=="function"?ce.call(Ee,K,Q):ce,Q==null)break e;K=Di({},K,Q);break e;case 2:Ia=!0}}L.callback!==null&&L.lane!==0&&(s.flags|=64,Q=g.effects,Q===null?g.effects=[L]:Q.push(L))}else Ee={eventTime:Ee,lane:Q,tag:L.tag,payload:L.payload,callback:L.callback,next:null},$===null?(W=$=Ee,x=K):$=$.next=Ee,b|=Q;if(L=L.next,L===null){if(L=g.shared.pending,L===null)break;Q=L,L=Q.next,Q.next=null,g.lastBaseUpdate=Q,g.shared.pending=null}}while(1);if($===null&&(x=K),g.baseState=x,g.firstBaseUpdate=W,g.lastBaseUpdate=$,c=g.shared.interleaved,c!==null){g=c;do b|=g.lane,g=g.next;while(g!==c)}else v===null&&(g.shared.lanes=0);Bc|=b,s.lanes=b,s.memoizedState=K}}function wU(s,c,h){if(s=c.effects,c.effects=null,s!==null)for(c=0;c<s.length;c++){var _=s[c],g=_.callback;if(g!==null){if(_.callback=null,_=h,typeof g!="function")throw Error(Re(191,g));g.call(_)}}}var ip={},as=Ba(ip),zh=Ba(ip),Yh=Ba(ip);function Mc(s){if(s===ip)throw Error(Re(174));return s}function jC(s,c){switch(ui(Yh,c),ui(zh,s),ui(as,ip),s=c.nodeType,s){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:OR(null,"");break;default:s=s===8?c.parentNode:c,c=s.namespaceURI||null,s=s.tagName,c=OR(c,s)}Si(as),ui(as,c)}function Ud(){Si(as),Si(zh),Si(Yh)}function mx(s){Mc(Yh.current);var c=Mc(as.current),h=OR(c,s.type);c!==h&&(ui(zh,s),ui(as,h))}function BC(s){zh.current===s&&(Si(as),Si(zh))}var bi=Ba(0);function Of(s){for(var c=s;c!==null;){if(c.tag===13){var h=c.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var dR=[];function GC(){for(var s=0;s<dR.length;s++)dR[s]._workInProgressVersionPrimary=null;dR.length=0}var nf=Ms.ReactCurrentDispatcher,uR=Ms.ReactCurrentBatchConfig,jc=0,Ni=null,$i=null,cr=null,bf=!1,Dh=!1,qh=0,TX=0;function br(){throw Error(Re(321))}function WC(s,c){if(c===null)return!1;for(var h=0;h<c.length&&h<s.length;h++)if(!No(s[h],c[h]))return!1;return!0}function HC(s,c,h,_,g,v){if(jc=v,Ni=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,nf.current=s===null||s.memoizedState===null?yX:IX,s=h(_,g),Dh){v=0;do{if(Dh=!1,qh=0,25<=v)throw Error(Re(301));v+=1,cr=$i=null,c.updateQueue=null,nf.current=wX,s=h(_,g)}while(Dh)}if(nf.current=Nf,c=$i!==null&&$i.next!==null,jc=0,cr=$i=Ni=null,bf=!1,c)throw Error(Re(300));return s}function KC(){var s=qh!==0;return qh=0,s}function ns(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?Ni.memoizedState=cr=s:cr=cr.next=s,cr}function oo(){if($i===null){var s=Ni.alternate;s=s!==null?s.memoizedState:null}else s=$i.next;var c=cr===null?Ni.memoizedState:cr.next;if(c!==null)cr=c,$i=s;else{if(s===null)throw Error(Re(310));$i=s,s={memoizedState:$i.memoizedState,baseState:$i.baseState,baseQueue:$i.baseQueue,queue:$i.queue,next:null},cr===null?Ni.memoizedState=cr=s:cr=cr.next=s}return cr}function Jh(s,c){return typeof c=="function"?c(s):c}function hR(s){var c=oo(),h=c.queue;if(h===null)throw Error(Re(311));h.lastRenderedReducer=s;var _=$i,g=_.baseQueue,v=h.pending;if(v!==null){if(g!==null){var b=g.next;g.next=v.next,v.next=b}_.baseQueue=g=v,h.pending=null}if(g!==null){v=g.next,_=_.baseState;var L=b=null,x=null,W=v;do{var $=W.lane;if((jc&$)===$)x!==null&&(x=x.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),_=W.hasEagerState?W.eagerState:s(_,W.action);else{var K={lane:$,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};x===null?(L=x=K,b=_):x=x.next=K,Ni.lanes|=$,Bc|=$}W=W.next}while(W!==null&&W!==v);x===null?b=_:x.next=L,No(_,c.memoizedState)||(cn=!0),c.memoizedState=_,c.baseState=b,c.baseQueue=x,h.lastRenderedState=_}if(s=h.interleaved,s!==null){g=s;do v=g.lane,Ni.lanes|=v,Bc|=v,g=g.next;while(g!==s)}else g===null&&(h.lanes=0);return[c.memoizedState,h.dispatch]}function pR(s){var c=oo(),h=c.queue;if(h===null)throw Error(Re(311));h.lastRenderedReducer=s;var _=h.dispatch,g=h.pending,v=c.memoizedState;if(g!==null){h.pending=null;var b=g=g.next;do v=s(v,b.action),b=b.next;while(b!==g);No(v,c.memoizedState)||(cn=!0),c.memoizedState=v,c.baseQueue===null&&(c.baseState=v),h.lastRenderedState=v}return[v,_]}function _x(){}function fx(s,c){var h=Ni,_=oo(),g=c(),v=!No(_.memoizedState,g);if(v&&(_.memoizedState=g,cn=!0),_=_.queue,zC(Sx.bind(null,h,_,s),[s]),_.getSnapshot!==c||v||cr!==null&&cr.memoizedState.tag&1){if(h.flags|=2048,Xh(9,gx.bind(null,h,_,g,c),void 0,null),lr===null)throw Error(Re(349));jc&30||Ex(h,c,g)}return g}function Ex(s,c,h){s.flags|=16384,s={getSnapshot:c,value:h},c=Ni.updateQueue,c===null?(c={lastEffect:null,stores:null},Ni.updateQueue=c,c.stores=[s]):(h=c.stores,h===null?c.stores=[s]:h.push(s))}function gx(s,c,h,_){c.value=h,c.getSnapshot=_,Tx(c)&&vx(s)}function Sx(s,c,h){return h(function(){Tx(c)&&vx(s)})}function Tx(s){var c=s.getSnapshot;s=s.value;try{var h=c();return!No(s,h)}catch{return!0}}function vx(s){var c=ks(s,1);c!==null&&bo(c,s,1,-1)}function AU(s){var c=ns();return typeof s=="function"&&(s=s()),c.memoizedState=c.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jh,lastRenderedState:s},c.queue=s,s=s.dispatch=CX.bind(null,Ni,s),[c.memoizedState,s]}function Xh(s,c,h,_){return s={tag:s,create:c,destroy:h,deps:_,next:null},c=Ni.updateQueue,c===null?(c={lastEffect:null,stores:null},Ni.updateQueue=c,c.lastEffect=s.next=s):(h=c.lastEffect,h===null?c.lastEffect=s.next=s:(_=h.next,h.next=s,s.next=_,c.lastEffect=s)),s}function Rx(){return oo().memoizedState}function of(s,c,h,_){var g=ns();Ni.flags|=s,g.memoizedState=Xh(1|c,h,void 0,_===void 0?null:_)}function Wf(s,c,h,_){var g=oo();_=_===void 0?null:_;var v=void 0;if($i!==null){var b=$i.memoizedState;if(v=b.destroy,_!==null&&WC(_,b.deps)){g.memoizedState=Xh(c,h,v,_);return}}Ni.flags|=s,g.memoizedState=Xh(1|c,h,v,_)}function OU(s,c){return of(8390656,8,s,c)}function zC(s,c){return Wf(2048,8,s,c)}function Cx(s,c){return Wf(4,2,s,c)}function yx(s,c){return Wf(4,4,s,c)}function Ix(s,c){if(typeof c=="function")return s=s(),c(s),function(){c(null)};if(c!=null)return s=s(),c.current=s,function(){c.current=null}}function wx(s,c,h){return h=h!=null?h.concat([s]):null,Wf(4,4,Ix.bind(null,c,s),h)}function YC(){}function Ax(s,c){var h=oo();c=c===void 0?null:c;var _=h.memoizedState;return _!==null&&c!==null&&WC(c,_[1])?_[0]:(h.memoizedState=[s,c],s)}function Ox(s,c){var h=oo();c=c===void 0?null:c;var _=h.memoizedState;return _!==null&&c!==null&&WC(c,_[1])?_[0]:(s=s(),h.memoizedState=[s,c],s)}function bx(s,c,h){return jc&21?(No(h,c)||(h=L2(),Ni.lanes|=h,Bc|=h,s.baseState=!0),c):(s.baseState&&(s.baseState=!1,cn=!0),s.memoizedState=h)}function vX(s,c){var h=ei;ei=h!==0&&4>h?h:4,s(!0);var _=uR.transition;uR.transition={};try{s(!1),c()}finally{ei=h,uR.transition=_}}function Nx(){return oo().memoizedState}function RX(s,c,h){var _=Ua(s);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},Dx(s))Px(c,h);else if(h=hx(s,c,h,_),h!==null){var g=Gr();bo(h,s,_,g),kx(h,c,_)}}function CX(s,c,h){var _=Ua(s),g={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(Dx(s))Px(c,g);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=c.lastRenderedReducer,v!==null))try{var b=c.lastRenderedState,L=v(b,h);if(g.hasEagerState=!0,g.eagerState=L,No(L,b)){var x=c.interleaved;x===null?(g.next=g,VC(c)):(g.next=x.next,x.next=g),c.interleaved=g;return}}catch{}finally{}h=hx(s,c,g,_),h!==null&&(g=Gr(),bo(h,s,_,g),kx(h,c,_))}}function Dx(s){var c=s.alternate;return s===Ni||c!==null&&c===Ni}function Px(s,c){Dh=bf=!0;var h=s.pending;h===null?c.next=c:(c.next=h.next,h.next=c),s.pending=c}function kx(s,c,h){if(h&4194240){var _=c.lanes;_&=s.pendingLanes,h|=_,c.lanes=h,yC(s,h)}}var Nf={readContext:no,useCallback:br,useContext:br,useEffect:br,useImperativeHandle:br,useInsertionEffect:br,useLayoutEffect:br,useMemo:br,useReducer:br,useRef:br,useState:br,useDebugValue:br,useDeferredValue:br,useTransition:br,useMutableSource:br,useSyncExternalStore:br,useId:br,unstable_isNewReconciler:!1},yX={readContext:no,useCallback:function(s,c){return ns().memoizedState=[s,c===void 0?null:c],s},useContext:no,useEffect:OU,useImperativeHandle:function(s,c,h){return h=h!=null?h.concat([s]):null,of(4194308,4,Ix.bind(null,c,s),h)},useLayoutEffect:function(s,c){return of(4194308,4,s,c)},useInsertionEffect:function(s,c){return of(4,2,s,c)},useMemo:function(s,c){var h=ns();return c=c===void 0?null:c,s=s(),h.memoizedState=[s,c],s},useReducer:function(s,c,h){var _=ns();return c=h!==void 0?h(c):c,_.memoizedState=_.baseState=c,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:c},_.queue=s,s=s.dispatch=RX.bind(null,Ni,s),[_.memoizedState,s]},useRef:function(s){var c=ns();return s={current:s},c.memoizedState=s},useState:AU,useDebugValue:YC,useDeferredValue:function(s){return ns().memoizedState=s},useTransition:function(){var s=AU(!1),c=s[0];return s=vX.bind(null,s[1]),ns().memoizedState=s,[c,s]},useMutableSource:function(){},useSyncExternalStore:function(s,c,h){var _=Ni,g=ns();if(wi){if(h===void 0)throw Error(Re(407));h=h()}else{if(h=c(),lr===null)throw Error(Re(349));jc&30||Ex(_,c,h)}g.memoizedState=h;var v={value:h,getSnapshot:c};return g.queue=v,OU(Sx.bind(null,_,v,s),[s]),_.flags|=2048,Xh(9,gx.bind(null,_,v,h,c),void 0,null),h},useId:function(){var s=ns(),c=lr.identifierPrefix;if(wi){var h=bs,_=Os;h=(_&~(1<<32-Oo(_)-1)).toString(32)+h,c=":"+c+"R"+h,h=qh++,0<h&&(c+="H"+h.toString(32)),c+=":"}else h=TX++,c=":"+c+"r"+h.toString(32)+":";return s.memoizedState=c},unstable_isNewReconciler:!1},IX={readContext:no,useCallback:Ax,useContext:no,useEffect:zC,useImperativeHandle:wx,useInsertionEffect:Cx,useLayoutEffect:yx,useMemo:Ox,useReducer:hR,useRef:Rx,useState:function(){return hR(Jh)},useDebugValue:YC,useDeferredValue:function(s){var c=oo();return bx(c,$i.memoizedState,s)},useTransition:function(){var s=hR(Jh)[0],c=oo().memoizedState;return[s,c]},useMutableSource:_x,useSyncExternalStore:fx,useId:Nx,unstable_isNewReconciler:!1},wX={readContext:no,useCallback:Ax,useContext:no,useEffect:zC,useImperativeHandle:wx,useInsertionEffect:Cx,useLayoutEffect:yx,useMemo:Ox,useReducer:pR,useRef:Rx,useState:function(){return pR(Jh)},useDebugValue:YC,useDeferredValue:function(s){var c=oo();return $i===null?c.memoizedState=s:bx(c,$i.memoizedState,s)},useTransition:function(){var s=pR(Jh)[0],c=oo().memoizedState;return[s,c]},useMutableSource:_x,useSyncExternalStore:fx,useId:Nx,unstable_isNewReconciler:!1};function Io(s,c){if(s&&s.defaultProps){c=Di({},c),s=s.defaultProps;for(var h in s)c[h]===void 0&&(c[h]=s[h]);return c}return c}function JR(s,c,h,_){c=s.memoizedState,h=h(_,c),h=h==null?c:Di({},c,h),s.memoizedState=h,s.lanes===0&&(s.updateQueue.baseState=h)}var Hf={isMounted:function(s){return(s=s._reactInternals)?Hc(s)===s:!1},enqueueSetState:function(s,c,h){s=s._reactInternals;var _=Gr(),g=Ua(s),v=Ns(_,g);v.payload=c,h!=null&&(v.callback=h),c=La(s,v,g),c!==null&&(bo(c,s,g,_),rf(c,s,g))},enqueueReplaceState:function(s,c,h){s=s._reactInternals;var _=Gr(),g=Ua(s),v=Ns(_,g);v.tag=1,v.payload=c,h!=null&&(v.callback=h),c=La(s,v,g),c!==null&&(bo(c,s,g,_),rf(c,s,g))},enqueueForceUpdate:function(s,c){s=s._reactInternals;var h=Gr(),_=Ua(s),g=Ns(h,_);g.tag=2,c!=null&&(g.callback=c),c=La(s,g,_),c!==null&&(bo(c,s,_,h),rf(c,s,_))}};function bU(s,c,h,_,g,v,b){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(_,v,b):c.prototype&&c.prototype.isPureReactComponent?!Gh(h,_)||!Gh(g,v):!0}function Lx(s,c,h){var _=!1,g=Fa,v=c.contextType;return typeof v=="object"&&v!==null?v=no(v):(g=dn(c)?Vc:kr.current,_=c.contextTypes,v=(_=_!=null)?kd(s,g):Fa),c=new c(h,v),s.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Hf,s.stateNode=c,c._reactInternals=s,_&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=g,s.__reactInternalMemoizedMaskedChildContext=v),c}function NU(s,c,h,_){s=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(h,_),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(h,_),c.state!==s&&Hf.enqueueReplaceState(c,c.state,null)}function XR(s,c,h,_){var g=s.stateNode;g.props=h,g.state=s.memoizedState,g.refs={},FC(s);var v=c.contextType;typeof v=="object"&&v!==null?g.context=no(v):(v=dn(c)?Vc:kr.current,g.context=kd(s,v)),g.state=s.memoizedState,v=c.getDerivedStateFromProps,typeof v=="function"&&(JR(s,c,v,h),g.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(c=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),c!==g.state&&Hf.enqueueReplaceState(g,g.state,null),Af(s,h,g,_),g.state=s.memoizedState),typeof g.componentDidMount=="function"&&(s.flags|=4194308)}function xd(s,c){try{var h="",_=c;do h+=eJ(_),_=_.return;while(_);var g=h}catch(v){g=`
Error generating stack: `+v.message+`
`+v.stack}return{value:s,source:c,stack:g,digest:null}}function mR(s,c,h){return{value:s,source:null,stack:h??null,digest:c??null}}function QR(s,c){try{console.error(c.value)}catch(h){setTimeout(function(){throw h})}}var AX=typeof WeakMap=="function"?WeakMap:Map;function Mx(s,c,h){h=Ns(-1,h),h.tag=3,h.payload={element:null};var _=c.value;return h.callback=function(){Pf||(Pf=!0,aC=_),QR(s,c)},h}function Ux(s,c,h){h=Ns(-1,h),h.tag=3;var _=s.type.getDerivedStateFromError;if(typeof _=="function"){var g=c.value;h.payload=function(){return _(g)},h.callback=function(){QR(s,c)}}var v=s.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(h.callback=function(){QR(s,c),typeof _!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var b=c.stack;this.componentDidCatch(c.value,{componentStack:b!==null?b:""})}),h}function DU(s,c,h){var _=s.pingCache;if(_===null){_=s.pingCache=new AX;var g=new Set;_.set(c,g)}else g=_.get(c),g===void 0&&(g=new Set,_.set(c,g));g.has(h)||(g.add(h),s=BX.bind(null,s,c,h),c.then(s,s))}function PU(s){do{var c;if((c=s.tag===13)&&(c=s.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return s;s=s.return}while(s!==null);return null}function kU(s,c,h,_,g){return s.mode&1?(s.flags|=65536,s.lanes=g,s):(s===c?s.flags|=65536:(s.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(c=Ns(-1,1),c.tag=2,La(h,c,1))),h.lanes|=1),s)}var OX=Ms.ReactCurrentOwner,cn=!1;function Br(s,c,h,_){c.child=s===null?ux(c,null,h,_):Md(c,s.child,h,_)}function LU(s,c,h,_,g){h=h.render;var v=c.ref;return Nd(c,g),_=HC(s,c,h,_,v,g),h=KC(),s!==null&&!cn?(c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~g,Ls(s,c,g)):(wi&&h&&PC(c),c.flags|=1,Br(s,c,_,g),c.child)}function MU(s,c,h,_,g){if(s===null){var v=h.type;return typeof v=="function"&&!ty(v)&&v.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(c.tag=15,c.type=v,xx(s,c,v,_,g)):(s=lf(h.type,null,_,c,c.mode,g),s.ref=c.ref,s.return=c,c.child=s)}if(v=s.child,!(s.lanes&g)){var b=v.memoizedProps;if(h=h.compare,h=h!==null?h:Gh,h(b,_)&&s.ref===c.ref)return Ls(s,c,g)}return c.flags|=1,s=xa(v,_),s.ref=c.ref,s.return=c,c.child=s}function xx(s,c,h,_,g){if(s!==null){var v=s.memoizedProps;if(Gh(v,_)&&s.ref===c.ref)if(cn=!1,c.pendingProps=_=v,(s.lanes&g)!==0)s.flags&131072&&(cn=!0);else return c.lanes=s.lanes,Ls(s,c,g)}return ZR(s,c,h,_,g)}function Vx(s,c,h){var _=c.pendingProps,g=_.children,v=s!==null?s.memoizedState:null;if(_.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},ui(Id,yn),yn|=h;else{if(!(h&1073741824))return s=v!==null?v.baseLanes|h:h,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:s,cachePool:null,transitions:null},c.updateQueue=null,ui(Id,yn),yn|=s,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=v!==null?v.baseLanes:h,ui(Id,yn),yn|=_}else v!==null?(_=v.baseLanes|h,c.memoizedState=null):_=h,ui(Id,yn),yn|=_;return Br(s,c,g,h),c.child}function Fx(s,c){var h=c.ref;(s===null&&h!==null||s!==null&&s.ref!==h)&&(c.flags|=512,c.flags|=2097152)}function ZR(s,c,h,_,g){var v=dn(h)?Vc:kr.current;return v=kd(c,v),Nd(c,g),h=HC(s,c,h,_,v,g),_=KC(),s!==null&&!cn?(c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~g,Ls(s,c,g)):(wi&&_&&PC(c),c.flags|=1,Br(s,c,h,g),c.child)}function UU(s,c,h,_,g){if(dn(h)){var v=!0;Rf(c)}else v=!1;if(Nd(c,g),c.stateNode===null)sf(s,c),Lx(c,h,_),XR(c,h,_,g),_=!0;else if(s===null){var b=c.stateNode,L=c.memoizedProps;b.props=L;var x=b.context,W=h.contextType;typeof W=="object"&&W!==null?W=no(W):(W=dn(h)?Vc:kr.current,W=kd(c,W));var $=h.getDerivedStateFromProps,K=typeof $=="function"||typeof b.getSnapshotBeforeUpdate=="function";K||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(L!==_||x!==W)&&NU(c,b,_,W),Ia=!1;var Q=c.memoizedState;b.state=Q,Af(c,_,b,g),x=c.memoizedState,L!==_||Q!==x||ln.current||Ia?(typeof $=="function"&&(JR(c,h,$,_),x=c.memoizedState),(L=Ia||bU(c,h,L,_,Q,x,W))?(K||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(c.flags|=4194308)):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=_,c.memoizedState=x),b.props=_,b.state=x,b.context=W,_=L):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),_=!1)}else{b=c.stateNode,px(s,c),L=c.memoizedProps,W=c.type===c.elementType?L:Io(c.type,L),b.props=W,K=c.pendingProps,Q=b.context,x=h.contextType,typeof x=="object"&&x!==null?x=no(x):(x=dn(h)?Vc:kr.current,x=kd(c,x));var Ee=h.getDerivedStateFromProps;($=typeof Ee=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(L!==K||Q!==x)&&NU(c,b,_,x),Ia=!1,Q=c.memoizedState,b.state=Q,Af(c,_,b,g);var ce=c.memoizedState;L!==K||Q!==ce||ln.current||Ia?(typeof Ee=="function"&&(JR(c,h,Ee,_),ce=c.memoizedState),(W=Ia||bU(c,h,W,_,Q,ce,x)||!1)?($||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(_,ce,x),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(_,ce,x)),typeof b.componentDidUpdate=="function"&&(c.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof b.componentDidUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(c.flags|=1024),c.memoizedProps=_,c.memoizedState=ce),b.props=_,b.state=ce,b.context=x,_=W):(typeof b.componentDidUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(c.flags|=1024),_=!1)}return $R(s,c,h,_,v,g)}function $R(s,c,h,_,g,v){Fx(s,c);var b=(c.flags&128)!==0;if(!_&&!b)return g&&vU(c,h,!1),Ls(s,c,v);_=c.stateNode,OX.current=c;var L=b&&typeof h.getDerivedStateFromError!="function"?null:_.render();return c.flags|=1,s!==null&&b?(c.child=Md(c,s.child,null,v),c.child=Md(c,null,L,v)):Br(s,c,L,v),c.memoizedState=_.state,g&&vU(c,h,!0),c.child}function jx(s){var c=s.stateNode;c.pendingContext?TU(s,c.pendingContext,c.pendingContext!==c.context):c.context&&TU(s,c.context,!1),jC(s,c.containerInfo)}function xU(s,c,h,_,g){return Ld(),LC(g),c.flags|=256,Br(s,c,h,_),c.child}var eC={dehydrated:null,treeContext:null,retryLane:0};function tC(s){return{baseLanes:s,cachePool:null,transitions:null}}function Bx(s,c,h){var _=c.pendingProps,g=bi.current,v=!1,b=(c.flags&128)!==0,L;if((L=b)||(L=s!==null&&s.memoizedState===null?!1:(g&2)!==0),L?(v=!0,c.flags&=-129):(s===null||s.memoizedState!==null)&&(g|=1),ui(bi,g&1),s===null)return YR(c),s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(c.mode&1?s.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(b=_.children,s=_.fallback,v?(_=c.mode,v=c.child,b={mode:"hidden",children:b},!(_&1)&&v!==null?(v.childLanes=0,v.pendingProps=b):v=Yf(b,_,0,null),s=xc(s,_,h,null),v.return=c,s.return=c,v.sibling=s,c.child=v,c.child.memoizedState=tC(h),c.memoizedState=eC,s):qC(c,b));if(g=s.memoizedState,g!==null&&(L=g.dehydrated,L!==null))return bX(s,c,b,_,L,g,h);if(v){v=_.fallback,b=c.mode,g=s.child,L=g.sibling;var x={mode:"hidden",children:_.children};return!(b&1)&&c.child!==g?(_=c.child,_.childLanes=0,_.pendingProps=x,c.deletions=null):(_=xa(g,x),_.subtreeFlags=g.subtreeFlags&14680064),L!==null?v=xa(L,v):(v=xc(v,b,h,null),v.flags|=2),v.return=c,_.return=c,_.sibling=v,c.child=_,_=v,v=c.child,b=s.child.memoizedState,b=b===null?tC(h):{baseLanes:b.baseLanes|h,cachePool:null,transitions:b.transitions},v.memoizedState=b,v.childLanes=s.childLanes&~h,c.memoizedState=eC,_}return v=s.child,s=v.sibling,_=xa(v,{mode:"visible",children:_.children}),!(c.mode&1)&&(_.lanes=h),_.return=c,_.sibling=null,s!==null&&(h=c.deletions,h===null?(c.deletions=[s],c.flags|=16):h.push(s)),c.child=_,c.memoizedState=null,_}function qC(s,c){return c=Yf({mode:"visible",children:c},s.mode,0,null),c.return=s,s.child=c}function Y_(s,c,h,_){return _!==null&&LC(_),Md(c,s.child,null,h),s=qC(c,c.pendingProps.children),s.flags|=2,c.memoizedState=null,s}function bX(s,c,h,_,g,v,b){if(h)return c.flags&256?(c.flags&=-257,_=mR(Error(Re(422))),Y_(s,c,b,_)):c.memoizedState!==null?(c.child=s.child,c.flags|=128,null):(v=_.fallback,g=c.mode,_=Yf({mode:"visible",children:_.children},g,0,null),v=xc(v,g,b,null),v.flags|=2,_.return=c,v.return=c,_.sibling=v,c.child=_,c.mode&1&&Md(c,s.child,null,b),c.child.memoizedState=tC(b),c.memoizedState=eC,v);if(!(c.mode&1))return Y_(s,c,b,null);if(g.data==="$!"){if(_=g.nextSibling&&g.nextSibling.dataset,_)var L=_.dgst;return _=L,v=Error(Re(419)),_=mR(v,_,void 0),Y_(s,c,b,_)}if(L=(b&s.childLanes)!==0,cn||L){if(_=lr,_!==null){switch(b&-b){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(_.suspendedLanes|b)?0:g,g!==0&&g!==v.retryLane&&(v.retryLane=g,ks(s,g),bo(_,s,g,-1))}return ey(),_=mR(Error(Re(421))),Y_(s,c,b,_)}return g.data==="$?"?(c.flags|=128,c.child=s.child,c=GX.bind(null,s),g._reactRetry=c,null):(s=v.treeContext,In=ka(g.nextSibling),wn=c,wi=!0,Ao=null,s!==null&&(eo[to++]=Os,eo[to++]=bs,eo[to++]=Fc,Os=s.id,bs=s.overflow,Fc=c),c=qC(c,_.children),c.flags|=4096,c)}function VU(s,c,h){s.lanes|=c;var _=s.alternate;_!==null&&(_.lanes|=c),qR(s.return,c,h)}function _R(s,c,h,_,g){var v=s.memoizedState;v===null?s.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:g}:(v.isBackwards=c,v.rendering=null,v.renderingStartTime=0,v.last=_,v.tail=h,v.tailMode=g)}function Gx(s,c,h){var _=c.pendingProps,g=_.revealOrder,v=_.tail;if(Br(s,c,_.children,h),_=bi.current,_&2)_=_&1|2,c.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=c.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&VU(s,h,c);else if(s.tag===19)VU(s,h,c);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===c)break e;for(;s.sibling===null;){if(s.return===null||s.return===c)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}_&=1}if(ui(bi,_),!(c.mode&1))c.memoizedState=null;else switch(g){case"forwards":for(h=c.child,g=null;h!==null;)s=h.alternate,s!==null&&Of(s)===null&&(g=h),h=h.sibling;h=g,h===null?(g=c.child,c.child=null):(g=h.sibling,h.sibling=null),_R(c,!1,g,h,v);break;case"backwards":for(h=null,g=c.child,c.child=null;g!==null;){if(s=g.alternate,s!==null&&Of(s)===null){c.child=g;break}s=g.sibling,g.sibling=h,h=g,g=s}_R(c,!0,h,null,v);break;case"together":_R(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function sf(s,c){!(c.mode&1)&&s!==null&&(s.alternate=null,c.alternate=null,c.flags|=2)}function Ls(s,c,h){if(s!==null&&(c.dependencies=s.dependencies),Bc|=c.lanes,!(h&c.childLanes))return null;if(s!==null&&c.child!==s.child)throw Error(Re(153));if(c.child!==null){for(s=c.child,h=xa(s,s.pendingProps),c.child=h,h.return=c;s.sibling!==null;)s=s.sibling,h=h.sibling=xa(s,s.pendingProps),h.return=c;h.sibling=null}return c.child}function NX(s,c,h){switch(c.tag){case 3:jx(c),Ld();break;case 5:mx(c);break;case 1:dn(c.type)&&Rf(c);break;case 4:jC(c,c.stateNode.containerInfo);break;case 10:var _=c.type._context,g=c.memoizedProps.value;ui(If,_._currentValue),_._currentValue=g;break;case 13:if(_=c.memoizedState,_!==null)return _.dehydrated!==null?(ui(bi,bi.current&1),c.flags|=128,null):h&c.child.childLanes?Bx(s,c,h):(ui(bi,bi.current&1),s=Ls(s,c,h),s!==null?s.sibling:null);ui(bi,bi.current&1);break;case 19:if(_=(h&c.childLanes)!==0,s.flags&128){if(_)return Gx(s,c,h);c.flags|=128}if(g=c.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ui(bi,bi.current),_)break;return null;case 22:case 23:return c.lanes=0,Vx(s,c,h)}return Ls(s,c,h)}var Wx,iC,Hx,Kx;Wx=function(s,c){for(var h=c.child;h!==null;){if(h.tag===5||h.tag===6)s.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};iC=function(){};Hx=function(s,c,h,_){var g=s.memoizedProps;if(g!==_){s=c.stateNode,Mc(as.current);var v=null;switch(h){case"input":g=yR(s,g),_=yR(s,_),v=[];break;case"select":g=Di({},g,{value:void 0}),_=Di({},_,{value:void 0}),v=[];break;case"textarea":g=AR(s,g),_=AR(s,_),v=[];break;default:typeof g.onClick!="function"&&typeof _.onClick=="function"&&(s.onclick=Tf)}bR(h,_);var b;h=null;for(W in g)if(!_.hasOwnProperty(W)&&g.hasOwnProperty(W)&&g[W]!=null)if(W==="style"){var L=g[W];for(b in L)L.hasOwnProperty(b)&&(h||(h={}),h[b]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(Mh.hasOwnProperty(W)?v||(v=[]):(v=v||[]).push(W,null));for(W in _){var x=_[W];if(L=g!=null?g[W]:void 0,_.hasOwnProperty(W)&&x!==L&&(x!=null||L!=null))if(W==="style")if(L){for(b in L)!L.hasOwnProperty(b)||x&&x.hasOwnProperty(b)||(h||(h={}),h[b]="");for(b in x)x.hasOwnProperty(b)&&L[b]!==x[b]&&(h||(h={}),h[b]=x[b])}else h||(v||(v=[]),v.push(W,h)),h=x;else W==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,L=L?L.__html:void 0,x!=null&&L!==x&&(v=v||[]).push(W,x)):W==="children"?typeof x!="string"&&typeof x!="number"||(v=v||[]).push(W,""+x):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(Mh.hasOwnProperty(W)?(x!=null&&W==="onScroll"&&gi("scroll",s),v||L===x||(v=[])):(v=v||[]).push(W,x))}h&&(v=v||[]).push("style",h);var W=v;(c.updateQueue=W)&&(c.flags|=4)}};Kx=function(s,c,h,_){h!==_&&(c.flags|=4)};function gh(s,c){if(!wi)switch(s.tailMode){case"hidden":c=s.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?s.tail=null:h.sibling=null;break;case"collapsed":h=s.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?c||s.tail===null?s.tail=null:s.tail.sibling=null:_.sibling=null}}function Nr(s){var c=s.alternate!==null&&s.alternate.child===s.child,h=0,_=0;if(c)for(var g=s.child;g!==null;)h|=g.lanes|g.childLanes,_|=g.subtreeFlags&14680064,_|=g.flags&14680064,g.return=s,g=g.sibling;else for(g=s.child;g!==null;)h|=g.lanes|g.childLanes,_|=g.subtreeFlags,_|=g.flags,g.return=s,g=g.sibling;return s.subtreeFlags|=_,s.childLanes=h,c}function DX(s,c,h){var _=c.pendingProps;switch(kC(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(c),null;case 1:return dn(c.type)&&vf(),Nr(c),null;case 3:return _=c.stateNode,Ud(),Si(ln),Si(kr),GC(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(s===null||s.child===null)&&(K_(c)?c.flags|=4:s===null||s.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Ao!==null&&(dC(Ao),Ao=null))),iC(s,c),Nr(c),null;case 5:BC(c);var g=Mc(Yh.current);if(h=c.type,s!==null&&c.stateNode!=null)Hx(s,c,h,_,g),s.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!_){if(c.stateNode===null)throw Error(Re(166));return Nr(c),null}if(s=Mc(as.current),K_(c)){_=c.stateNode,h=c.type;var v=c.memoizedProps;switch(_[os]=c,_[Kh]=v,s=(c.mode&1)!==0,h){case"dialog":gi("cancel",_),gi("close",_);break;case"iframe":case"object":case"embed":gi("load",_);break;case"video":case"audio":for(g=0;g<Ch.length;g++)gi(Ch[g],_);break;case"source":gi("error",_);break;case"img":case"image":case"link":gi("error",_),gi("load",_);break;case"details":gi("toggle",_);break;case"input":YM(_,v),gi("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!v.multiple},gi("invalid",_);break;case"textarea":JM(_,v),gi("invalid",_)}bR(h,v),g=null;for(var b in v)if(v.hasOwnProperty(b)){var L=v[b];b==="children"?typeof L=="string"?_.textContent!==L&&(v.suppressHydrationWarning!==!0&&H_(_.textContent,L,s),g=["children",L]):typeof L=="number"&&_.textContent!==""+L&&(v.suppressHydrationWarning!==!0&&H_(_.textContent,L,s),g=["children",""+L]):Mh.hasOwnProperty(b)&&L!=null&&b==="onScroll"&&gi("scroll",_)}switch(h){case"input":U_(_),qM(_,v,!0);break;case"textarea":U_(_),XM(_);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(_.onclick=Tf)}_=g,c.updateQueue=_,_!==null&&(c.flags|=4)}else{b=g.nodeType===9?g:g.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=S2(h)),s==="http://www.w3.org/1999/xhtml"?h==="script"?(s=b.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof _.is=="string"?s=b.createElement(h,{is:_.is}):(s=b.createElement(h),h==="select"&&(b=s,_.multiple?b.multiple=!0:_.size&&(b.size=_.size))):s=b.createElementNS(s,h),s[os]=c,s[Kh]=_,Wx(s,c,!1,!1),c.stateNode=s;e:{switch(b=NR(h,_),h){case"dialog":gi("cancel",s),gi("close",s),g=_;break;case"iframe":case"object":case"embed":gi("load",s),g=_;break;case"video":case"audio":for(g=0;g<Ch.length;g++)gi(Ch[g],s);g=_;break;case"source":gi("error",s),g=_;break;case"img":case"image":case"link":gi("error",s),gi("load",s),g=_;break;case"details":gi("toggle",s),g=_;break;case"input":YM(s,_),g=yR(s,_),gi("invalid",s);break;case"option":g=_;break;case"select":s._wrapperState={wasMultiple:!!_.multiple},g=Di({},_,{value:void 0}),gi("invalid",s);break;case"textarea":JM(s,_),g=AR(s,_),gi("invalid",s);break;default:g=_}bR(h,g),L=g;for(v in L)if(L.hasOwnProperty(v)){var x=L[v];v==="style"?R2(s,x):v==="dangerouslySetInnerHTML"?(x=x?x.__html:void 0,x!=null&&T2(s,x)):v==="children"?typeof x=="string"?(h!=="textarea"||x!=="")&&Uh(s,x):typeof x=="number"&&Uh(s,""+x):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Mh.hasOwnProperty(v)?x!=null&&v==="onScroll"&&gi("scroll",s):x!=null&&gC(s,v,x,b))}switch(h){case"input":U_(s),qM(s,_,!1);break;case"textarea":U_(s),XM(s);break;case"option":_.value!=null&&s.setAttribute("value",""+Va(_.value));break;case"select":s.multiple=!!_.multiple,v=_.value,v!=null?wd(s,!!_.multiple,v,!1):_.defaultValue!=null&&wd(s,!!_.multiple,_.defaultValue,!0);break;default:typeof g.onClick=="function"&&(s.onclick=Tf)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Nr(c),null;case 6:if(s&&c.stateNode!=null)Kx(s,c,s.memoizedProps,_);else{if(typeof _!="string"&&c.stateNode===null)throw Error(Re(166));if(h=Mc(Yh.current),Mc(as.current),K_(c)){if(_=c.stateNode,h=c.memoizedProps,_[os]=c,(v=_.nodeValue!==h)&&(s=wn,s!==null))switch(s.tag){case 3:H_(_.nodeValue,h,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&H_(_.nodeValue,h,(s.mode&1)!==0)}v&&(c.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[os]=c,c.stateNode=_}return Nr(c),null;case 13:if(Si(bi),_=c.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(wi&&In!==null&&c.mode&1&&!(c.flags&128))lx(),Ld(),c.flags|=98560,v=!1;else if(v=K_(c),_!==null&&_.dehydrated!==null){if(s===null){if(!v)throw Error(Re(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(Re(317));v[os]=c}else Ld(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;Nr(c),v=!1}else Ao!==null&&(dC(Ao),Ao=null),v=!0;if(!v)return c.flags&65536?c:null}return c.flags&128?(c.lanes=h,c):(_=_!==null,_!==(s!==null&&s.memoizedState!==null)&&_&&(c.child.flags|=8192,c.mode&1&&(s===null||bi.current&1?er===0&&(er=3):ey())),c.updateQueue!==null&&(c.flags|=4),Nr(c),null);case 4:return Ud(),iC(s,c),s===null&&Wh(c.stateNode.containerInfo),Nr(c),null;case 10:return xC(c.type._context),Nr(c),null;case 17:return dn(c.type)&&vf(),Nr(c),null;case 19:if(Si(bi),v=c.memoizedState,v===null)return Nr(c),null;if(_=(c.flags&128)!==0,b=v.rendering,b===null)if(_)gh(v,!1);else{if(er!==0||s!==null&&s.flags&128)for(s=c.child;s!==null;){if(b=Of(s),b!==null){for(c.flags|=128,gh(v,!1),_=b.updateQueue,_!==null&&(c.updateQueue=_,c.flags|=4),c.subtreeFlags=0,_=h,h=c.child;h!==null;)v=h,s=_,v.flags&=14680066,b=v.alternate,b===null?(v.childLanes=0,v.lanes=s,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=b.childLanes,v.lanes=b.lanes,v.child=b.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=b.memoizedProps,v.memoizedState=b.memoizedState,v.updateQueue=b.updateQueue,v.type=b.type,s=b.dependencies,v.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),h=h.sibling;return ui(bi,bi.current&1|2),c.child}s=s.sibling}v.tail!==null&&Wi()>Vd&&(c.flags|=128,_=!0,gh(v,!1),c.lanes=4194304)}else{if(!_)if(s=Of(b),s!==null){if(c.flags|=128,_=!0,h=s.updateQueue,h!==null&&(c.updateQueue=h,c.flags|=4),gh(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!wi)return Nr(c),null}else 2*Wi()-v.renderingStartTime>Vd&&h!==1073741824&&(c.flags|=128,_=!0,gh(v,!1),c.lanes=4194304);v.isBackwards?(b.sibling=c.child,c.child=b):(h=v.last,h!==null?h.sibling=b:c.child=b,v.last=b)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Wi(),c.sibling=null,h=bi.current,ui(bi,_?h&1|2:h&1),c):(Nr(c),null);case 22:case 23:return $C(),_=c.memoizedState!==null,s!==null&&s.memoizedState!==null!==_&&(c.flags|=8192),_&&c.mode&1?yn&1073741824&&(Nr(c),c.subtreeFlags&6&&(c.flags|=8192)):Nr(c),null;case 24:return null;case 25:return null}throw Error(Re(156,c.tag))}function PX(s,c){switch(kC(c),c.tag){case 1:return dn(c.type)&&vf(),s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 3:return Ud(),Si(ln),Si(kr),GC(),s=c.flags,s&65536&&!(s&128)?(c.flags=s&-65537|128,c):null;case 5:return BC(c),null;case 13:if(Si(bi),s=c.memoizedState,s!==null&&s.dehydrated!==null){if(c.alternate===null)throw Error(Re(340));Ld()}return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 19:return Si(bi),null;case 4:return Ud(),null;case 10:return xC(c.type._context),null;case 22:case 23:return $C(),null;case 24:return null;default:return null}}var q_=!1,Dr=!1,kX=typeof WeakSet=="function"?WeakSet:Set,Le=null;function yd(s,c){var h=s.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){xi(s,c,_)}else h.current=null}function rC(s,c,h){try{h()}catch(_){xi(s,c,_)}}var FU=!1;function LX(s,c){if(jR=Ef,s=X2(),DC(s)){if("selectionStart"in s)var h={start:s.selectionStart,end:s.selectionEnd};else e:{h=(h=s.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var g=_.anchorOffset,v=_.focusNode;_=_.focusOffset;try{h.nodeType,v.nodeType}catch{h=null;break e}var b=0,L=-1,x=-1,W=0,$=0,K=s,Q=null;t:for(;;){for(var Ee;K!==h||g!==0&&K.nodeType!==3||(L=b+g),K!==v||_!==0&&K.nodeType!==3||(x=b+_),K.nodeType===3&&(b+=K.nodeValue.length),(Ee=K.firstChild)!==null;)Q=K,K=Ee;for(;;){if(K===s)break t;if(Q===h&&++W===g&&(L=b),Q===v&&++$===_&&(x=b),(Ee=K.nextSibling)!==null)break;K=Q,Q=K.parentNode}K=Ee}h=L===-1||x===-1?null:{start:L,end:x}}else h=null}h=h||{start:0,end:0}}else h=null;for(BR={focusedElem:s,selectionRange:h},Ef=!1,Le=c;Le!==null;)if(c=Le,s=c.child,(c.subtreeFlags&1028)!==0&&s!==null)s.return=c,Le=s;else for(;Le!==null;){c=Le;try{var ce=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var te=ce.memoizedProps,ve=ce.memoizedState,H=c.stateNode,j=H.getSnapshotBeforeUpdate(c.elementType===c.type?te:Io(c.type,te),ve);H.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var Y=c.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(ge){xi(c,c.return,ge)}if(s=c.sibling,s!==null){s.return=c.return,Le=s;break}Le=c.return}return ce=FU,FU=!1,ce}function Ph(s,c,h){var _=c.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var g=_=_.next;do{if((g.tag&s)===s){var v=g.destroy;g.destroy=void 0,v!==void 0&&rC(c,h,v)}g=g.next}while(g!==_)}}function Kf(s,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&s)===s){var _=h.create;h.destroy=_()}h=h.next}while(h!==c)}}function nC(s){var c=s.ref;if(c!==null){var h=s.stateNode;switch(s.tag){case 5:s=h;break;default:s=h}typeof c=="function"?c(s):c.current=s}}function zx(s){var c=s.alternate;c!==null&&(s.alternate=null,zx(c)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(c=s.stateNode,c!==null&&(delete c[os],delete c[Kh],delete c[HR],delete c[fX],delete c[EX])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function Yx(s){return s.tag===5||s.tag===3||s.tag===4}function jU(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Yx(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function oC(s,c,h){var _=s.tag;if(_===5||_===6)s=s.stateNode,c?h.nodeType===8?h.parentNode.insertBefore(s,c):h.insertBefore(s,c):(h.nodeType===8?(c=h.parentNode,c.insertBefore(s,h)):(c=h,c.appendChild(s)),h=h._reactRootContainer,h!=null||c.onclick!==null||(c.onclick=Tf));else if(_!==4&&(s=s.child,s!==null))for(oC(s,c,h),s=s.sibling;s!==null;)oC(s,c,h),s=s.sibling}function sC(s,c,h){var _=s.tag;if(_===5||_===6)s=s.stateNode,c?h.insertBefore(s,c):h.appendChild(s);else if(_!==4&&(s=s.child,s!==null))for(sC(s,c,h),s=s.sibling;s!==null;)sC(s,c,h),s=s.sibling}var fr=null,wo=!1;function va(s,c,h){for(h=h.child;h!==null;)qx(s,c,h),h=h.sibling}function qx(s,c,h){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(xf,h)}catch{}switch(h.tag){case 5:Dr||yd(h,c);case 6:var _=fr,g=wo;fr=null,va(s,c,h),fr=_,wo=g,fr!==null&&(wo?(s=fr,h=h.stateNode,s.nodeType===8?s.parentNode.removeChild(h):s.removeChild(h)):fr.removeChild(h.stateNode));break;case 18:fr!==null&&(wo?(s=fr,h=h.stateNode,s.nodeType===8?cR(s.parentNode,h):s.nodeType===1&&cR(s,h),jh(s)):cR(fr,h.stateNode));break;case 4:_=fr,g=wo,fr=h.stateNode.containerInfo,wo=!0,va(s,c,h),fr=_,wo=g;break;case 0:case 11:case 14:case 15:if(!Dr&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){g=_=_.next;do{var v=g,b=v.destroy;v=v.tag,b!==void 0&&(v&2||v&4)&&rC(h,c,b),g=g.next}while(g!==_)}va(s,c,h);break;case 1:if(!Dr&&(yd(h,c),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(L){xi(h,c,L)}va(s,c,h);break;case 21:va(s,c,h);break;case 22:h.mode&1?(Dr=(_=Dr)||h.memoizedState!==null,va(s,c,h),Dr=_):va(s,c,h);break;default:va(s,c,h)}}function BU(s){var c=s.updateQueue;if(c!==null){s.updateQueue=null;var h=s.stateNode;h===null&&(h=s.stateNode=new kX),c.forEach(function(_){var g=WX.bind(null,s,_);h.has(_)||(h.add(_),_.then(g,g))})}}function yo(s,c){var h=c.deletions;if(h!==null)for(var _=0;_<h.length;_++){var g=h[_];try{var v=s,b=c,L=b;e:for(;L!==null;){switch(L.tag){case 5:fr=L.stateNode,wo=!1;break e;case 3:fr=L.stateNode.containerInfo,wo=!0;break e;case 4:fr=L.stateNode.containerInfo,wo=!0;break e}L=L.return}if(fr===null)throw Error(Re(160));qx(v,b,g),fr=null,wo=!1;var x=g.alternate;x!==null&&(x.return=null),g.return=null}catch(W){xi(g,c,W)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)Jx(c,s),c=c.sibling}function Jx(s,c){var h=s.alternate,_=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(yo(c,s),rs(s),_&4){try{Ph(3,s,s.return),Kf(3,s)}catch(te){xi(s,s.return,te)}try{Ph(5,s,s.return)}catch(te){xi(s,s.return,te)}}break;case 1:yo(c,s),rs(s),_&512&&h!==null&&yd(h,h.return);break;case 5:if(yo(c,s),rs(s),_&512&&h!==null&&yd(h,h.return),s.flags&32){var g=s.stateNode;try{Uh(g,"")}catch(te){xi(s,s.return,te)}}if(_&4&&(g=s.stateNode,g!=null)){var v=s.memoizedProps,b=h!==null?h.memoizedProps:v,L=s.type,x=s.updateQueue;if(s.updateQueue=null,x!==null)try{L==="input"&&v.type==="radio"&&v.name!=null&&E2(g,v),NR(L,b);var W=NR(L,v);for(b=0;b<x.length;b+=2){var $=x[b],K=x[b+1];$==="style"?R2(g,K):$==="dangerouslySetInnerHTML"?T2(g,K):$==="children"?Uh(g,K):gC(g,$,K,W)}switch(L){case"input":IR(g,v);break;case"textarea":g2(g,v);break;case"select":var Q=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!v.multiple;var Ee=v.value;Ee!=null?wd(g,!!v.multiple,Ee,!1):Q!==!!v.multiple&&(v.defaultValue!=null?wd(g,!!v.multiple,v.defaultValue,!0):wd(g,!!v.multiple,v.multiple?[]:"",!1))}g[Kh]=v}catch(te){xi(s,s.return,te)}}break;case 6:if(yo(c,s),rs(s),_&4){if(s.stateNode===null)throw Error(Re(162));g=s.stateNode,v=s.memoizedProps;try{g.nodeValue=v}catch(te){xi(s,s.return,te)}}break;case 3:if(yo(c,s),rs(s),_&4&&h!==null&&h.memoizedState.isDehydrated)try{jh(c.containerInfo)}catch(te){xi(s,s.return,te)}break;case 4:yo(c,s),rs(s);break;case 13:yo(c,s),rs(s),g=s.child,g.flags&8192&&(v=g.memoizedState!==null,g.stateNode.isHidden=v,!v||g.alternate!==null&&g.alternate.memoizedState!==null||(QC=Wi())),_&4&&BU(s);break;case 22:if($=h!==null&&h.memoizedState!==null,s.mode&1?(Dr=(W=Dr)||$,yo(c,s),Dr=W):yo(c,s),rs(s),_&8192){if(W=s.memoizedState!==null,(s.stateNode.isHidden=W)&&!$&&s.mode&1)for(Le=s,$=s.child;$!==null;){for(K=Le=$;Le!==null;){switch(Q=Le,Ee=Q.child,Q.tag){case 0:case 11:case 14:case 15:Ph(4,Q,Q.return);break;case 1:yd(Q,Q.return);var ce=Q.stateNode;if(typeof ce.componentWillUnmount=="function"){_=Q,h=Q.return;try{c=_,ce.props=c.memoizedProps,ce.state=c.memoizedState,ce.componentWillUnmount()}catch(te){xi(_,h,te)}}break;case 5:yd(Q,Q.return);break;case 22:if(Q.memoizedState!==null){WU(K);continue}}Ee!==null?(Ee.return=Q,Le=Ee):WU(K)}$=$.sibling}e:for($=null,K=s;;){if(K.tag===5){if($===null){$=K;try{g=K.stateNode,W?(v=g.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(L=K.stateNode,x=K.memoizedProps.style,b=x!=null&&x.hasOwnProperty("display")?x.display:null,L.style.display=v2("display",b))}catch(te){xi(s,s.return,te)}}}else if(K.tag===6){if($===null)try{K.stateNode.nodeValue=W?"":K.memoizedProps}catch(te){xi(s,s.return,te)}}else if((K.tag!==22&&K.tag!==23||K.memoizedState===null||K===s)&&K.child!==null){K.child.return=K,K=K.child;continue}if(K===s)break e;for(;K.sibling===null;){if(K.return===null||K.return===s)break e;$===K&&($=null),K=K.return}$===K&&($=null),K.sibling.return=K.return,K=K.sibling}}break;case 19:yo(c,s),rs(s),_&4&&BU(s);break;case 21:break;default:yo(c,s),rs(s)}}function rs(s){var c=s.flags;if(c&2){try{e:{for(var h=s.return;h!==null;){if(Yx(h)){var _=h;break e}h=h.return}throw Error(Re(160))}switch(_.tag){case 5:var g=_.stateNode;_.flags&32&&(Uh(g,""),_.flags&=-33);var v=jU(s);sC(s,v,g);break;case 3:case 4:var b=_.stateNode.containerInfo,L=jU(s);oC(s,L,b);break;default:throw Error(Re(161))}}catch(x){xi(s,s.return,x)}s.flags&=-3}c&4096&&(s.flags&=-4097)}function MX(s,c,h){Le=s,Xx(s)}function Xx(s,c,h){for(var _=(s.mode&1)!==0;Le!==null;){var g=Le,v=g.child;if(g.tag===22&&_){var b=g.memoizedState!==null||q_;if(!b){var L=g.alternate,x=L!==null&&L.memoizedState!==null||Dr;L=q_;var W=Dr;if(q_=b,(Dr=x)&&!W)for(Le=g;Le!==null;)b=Le,x=b.child,b.tag===22&&b.memoizedState!==null?HU(g):x!==null?(x.return=b,Le=x):HU(g);for(;v!==null;)Le=v,Xx(v),v=v.sibling;Le=g,q_=L,Dr=W}GU(s)}else g.subtreeFlags&8772&&v!==null?(v.return=g,Le=v):GU(s)}}function GU(s){for(;Le!==null;){var c=Le;if(c.flags&8772){var h=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:Dr||Kf(5,c);break;case 1:var _=c.stateNode;if(c.flags&4&&!Dr)if(h===null)_.componentDidMount();else{var g=c.elementType===c.type?h.memoizedProps:Io(c.type,h.memoizedProps);_.componentDidUpdate(g,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var v=c.updateQueue;v!==null&&wU(c,v,_);break;case 3:var b=c.updateQueue;if(b!==null){if(h=null,c.child!==null)switch(c.child.tag){case 5:h=c.child.stateNode;break;case 1:h=c.child.stateNode}wU(c,b,h)}break;case 5:var L=c.stateNode;if(h===null&&c.flags&4){h=L;var x=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":x.autoFocus&&h.focus();break;case"img":x.src&&(h.src=x.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var W=c.alternate;if(W!==null){var $=W.memoizedState;if($!==null){var K=$.dehydrated;K!==null&&jh(K)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}Dr||c.flags&512&&nC(c)}catch(Q){xi(c,c.return,Q)}}if(c===s){Le=null;break}if(h=c.sibling,h!==null){h.return=c.return,Le=h;break}Le=c.return}}function WU(s){for(;Le!==null;){var c=Le;if(c===s){Le=null;break}var h=c.sibling;if(h!==null){h.return=c.return,Le=h;break}Le=c.return}}function HU(s){for(;Le!==null;){var c=Le;try{switch(c.tag){case 0:case 11:case 15:var h=c.return;try{Kf(4,c)}catch(x){xi(c,h,x)}break;case 1:var _=c.stateNode;if(typeof _.componentDidMount=="function"){var g=c.return;try{_.componentDidMount()}catch(x){xi(c,g,x)}}var v=c.return;try{nC(c)}catch(x){xi(c,v,x)}break;case 5:var b=c.return;try{nC(c)}catch(x){xi(c,b,x)}}}catch(x){xi(c,c.return,x)}if(c===s){Le=null;break}var L=c.sibling;if(L!==null){L.return=c.return,Le=L;break}Le=c.return}}var UX=Math.ceil,Df=Ms.ReactCurrentDispatcher,JC=Ms.ReactCurrentOwner,ro=Ms.ReactCurrentBatchConfig,Ft=0,lr=null,Yi=null,Er=0,yn=0,Id=Ba(0),er=0,Qh=null,Bc=0,zf=0,XC=0,kh=null,an=null,QC=0,Vd=1/0,ws=null,Pf=!1,aC=null,Ma=null,J_=!1,ba=null,kf=0,Lh=0,cC=null,af=-1,cf=0;function Gr(){return Ft&6?Wi():af!==-1?af:af=Wi()}function Ua(s){return s.mode&1?Ft&2&&Er!==0?Er&-Er:SX.transition!==null?(cf===0&&(cf=L2()),cf):(s=ei,s!==0||(s=window.event,s=s===void 0?16:B2(s.type)),s):1}function bo(s,c,h,_){if(50<Lh)throw Lh=0,cC=null,Error(Re(185));$h(s,h,_),(!(Ft&2)||s!==lr)&&(s===lr&&(!(Ft&2)&&(zf|=h),er===4&&Aa(s,Er)),un(s,_),h===1&&Ft===0&&!(c.mode&1)&&(Vd=Wi()+500,Gf&&Ga()))}function un(s,c){var h=s.callbackNode;SJ(s,c);var _=ff(s,s===lr?Er:0);if(_===0)h!==null&&$M(h),s.callbackNode=null,s.callbackPriority=0;else if(c=_&-_,s.callbackPriority!==c){if(h!=null&&$M(h),c===1)s.tag===0?gX(KU.bind(null,s)):sx(KU.bind(null,s)),mX(function(){!(Ft&6)&&Ga()}),h=null;else{switch(M2(_)){case 1:h=CC;break;case 4:h=P2;break;case 16:h=_f;break;case 536870912:h=k2;break;default:h=_f}h=nV(h,Qx.bind(null,s))}s.callbackPriority=c,s.callbackNode=h}}function Qx(s,c){if(af=-1,cf=0,Ft&6)throw Error(Re(327));var h=s.callbackNode;if(Dd()&&s.callbackNode!==h)return null;var _=ff(s,s===lr?Er:0);if(_===0)return null;if(_&30||_&s.expiredLanes||c)c=Lf(s,_);else{c=_;var g=Ft;Ft|=2;var v=$x();(lr!==s||Er!==c)&&(ws=null,Vd=Wi()+500,Uc(s,c));do try{FX();break}catch(L){Zx(s,L)}while(1);UC(),Df.current=v,Ft=g,Yi!==null?c=0:(lr=null,Er=0,c=er)}if(c!==0){if(c===2&&(g=MR(s),g!==0&&(_=g,c=lC(s,g))),c===1)throw h=Qh,Uc(s,0),Aa(s,_),un(s,Wi()),h;if(c===6)Aa(s,_);else{if(g=s.current.alternate,!(_&30)&&!xX(g)&&(c=Lf(s,_),c===2&&(v=MR(s),v!==0&&(_=v,c=lC(s,v))),c===1))throw h=Qh,Uc(s,0),Aa(s,_),un(s,Wi()),h;switch(s.finishedWork=g,s.finishedLanes=_,c){case 0:case 1:throw Error(Re(345));case 2:Pc(s,an,ws);break;case 3:if(Aa(s,_),(_&130023424)===_&&(c=QC+500-Wi(),10<c)){if(ff(s,0)!==0)break;if(g=s.suspendedLanes,(g&_)!==_){Gr(),s.pingedLanes|=s.suspendedLanes&g;break}s.timeoutHandle=WR(Pc.bind(null,s,an,ws),c);break}Pc(s,an,ws);break;case 4:if(Aa(s,_),(_&4194240)===_)break;for(c=s.eventTimes,g=-1;0<_;){var b=31-Oo(_);v=1<<b,b=c[b],b>g&&(g=b),_&=~v}if(_=g,_=Wi()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*UX(_/1960))-_,10<_){s.timeoutHandle=WR(Pc.bind(null,s,an,ws),_);break}Pc(s,an,ws);break;case 5:Pc(s,an,ws);break;default:throw Error(Re(329))}}}return un(s,Wi()),s.callbackNode===h?Qx.bind(null,s):null}function lC(s,c){var h=kh;return s.current.memoizedState.isDehydrated&&(Uc(s,c).flags|=256),s=Lf(s,c),s!==2&&(c=an,an=h,c!==null&&dC(c)),s}function dC(s){an===null?an=s:an.push.apply(an,s)}function xX(s){for(var c=s;;){if(c.flags&16384){var h=c.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var g=h[_],v=g.getSnapshot;g=g.value;try{if(!No(v(),g))return!1}catch{return!1}}}if(h=c.child,c.subtreeFlags&16384&&h!==null)h.return=c,c=h;else{if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Aa(s,c){for(c&=~XC,c&=~zf,s.suspendedLanes|=c,s.pingedLanes&=~c,s=s.expirationTimes;0<c;){var h=31-Oo(c),_=1<<h;s[h]=-1,c&=~_}}function KU(s){if(Ft&6)throw Error(Re(327));Dd();var c=ff(s,0);if(!(c&1))return un(s,Wi()),null;var h=Lf(s,c);if(s.tag!==0&&h===2){var _=MR(s);_!==0&&(c=_,h=lC(s,_))}if(h===1)throw h=Qh,Uc(s,0),Aa(s,c),un(s,Wi()),h;if(h===6)throw Error(Re(345));return s.finishedWork=s.current.alternate,s.finishedLanes=c,Pc(s,an,ws),un(s,Wi()),null}function ZC(s,c){var h=Ft;Ft|=1;try{return s(c)}finally{Ft=h,Ft===0&&(Vd=Wi()+500,Gf&&Ga())}}function Gc(s){ba!==null&&ba.tag===0&&!(Ft&6)&&Dd();var c=Ft;Ft|=1;var h=ro.transition,_=ei;try{if(ro.transition=null,ei=1,s)return s()}finally{ei=_,ro.transition=h,Ft=c,!(Ft&6)&&Ga()}}function $C(){yn=Id.current,Si(Id)}function Uc(s,c){s.finishedWork=null,s.finishedLanes=0;var h=s.timeoutHandle;if(h!==-1&&(s.timeoutHandle=-1,pX(h)),Yi!==null)for(h=Yi.return;h!==null;){var _=h;switch(kC(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&vf();break;case 3:Ud(),Si(ln),Si(kr),GC();break;case 5:BC(_);break;case 4:Ud();break;case 13:Si(bi);break;case 19:Si(bi);break;case 10:xC(_.type._context);break;case 22:case 23:$C()}h=h.return}if(lr=s,Yi=s=xa(s.current,null),Er=yn=c,er=0,Qh=null,XC=zf=Bc=0,an=kh=null,Lc!==null){for(c=0;c<Lc.length;c++)if(h=Lc[c],_=h.interleaved,_!==null){h.interleaved=null;var g=_.next,v=h.pending;if(v!==null){var b=v.next;v.next=g,_.next=b}h.pending=_}Lc=null}return s}function Zx(s,c){do{var h=Yi;try{if(UC(),nf.current=Nf,bf){for(var _=Ni.memoizedState;_!==null;){var g=_.queue;g!==null&&(g.pending=null),_=_.next}bf=!1}if(jc=0,cr=$i=Ni=null,Dh=!1,qh=0,JC.current=null,h===null||h.return===null){er=1,Qh=c,Yi=null;break}e:{var v=s,b=h.return,L=h,x=c;if(c=Er,L.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){var W=x,$=L,K=$.tag;if(!($.mode&1)&&(K===0||K===11||K===15)){var Q=$.alternate;Q?($.updateQueue=Q.updateQueue,$.memoizedState=Q.memoizedState,$.lanes=Q.lanes):($.updateQueue=null,$.memoizedState=null)}var Ee=PU(b);if(Ee!==null){Ee.flags&=-257,kU(Ee,b,L,v,c),Ee.mode&1&&DU(v,W,c),c=Ee,x=W;var ce=c.updateQueue;if(ce===null){var te=new Set;te.add(x),c.updateQueue=te}else ce.add(x);break e}else{if(!(c&1)){DU(v,W,c),ey();break e}x=Error(Re(426))}}else if(wi&&L.mode&1){var ve=PU(b);if(ve!==null){!(ve.flags&65536)&&(ve.flags|=256),kU(ve,b,L,v,c),LC(xd(x,L));break e}}v=x=xd(x,L),er!==4&&(er=2),kh===null?kh=[v]:kh.push(v),v=b;do{switch(v.tag){case 3:v.flags|=65536,c&=-c,v.lanes|=c;var H=Mx(v,x,c);IU(v,H);break e;case 1:L=x;var j=v.type,Y=v.stateNode;if(!(v.flags&128)&&(typeof j.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(Ma===null||!Ma.has(Y)))){v.flags|=65536,c&=-c,v.lanes|=c;var ge=Ux(v,L,c);IU(v,ge);break e}}v=v.return}while(v!==null)}tV(h)}catch(Te){c=Te,Yi===h&&h!==null&&(Yi=h=h.return);continue}break}while(1)}function $x(){var s=Df.current;return Df.current=Nf,s===null?Nf:s}function ey(){(er===0||er===3||er===2)&&(er=4),lr===null||!(Bc&268435455)&&!(zf&268435455)||Aa(lr,Er)}function Lf(s,c){var h=Ft;Ft|=2;var _=$x();(lr!==s||Er!==c)&&(ws=null,Uc(s,c));do try{VX();break}catch(g){Zx(s,g)}while(1);if(UC(),Ft=h,Df.current=_,Yi!==null)throw Error(Re(261));return lr=null,Er=0,er}function VX(){for(;Yi!==null;)eV(Yi)}function FX(){for(;Yi!==null&&!dJ();)eV(Yi)}function eV(s){var c=rV(s.alternate,s,yn);s.memoizedProps=s.pendingProps,c===null?tV(s):Yi=c,JC.current=null}function tV(s){var c=s;do{var h=c.alternate;if(s=c.return,c.flags&32768){if(h=PX(h,c),h!==null){h.flags&=32767,Yi=h;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{er=6,Yi=null;return}}else if(h=DX(h,c,yn),h!==null){Yi=h;return}if(c=c.sibling,c!==null){Yi=c;return}Yi=c=s}while(c!==null);er===0&&(er=5)}function Pc(s,c,h){var _=ei,g=ro.transition;try{ro.transition=null,ei=1,jX(s,c,h,_)}finally{ro.transition=g,ei=_}return null}function jX(s,c,h,_){do Dd();while(ba!==null);if(Ft&6)throw Error(Re(327));h=s.finishedWork;var g=s.finishedLanes;if(h===null)return null;if(s.finishedWork=null,s.finishedLanes=0,h===s.current)throw Error(Re(177));s.callbackNode=null,s.callbackPriority=0;var v=h.lanes|h.childLanes;if(TJ(s,v),s===lr&&(Yi=lr=null,Er=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||J_||(J_=!0,nV(_f,function(){return Dd(),null})),v=(h.flags&15990)!==0,h.subtreeFlags&15990||v){v=ro.transition,ro.transition=null;var b=ei;ei=1;var L=Ft;Ft|=4,JC.current=null,LX(s,h),Jx(h,s),sX(BR),Ef=!!jR,BR=jR=null,s.current=h,MX(h),uJ(),Ft=L,ei=b,ro.transition=v}else s.current=h;if(J_&&(J_=!1,ba=s,kf=g),v=s.pendingLanes,v===0&&(Ma=null),mJ(h.stateNode),un(s,Wi()),c!==null)for(_=s.onRecoverableError,h=0;h<c.length;h++)g=c[h],_(g.value,{componentStack:g.stack,digest:g.digest});if(Pf)throw Pf=!1,s=aC,aC=null,s;return kf&1&&s.tag!==0&&Dd(),v=s.pendingLanes,v&1?s===cC?Lh++:(Lh=0,cC=s):Lh=0,Ga(),null}function Dd(){if(ba!==null){var s=M2(kf),c=ro.transition,h=ei;try{if(ro.transition=null,ei=16>s?16:s,ba===null)var _=!1;else{if(s=ba,ba=null,kf=0,Ft&6)throw Error(Re(331));var g=Ft;for(Ft|=4,Le=s.current;Le!==null;){var v=Le,b=v.child;if(Le.flags&16){var L=v.deletions;if(L!==null){for(var x=0;x<L.length;x++){var W=L[x];for(Le=W;Le!==null;){var $=Le;switch($.tag){case 0:case 11:case 15:Ph(8,$,v)}var K=$.child;if(K!==null)K.return=$,Le=K;else for(;Le!==null;){$=Le;var Q=$.sibling,Ee=$.return;if(zx($),$===W){Le=null;break}if(Q!==null){Q.return=Ee,Le=Q;break}Le=Ee}}}var ce=v.alternate;if(ce!==null){var te=ce.child;if(te!==null){ce.child=null;do{var ve=te.sibling;te.sibling=null,te=ve}while(te!==null)}}Le=v}}if(v.subtreeFlags&2064&&b!==null)b.return=v,Le=b;else e:for(;Le!==null;){if(v=Le,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Ph(9,v,v.return)}var H=v.sibling;if(H!==null){H.return=v.return,Le=H;break e}Le=v.return}}var j=s.current;for(Le=j;Le!==null;){b=Le;var Y=b.child;if(b.subtreeFlags&2064&&Y!==null)Y.return=b,Le=Y;else e:for(b=j;Le!==null;){if(L=Le,L.flags&2048)try{switch(L.tag){case 0:case 11:case 15:Kf(9,L)}}catch(Te){xi(L,L.return,Te)}if(L===b){Le=null;break e}var ge=L.sibling;if(ge!==null){ge.return=L.return,Le=ge;break e}Le=L.return}}if(Ft=g,Ga(),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(xf,s)}catch{}_=!0}return _}finally{ei=h,ro.transition=c}}return!1}function zU(s,c,h){c=xd(h,c),c=Mx(s,c,1),s=La(s,c,1),c=Gr(),s!==null&&($h(s,1,c),un(s,c))}function xi(s,c,h){if(s.tag===3)zU(s,s,h);else for(;c!==null;){if(c.tag===3){zU(c,s,h);break}else if(c.tag===1){var _=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Ma===null||!Ma.has(_))){s=xd(h,s),s=Ux(c,s,1),c=La(c,s,1),s=Gr(),c!==null&&($h(c,1,s),un(c,s));break}}c=c.return}}function BX(s,c,h){var _=s.pingCache;_!==null&&_.delete(c),c=Gr(),s.pingedLanes|=s.suspendedLanes&h,lr===s&&(Er&h)===h&&(er===4||er===3&&(Er&130023424)===Er&&500>Wi()-QC?Uc(s,0):XC|=h),un(s,c)}function iV(s,c){c===0&&(s.mode&1?(c=F_,F_<<=1,!(F_&130023424)&&(F_=4194304)):c=1);var h=Gr();s=ks(s,c),s!==null&&($h(s,c,h),un(s,h))}function GX(s){var c=s.memoizedState,h=0;c!==null&&(h=c.retryLane),iV(s,h)}function WX(s,c){var h=0;switch(s.tag){case 13:var _=s.stateNode,g=s.memoizedState;g!==null&&(h=g.retryLane);break;case 19:_=s.stateNode;break;default:throw Error(Re(314))}_!==null&&_.delete(c),iV(s,h)}var rV;rV=function(s,c,h){if(s!==null)if(s.memoizedProps!==c.pendingProps||ln.current)cn=!0;else{if(!(s.lanes&h)&&!(c.flags&128))return cn=!1,NX(s,c,h);cn=!!(s.flags&131072)}else cn=!1,wi&&c.flags&1048576&&ax(c,yf,c.index);switch(c.lanes=0,c.tag){case 2:var _=c.type;sf(s,c),s=c.pendingProps;var g=kd(c,kr.current);Nd(c,h),g=HC(null,c,_,s,g,h);var v=KC();return c.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,dn(_)?(v=!0,Rf(c)):v=!1,c.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,FC(c),g.updater=Hf,c.stateNode=g,g._reactInternals=c,XR(c,_,s,h),c=$R(null,c,_,!0,v,h)):(c.tag=0,wi&&v&&PC(c),Br(null,c,g,h),c=c.child),c;case 16:_=c.elementType;e:{switch(sf(s,c),s=c.pendingProps,g=_._init,_=g(_._payload),c.type=_,g=c.tag=KX(_),s=Io(_,s),g){case 0:c=ZR(null,c,_,s,h);break e;case 1:c=UU(null,c,_,s,h);break e;case 11:c=LU(null,c,_,s,h);break e;case 14:c=MU(null,c,_,Io(_.type,s),h);break e}throw Error(Re(306,_,""))}return c;case 0:return _=c.type,g=c.pendingProps,g=c.elementType===_?g:Io(_,g),ZR(s,c,_,g,h);case 1:return _=c.type,g=c.pendingProps,g=c.elementType===_?g:Io(_,g),UU(s,c,_,g,h);case 3:e:{if(jx(c),s===null)throw Error(Re(387));_=c.pendingProps,v=c.memoizedState,g=v.element,px(s,c),Af(c,_,null,h);var b=c.memoizedState;if(_=b.element,v.isDehydrated)if(v={element:_,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},c.updateQueue.baseState=v,c.memoizedState=v,c.flags&256){g=xd(Error(Re(423)),c),c=xU(s,c,_,h,g);break e}else if(_!==g){g=xd(Error(Re(424)),c),c=xU(s,c,_,h,g);break e}else for(In=ka(c.stateNode.containerInfo.firstChild),wn=c,wi=!0,Ao=null,h=ux(c,null,_,h),c.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ld(),_===g){c=Ls(s,c,h);break e}Br(s,c,_,h)}c=c.child}return c;case 5:return mx(c),s===null&&YR(c),_=c.type,g=c.pendingProps,v=s!==null?s.memoizedProps:null,b=g.children,GR(_,g)?b=null:v!==null&&GR(_,v)&&(c.flags|=32),Fx(s,c),Br(s,c,b,h),c.child;case 6:return s===null&&YR(c),null;case 13:return Bx(s,c,h);case 4:return jC(c,c.stateNode.containerInfo),_=c.pendingProps,s===null?c.child=Md(c,null,_,h):Br(s,c,_,h),c.child;case 11:return _=c.type,g=c.pendingProps,g=c.elementType===_?g:Io(_,g),LU(s,c,_,g,h);case 7:return Br(s,c,c.pendingProps,h),c.child;case 8:return Br(s,c,c.pendingProps.children,h),c.child;case 12:return Br(s,c,c.pendingProps.children,h),c.child;case 10:e:{if(_=c.type._context,g=c.pendingProps,v=c.memoizedProps,b=g.value,ui(If,_._currentValue),_._currentValue=b,v!==null)if(No(v.value,b)){if(v.children===g.children&&!ln.current){c=Ls(s,c,h);break e}}else for(v=c.child,v!==null&&(v.return=c);v!==null;){var L=v.dependencies;if(L!==null){b=v.child;for(var x=L.firstContext;x!==null;){if(x.context===_){if(v.tag===1){x=Ns(-1,h&-h),x.tag=2;var W=v.updateQueue;if(W!==null){W=W.shared;var $=W.pending;$===null?x.next=x:(x.next=$.next,$.next=x),W.pending=x}}v.lanes|=h,x=v.alternate,x!==null&&(x.lanes|=h),qR(v.return,h,c),L.lanes|=h;break}x=x.next}}else if(v.tag===10)b=v.type===c.type?null:v.child;else if(v.tag===18){if(b=v.return,b===null)throw Error(Re(341));b.lanes|=h,L=b.alternate,L!==null&&(L.lanes|=h),qR(b,h,c),b=v.sibling}else b=v.child;if(b!==null)b.return=v;else for(b=v;b!==null;){if(b===c){b=null;break}if(v=b.sibling,v!==null){v.return=b.return,b=v;break}b=b.return}v=b}Br(s,c,g.children,h),c=c.child}return c;case 9:return g=c.type,_=c.pendingProps.children,Nd(c,h),g=no(g),_=_(g),c.flags|=1,Br(s,c,_,h),c.child;case 14:return _=c.type,g=Io(_,c.pendingProps),g=Io(_.type,g),MU(s,c,_,g,h);case 15:return xx(s,c,c.type,c.pendingProps,h);case 17:return _=c.type,g=c.pendingProps,g=c.elementType===_?g:Io(_,g),sf(s,c),c.tag=1,dn(_)?(s=!0,Rf(c)):s=!1,Nd(c,h),Lx(c,_,g),XR(c,_,g,h),$R(null,c,_,!0,s,h);case 19:return Gx(s,c,h);case 22:return Vx(s,c,h)}throw Error(Re(156,c.tag))};function nV(s,c){return D2(s,c)}function HX(s,c,h,_){this.tag=s,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function io(s,c,h,_){return new HX(s,c,h,_)}function ty(s){return s=s.prototype,!(!s||!s.isReactComponent)}function KX(s){if(typeof s=="function")return ty(s)?1:0;if(s!=null){if(s=s.$$typeof,s===TC)return 11;if(s===vC)return 14}return 2}function xa(s,c){var h=s.alternate;return h===null?(h=io(s.tag,c,s.key,s.mode),h.elementType=s.elementType,h.type=s.type,h.stateNode=s.stateNode,h.alternate=s,s.alternate=h):(h.pendingProps=c,h.type=s.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=s.flags&14680064,h.childLanes=s.childLanes,h.lanes=s.lanes,h.child=s.child,h.memoizedProps=s.memoizedProps,h.memoizedState=s.memoizedState,h.updateQueue=s.updateQueue,c=s.dependencies,h.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},h.sibling=s.sibling,h.index=s.index,h.ref=s.ref,h}function lf(s,c,h,_,g,v){var b=2;if(_=s,typeof s=="function")ty(s)&&(b=1);else if(typeof s=="string")b=5;else e:switch(s){case _d:return xc(h.children,g,v,c);case SC:b=8,g|=8;break;case TR:return s=io(12,h,c,g|2),s.elementType=TR,s.lanes=v,s;case vR:return s=io(13,h,c,g),s.elementType=vR,s.lanes=v,s;case RR:return s=io(19,h,c,g),s.elementType=RR,s.lanes=v,s;case m2:return Yf(h,g,v,c);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case h2:b=10;break e;case p2:b=9;break e;case TC:b=11;break e;case vC:b=14;break e;case ya:b=16,_=null;break e}throw Error(Re(130,s==null?s:typeof s,""))}return c=io(b,h,c,g),c.elementType=s,c.type=_,c.lanes=v,c}function xc(s,c,h,_){return s=io(7,s,_,c),s.lanes=h,s}function Yf(s,c,h,_){return s=io(22,s,_,c),s.elementType=m2,s.lanes=h,s.stateNode={isHidden:!1},s}function fR(s,c,h){return s=io(6,s,null,c),s.lanes=h,s}function ER(s,c,h){return c=io(4,s.children!==null?s.children:[],s.key,c),c.lanes=h,c.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},c}function zX(s,c,h,_,g){this.tag=c,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qv(0),this.expirationTimes=Qv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qv(0),this.identifierPrefix=_,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function iy(s,c,h,_,g,v,b,L,x){return s=new zX(s,c,h,L,x),c===1?(c=1,v===!0&&(c|=8)):c=0,v=io(3,null,null,c),s.current=v,v.stateNode=s,v.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},FC(v),s}function YX(s,c,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:md,key:_==null?null:""+_,children:s,containerInfo:c,implementation:h}}function oV(s){if(!s)return Fa;s=s._reactInternals;e:{if(Hc(s)!==s||s.tag!==1)throw Error(Re(170));var c=s;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(dn(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(Re(171))}if(s.tag===1){var h=s.type;if(dn(h))return ox(s,h,c)}return c}function sV(s,c,h,_,g,v,b,L,x){return s=iy(h,_,!0,s,g,v,b,L,x),s.context=oV(null),h=s.current,_=Gr(),g=Ua(h),v=Ns(_,g),v.callback=c??null,La(h,v,g),s.current.lanes=g,$h(s,g,_),un(s,_),s}function qf(s,c,h,_){var g=c.current,v=Gr(),b=Ua(g);return h=oV(h),c.context===null?c.context=h:c.pendingContext=h,c=Ns(v,b),c.payload={element:s},_=_===void 0?null:_,_!==null&&(c.callback=_),s=La(g,c,b),s!==null&&(bo(s,g,b,v),rf(s,g,b)),b}function Mf(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function YU(s,c){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var h=s.retryLane;s.retryLane=h!==0&&h<c?h:c}}function ry(s,c){YU(s,c),(s=s.alternate)&&YU(s,c)}function qX(){return null}var aV=typeof reportError=="function"?reportError:function(s){console.error(s)};function ny(s){this._internalRoot=s}Jf.prototype.render=ny.prototype.render=function(s){var c=this._internalRoot;if(c===null)throw Error(Re(409));qf(s,c,null,null)};Jf.prototype.unmount=ny.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var c=s.containerInfo;Gc(function(){qf(null,s,null,null)}),c[Ps]=null}};function Jf(s){this._internalRoot=s}Jf.prototype.unstable_scheduleHydration=function(s){if(s){var c=V2();s={blockedOn:null,target:s,priority:c};for(var h=0;h<wa.length&&c!==0&&c<wa[h].priority;h++);wa.splice(h,0,s),h===0&&j2(s)}};function oy(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Xf(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function qU(){}function JX(s,c,h,_,g){if(g){if(typeof _=="function"){var v=_;_=function(){var W=Mf(b);v.call(W)}}var b=sV(c,_,s,0,null,!1,!1,"",qU);return s._reactRootContainer=b,s[Ps]=b.current,Wh(s.nodeType===8?s.parentNode:s),Gc(),b}for(;g=s.lastChild;)s.removeChild(g);if(typeof _=="function"){var L=_;_=function(){var W=Mf(x);L.call(W)}}var x=iy(s,0,!1,null,null,!1,!1,"",qU);return s._reactRootContainer=x,s[Ps]=x.current,Wh(s.nodeType===8?s.parentNode:s),Gc(function(){qf(c,x,h,_)}),x}function Qf(s,c,h,_,g){var v=h._reactRootContainer;if(v){var b=v;if(typeof g=="function"){var L=g;g=function(){var x=Mf(b);L.call(x)}}qf(c,b,s,g)}else b=JX(h,c,s,g,_);return Mf(b)}U2=function(s){switch(s.tag){case 3:var c=s.stateNode;if(c.current.memoizedState.isDehydrated){var h=Rh(c.pendingLanes);h!==0&&(yC(c,h|1),un(c,Wi()),!(Ft&6)&&(Vd=Wi()+500,Ga()))}break;case 13:Gc(function(){var _=ks(s,1);if(_!==null){var g=Gr();bo(_,s,1,g)}}),ry(s,1)}};IC=function(s){if(s.tag===13){var c=ks(s,134217728);if(c!==null){var h=Gr();bo(c,s,134217728,h)}ry(s,134217728)}};x2=function(s){if(s.tag===13){var c=Ua(s),h=ks(s,c);if(h!==null){var _=Gr();bo(h,s,c,_)}ry(s,c)}};V2=function(){return ei};F2=function(s,c){var h=ei;try{return ei=s,c()}finally{ei=h}};PR=function(s,c,h){switch(c){case"input":if(IR(s,h),c=h.name,h.type==="radio"&&c!=null){for(h=s;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<h.length;c++){var _=h[c];if(_!==s&&_.form===s.form){var g=Bf(_);if(!g)throw Error(Re(90));f2(_),IR(_,g)}}}break;case"textarea":g2(s,h);break;case"select":c=h.value,c!=null&&wd(s,!!h.multiple,c,!1)}};I2=ZC;w2=Gc;var XX={usingClientEntryPoint:!1,Events:[tp,Sd,Bf,C2,y2,ZC]},Sh={findFiberByHostInstance:kc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QX={bundleType:Sh.bundleType,version:Sh.version,rendererPackageName:Sh.rendererPackageName,rendererConfig:Sh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ms.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=b2(s),s===null?null:s.stateNode},findFiberByHostInstance:Sh.findFiberByHostInstance||qX,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var X_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!X_.isDisabled&&X_.supportsFiber)try{xf=X_.inject(QX),ss=X_}catch{}}On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XX;On.createPortal=function(s,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!oy(c))throw Error(Re(200));return YX(s,c,null,h)};On.createRoot=function(s,c){if(!oy(s))throw Error(Re(299));var h=!1,_="",g=aV;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(_=c.identifierPrefix),c.onRecoverableError!==void 0&&(g=c.onRecoverableError)),c=iy(s,1,!1,null,null,h,!1,_,g),s[Ps]=c.current,Wh(s.nodeType===8?s.parentNode:s),new ny(c)};On.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var c=s._reactInternals;if(c===void 0)throw typeof s.render=="function"?Error(Re(188)):(s=Object.keys(s).join(","),Error(Re(268,s)));return s=b2(c),s=s===null?null:s.stateNode,s};On.flushSync=function(s){return Gc(s)};On.hydrate=function(s,c,h){if(!Xf(c))throw Error(Re(200));return Qf(null,s,c,!0,h)};On.hydrateRoot=function(s,c,h){if(!oy(s))throw Error(Re(405));var _=h!=null&&h.hydratedSources||null,g=!1,v="",b=aV;if(h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(v=h.identifierPrefix),h.onRecoverableError!==void 0&&(b=h.onRecoverableError)),c=sV(c,null,s,1,h??null,g,!1,v,b),s[Ps]=c.current,Wh(s),_)for(s=0;s<_.length;s++)h=_[s],g=h._getVersion,g=g(h._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[h,g]:c.mutableSourceEagerHydrationData.push(h,g);return new Jf(c)};On.render=function(s,c,h){if(!Xf(c))throw Error(Re(200));return Qf(null,s,c,!1,h)};On.unmountComponentAtNode=function(s){if(!Xf(s))throw Error(Re(40));return s._reactRootContainer?(Gc(function(){Qf(null,null,s,!1,function(){s._reactRootContainer=null,s[Ps]=null})}),!0):!1};On.unstable_batchedUpdates=ZC;On.unstable_renderSubtreeIntoContainer=function(s,c,h,_){if(!Xf(h))throw Error(Re(200));if(s==null||s._reactInternals===void 0)throw Error(Re(38));return Qf(s,c,h,!1,_)};On.version="18.3.1-next-f1338f8080-20240426";function cV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cV)}catch(s){console.error(s)}}cV(),c2.exports=On;var ZX=c2.exports,JU=ZX;gR.createRoot=JU.createRoot,gR.hydrateRoot=JU.hydrateRoot;/**
 * @license agora-rtc-react
 * @version 2.2.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var $X=Object.create,sy=Object.defineProperty,eQ=Object.getOwnPropertyDescriptor,tQ=Object.getOwnPropertyNames,iQ=Object.getPrototypeOf,rQ=Object.prototype.hasOwnProperty,nQ=(s,c)=>()=>(c||s((c={exports:{}}).exports,c),c.exports),oQ=(s,c)=>{for(var h in c)sy(s,h,{get:c[h],enumerable:!0})},lV=(s,c,h,_)=>{if(c&&typeof c=="object"||typeof c=="function")for(let g of tQ(c))!rQ.call(s,g)&&g!==h&&sy(s,g,{get:()=>c[g],enumerable:!(_=eQ(c,g))||_.enumerable});return s},sQ=(s,c,h)=>(lV(s,c,"default"),h),Kc=(s,c,h)=>(h=s!=null?$X(iQ(s)):{},lV(!s||!s.__esModule?sy(h,"default",{value:s,enumerable:!0}):h,s)),zc=nQ((s,c)=>{(function(h,_){typeof s=="object"&&typeof c<"u"?c.exports=_():typeof define=="function"&&define.amd?define(_):(h=typeof globalThis<"u"?globalThis:h||self).AgoraRTC=_()})(s,function(){function h(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(r){if(r!=="default"&&!(r in e)){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}})}),Object.freeze(e)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v=function(e){try{return!!e()}catch{return!0}},b=!v(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),L=b,x=Function.prototype,W=x.call,$=L&&x.bind.bind(W,W),K=L?$:function(e){return function(){return W.apply(e,arguments)}},Q=K({}.isPrototypeOf),Ee=function(e){return e&&e.Math==Math&&e},ce=Ee(typeof globalThis=="object"&&globalThis)||Ee(typeof window=="object"&&window)||Ee(typeof self=="object"&&self)||Ee(typeof _=="object"&&_)||function(){return this}()||_||Function("return this")(),te=b,ve=Function.prototype,H=ve.apply,j=ve.call,Y=typeof Reflect=="object"&&Reflect.apply||(te?j.bind(H):function(){return j.apply(H,arguments)}),ge=K,Te=ge({}.toString),be=ge("".slice),Ae=function(e){return be(Te(e),8,-1)},Ve=Ae,Bt=K,et=function(e){if(Ve(e)==="Function")return Bt(e)},dr=typeof document=="object"&&document.all,Po={all:dr,IS_HTMLDDA:dr===void 0&&dr!==void 0},Ha=Po.all,hi=Po.IS_HTMLDDA?function(e){return typeof e=="function"||e===Ha}:function(e){return typeof e=="function"},Ka={},ur=!v(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Gd=b,Pe=Function.prototype.call,Me=Gd?Pe.bind(Pe):function(){return Pe.apply(Pe,arguments)},dt={},Ti={}.propertyIsEnumerable,Vi=Object.getOwnPropertyDescriptor,Jc=Vi&&!Ti.call({1:2},1);dt.f=Jc?function(e){var t=Vi(this,e);return!!t&&t.enumerable}:Ti;var Sr,Us,Tr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Xc=v,PV=Ae,tE=Object,kV=K("".split),rp=Xc(function(){return!tE("z").propertyIsEnumerable(0)})?function(e){return PV(e)=="String"?kV(e,""):tE(e)}:tE,Qc=function(e){return e==null},LV=Qc,MV=TypeError,Zc=function(e){if(LV(e))throw MV("Can't call method on "+e);return e},UV=rp,xV=Zc,xs=function(e){return UV(xV(e))},hy=hi,VV=Po.all,zr=Po.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:hy(e)||e===VV}:function(e){return typeof e=="object"?e!==null:hy(e)},so={},iE=so,rE=ce,FV=hi,py=function(e){return FV(e)?e:void 0},Lr=function(e,t){return arguments.length<2?py(iE[e])||py(rE[e]):iE[e]&&iE[e][t]||rE[e]&&rE[e][t]},za=typeof navigator<"u"&&String(navigator.userAgent)||"",my=ce,nE=za,_y=my.process,fy=my.Deno,Ey=_y&&_y.versions||fy&&fy.version,gy=Ey&&Ey.v8;gy&&(Us=(Sr=gy.split("."))[0]>0&&Sr[0]<4?1:+(Sr[0]+Sr[1])),!Us&&nE&&(!(Sr=nE.match(/Edge\/(\d+)/))||Sr[1]>=74)&&(Sr=nE.match(/Chrome\/(\d+)/))&&(Us=+Sr[1]);var Ya=Us,Sy=Ya,jV=v,BV=ce.String,$c=!!Object.getOwnPropertySymbols&&!jV(function(){var e=Symbol();return!BV(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Sy&&Sy<41}),Ty=$c&&!Symbol.sham&&typeof Symbol.iterator=="symbol",GV=Lr,WV=hi,HV=Q,KV=Object,Wd=Ty?function(e){return typeof e=="symbol"}:function(e){var t=GV("Symbol");return WV(t)&&HV(t.prototype,KV(e))},zV=String,el=function(e){try{return zV(e)}catch{return"Object"}},YV=hi,qV=el,JV=TypeError,Nn=function(e){if(YV(e))return e;throw JV(qV(e)+" is not a function")},XV=Nn,QV=Qc,np=function(e,t){var i=e[t];return QV(i)?void 0:XV(i)},vy=Me,Ry=hi,Cy=zr,ZV=TypeError,yy={exports:{}},Iy=ce,$V=Object.defineProperty,eF=function(e,t){try{$V(Iy,e,{value:t,configurable:!0,writable:!0})}catch{Iy[e]=t}return t},wy="__core-js_shared__",oE=ce[wy]||eF(wy,{}),Ay=oE;(yy.exports=function(e,t){return Ay[e]||(Ay[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var tl=yy.exports,tF=Zc,iF=Object,ko=function(e){return iF(tF(e))},rF=ko,nF=K({}.hasOwnProperty),Fi=Object.hasOwn||function(e,t){return nF(rF(e),t)},oF=K,sF=0,aF=Math.random(),cF=oF(1 .toString),sE=function(e){return"Symbol("+(e===void 0?"":e)+")_"+cF(++sF+aF,36)},lF=tl,Oy=Fi,dF=sE,uF=$c,hF=Ty,il=ce.Symbol,aE=lF("wks"),pF=hF?il.for||il:il&&il.withoutSetter||dF,Jt=function(e){return Oy(aE,e)||(aE[e]=uF&&Oy(il,e)?il[e]:pF("Symbol."+e)),aE[e]},mF=Me,by=zr,Ny=Wd,_F=np,fF=function(e,t){var i,r;if(Ry(i=e.toString)&&!Cy(r=vy(i,e))||Ry(i=e.valueOf)&&!Cy(r=vy(i,e))||t!=="string")return r;throw ZV("Can't convert object to primitive value")},EF=TypeError,gF=Jt("toPrimitive"),SF=function(e,t){if(!by(e)||Ny(e))return e;var i,r=_F(e,gF);if(r){if(i=mF(r,e,t),!by(i)||Ny(i))return i;throw EF("Can't convert object to primitive value")}return fF(e,t)},TF=Wd,op=function(e){var t=SF(e,"string");return TF(t)?t:t+""},Dy=zr,cE=ce.document,vF=Dy(cE)&&Dy(cE.createElement),lE=function(e){return vF?cE.createElement(e):{}},RF=lE,Py=!ur&&!v(function(){return Object.defineProperty(RF("div"),"a",{get:function(){return 7}}).a!=7}),CF=ur,yF=Me,IF=dt,wF=Tr,AF=xs,OF=op,bF=Fi,NF=Py,ky=Object.getOwnPropertyDescriptor;Ka.f=CF?ky:function(e,t){if(e=AF(e),t=OF(t),NF)try{return ky(e,t)}catch{}if(bF(e,t))return wF(!yF(IF.f,e,t),e[t])};var DF=v,PF=hi,kF=/#|\.prototype\./,Hd=function(e,t){var i=MF[LF(e)];return i==xF||i!=UF&&(PF(t)?DF(t):!!t)},LF=Hd.normalize=function(e){return String(e).replace(kF,".").toLowerCase()},MF=Hd.data={},UF=Hd.NATIVE="N",xF=Hd.POLYFILL="P",Ly=Hd,VF=Nn,FF=b,jF=et(et.bind),Vs=function(e,t){return VF(e),t===void 0?e:FF?jF(e,t):function(){return e.apply(t,arguments)}},Dn={},My=ur&&v(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),BF=zr,GF=String,WF=TypeError,vr=function(e){if(BF(e))return e;throw WF(GF(e)+" is not an object")},HF=ur,KF=Py,zF=My,sp=vr,Uy=op,YF=TypeError,dE=Object.defineProperty,qF=Object.getOwnPropertyDescriptor,uE="enumerable",hE="configurable",pE="writable";Dn.f=HF?zF?function(e,t,i){if(sp(e),t=Uy(t),sp(i),typeof e=="function"&&t==="prototype"&&"value"in i&&pE in i&&!i[pE]){var r=qF(e,t);r&&r[pE]&&(e[t]=i.value,i={configurable:hE in i?i[hE]:r[hE],enumerable:uE in i?i[uE]:r[uE],writable:!1})}return dE(e,t,i)}:dE:function(e,t,i){if(sp(e),t=Uy(t),sp(i),KF)try{return dE(e,t,i)}catch{}if("get"in i||"set"in i)throw YF("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var JF=Dn,XF=Tr,Fs=ur?function(e,t,i){return JF.f(e,t,XF(1,i))}:function(e,t,i){return e[t]=i,e},ap=ce,QF=Y,ZF=et,$F=hi,ej=Ka.f,tj=Ly,rl=so,ij=Vs,nl=Fs,xy=Fi,rj=function(e){var t=function(i,r,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,r)}return new e(i,r,n)}return QF(e,this,arguments)};return t.prototype=e.prototype,t},Tt=function(e,t){var i,r,n,o,a,l,d,u,p,m=e.target,f=e.global,E=e.stat,I=e.proto,T=f?ap:E?ap[m]:(ap[m]||{}).prototype,R=f?rl:rl[m]||nl(rl,m,{})[m],w=R.prototype;for(o in t)r=!(i=tj(f?o:m+(E?".":"#")+o,e.forced))&&T&&xy(T,o),l=R[o],r&&(d=e.dontCallGetSet?(p=ej(T,o))&&p.value:T[o]),a=r&&d?d:t[o],r&&typeof l==typeof a||(u=e.bind&&r?ij(a,ap):e.wrap&&r?rj(a):I&&$F(a)?ZF(a):a,(e.sham||a&&a.sham||l&&l.sham)&&nl(u,"sham",!0),nl(R,o,u),I&&(xy(rl,n=m+"Prototype")||nl(rl,n,{}),nl(rl[n],o,a),e.real&&w&&(i||!w[o])&&nl(w,o,a)))},nj=Math.ceil,oj=Math.floor,sj=Math.trunc||function(e){var t=+e;return(t>0?oj:nj)(t)},aj=sj,mE=function(e){var t=+e;return t!=t||t===0?0:aj(t)},cj=mE,lj=Math.max,dj=Math.min,_E=function(e,t){var i=cj(e);return i<0?lj(i+t,0):dj(i,t)},uj=mE,hj=Math.min,Vy=function(e){return e>0?hj(uj(e),9007199254740991):0},pj=Vy,ls=function(e){return pj(e.length)},mj=xs,_j=_E,fj=ls,Fy=function(e){return function(t,i,r){var n,o=mj(t),a=fj(o),l=_j(r,a);if(e&&i!=i){for(;a>l;)if((n=o[l++])!=n)return!0}else for(;a>l;l++)if((e||l in o)&&o[l]===i)return e||l||0;return!e&&-1}},fE={includes:Fy(!0),indexOf:Fy(!1)},Ej=fE.includes;Tt({target:"Array",proto:!0,forced:v(function(){return!Array(1).includes()})},{includes:function(e){return Ej(this,e,arguments.length>1?arguments[1]:void 0)}});var gj=so,Pn=function(e){return gj[e+"Prototype"]},Sj=Pn("Array").includes,Tj=zr,vj=Ae,Rj=Jt("match"),jy=function(e){var t;return Tj(e)&&((t=e[Rj])!==void 0?!!t:vj(e)=="RegExp")},Cj=jy,yj=TypeError,By={};By[Jt("toStringTag")]="z";var EE=String(By)==="[object z]",Ij=EE,wj=hi,cp=Ae,Aj=Jt("toStringTag"),Oj=Object,bj=cp(function(){return arguments}())=="Arguments",Lo=Ij?cp:function(e){var t,i,r;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(n,o){try{return n[o]}catch{}}(t=Oj(e),Aj))=="string"?i:bj?cp(t):(r=cp(t))=="Object"&&wj(t.callee)?"Arguments":r},Nj=Lo,Dj=String,hn=function(e){if(Nj(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Dj(e)},Pj=Jt("match"),kj=Tt,Lj=function(e){if(Cj(e))throw yj("The method doesn't accept regular expressions");return e},Mj=Zc,Gy=hn,Uj=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Pj]=!1,"/./"[e](t)}catch{}}return!1},xj=K("".indexOf);kj({target:"String",proto:!0,forced:!Uj("includes")},{includes:function(e){return!!~xj(Gy(Mj(this)),Gy(Lj(e)),arguments.length>1?arguments[1]:void 0)}});var Vj=Pn("String").includes,Wy=Q,Fj=Sj,jj=Vj,gE=Array.prototype,SE=String.prototype,Bj=function(e){var t=e.includes;return e===gE||Wy(gE,e)&&t===gE.includes?Fj:typeof e=="string"||e===SE||Wy(SE,e)&&t===SE.includes?jj:t},se=g(Bj),Gj=Nn,Wj=ko,Hj=rp,Kj=ls,zj=TypeError,Hy=function(e){return function(t,i,r,n){Gj(i);var o=Wj(t),a=Hj(o),l=Kj(o),d=e?l-1:0,u=e?-1:1;if(r<2)for(;;){if(d in a){n=a[d],d+=u;break}if(d+=u,e?d<0:l<=d)throw zj("Reduce of empty array with no initial value")}for(;e?d>=0:l>d;d+=u)d in a&&(n=i(n,a[d],d,o));return n}},Yj={left:Hy(!1),right:Hy(!0)},qj=v,lp=function(e,t){var i=[][e];return!!i&&qj(function(){i.call(null,t||function(){return 1},1)})},Kd=typeof process<"u"&&Ae(process)=="process",Jj=Yj.left;Tt({target:"Array",proto:!0,forced:!Kd&&Ya>79&&Ya<83||!lp("reduce")},{reduce:function(e){var t=arguments.length;return Jj(this,e,t,t>1?arguments[1]:void 0)}});var Xj=Pn("Array").reduce,Qj=Q,Zj=Xj,TE=Array.prototype,$j=function(e){var t=e.reduce;return e===TE||Qj(TE,e)&&t===TE.reduce?Zj:t},Ky=$j,ao=g(Ky);let zy=!0,Yy=!0;function dp(e,t,i){let r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function qa(e,t,i){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(a,l){if(a!==t)return n.apply(this,arguments);let d=u=>{let p=i(u);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,d),n.apply(this,[a,d])};let o=r.removeEventListener;r.removeEventListener=function(a,l){if(a!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(l))return o.apply(this,arguments);let d=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,d])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function eB(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(zy=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function tB(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Yy=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function qy(){if(typeof window=="object"){if(zy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function vE(e,t){Yy&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Jy(e){return Object.prototype.toString.call(e)==="[object Object]"}function Xy(e){var t;return Jy(e)?ao(t=Object.keys(e)).call(t,function(i,r){let n=Jy(e[r]),o=n?Xy(e[r]):e[r],a=n&&!Object.keys(o).length;return o===void 0||a?i:Object.assign(i,{[r]:o})},{}):e}function RE(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?RE(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(n=>{RE(e,e.get(n),i)})}))}function Qy(e,t,i){let r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;let o=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&o.push(a)}),o.forEach(a=>{e.forEach(l=>{l.type===r&&l.trackId===a.id&&RE(e,l,n)})}),n}var iB=sE,Zy=tl("keys"),up=function(e){return Zy[e]||(Zy[e]=iB(e))},rB=!v(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),nB=Fi,oB=hi,sB=ko,aB=rB,$y=up("IE_PROTO"),CE=Object,cB=CE.prototype,yE=aB?CE.getPrototypeOf:function(e){var t=sB(e);if(nB(t,$y))return t[$y];var i=t.constructor;return oB(i)&&t instanceof i?i.prototype:t instanceof CE?cB:null},lB=K,dB=Nn,uB=hi,hB=String,pB=TypeError,mB=function(e,t,i){try{return lB(dB(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},_B=vr,fB=function(e){if(typeof e=="object"||uB(e))return e;throw pB("Can't set "+hB(e)+" as a prototype")},EB=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=mB(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(r,n){return _B(r),fB(n),t?e(r,n):r.__proto__=n,r}}():void 0),hp={},pp={},IE=Fi,gB=xs,SB=fE.indexOf,TB=pp,eI=K([].push),tI=function(e,t){var i,r=gB(e),n=0,o=[];for(i in r)!IE(TB,i)&&IE(r,i)&&eI(o,i);for(;t.length>n;)IE(r,i=t[n++])&&(~SB(o,i)||eI(o,i));return o},wE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],vB=tI,RB=wE.concat("length","prototype");hp.f=Object.getOwnPropertyNames||function(e){return vB(e,RB)};var zd={};zd.f=Object.getOwnPropertySymbols;var CB=Lr,yB=hp,IB=zd,wB=vr,AB=K([].concat),OB=CB("Reflect","ownKeys")||function(e){var t=yB.f(wB(e)),i=IB.f;return i?AB(t,i(e)):t},iI=Fi,bB=OB,NB=Ka,DB=Dn,AE={},PB=tI,kB=wE,mp=Object.keys||function(e){return PB(e,kB)},LB=ur,MB=My,UB=Dn,xB=vr,VB=xs,FB=mp;AE.f=LB&&!MB?Object.defineProperties:function(e,t){xB(e);for(var i,r=VB(t),n=FB(t),o=n.length,a=0;o>a;)UB.f(e,i=n[a++],r[i]);return e};var _p,rI=Lr("document","documentElement"),jB=vr,BB=AE,nI=wE,GB=pp,WB=rI,HB=lE,OE="prototype",bE="script",oI=up("IE_PROTO"),NE=function(){},sI=function(e){return"<"+bE+">"+e+"</"+bE+">"},aI=function(e){e.write(sI("")),e.close();var t=e.parentWindow.Object;return e=null,t},fp=function(){try{_p=new ActiveXObject("htmlfile")}catch{}var e,t,i;fp=typeof document<"u"?document.domain&&_p?aI(_p):(t=HB("iframe"),i="java"+bE+":",t.style.display="none",WB.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(sI("document.F=Object")),e.close(),e.F):aI(_p);for(var r=nI.length;r--;)delete fp[OE][nI[r]];return fp()};GB[oI]=!0;var Yd=Object.create||function(e,t){var i;return e!==null?(NE[OE]=jB(e),i=new NE,NE[OE]=null,i[oI]=e):i=fp(),t===void 0?i:BB.f(i,t)},KB=zr,zB=Fs,cI=Error,YB=K("".replace),qB=String(cI("zxcasd").stack),lI=/\n\s*at [^:]*:[^\n]*/,JB=lI.test(qB),XB=Tr,QB=!v(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",XB(1,7)),e.stack!==7)}),ZB=Fs,$B=function(e,t){if(JB&&typeof e=="string"&&!cI.prepareStackTrace)for(;t--;)e=YB(e,lI,"");return e},e3=QB,dI=Error.captureStackTrace,Ja={},t3=Ja,i3=Jt("iterator"),r3=Array.prototype,uI=function(e){return e!==void 0&&(t3.Array===e||r3[i3]===e)},n3=Lo,hI=np,o3=Qc,s3=Ja,a3=Jt("iterator"),Ep=function(e){if(!o3(e))return hI(e,a3)||hI(e,"@@iterator")||s3[n3(e)]},c3=Me,l3=Nn,d3=vr,u3=el,h3=Ep,p3=TypeError,DE=function(e,t){var i=arguments.length<2?h3(e):t;if(l3(i))return d3(c3(i,e));throw p3(u3(e)+" is not iterable")},m3=Me,pI=vr,_3=np,mI=function(e,t,i){var r,n;pI(e);try{if(!(r=_3(e,"return"))){if(t==="throw")throw i;return i}r=m3(r,e)}catch(o){n=!0,r=o}if(t==="throw")throw i;if(n)throw r;return pI(r),i},f3=Vs,E3=Me,g3=vr,S3=el,T3=uI,v3=ls,_I=Q,R3=DE,C3=Ep,fI=mI,y3=TypeError,gp=function(e,t){this.stopped=e,this.result=t},EI=gp.prototype,qd=function(e,t,i){var r,n,o,a,l,d,u,p=i&&i.that,m=!(!i||!i.AS_ENTRIES),f=!(!i||!i.IS_RECORD),E=!(!i||!i.IS_ITERATOR),I=!(!i||!i.INTERRUPTED),T=f3(t,p),R=function(O){return r&&fI(r,"normal",O),new gp(!0,O)},w=function(O){return m?(g3(O),I?T(O[0],O[1],R):T(O[0],O[1])):I?T(O,R):T(O)};if(f)r=e.iterator;else if(E)r=e;else{if(!(n=C3(e)))throw y3(S3(e)+" is not iterable");if(T3(n)){for(o=0,a=v3(e);a>o;o++)if((l=w(e[o]))&&_I(EI,l))return l;return new gp(!1)}r=R3(e,n)}for(d=f?e.next:r.next;!(u=E3(d,r)).done;){try{l=w(u.value)}catch(O){fI(r,"throw",O)}if(typeof l=="object"&&l&&_I(EI,l))return l}return new gp(!1)},I3=hn,w3=Tt,A3=Q,O3=yE,Sp=EB,b3=function(e,t,i){for(var r=bB(t),n=DB.f,o=NB.f,a=0;a<r.length;a++){var l=r[a];iI(e,l)||i&&iI(i,l)||n(e,l,o(t,l))}},gI=Yd,PE=Fs,kE=Tr,N3=function(e,t){KB(t)&&"cause"in t&&zB(e,"cause",t.cause)},D3=function(e,t,i,r){e3&&(dI?dI(e,t):ZB(e,"stack",$B(i,r)))},P3=qd,k3=function(e,t){return e===void 0?arguments.length<2?"":t:I3(e)},L3=Jt("toStringTag"),Tp=Error,M3=[].push,ol=function(e,t){var i,r=A3(LE,this);Sp?i=Sp(Tp(),r?O3(this):LE):(i=r?this:gI(LE),PE(i,L3,"Error")),t!==void 0&&PE(i,"message",k3(t)),D3(i,ol,i.stack,1),arguments.length>2&&N3(i,arguments[2]);var n=[];return P3(e,M3,{that:n}),PE(i,"errors",n),i};Sp?Sp(ol,Tp):b3(ol,Tp,{name:!0});var LE=ol.prototype=gI(Tp.prototype,{constructor:kE(1,ol),message:kE(1,""),name:kE(1,"AggregateError")});w3({global:!0,constructor:!0,arity:2},{AggregateError:ol});var vp,Jd,Rp,U3=hi,SI=ce.WeakMap,x3=U3(SI)&&/native code/.test(String(SI)),TI=ce,V3=zr,F3=Fs,ME=Fi,UE=oE,j3=up,B3=pp,vI="Object already initialized",xE=TI.TypeError,G3=TI.WeakMap;if(x3||UE.state){var Mo=UE.state||(UE.state=new G3);Mo.get=Mo.get,Mo.has=Mo.has,Mo.set=Mo.set,vp=function(e,t){if(Mo.has(e))throw xE(vI);return t.facade=e,Mo.set(e,t),t},Jd=function(e){return Mo.get(e)||{}},Rp=function(e){return Mo.has(e)}}else{var sl=j3("state");B3[sl]=!0,vp=function(e,t){if(ME(e,sl))throw xE(vI);return t.facade=e,F3(e,sl,t),t},Jd=function(e){return ME(e,sl)?e[sl]:{}},Rp=function(e){return ME(e,sl)}}var Xa,RI,CI,Qa={set:vp,get:Jd,has:Rp,enforce:function(e){return Rp(e)?Jd(e):vp(e,{})},getterFor:function(e){return function(t){var i;if(!V3(t)||(i=Jd(t)).type!==e)throw xE("Incompatible receiver, "+e+" required");return i}}},VE=ur,W3=Fi,yI=Function.prototype,H3=VE&&Object.getOwnPropertyDescriptor,FE=W3(yI,"name"),II={EXISTS:FE,PROPER:FE&&(function(){}).name==="something",CONFIGURABLE:FE&&(!VE||VE&&H3(yI,"name").configurable)},K3=Fs,js=function(e,t,i,r){return r&&r.enumerable?e[t]=i:K3(e,t,i),e},z3=v,Y3=hi,q3=zr,J3=Yd,wI=yE,X3=js,jE=Jt("iterator"),AI=!1;[].keys&&("next"in(CI=[].keys())?(RI=wI(wI(CI)))!==Object.prototype&&(Xa=RI):AI=!0);var Q3=!q3(Xa)||z3(function(){var e={};return Xa[jE].call(e)!==e});Y3((Xa=Q3?{}:J3(Xa))[jE])||X3(Xa,jE,function(){return this});var OI={IteratorPrototype:Xa,BUGGY_SAFARI_ITERATORS:AI},Z3=Lo,$3=EE?{}.toString:function(){return"[object "+Z3(this)+"]"},eG=EE,tG=Dn.f,iG=Fs,rG=Fi,nG=$3,bI=Jt("toStringTag"),Bs=function(e,t,i,r){if(e){var n=i?e:e.prototype;rG(n,bI)||tG(n,bI,{configurable:!0,value:t}),r&&!eG&&iG(n,"toString",nG)}},oG=OI.IteratorPrototype,sG=Yd,aG=Tr,cG=Bs,lG=Ja,dG=function(){return this},BE=function(e,t,i,r){var n=t+" Iterator";return e.prototype=sG(oG,{next:aG(+!r,i)}),cG(e,n,!1,!0),lG[n]=dG,e},uG=Tt,hG=Me,pG=II,mG=BE,_G=yE,fG=Bs,NI=js,DI=Ja,EG=OI,gG=pG.PROPER,Cp=EG.BUGGY_SAFARI_ITERATORS,GE=Jt("iterator"),PI="keys",yp="values",kI="entries",SG=function(){return this},LI=function(e,t,i,r,n,o,a){mG(i,t,r);var l,d,u,p=function(w){if(w===n&&T)return T;if(!Cp&&w in E)return E[w];switch(w){case PI:case yp:case kI:return function(){return new i(this,w)}}return function(){return new i(this)}},m=t+" Iterator",f=!1,E=e.prototype,I=E[GE]||E["@@iterator"]||n&&E[n],T=!Cp&&I||p(n),R=t=="Array"&&E.entries||I;if(R&&(l=_G(R.call(new e)))!==Object.prototype&&l.next&&(fG(l,m,!0,!0),DI[m]=SG),gG&&n==yp&&I&&I.name!==yp&&(f=!0,T=function(){return hG(I,this)}),n)if(d={values:p(yp),keys:o?T:p(PI),entries:p(kI)},a)for(u in d)(Cp||f||!(u in E))&&NI(E,u,d[u]);else uG({target:t,proto:!0,forced:Cp||f},d);return a&&E[GE]!==T&&NI(E,GE,T,{name:n}),DI[t]=T,d},WE=function(e,t){return{value:e,done:t}},TG=xs,MI=Ja,UI=Qa;Dn.f;var vG=LI,xI=WE,VI="Array Iterator",RG=UI.set,CG=UI.getterFor(VI);vG(Array,"Array",function(e,t){RG(this,{type:VI,target:TG(e),index:0,kind:t})},function(){var e=CG(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,xI(void 0,!0)):xI(i=="keys"?r:i=="values"?t[r]:[r,t[r]],!1)},"values"),MI.Arguments=MI.Array;var yG=Dn,Ip=function(e,t,i){return yG.f(e,t,i)},IG=Lr,wG=Ip,AG=ur,FI=Jt("species"),OG=Q,bG=TypeError,HE=function(e,t){if(OG(t,e))return e;throw bG("Incorrect invocation")},NG=hi,KE=oE,DG=K(Function.toString);NG(KE.inspectSource)||(KE.inspectSource=function(e){return DG(e)});var jI=KE.inspectSource,PG=K,kG=v,BI=hi,LG=Lo,MG=jI,GI=function(){},UG=[],WI=Lr("Reflect","construct"),zE=/^\s*(?:class|function)\b/,xG=PG(zE.exec),VG=!zE.exec(GI),Xd=function(e){if(!BI(e))return!1;try{return WI(GI,UG,e),!0}catch{return!1}},HI=function(e){if(!BI(e))return!1;switch(LG(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return VG||!!xG(zE,MG(e))}catch{return!0}};HI.sham=!0;var Qd,al,KI,YE,wp=!WI||kG(function(){var e;return Xd(Xd.call)||!Xd(Object)||!Xd(function(){e=!0})||e})?HI:Xd,FG=wp,jG=el,BG=TypeError,zI=vr,GG=function(e){if(FG(e))return e;throw BG(jG(e)+" is not a constructor")},WG=Qc,HG=Jt("species"),qE=function(e,t){var i,r=zI(e).constructor;return r===void 0||WG(i=zI(r)[HG])?t:GG(i)},JE=K([].slice),KG=TypeError,Ap=function(e,t){if(e<t)throw KG("Not enough arguments");return e},YI=/(?:ipad|iphone|ipod).*applewebkit/i.test(za),pn=ce,zG=Y,YG=Vs,qI=hi,qG=Fi,JI=v,XI=rI,JG=JE,QI=lE,XG=Ap,QG=YI,ZG=Kd,XE=pn.setImmediate,QE=pn.clearImmediate,$G=pn.process,ZE=pn.Dispatch,e4=pn.Function,ZI=pn.MessageChannel,t4=pn.String,$E=0,Zd={},$I="onreadystatechange";JI(function(){Qd=pn.location});var eg=function(e){if(qG(Zd,e)){var t=Zd[e];delete Zd[e],t()}},tg=function(e){return function(){eg(e)}},e0=function(e){eg(e.data)},t0=function(e){pn.postMessage(t4(e),Qd.protocol+"//"+Qd.host)};XE&&QE||(XE=function(e){XG(arguments.length,1);var t=qI(e)?e:e4(e),i=JG(arguments,1);return Zd[++$E]=function(){zG(t,void 0,i)},al($E),$E},QE=function(e){delete Zd[e]},ZG?al=function(e){$G.nextTick(tg(e))}:ZE&&ZE.now?al=function(e){ZE.now(tg(e))}:ZI&&!QG?(YE=(KI=new ZI).port2,KI.port1.onmessage=e0,al=YG(YE.postMessage,YE)):pn.addEventListener&&qI(pn.postMessage)&&!pn.importScripts&&Qd&&Qd.protocol!=="file:"&&!JI(t0)?(al=t0,pn.addEventListener("message",e0,!1)):al=$I in QI("script")?function(e){XI.appendChild(QI("script"))[$I]=function(){XI.removeChild(this),eg(e)}}:function(e){setTimeout(tg(e),0)});var i0={set:XE,clear:QE},r0=function(){this.head=null,this.tail=null};r0.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var cl,ig,rg,ng,n0,o0=r0,i4=/ipad|iphone|ipod/i.test(za)&&typeof Pebble<"u",r4=/web0s(?!.*chrome)/i.test(za),Za=ce,s0=Vs,n4=Ka.f,og=i0.set,o4=o0,s4=YI,a4=i4,c4=r4,sg=Kd,a0=Za.MutationObserver||Za.WebKitMutationObserver,c0=Za.document,l0=Za.process,Op=Za.Promise,d0=n4(Za,"queueMicrotask"),ag=d0&&d0.value;if(!ag){var bp=new o4,Np=function(){var e,t;for(sg&&(e=l0.domain)&&e.exit();t=bp.get();)try{t()}catch(i){throw bp.head&&cl(),i}e&&e.enter()};s4||sg||c4||!a0||!c0?!a4&&Op&&Op.resolve?((ng=Op.resolve(void 0)).constructor=Op,n0=s0(ng.then,ng),cl=function(){n0(Np)}):sg?cl=function(){l0.nextTick(Np)}:(og=s0(og,Za),cl=function(){og(Np)}):(ig=!0,rg=c0.createTextNode(""),new a0(Np).observe(rg,{characterData:!0}),cl=function(){rg.data=ig=!ig}),ag=function(e){bp.head||cl(),bp.add(e)}}var l4=ag,ll=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},$a=ce.Promise,u0=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",d4=!u0&&!Kd&&typeof window=="object"&&typeof document=="object",u4=ce,$d=$a,h4=hi,p4=Ly,m4=jI,_4=Jt,f4=d4,E4=u0,cg=Ya,h0=$d&&$d.prototype,g4=_4("species"),p0=!1,m0=h4(u4.PromiseRejectionEvent),S4=p4("Promise",function(){var e=m4($d),t=e!==String($d);if(!t&&cg===66||!h0.catch||!h0.finally)return!0;if(!cg||cg<51||!/native code/.test(e)){var i=new $d(function(n){n(1)}),r=function(n){n(function(){},function(){})};if((i.constructor={})[g4]=r,!(p0=i.then(function(){})instanceof r))return!0}return!t&&(f4||E4)&&!m0}),eu={CONSTRUCTOR:S4,REJECTION_EVENT:m0,SUBCLASSING:p0},Uo={},_0=Nn,T4=TypeError,v4=function(e){var t,i;this.promise=new e(function(r,n){if(t!==void 0||i!==void 0)throw T4("Bad Promise constructor");t=r,i=n}),this.resolve=_0(t),this.reject=_0(i)};Uo.f=function(e){return new v4(e)};var lg,f0,R4=Tt,Dp=Kd,Gs=ce,tu=Me,C4=js,y4=Bs,I4=function(e){var t=IG(e);AG&&t&&!t[FI]&&wG(t,FI,{configurable:!0,get:function(){return this}})},w4=Nn,dg=hi,A4=zr,O4=HE,b4=qE,E0=i0.set,ug=l4,N4=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},D4=ll,P4=o0,g0=Qa,hg=$a,S0=eu,T0=Uo,Pp="Promise",v0=S0.CONSTRUCTOR,k4=S0.REJECTION_EVENT,pg=g0.getterFor(Pp),L4=g0.set,M4=hg&&hg.prototype,iu=hg,mg=M4,R0=Gs.TypeError,_g=Gs.document,fg=Gs.process,Eg=T0.f,U4=Eg,x4=!!(_g&&_g.createEvent&&Gs.dispatchEvent),C0="unhandledrejection",y0=function(e){var t;return!(!A4(e)||!dg(t=e.then))&&t},I0=function(e,t){var i,r,n,o=t.value,a=t.state==1,l=a?e.ok:e.fail,d=e.resolve,u=e.reject,p=e.domain;try{l?(a||(t.rejection===2&&F4(t),t.rejection=1),l===!0?i=o:(p&&p.enter(),i=l(o),p&&(p.exit(),n=!0)),i===e.promise?u(R0("Promise-chain cycle")):(r=y0(i))?tu(r,i,d,u):d(i)):u(o)}catch(m){p&&!n&&p.exit(),u(m)}},w0=function(e,t){e.notified||(e.notified=!0,ug(function(){for(var i,r=e.reactions;i=r.get();)I0(i,e);e.notified=!1,t&&!e.rejection&&V4(e)}))},A0=function(e,t,i){var r,n;x4?((r=_g.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Gs.dispatchEvent(r)):r={promise:t,reason:i},!k4&&(n=Gs["on"+e])?n(r):e===C0&&N4("Unhandled promise rejection",i)},V4=function(e){tu(E0,Gs,function(){var t,i=e.facade,r=e.value;if(O0(e)&&(t=D4(function(){Dp?fg.emit("unhandledRejection",r,i):A0(C0,i,r)}),e.rejection=Dp||O0(e)?2:1,t.error))throw t.value})},O0=function(e){return e.rejection!==1&&!e.parent},F4=function(e){tu(E0,Gs,function(){var t=e.facade;Dp?fg.emit("rejectionHandled",t):A0("rejectionhandled",t,e.value)})},dl=function(e,t,i){return function(r){e(t,r,i)}},ul=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,w0(e,!0))},gg=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw R0("Promise can't be resolved itself");var r=y0(t);r?ug(function(){var n={done:!1};try{tu(r,t,dl(gg,n,e),dl(ul,n,e))}catch(o){ul(n,o,e)}}):(e.value=t,e.state=1,w0(e,!1))}catch(n){ul({done:!1},n,e)}}};v0&&(mg=(iu=function(e){O4(this,mg),w4(e),tu(lg,this);var t=pg(this);try{e(dl(gg,t),dl(ul,t))}catch(i){ul(t,i)}}).prototype,(lg=function(e){L4(this,{type:Pp,done:!1,notified:!1,parent:!1,reactions:new P4,rejection:!1,state:0,value:void 0})}).prototype=C4(mg,"then",function(e,t){var i=pg(this),r=Eg(b4(this,iu));return i.parent=!0,r.ok=!dg(e)||e,r.fail=dg(t)&&t,r.domain=Dp?fg.domain:void 0,i.state==0?i.reactions.add(r):ug(function(){I0(r,i)}),r.promise}),f0=function(){var e=new lg,t=pg(e);this.promise=e,this.resolve=dl(gg,t),this.reject=dl(ul,t)},T0.f=Eg=function(e){return e===iu||e===void 0?new f0(e):U4(e)}),R4({global:!0,constructor:!0,wrap:!0,forced:v0},{Promise:iu}),y4(iu,Pp,!1,!0),I4(Pp);var b0=Jt("iterator"),N0=!1;try{var j4=0,D0={next:function(){return{done:!!j4++}},return:function(){N0=!0}};D0[b0]=function(){return this},Array.from(D0,function(){throw 2})}catch{}var B4=$a,G4=function(e,t){if(!N0)return!1;var i=!1;try{var r={};r[b0]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},kp=eu.CONSTRUCTOR||!G4(function(e){B4.all(e).then(void 0,function(){})}),W4=Me,H4=Nn,K4=Uo,z4=ll,Y4=qd;Tt({target:"Promise",stat:!0,forced:kp},{all:function(e){var t=this,i=K4.f(t),r=i.resolve,n=i.reject,o=z4(function(){var a=H4(t.resolve),l=[],d=0,u=1;Y4(e,function(p){var m=d++,f=!1;u++,W4(a,t,p).then(function(E){f||(f=!0,l[m]=E,--u||r(l))},n)}),--u||r(l)});return o.error&&n(o.value),i.promise}});var q4=Tt,J4=eu.CONSTRUCTOR;$a&&$a.prototype,q4({target:"Promise",proto:!0,forced:J4,real:!0},{catch:function(e){return this.then(void 0,e)}});var X4=Me,Q4=Nn,Z4=Uo,$4=ll,eW=qd;Tt({target:"Promise",stat:!0,forced:kp},{race:function(e){var t=this,i=Z4.f(t),r=i.reject,n=$4(function(){var o=Q4(t.resolve);eW(e,function(a){X4(o,t,a).then(i.resolve,r)})});return n.error&&r(n.value),i.promise}});var tW=Me,iW=Uo;Tt({target:"Promise",stat:!0,forced:eu.CONSTRUCTOR},{reject:function(e){var t=iW.f(this);return tW(t.reject,void 0,e),t.promise}});var rW=vr,nW=zr,oW=Uo,P0=function(e,t){if(rW(e),nW(t)&&t.constructor===e)return t;var i=oW.f(e);return(0,i.resolve)(t),i.promise},sW=Tt,aW=$a,cW=eu.CONSTRUCTOR,lW=P0,dW=Lr("Promise"),uW=!cW;sW({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return lW(uW&&this===dW?aW:this,e)}});var hW=Me,pW=Nn,mW=Uo,_W=ll,fW=qd;Tt({target:"Promise",stat:!0,forced:kp},{allSettled:function(e){var t=this,i=mW.f(t),r=i.resolve,n=i.reject,o=_W(function(){var a=pW(t.resolve),l=[],d=0,u=1;fW(e,function(p){var m=d++,f=!1;u++,hW(a,t,p).then(function(E){f||(f=!0,l[m]={status:"fulfilled",value:E},--u||r(l))},function(E){f||(f=!0,l[m]={status:"rejected",reason:E},--u||r(l))})}),--u||r(l)});return o.error&&n(o.value),i.promise}});var EW=Me,gW=Nn,SW=Lr,TW=Uo,vW=ll,RW=qd,k0="No one promise resolved";Tt({target:"Promise",stat:!0,forced:kp},{any:function(e){var t=this,i=SW("AggregateError"),r=TW.f(t),n=r.resolve,o=r.reject,a=vW(function(){var l=gW(t.resolve),d=[],u=0,p=1,m=!1;RW(e,function(f){var E=u++,I=!1;p++,EW(l,t,f).then(function(T){I||m||(m=!0,n(T))},function(T){I||m||(I=!0,d[E]=T,--p||o(new i(d,k0)))})}),--p||o(new i(d,k0))});return a.error&&o(a.value),r.promise}});var CW=Tt,Sg=$a,yW=v,IW=Lr,wW=hi,AW=qE,L0=P0,OW=Sg&&Sg.prototype;CW({target:"Promise",proto:!0,real:!0,forced:!!Sg&&yW(function(){OW.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=AW(this,IW("Promise")),i=wW(e);return this.then(i?function(r){return L0(t,e()).then(function(){return r})}:e,i?function(r){return L0(t,e()).then(function(){throw r})}:e)}});var Tg=K,bW=mE,NW=hn,DW=Zc,PW=Tg("".charAt),M0=Tg("".charCodeAt),kW=Tg("".slice),U0=function(e){return function(t,i){var r,n,o=NW(DW(t)),a=bW(i),l=o.length;return a<0||a>=l?e?"":void 0:(r=M0(o,a))<55296||r>56319||a+1===l||(n=M0(o,a+1))<56320||n>57343?e?PW(o,a):r:e?kW(o,a,a+2):n-56320+(r-55296<<10)+65536}},vg={codeAt:U0(!1),charAt:U0(!0)},LW=vg.charAt,MW=hn,x0=Qa,UW=LI,V0=WE,F0="String Iterator",xW=x0.set,VW=x0.getterFor(F0);UW(String,"String",function(e){xW(this,{type:F0,string:MW(e),index:0})},function(){var e,t=VW(this),i=t.string,r=t.index;return r>=i.length?V0(void 0,!0):(e=LW(i,r),t.index+=e.length,V0(e,!1))});var FW=so.Promise,jW={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},BW=ce,GW=Lo,WW=Fs,j0=Ja,B0=Jt("toStringTag");for(var Rg in jW){var G0=BW[Rg],Cg=G0&&G0.prototype;Cg&&GW(Cg)!==B0&&WW(Cg,B0,Rg),j0[Rg]=j0.Array}var W0=FW,ne=g(W0);let H0=qy;function K0(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;let l={};return Object.keys(a).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;let u=typeof a[d]=="object"?a[d]:{ideal:a[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);let p=function(m,f){return m?m+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){l.optional=l.optional||[];let m={};typeof u.ideal=="number"?(m[p("min",d)]=u.ideal,l.optional.push(m),m={},m[p("max",d)]=u.ideal,l.optional.push(m)):(m[p("",d)]=u.ideal,l.optional.push(m))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=u.exact):["min","max"].forEach(m=>{u[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,d)]=u[m])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},n=function(a,l){if(t.version>=61)return l(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){let d=function(u,p,m){p in u&&!(m in u)&&(u[m]=u[p],delete u[p])};d((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),d(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let d=a.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});let u=t.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||u)){let p;if(delete a.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return i.mediaDevices.enumerateDevices().then(m=>{let f=(m=m.filter(E=>E.kind==="videoinput")).find(E=>p.some(I=>{var T;return se(T=E.label.toLowerCase()).call(T,I)}));return!f&&m.length&&se(p).call(p,"back")&&(f=m[m.length-1]),f&&(a.video.deviceId=d.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=r(a.video),H0("chrome: "+JSON.stringify(a)),l(a)})}a.video=r(a.video)}return H0("chrome: "+JSON.stringify(a)),l(a)},o=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(a,l,d){n(a,u=>{i.webkitGetUserMedia(u,l,p=>{d&&d(o(p))})})}).bind(i),i.mediaDevices.getUserMedia){let a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(l){return n(l,d=>a(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>ne.reject(o(u))))}}}function z0(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Y0(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):{track:r.track};let o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.id):{track:r};let o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else qa(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function q0(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(n,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=n.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,l){let d=n.apply(this,arguments);return d||(d=t(this,a),this._senders.push(d)),d};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);let l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(n){this._senders=this._senders||[],i.apply(this,[n]),n.getTracks().forEach(o=>{this._senders.push(t(this,o))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(n){this._senders=this._senders||[],r.apply(this,[n]),n.getTracks().forEach(o=>{let a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function J0(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,r,n]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);let o=function(l){let d={};return l.result().forEach(u=>{let p={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(m=>{p[m]=u.stat(m)}),d[p.id]=p}),d},a=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){let l=function(d){r(a(o(d)))};return t.apply(this,[l,i])}return new ne((l,d)=>{t.apply(this,[function(u){l(a(o(u)))},d])}).then(r,n)}}function X0(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=i.apply(this,[]);return n.forEach(o=>o._pc=this),n});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){let n=this;return this._pc.getStats().then(o=>Qy(o,n.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=i.apply(this,[]);return r.forEach(n=>n._pc=this),r}),qa(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(n=>Qy(n,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],r,n,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(n?o=!0:n=a),a.track===i)),o||r&&n?ne.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():ne.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Q0(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(u=>u.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});let a=this.getSenders();i.apply(this,arguments);let l=this.getSenders().filter(d=>a.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{let l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function Z0(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Q0(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){let u=new e.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}r.apply(this,[d])};let n=e.RTCPeerConnection.prototype.removeStream;function o(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{let f=d._reverseStreams[m],E=d._streams[f.id];p=p.replace(new RegExp(E.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},e.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(f=>f===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let m=this._streams[u.id];if(m)m.addTrack(d),ne.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let f=new e.MediaStream([d]);this._streams[u.id]=f,this._reverseStreams[f.id]=u,this.addStream(f)}return this.getSenders().find(f=>f.track===d)},["createOffer","createAnswer"].forEach(function(d){let u=e.RTCPeerConnection.prototype[d],p={[d](){let m=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[f=>{let E=o(this,f);m[0].apply(null,[E])},f=>{m[1]&&m[1].apply(null,f)},arguments[2]]):u.apply(this,arguments).then(f=>o(this,f))}};e.RTCPeerConnection.prototype[d]=p[d]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{let f=d._reverseStreams[m],E=d._streams[f.id];p=p.replace(new RegExp(f.id,"g"),E.id)}),new RTCSessionDescription({type:u.type,sdp:p})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let d=l.get.apply(this);return d.type===""?d:o(this,d)}}),e.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(u=this._streams[p])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function yg(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let r=e.RTCPeerConnection.prototype[i],n={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=n[i]})}function $0(e,t){qa(e,"negotiationneeded",i=>{let r=i.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return i})}var ew=Object.freeze({__proto__:null,fixNegotiationNeeded:$0,shimAddTrackRemoveTrack:Z0,shimAddTrackRemoveTrackWithNative:Q0,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(r=>{let n=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:a||3}},n&&(i.video.mandatory.maxWidth=n),o&&(i.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:q0,shimGetStats:J0,shimGetUserMedia:K0,shimMediaStream:z0,shimOnTrack:Y0,shimPeerConnection:yg,shimSenderReceiverGetStats:X0});function tw(e,t){let i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(n,o,a){vE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(n).then(o,a)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let n=function(a,l,d){l in a&&!(d in a)&&(a[d]=a[l],delete a[l])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},r&&r.prototype.getSettings){let a=r.prototype.getSettings;r.prototype.getSettings=function(){let l=a.apply(this,arguments);return n(l,"mozAutoGainControl","autoGainControl"),n(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){let a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),n(l,"autoGainControl","mozAutoGainControl"),n(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function iw(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ig(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let o=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,o,a]=arguments;return r.apply(this,[n||null]).then(l=>{if(t.version<53&&!o)try{l.forEach(d=>{d.type=i[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((u,p)=>{l.set(p,Object.assign({},u,{type:i[u.type]||u.type}))})}return l}).then(o,a)}}function rw(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ne.resolve(new Map)}}function nw(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i}),qa(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ow(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){vE("removeStream","removeTrack"),this.getSenders().forEach(i=>{var r;i.track&&se(r=t.getTracks()).call(r,i.track)&&this.removeTrack(i)})})}function sw(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function aw(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let n=t.apply(this,arguments);if(r){let{sender:o}=n,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return n})}function cw(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function lw(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function dw(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var uw=Object.freeze({__proto__:null,shimAddTransceiver:aw,shimCreateAnswer:dw,shimCreateOffer:lw,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ne.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:cw,shimGetUserMedia:tw,shimOnTrack:iw,shimPeerConnection:Ig,shimRTCDataChannel:sw,shimReceiverGetStats:nw,shimRemoveStream:ow,shimSenderGetStats:rw});function hw(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var r;this._localStreams||(this._localStreams=[]),se(r=this._localStreams).call(r,i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>t.call(this,n,i)),i.getVideoTracks().forEach(n=>t.call(this,n,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return n&&n.forEach(a=>{var l;this._localStreams?se(l=this._localStreams).call(l,a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);let r=t.getTracks();this.getSenders().forEach(n=>{se(r).call(r,n.track)&&this.removeTrack(n)})})}}function pw(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),se(o=this._remoteStreams).call(o,n))return;this._remoteStreams.push(n);let a=new Event("addstream");a.stream=n,this.dispatchEvent(a)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(n=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(n)>=0)return;i._remoteStreams.push(n);let o=new Event("addstream");o.stream=n,i.dispatchEvent(o)})}),t.apply(i,arguments)}}}function mw(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(d,u){let p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return u?(m.then(d,u),ne.resolve()):m},t.createAnswer=function(d,u){let p=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[p]);return u?(m.then(d,u),ne.resolve()):m};let l=function(d,u,p){let m=n.apply(this,[d]);return p?(m.then(u,p),ne.resolve()):m};t.setLocalDescription=l,l=function(d,u,p){let m=o.apply(this,[d]);return p?(m.then(u,p),ne.resolve()):m},t.setRemoteDescription=l,l=function(d,u,p){let m=a.apply(this,[d]);return p?(m.then(u,p),ne.resolve()):m},t.addIceCandidate=l}function _w(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let i=t.mediaDevices,r=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=n=>r(fw(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,r,n){t.mediaDevices.getUserMedia(i).then(r,n)}).bind(t))}function fw(e){return e&&e.video!==void 0?Object.assign({},e,{video:Xy(e.video)}):e}function Ew(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,r){if(i&&i.iceServers){let n=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(vE("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,n.push(a)):n.push(i.iceServers[o])}i.iceServers=n}return new t(i,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function gw(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Sw(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let n=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveVideo!==!0||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Tw(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var vw=Object.freeze({__proto__:null,shimAudioContext:Tw,shimCallbacksAPI:mw,shimConstraints:fw,shimCreateOfferLegacy:Sw,shimGetUserMedia:_w,shimLocalStreamsAPI:hw,shimRTCIceServerUrls:Ew,shimRemoteStreamsAPI:pw,shimTrackEventTransceiver:gw}),Rw=`	
\v\f\r                　\u2028\u2029\uFEFF`,HW=Zc,KW=hn,wg=Rw,Cw=K("".replace),zW=RegExp("^["+wg+"]+"),YW=RegExp("(^|[^"+wg+"])["+wg+"]+$"),Ag=function(e){return function(t){var i=KW(HW(t));return 1&e&&(i=Cw(i,zW,"")),2&e&&(i=Cw(i,YW,"$1")),i}},qW={start:Ag(1),end:Ag(2),trim:Ag(3)},JW=II.PROPER,XW=v,yw=Rw,QW=qW.trim;Tt({target:"String",proto:!0,forced:function(e){return XW(function(){return!!yw[e]()||"​᠎"[e]()!=="​᠎"||JW&&yw[e].name!==e})}("trim")},{trim:function(){return QW(this)}});var ZW=Pn("String").trim,$W=Q,e5=ZW,Og=String.prototype,t5=function(e){var t=e.trim;return typeof e=="string"||e===Og||$W(Og,e)&&t===Og.trim?e5:t},qi=g(t5),Iw={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(i){return i.split(`
m=`).map((r,n)=>(n>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(i){let r=t.splitSections(i);return r&&r[0]},t.getMediaSections=function(i){let r=t.splitSections(i);return r.shift(),r},t.matchPrefix=function(i,r){return t.splitLines(i).filter(n=>n.indexOf(r)===0)},t.parseCandidate=function(i){let r;r=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":n.relatedAddress=r[o+1];break;case"rport":n.relatedPort=parseInt(r[o+1],10);break;case"tcptype":n.tcpType=r[o+1];break;case"ufrag":n.ufrag=r[o+1],n.usernameFragment=r[o+1];break;default:n[r[o]]===void 0&&(n[r[o]]=r[o+1])}return n},t.writeCandidate=function(i){let r=[];r.push(i.foundation);let n=i.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);let o=i.type;return r.push("typ"),r.push(o),o!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let r=i.substring(9).split(" "),n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){let r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);let n=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){let r=i.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){let r={},n,o=i.substring(i.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)n=o[a].trim().split("="),r[n[0].trim()]=n[1];return r},t.writeFmtp=function(i){let r="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let o=[];Object.keys(i.parameters).forEach(a=>{i.parameters[a]!==void 0?o.push(a+"="+i.parameters[a]):o.push(a)}),r+="a=fmtp:"+n+" "+o.join(";")+`\r
`}return r},t.parseRtcpFb=function(i){let r=i.substring(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(i){let r="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+n+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(i){let r=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,r),10)},o=i.indexOf(":",r);return o>-1?(n.attribute=i.substring(r+1,o),n.value=i.substring(o+1)):n.attribute=i.substring(r+1),n},t.parseSsrcGroup=function(i){let r=i.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},t.getMid=function(i){let r=t.matchPrefix(i,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(i){let r=i.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(i,r){return{role:"auto",fingerprints:t.matchPrefix(i+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,r){let n="a=setup:"+r+`\r
`;return i.fingerprints.forEach(o=>{n+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),n},t.parseCryptoLine=function(i){let r=i.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let r=i.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,r){return t.matchPrefix(i+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,r){let n=t.matchPrefix(i+r,"a=ice-ufrag:")[0],o=t.matchPrefix(i+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(i){let r="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(i){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(i)[0].split(" ");r.profile=n[2];for(let a=3;a<n.length;a++){let l=n[a],d=t.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(d){let u=t.parseRtpMap(d),p=t.matchPrefix(i,"a=fmtp:"+l+" ");switch(u.parameters=p.length?t.parseFmtp(p[0]):{},u.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))});let o=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(i,r){let n="";n+="m="+i+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{n+=t.writeRtpMap(a),n+=t.writeFmtp(a),n+=t.writeRtcpFb(a)});let o=0;return r.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(n+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{n+=t.writeExtmap(a)}),n},t.parseRtpEncodingParameters=function(i){let r=[],n=t.parseRtpParameters(i),o=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(i,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),d=l.length>0&&l[0].ssrc,u,p=t.matchPrefix(i,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(E=>parseInt(E,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(u=p[0][1]),n.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let E={ssrc:d,codecPayloadType:parseInt(f.parameters.apt,10)};d&&u&&(E.rtx={ssrc:u}),r.push(E),o&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:d,mechanism:a?"red+ulpfec":"red"},r.push(E))}}),r.length===0&&d&&r.push({ssrc:d});let m=t.matchPrefix(i,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,r.forEach(f=>{f.maxBitrate=m})),r},t.parseRtcpParameters=function(i){let r={},n=t.matchPrefix(i,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);let o=t.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;let a=t.matchPrefix(i,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(i){let r="";return i.reducedSize&&(r+=`a=rtcp-rsize\r
`),i.mux&&(r+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(r+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),r},t.parseMsid=function(i){let r,n=t.matchPrefix(i,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};let o=t.matchPrefix(i,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(i){let r=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:"),o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);let a=t.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};let l=t.matchPrefix(i,"a=sctpmap:");if(l.length>0){let d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:o}}},t.writeSctpDescription=function(i,r){let n=[];return n=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,r,n){let o,a=r!==void 0?r:2;return o=i||t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,r){let n=t.splitLines(i);for(let o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){let r=t.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(i){let r=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let r=t.splitLines(i);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},e.exports=t})(Iw);var ww=Iw.exports,hl=g(ww),i5=h({__proto__:null,default:hl},[ww]);function Lp(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let r=new t(i),n=hl.parseCandidate(i.candidate),o=Object.assign(r,n);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,qa(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function bg(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||qa(e,"icecandidate",t=>{if(t.candidate){let i=hl.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Mp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(l){if(!l||!l.sdp)return!1;let d=hl.splitSections(l.sdp);return d.shift(),d.some(u=>{let p=hl.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(l){let d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;let u=parseInt(d[1],10);return u!=u?-1:u},n=function(l){let d=65536;return t.browser==="firefox"&&(d=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),d},o=function(l,d){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);let p=hl.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substr(19),10):t.browser==="firefox"&&d!==-1&&(u=2147483637),u},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let l=r(arguments[0]),d=n(l),u=o(arguments[0],l),p;p=d===0&&u===0?Number.POSITIVE_INFINITY:d===0||u===0?Math.max(d,u):Math.min(d,u);let m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return a.apply(this,arguments)}}function Up(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,n){let o=r.send;r.send=function(){let a=arguments[0],l=a.length||a.size||a.byteLength;if(r.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=i.apply(this,arguments);return t(r,this),r},qa(e,"datachannel",r=>(t(r.channel,r.target),r))}function Ng(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let r=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{let o=n.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;let a=new Event("connectionstatechange",n);o.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Dg(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let n=r.sdp.split(`
`).filter(o=>qi(o).call(o)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:n}):r.sdp=n}return i.apply(this,arguments)}}function xp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ne.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ne.resolve())})}function Vp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(n=>i.apply(this,[n]))})}var r5=Object.freeze({__proto__:null,removeExtmapAllowMixed:Dg,shimAddIceCandidateNullOrEmpty:xp,shimConnectionState:Ng,shimMaxMessageSize:Mp,shimParameterlessSetLocalDescription:Vp,shimRTCIceCandidate:Lp,shimRTCIceCandidateRelayProtocol:bg,shimSendThrowTypeError:Up});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=qy,r=function(o){let a={browser:null,version:null};if(o===void 0||!o.navigator)return a.browser="Not a browser.",a;let{navigator:l}=o;if(l.mozGetUserMedia)a.browser="firefox",a.version=dp(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)a.browser="chrome",a.version=dp(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=dp(l.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return a}(e),n={browserDetails:r,commonShim:r5,extractVersion:dp,disableLog:eB,disableWarnings:tB,sdp:i5};switch(r.browser){case"chrome":if(!ew||!yg||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=ew,xp(e,r),Vp(e),K0(e,r),z0(e),yg(e,r),Y0(e),Z0(e,r),q0(e),J0(e),X0(e),$0(e,r),Lp(e),bg(e),Ng(e),Mp(e,r),Up(e),Dg(e,r);break;case"firefox":if(!uw||!Ig||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=uw,xp(e,r),Vp(e),tw(e,r),Ig(e,r),iw(e),ow(e),rw(e),nw(e),sw(e),aw(e),cw(e),lw(e),dw(e),Lp(e),Ng(e),Mp(e,r),Up(e);break;case"safari":if(!vw||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=vw,xp(e,r),Vp(e),Ew(e),Sw(e),mw(e),hw(e),pw(e),gw(e),_w(e),Tw(e),Lp(e),bg(e),Mp(e,r),Up(e),Dg(e,r);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var n5=Pn("Array").keys,o5=Lo,s5=Fi,a5=Q,c5=n5,Pg=Array.prototype,l5={DOMTokenList:!0,NodeList:!0},d5=function(e){var t=e.keys;return e===Pg||a5(Pg,e)&&t===Pg.keys||s5(l5,o5(e))?c5:t},Yr=g(d5),Aw=el,u5=TypeError,h5=op,p5=Dn,m5=Tr,Fp=function(e,t,i){var r=h5(t);r in e?p5.f(e,r,m5(0,i)):e[r]=i},Ow=_E,_5=ls,f5=Fp,E5=Array,g5=Math.max,kg=function(e,t,i){for(var r=_5(e),n=Ow(t,r),o=Ow(i===void 0?r:i,r),a=E5(g5(o-n,0)),l=0;n<o;n++,l++)f5(a,l,e[n]);return a.length=l,a},bw=kg,S5=Math.floor,Lg=function(e,t){var i=e.length,r=S5(i/2);return i<8?T5(e,t):v5(e,Lg(bw(e,0,r),t),Lg(bw(e,r),t),t)},T5=function(e,t){for(var i,r,n=e.length,o=1;o<n;){for(r=o,i=e[o];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==o++&&(e[r]=i)}return e},v5=function(e,t,i,r){for(var n=t.length,o=i.length,a=0,l=0;a<n||l<o;)e[a+l]=a<n&&l<o?r(t[a],i[l])<=0?t[a++]:i[l++]:a<n?t[a++]:i[l++];return e},Nw=Lg,Dw=za.match(/firefox\/(\d+)/i),R5=!!Dw&&+Dw[1],C5=/MSIE|Trident/.test(za),Pw=za.match(/AppleWebKit\/(\d+)\./),y5=!!Pw&&+Pw[1],I5=Tt,kw=K,w5=Nn,A5=ko,Lw=ls,O5=function(e,t){if(!delete e[t])throw u5("Cannot delete property "+Aw(t)+" of "+Aw(e))},Mw=hn,Mg=v,b5=Nw,N5=lp,Uw=R5,D5=C5,xw=Ya,Vw=y5,Ws=[],Fw=kw(Ws.sort),P5=kw(Ws.push),k5=Mg(function(){Ws.sort(void 0)}),L5=Mg(function(){Ws.sort(null)}),M5=N5("sort"),jw=!Mg(function(){if(xw)return xw<70;if(!(Uw&&Uw>3)){if(D5)return!0;if(Vw)return Vw<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)Ws.push({k:t+r,v:i})}for(Ws.sort(function(o,a){return a.v-o.v}),r=0;r<Ws.length;r++)t=Ws[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return n!=="DGBEFHACIJK"}});I5({target:"Array",proto:!0,forced:k5||!L5||!M5||!jw},{sort:function(e){e!==void 0&&w5(e);var t=A5(this);if(jw)return e===void 0?Fw(t):Fw(t,e);var i,r,n=[],o=Lw(t);for(r=0;r<o;r++)r in t&&P5(n,t[r]);for(b5(n,function(a){return function(l,d){return d===void 0?-1:l===void 0?1:a!==void 0?+a(l,d)||0:Mw(l)>Mw(d)?1:-1}}(e)),i=Lw(n),r=0;r<i;)t[r]=n[r++];for(;r<o;)O5(t,r++);return t}});var U5=Pn("Array").sort,x5=Q,V5=U5,Ug=Array.prototype,F5=function(e){var t=e.sort;return e===Ug||x5(Ug,e)&&t===Ug.sort?V5:t},ru=g(F5),xg={exports:{}};(function(e,t){(function(i,r){var n="function",o="undefined",a="object",l="string",d="major",u="model",p="name",m="type",f="vendor",E="version",I="architecture",T="console",R="mobile",w="tablet",O="smarttv",P="wearable",M="embedded",V="Amazon",F="Apple",q="ASUS",J="BlackBerry",Z="Browser",pe="Chrome",ze="Firefox",nt="Google",Ct="Huawei",$t="LG",Mt="Microsoft",$n="Motorola",z="Opera",re="Samsung",he="Sharp",ke="Sony",it="Xiaomi",oe="Zebra",C="Facebook",D="Chromium OS",k="Mac OS",ee=function(Yt){for(var oi={},At=0;At<Yt.length;At++)oi[Yt[At].toUpperCase()]=Yt[At];return oi},De=function(Yt,oi){return typeof Yt===l&&St(oi).indexOf(St(Yt))!==-1},St=function(Yt){return Yt.toLowerCase()},di=function(Yt,oi){if(typeof Yt===l)return Yt=Yt.replace(/^\s\s*/,""),typeof oi===o?Yt:Yt.substring(0,350)},Ar=function(Yt,oi){for(var At,jr,is,qt,rt,Or,Ta=0;Ta<oi.length&&!rt;){var Co=oi[Ta],jM=oi[Ta+1];for(At=jr=0;At<Co.length&&!rt&&Co[At];)if(rt=Co[At++].exec(Yt))for(is=0;is<jM.length;is++)Or=rt[++jr],typeof(qt=jM[is])===a&&qt.length>0?qt.length===2?typeof qt[1]==n?this[qt[0]]=qt[1].call(this,Or):this[qt[0]]=qt[1]:qt.length===3?typeof qt[1]!==n||qt[1].exec&&qt[1].test?this[qt[0]]=Or?Or.replace(qt[1],qt[2]):r:this[qt[0]]=Or?qt[1].call(this,Or,qt[2]):r:qt.length===4&&(this[qt[0]]=Or?qt[3].call(this,Or.replace(qt[1],qt[2])):r):this[qt]=Or||r;Ta+=2}},Is=function(Yt,oi){for(var At in oi)if(typeof oi[At]===a&&oi[At].length>0){for(var jr=0;jr<oi[At].length;jr++)if(De(oi[At][jr],Yt))return At==="?"?r:At}else if(De(oi[At],Yt))return At==="?"?r:At;return Yt},P_={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},k_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[E,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[E,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,E],[/opios[\/ ]+([\w\.]+)/i],[E,[p,z+" Mini"]],[/\bopr\/([\w\.]+)/i],[E,[p,z]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,E],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[E,[p,"UC"+Z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[E,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[E,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[E,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[E,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[E,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Z],E],[/\bfocus\/([\w\.]+)/i],[E,[p,ze+" Focus"]],[/\bopt\/([\w\.]+)/i],[E,[p,z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[E,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[E,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[E,[p,z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[E,[p,"MIUI "+Z]],[/fxios\/([-\w\.]+)/i],[E,[p,ze]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+Z]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+Z],E],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],E],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,E],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,C],E],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,E],[/\bgsa\/([\w\.]+) .*safari\//i],[E,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[E,[p,pe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,pe+" WebView"],E],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[E,[p,"Android "+Z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,E],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[E,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[E,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[E,Is,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,E],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],E],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[E,[p,ze+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,E],[/(cobalt)\/([\w\.]+)/i],[p,[E,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,St]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",St]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,St]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[f,re],[m,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[f,re],[m,R]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[f,F],[m,R]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[f,F],[m,w]],[/(macintosh);/i],[u,[f,F]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[f,he],[m,R]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[f,Ct],[m,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[f,Ct],[m,R]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[f,it],[m,R]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[f,it],[m,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[f,"OPPO"],[m,R]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[f,"Vivo"],[m,R]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[f,"Realme"],[m,R]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[f,$n],[m,R]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[f,$n],[m,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[f,$t],[m,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[f,$t],[m,R]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[f,"Lenovo"],[m,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[f,"Nokia"],[m,R]],[/(pixel c)\b/i],[u,[f,nt],[m,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[f,nt],[m,R]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[f,ke],[m,R]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[f,ke],[m,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[f,"OnePlus"],[m,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[f,V],[m,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[f,V],[m,R]],[/(playbook);[-\w\),; ]+(rim)/i],[u,f,[m,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[f,J],[m,R]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[f,q],[m,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[f,q],[m,R]],[/(nexus 9)/i],[u,[f,"HTC"],[m,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[u,/_/g," "],[m,R]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[f,"Acer"],[m,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[f,"Meizu"],[m,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,u,[m,R]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,u,[m,w]],[/(surface duo)/i],[u,[f,Mt],[m,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[f,"Fairphone"],[m,R]],[/(u304aa)/i],[u,[f,"AT&T"],[m,R]],[/\bsie-(\w*)/i],[u,[f,"Siemens"],[m,R]],[/\b(rct\w+) b/i],[u,[f,"RCA"],[m,w]],[/\b(venue[\d ]{2,7}) b/i],[u,[f,"Dell"],[m,w]],[/\b(q(?:mv|ta)\w+) b/i],[u,[f,"Verizon"],[m,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[f,"Barnes & Noble"],[m,w]],[/\b(tm\d{3}\w+) b/i],[u,[f,"NuVision"],[m,w]],[/\b(k88) b/i],[u,[f,"ZTE"],[m,w]],[/\b(nx\d{3}j) b/i],[u,[f,"ZTE"],[m,R]],[/\b(gen\d{3}) b.+49h/i],[u,[f,"Swiss"],[m,R]],[/\b(zur\d{3}) b/i],[u,[f,"Swiss"],[m,w]],[/\b((zeki)?tb.*\b) b/i],[u,[f,"Zeki"],[m,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],u,[m,w]],[/\b(ns-?\w{0,9}) b/i],[u,[f,"Insignia"],[m,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[f,"NextBook"],[m,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],u,[m,R]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],u,[m,R]],[/\b(ph-1) /i],[u,[f,"Essential"],[m,R]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[f,"Envizen"],[m,w]],[/\b(trio[-\w\. ]+) b/i],[u,[f,"MachSpeed"],[m,w]],[/\btu_(1491) b/i],[u,[f,"Rotor"],[m,w]],[/(shield[\w ]+) b/i],[u,[f,"Nvidia"],[m,w]],[/(sprint) (\w+)/i],[f,u,[m,R]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[f,Mt],[m,R]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[f,oe],[m,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[f,oe],[m,R]],[/smart-tv.+(samsung)/i],[f,[m,O]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[f,re],[m,O]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,$t],[m,O]],[/(apple) ?tv/i],[f,[u,F+" TV"],[m,O]],[/crkey/i],[[u,pe+"cast"],[f,nt],[m,O]],[/droid.+aft(\w)( bui|\))/i],[u,[f,V],[m,O]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[f,he],[m,O]],[/(bravia[\w ]+)( bui|\))/i],[u,[f,ke],[m,O]],[/(mitv-\w{5}) bui/i],[u,[f,it],[m,O]],[/Hbbtv.*(technisat) (.*);/i],[f,u,[m,O]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,di],[u,di],[m,O]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,O]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,u,[m,T]],[/droid.+; (shield) bui/i],[u,[f,"Nvidia"],[m,T]],[/(playstation [345portablevi]+)/i],[u,[f,ke],[m,T]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[f,Mt],[m,T]],[/((pebble))app/i],[f,u,[m,P]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[f,F],[m,P]],[/droid.+; (glass) \d/i],[u,[f,nt],[m,P]],[/droid.+; (wt63?0{2,3})\)/i],[u,[f,oe],[m,P]],[/(quest( 2| pro)?)/i],[u,[f,C],[m,P]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[m,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[m,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[m,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,R]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[E,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[E,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,E],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[E,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,E],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[E,Is,P_]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[E,Is,P_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[E,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,k],[E,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[E,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,E],[/\(bb(10);/i],[E,[p,J]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[E,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[E,[p,ze+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[E,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[E,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[E,[p,pe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,D],E],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,E],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],E],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,E]]},Cn=function(Yt,oi){if(typeof Yt===a&&(oi=Yt,Yt=r),!(this instanceof Cn))return new Cn(Yt,oi).getResult();var At=typeof i!==o&&i.navigator?i.navigator:r,jr=Yt||(At&&At.userAgent?At.userAgent:""),is=At&&At.userAgentData?At.userAgentData:r,qt=oi?function(rt,Or){var Ta={};for(var Co in rt)Or[Co]&&Or[Co].length%2==0?Ta[Co]=Or[Co].concat(rt[Co]):Ta[Co]=rt[Co];return Ta}(k_,oi):k_;return this.getBrowser=function(){var rt={};return rt[p]=r,rt[E]=r,Ar.call(rt,jr,qt.browser),rt[d]=function(Or){return typeof Or===l?Or.replace(/[^\d\.]/g,"").split(".")[0]:r}(rt[E]),At&&At.brave&&typeof At.brave.isBrave==n&&(rt[p]="Brave"),rt},this.getCPU=function(){var rt={};return rt[I]=r,Ar.call(rt,jr,qt.cpu),rt},this.getDevice=function(){var rt={};return rt[f]=r,rt[u]=r,rt[m]=r,Ar.call(rt,jr,qt.device),!rt[m]&&is&&is.mobile&&(rt[m]=R),rt[u]=="Macintosh"&&At&&typeof At.standalone!==o&&At.maxTouchPoints&&At.maxTouchPoints>2&&(rt[u]="iPad",rt[m]=w),rt},this.getEngine=function(){var rt={};return rt[p]=r,rt[E]=r,Ar.call(rt,jr,qt.engine),rt},this.getOS=function(){var rt={};return rt[p]=r,rt[E]=r,Ar.call(rt,jr,qt.os),!rt[p]&&is&&is.platform!="Unknown"&&(rt[p]=is.platform.replace(/chrome os/i,D).replace(/macos/i,k)),rt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return jr},this.setUA=function(rt){return jr=typeof rt===l&&rt.length>350?di(rt,350):rt,this},this.setUA(jr),this};Cn.VERSION="0.7.34",Cn.BROWSER=ee([p,E,d]),Cn.CPU=ee([I]),Cn.DEVICE=ee([u,f,m,T,R,O,w,P,M]),Cn.ENGINE=Cn.OS=ee([p,E]),e.exports&&(t=e.exports=Cn),t.UAParser=Cn;var Sa=typeof i!==o&&(i.jQuery||i.Zepto);if(Sa&&!Sa.ua){var ud=new Cn;Sa.ua=ud.getResult(),Sa.ua.get=function(){return ud.getUA()},Sa.ua.set=function(Yt){ud.setUA(Yt);var oi=ud.getResult();for(var At in oi)Sa.ua[At]=oi[At]}}})(typeof window=="object"?window:_)})(xg,xg.exports);var j5=g(xg.exports),B5=Lo,G5=Fi,W5=Qc,H5=Ja,K5=Jt("iterator"),z5=Object,Y5=function(e){if(W5(e))return!1;var t=z5(e);return t[K5]!==void 0||"@@iterator"in t||G5(H5,B5(t))},q5=g(Y5),Vg=ce;Tt({global:!0,forced:Vg.globalThis!==Vg},{globalThis:Vg});var Bw=g(ce);function Gw(e,t){return function(){return e.apply(t,arguments)}}let{toString:J5}=Object.prototype,{getPrototypeOf:Fg}=Object,jp=(jg=Object.create(null),e=>{let t=J5.call(e);return jg[t]||(jg[t]=t.slice(8,-1).toLowerCase())});var jg;let xo=e=>(e=e.toLowerCase(),t=>jp(t)===e),Bp=e=>t=>typeof t===e,{isArray:pl}=Array,nu=Bp("undefined"),Ww=xo("ArrayBuffer"),X5=Bp("string"),kn=Bp("function"),Hw=Bp("number"),Gp=e=>e!==null&&typeof e=="object",Wp=e=>{if(jp(e)!=="object")return!1;let t=Fg(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||q5(e))},Q5=xo("Date"),Z5=xo("File"),$5=xo("Blob"),eH=xo("FileList"),tH=xo("URLSearchParams");function ou(e,t){let i,r,{allOwnKeys:n=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),pl(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{let o=n?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length,l;for(i=0;i<a;i++)l=o[i],t.call(null,e[l],l,e)}}function Kw(e,t){t=t.toLowerCase();let i=Object.keys(e),r,n=i.length;for(;n-- >0;)if(r=i[n],t===r.toLowerCase())return r;return null}let zw=Bw!==void 0?Bw:typeof self<"u"?self:typeof window<"u"?window:global,Yw=e=>!nu(e)&&e!==zw,iH=(Bg=typeof Uint8Array<"u"&&Fg(Uint8Array),e=>Bg&&e instanceof Bg);var Bg;let rH=xo("HTMLFormElement"),qw=(e=>{let{hasOwnProperty:t}=e;return(i,r)=>t.call(i,r)})(Object.prototype),nH=xo("RegExp"),Jw=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),r={};ou(i,(n,o)=>{let a;(a=t(n,o,e))!==!1&&(r[o]=a||n)}),Object.defineProperties(e,r)},Gg="abcdefghijklmnopqrstuvwxyz",Xw="0123456789",Qw={DIGIT:Xw,ALPHA:Gg,ALPHA_DIGIT:Gg+Gg.toUpperCase()+Xw},oH=xo("AsyncFunction");var ue={isArray:pl,isArrayBuffer:Ww,isBuffer:function(e){return e!==null&&!nu(e)&&e.constructor!==null&&!nu(e.constructor)&&kn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||kn(e.append)&&((t=jp(e))==="formdata"||t==="object"&&kn(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ww(e.buffer),t},isString:X5,isNumber:Hw,isBoolean:e=>e===!0||e===!1,isObject:Gp,isPlainObject:Wp,isUndefined:nu,isDate:Q5,isFile:Z5,isBlob:$5,isRegExp:nH,isFunction:kn,isStream:e=>Gp(e)&&kn(e.pipe),isURLSearchParams:tH,isTypedArray:iH,isFileList:eH,forEach:ou,merge:function e(){let{caseless:t}=Yw(this)&&this||{},i={},r=(n,o)=>{let a=t&&Kw(i,o)||o;Wp(i[a])&&Wp(n)?i[a]=e(i[a],n):Wp(n)?i[a]=e({},n):pl(n)?i[a]=n.slice():i[a]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&ou(arguments[n],r);return i},extend:function(e,t,i){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ou(t,(n,o)=>{i&&kn(n)?e[o]=Gw(n,i):e[o]=n},{allOwnKeys:r}),e},trim:e=>qi(e)?qi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,r)=>{let n,o,a,l={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),o=n.length;o-- >0;)a=n[o],r&&!r(a,e,t)||l[a]||(t[a]=e[a],l[a]=!0);e=i!==!1&&Fg(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:jp,kindOfTest:xo,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;let r=e.indexOf(t,i);return r!==-1&&r===i},toArray:e=>{if(!e)return null;if(pl(e))return e;let t=e.length;if(!Hw(t))return null;let i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{let i=(e&&e[Symbol.iterator]).call(e),r;for(;(r=i.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let i,r=[];for(;(i=e.exec(t))!==null;)r.push(i);return r},isHTMLForm:rH,hasOwnProperty:qw,hasOwnProp:qw,reduceDescriptors:Jw,freezeMethods:e=>{Jw(e,(t,i)=>{if(kn(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let r=e[i];kn(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,t)=>{let i={},r=n=>{n.forEach(o=>{i[o]=!0})};return pl(e)?r(e):r(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Kw,global:zw,isContextDefined:Yw,ALPHABET:Qw,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qw.ALPHA_DIGIT,i="",{length:r}=t;for(;e--;)i+=t[Math.random()*r|0];return i},isSpecCompliantForm:function(e){return!!(e&&kn(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),i=(r,n)=>{if(Gp(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[n]=r;let o=pl(r)?[]:{};return ou(r,(a,l)=>{let d=i(a,n+1);!nu(d)&&(o[l]=d)}),t[n]=void 0,o}}return r};return i(e,0)},isAsyncFn:oH,isThenable:e=>e&&(Gp(e)||kn(e))&&kn(e.then)&&kn(e.catch)};function Pt(e,t,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}ue.inherits(Pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ue.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});let Zw=Pt.prototype,$w={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{$w[e]={value:e}}),Object.defineProperties(Pt,$w),Object.defineProperty(Zw,"isAxiosError",{value:!0}),Pt.from=(e,t,i,r,n,o)=>{let a=Object.create(Zw);return ue.toFlatObject(e,a,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Pt.call(a,e.message,t,i,r,n),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};function Wg(e){return ue.isPlainObject(e)||ue.isArray(e)}function eA(e){return ue.endsWith(e,"[]")?e.slice(0,-2):e}function tA(e,t,i){return e?e.concat(t).map(function(r,n){return r=eA(r),!i&&n?"["+r+"]":r}).join(i?".":""):t}let sH=ue.toFlatObject(ue,{},null,function(e){return/^is[A-Z]/.test(e)});function Hp(e,t,i){if(!ue.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(i=ue.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,E){return!ue.isUndefined(E[f])})).metaTokens,n=i.visitor||u,o=i.dots,a=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&ue.isSpecCompliantForm(t);if(!ue.isFunction(n))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(ue.isDate(f))return f.toISOString();if(!l&&ue.isBlob(f))throw new Pt("Blob is not supported. Use a Buffer instead.");return ue.isArrayBuffer(f)||ue.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,E,I){let T=f;if(f&&!I&&typeof f=="object"){if(ue.endsWith(E,"{}"))E=r?E:E.slice(0,-2),f=JSON.stringify(f);else if(ue.isArray(f)&&function(R){return ue.isArray(R)&&!R.some(Wg)}(f)||(ue.isFileList(f)||ue.endsWith(E,"[]"))&&(T=ue.toArray(f)))return E=eA(E),T.forEach(function(R,w){!ue.isUndefined(R)&&R!==null&&t.append(a===!0?tA([E],w,o):a===null?E:E+"[]",d(R))}),!1}return!!Wg(f)||(t.append(tA(I,E,o),d(f)),!1)}let p=[],m=Object.assign(sH,{defaultVisitor:u,convertValue:d,isVisitable:Wg});if(!ue.isObject(e))throw new TypeError("data must be an object");return function f(E,I){if(!ue.isUndefined(E)){if(p.indexOf(E)!==-1)throw Error("Circular reference detected in "+I.join("."));p.push(E),ue.forEach(E,function(T,R){(!(ue.isUndefined(T)||T===null)&&n.call(t,T,ue.isString(R)?qi(R).call(R):R,I,m))===!0&&f(T,I?I.concat(R):[R])}),p.pop()}}(e),t}function iA(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function Hg(e,t){this._pairs=[],e&&Hp(e,this,t)}let rA=Hg.prototype;function aH(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nA(e,t,i){if(!t)return e;let r=i&&i.encode||aH,n=i&&i.serialize,o;if(o=n?n(t,i):ue.isURLSearchParams(t)?t.toString():new Hg(t,i).toString(r),o){let a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}rA.append=function(e,t){this._pairs.push([e,t])},rA.toString=function(e){let t=e?function(i){return e.call(this,i,iA)}:iA;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var oA=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ue.forEach(this.handlers,function(t){t!==null&&e(t)})}},sA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},aA={exports:{}},cH=Tt,lH=ur,cA=Dn.f;cH({target:"Object",stat:!0,forced:Object.defineProperty!==cA,sham:!lH},{defineProperty:cA});var lA=so.Object,dH=aA.exports=function(e,t,i){return lA.defineProperty(e,t,i)};lA.defineProperty.sham&&(dH.sham=!0);var dA=g(aA.exports),uH=Ae,su=Array.isArray||function(e){return uH(e)=="Array"},hH=TypeError,uA=su,pH=wp,mH=zr,_H=Jt("species"),hA=Array,fH=function(e){var t;return uA(e)&&(t=e.constructor,(pH(t)&&(t===hA||uA(t.prototype))||mH(t)&&(t=t[_H])===null)&&(t=void 0)),t===void 0?hA:t},pA=function(e,t){return new(fH(e))(t===0?0:t)},EH=v,gH=Ya,SH=Jt("species"),mA=function(e){return gH>=51||!EH(function(){var t=[];return(t.constructor={})[SH]=function(){return{foo:1}},t[e](Boolean).foo!==1})},TH=Tt,vH=v,RH=su,CH=zr,yH=ko,IH=ls,_A=function(e){if(e>9007199254740991)throw hH("Maximum allowed index exceeded");return e},fA=Fp,wH=pA,AH=mA,OH=Ya,EA=Jt("isConcatSpreadable"),bH=OH>=51||!vH(function(){var e=[];return e[EA]=!1,e.concat()[0]!==e}),NH=function(e){if(!CH(e))return!1;var t=e[EA];return t!==void 0?!!t:RH(e)};TH({target:"Array",proto:!0,arity:1,forced:!bH||!AH("concat")},{concat:function(e){var t,i,r,n,o,a=yH(this),l=wH(a,0),d=0;for(t=-1,r=arguments.length;t<r;t++)if(NH(o=t===-1?a:arguments[t]))for(n=IH(o),_A(d+n),i=0;i<n;i++,d++)i in o&&fA(l,d,o[i]);else _A(d+1),fA(l,d++,o);return l.length=d,l}});var gA={},DH=Ae,PH=xs,SA=hp.f,kH=kg,TA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];gA.f=function(e){return TA&&DH(e)=="Window"?function(t){try{return SA(t)}catch{return kH(TA)}}(e):SA(PH(e))};var ml={},LH=Jt;ml.f=LH;var vA=so,MH=Fi,UH=ml,xH=Dn.f,Pi=function(e){var t=vA.Symbol||(vA.Symbol={});MH(t,e)||xH(t,e,{value:UH.f(e)})},VH=Me,FH=Lr,jH=Jt,BH=js,RA=function(){var e=FH("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=jH("toPrimitive");t&&!t[r]&&BH(t,r,function(n){return VH(i,this)},{arity:1})},GH=Vs,WH=rp,HH=ko,KH=ls,zH=pA,CA=K([].push),Hs=function(e){var t=e==1,i=e==2,r=e==3,n=e==4,o=e==6,a=e==7,l=e==5||o;return function(d,u,p,m){for(var f,E,I=HH(d),T=WH(I),R=GH(u,p),w=KH(T),O=0,P=m||zH,M=t?P(d,w):i||a?P(d,0):void 0;w>O;O++)if((l||O in T)&&(E=R(f=T[O],O,I),e))if(t)M[O]=E;else if(E)switch(e){case 3:return!0;case 5:return f;case 6:return O;case 2:CA(M,f)}else switch(e){case 4:return!1;case 7:CA(M,f)}return o?-1:r||n?n:M}},yA={forEach:Hs(0),map:Hs(1),filter:Hs(2),some:Hs(3),every:Hs(4),find:Hs(5),findIndex:Hs(6),filterReject:Hs(7)},Kp=Tt,Kg=ce,zg=Me,YH=K,_l=ur,fl=$c,qH=v,tr=Fi,JH=Q,Yg=vr,zp=xs,qg=op,XH=hn,Jg=Tr,au=Yd,IA=mp,QH=hp,wA=gA,ZH=zd,AA=Ka,OA=Dn,$H=AE,bA=dt,NA=js,e6=Ip,Xg=tl,DA=pp,PA=sE,t6=Jt,i6=ml,r6=Pi,n6=RA,o6=Bs,kA=Qa,Yp=yA.forEach,qr=up("hidden"),qp="Symbol",cu="prototype",s6=kA.set,LA=kA.getterFor(qp),co=Object[cu],ec=Kg.Symbol,Jp=ec&&ec[cu],a6=Kg.TypeError,Qg=Kg.QObject,MA=AA.f,tc=OA.f,UA=wA.f,c6=bA.f,xA=YH([].push),ds=Xg("symbols"),lu=Xg("op-symbols"),l6=Xg("wks"),Zg=!Qg||!Qg[cu]||!Qg[cu].findChild,$g=_l&&qH(function(){return au(tc({},"a",{get:function(){return tc(this,"a",{value:7}).a}})).a!=7})?function(e,t,i){var r=MA(co,t);r&&delete co[t],tc(e,t,i),r&&e!==co&&tc(co,t,r)}:tc,eS=function(e,t){var i=ds[e]=au(Jp);return s6(i,{type:qp,tag:e,description:t}),_l||(i.description=t),i},Xp=function(e,t,i){e===co&&Xp(lu,t,i),Yg(e);var r=qg(t);return Yg(i),tr(ds,r)?(i.enumerable?(tr(e,qr)&&e[qr][r]&&(e[qr][r]=!1),i=au(i,{enumerable:Jg(0,!1)})):(tr(e,qr)||tc(e,qr,Jg(1,{})),e[qr][r]=!0),$g(e,r,i)):tc(e,r,i)},tS=function(e,t){Yg(e);var i=zp(t),r=IA(i).concat(BA(i));return Yp(r,function(n){_l&&!zg(VA,i,n)||Xp(e,n,i[n])}),e},VA=function(e){var t=qg(e),i=zg(c6,this,t);return!(this===co&&tr(ds,t)&&!tr(lu,t))&&(!(i||!tr(this,t)||!tr(ds,t)||tr(this,qr)&&this[qr][t])||i)},FA=function(e,t){var i=zp(e),r=qg(t);if(i!==co||!tr(ds,r)||tr(lu,r)){var n=MA(i,r);return!n||!tr(ds,r)||tr(i,qr)&&i[qr][r]||(n.enumerable=!0),n}},jA=function(e){var t=UA(zp(e)),i=[];return Yp(t,function(r){tr(ds,r)||tr(DA,r)||xA(i,r)}),i},BA=function(e){var t=e===co,i=UA(t?lu:zp(e)),r=[];return Yp(i,function(n){!tr(ds,n)||t&&!tr(co,n)||xA(r,ds[n])}),r};fl||(ec=function(){if(JH(Jp,this))throw a6("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?XH(arguments[0]):void 0,t=PA(e),i=function(r){this===co&&zg(i,lu,r),tr(this,qr)&&tr(this[qr],t)&&(this[qr][t]=!1),$g(this,t,Jg(1,r))};return _l&&Zg&&$g(co,t,{configurable:!0,set:i}),eS(t,e)},NA(Jp=ec[cu],"toString",function(){return LA(this).tag}),NA(ec,"withoutSetter",function(e){return eS(PA(e),e)}),bA.f=VA,OA.f=Xp,$H.f=tS,AA.f=FA,QH.f=wA.f=jA,ZH.f=BA,i6.f=function(e){return eS(t6(e),e)},_l&&e6(Jp,"description",{configurable:!0,get:function(){return LA(this).description}})),Kp({global:!0,constructor:!0,wrap:!0,forced:!fl,sham:!fl},{Symbol:ec}),Yp(IA(l6),function(e){r6(e)}),Kp({target:qp,stat:!0,forced:!fl},{useSetter:function(){Zg=!0},useSimple:function(){Zg=!1}}),Kp({target:"Object",stat:!0,forced:!fl,sham:!_l},{create:function(e,t){return t===void 0?au(e):tS(au(e),t)},defineProperty:Xp,defineProperties:tS,getOwnPropertyDescriptor:FA}),Kp({target:"Object",stat:!0,forced:!fl},{getOwnPropertyNames:jA}),n6(),o6(ec,qp),DA[qr]=!0;var GA=$c&&!!Symbol.for&&!!Symbol.keyFor,d6=Tt,u6=Lr,h6=Fi,p6=hn,WA=tl,m6=GA,iS=WA("string-to-symbol-registry"),_6=WA("symbol-to-string-registry");d6({target:"Symbol",stat:!0,forced:!m6},{for:function(e){var t=p6(e);if(h6(iS,t))return iS[t];var i=u6("Symbol")(t);return iS[t]=i,_6[i]=t,i}});var f6=Tt,E6=Fi,g6=Wd,S6=el,T6=GA,HA=tl("symbol-to-string-registry");f6({target:"Symbol",stat:!0,forced:!T6},{keyFor:function(e){if(!g6(e))throw TypeError(S6(e)+" is not a symbol");if(E6(HA,e))return HA[e]}});var KA=su,v6=hi,zA=Ae,R6=hn,YA=K([].push),C6=Tt,qA=Lr,JA=Y,y6=Me,du=K,XA=v,QA=hi,ZA=Wd,$A=JE,I6=function(e){if(v6(e))return e;if(KA(e)){for(var t=e.length,i=[],r=0;r<t;r++){var n=e[r];typeof n=="string"?YA(i,n):typeof n!="number"&&zA(n)!="Number"&&zA(n)!="String"||YA(i,R6(n))}var o=i.length,a=!0;return function(l,d){if(a)return a=!1,d;if(KA(this))return d;for(var u=0;u<o;u++)if(i[u]===l)return d}}},w6=$c,A6=String,Ks=qA("JSON","stringify"),Qp=du(/./.exec),eO=du("".charAt),O6=du("".charCodeAt),b6=du("".replace),N6=du(1 .toString),D6=/[\uD800-\uDFFF]/g,tO=/^[\uD800-\uDBFF]$/,iO=/^[\uDC00-\uDFFF]$/,rO=!w6||XA(function(){var e=qA("Symbol")();return Ks([e])!="[null]"||Ks({a:e})!="{}"||Ks(Object(e))!="{}"}),nO=XA(function(){return Ks("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ks("\uDEAD")!=='"\\udead"'}),P6=function(e,t){var i=$A(arguments),r=I6(t);if(QA(r)||e!==void 0&&!ZA(e))return i[1]=function(n,o){if(QA(r)&&(o=y6(r,this,A6(n),o)),!ZA(o))return o},JA(Ks,null,i)},k6=function(e,t,i){var r=eO(i,t-1),n=eO(i,t+1);return Qp(tO,e)&&!Qp(iO,n)||Qp(iO,e)&&!Qp(tO,r)?"\\u"+N6(O6(e,0),16):e};Ks&&C6({target:"JSON",stat:!0,arity:3,forced:rO||nO},{stringify:function(e,t,i){var r=$A(arguments),n=JA(rO?P6:Ks,null,r);return nO&&typeof n=="string"?b6(n,D6,k6):n}});var oO=zd,L6=ko;Tt({target:"Object",stat:!0,forced:!$c||v(function(){oO.f(1)})},{getOwnPropertySymbols:function(e){var t=oO.f;return t?t(L6(e)):[]}}),Pi("asyncIterator"),Pi("hasInstance"),Pi("isConcatSpreadable"),Pi("iterator"),Pi("match"),Pi("matchAll"),Pi("replace"),Pi("search"),Pi("species"),Pi("split");var M6=RA;Pi("toPrimitive"),M6();var U6=Lr,x6=Bs;Pi("toStringTag"),x6(U6("Symbol"),"Symbol"),Pi("unscopables"),Bs(ce.JSON,"JSON",!0);var V6=so.Symbol,F6=Jt,j6=Dn.f,sO=F6("metadata"),aO=Function.prototype;aO[sO]===void 0&&j6(aO,sO,{value:null}),Pi("dispose"),Pi("metadata");var B6=V6;Pi("asyncDispose");var G6=K,rS=Lr("Symbol"),W6=rS.keyFor,H6=G6(rS.prototype.valueOf),cO=rS.isRegisteredSymbol||function(e){try{return W6(H6(e))!==void 0}catch{return!1}};Tt({target:"Symbol",stat:!0},{isRegisteredSymbol:cO});for(var K6=tl,lO=Lr,z6=K,Y6=Wd,q6=Jt,Zp=lO("Symbol"),dO=Zp.isWellKnownSymbol,uO=lO("Object","getOwnPropertyNames"),J6=z6(Zp.prototype.valueOf),hO=K6("wks"),nS=0,pO=uO(Zp),X6=pO.length;nS<X6;nS++)try{var mO=pO[nS];Y6(Zp[mO])&&q6(mO)}catch{}var _O=function(e){if(dO&&dO(e))return!0;try{for(var t=J6(e),i=0,r=uO(hO),n=r.length;i<n;i++)if(hO[r[i]]==t)return!0}catch{}return!1};Tt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:_O}),Pi("matcher"),Pi("observable"),Tt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:cO}),Tt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:_O}),Pi("metadataKey"),Pi("patternMatch"),Pi("replaceAll");var El=g(B6),fO=g(ml.f("iterator"));function uu(e){return uu=typeof El=="function"&&typeof fO=="symbol"?function(t){return typeof t}:function(t){return t&&typeof El=="function"&&t.constructor===El&&t!==El.prototype?"symbol":typeof t},uu(e)}var Q6=g(ml.f("toPrimitive"));function Z6(e){var t=function(i,r){if(uu(i)!=="object"||i===null)return i;var n=i[Q6];if(n!==void 0){var o=n.call(i,r||"default");if(uu(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)}(e,"string");return uu(t)==="symbol"?t:String(t)}function y(e,t,i){return(t=Z6(t))in e?dA(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var $6=v,eK=Jt("iterator"),oS=!$6(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(n,o){t.delete("b"),r+=o+n}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[eK]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),tK=js,sS=Tt,gl=ce,$p=Me,Vo=K,Sl=ur,EO=oS,gO=js,iK=Ip,rK=function(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:tK(e,r,t[r],i);return e},nK=Bs,oK=BE,aS=Qa,SO=HE,cS=hi,sK=Fi,aK=Vs,cK=Lo,lK=vr,TO=zr,Mr=hn,dK=Yd,vO=Tr,lS=DE,uK=Ep,Tl=Ap,hK=Nw,pK=Jt("iterator"),hu="URLSearchParams",RO=hu+"Iterator",CO=aS.set,Ln=aS.getterFor(hu),mK=aS.getterFor(RO),_K=Object.getOwnPropertyDescriptor,dS=function(e){if(!Sl)return gl[e];var t=_K(gl,e);return t&&t.value},yO=dS("fetch"),em=dS("Request"),pu=dS("Headers"),uS=em&&em.prototype,IO=pu&&pu.prototype,fK=gl.RegExp,EK=gl.TypeError,wO=gl.decodeURIComponent,gK=gl.encodeURIComponent,SK=Vo("".charAt),AO=Vo([].join),ic=Vo([].push),hS=Vo("".replace),TK=Vo([].shift),OO=Vo([].splice),bO=Vo("".split),vK=Vo("".slice),RK=/\+/g,NO=Array(4),CK=function(e){return NO[e-1]||(NO[e-1]=fK("((?:%[\\da-f]{2}){"+e+"})","gi"))},yK=function(e){try{return wO(e)}catch{return e}},DO=function(e){var t=hS(e,RK," "),i=4;try{return wO(t)}catch{for(;i;)t=hS(t,CK(i--),yK);return t}},IK=/[!'()~]|%20/g,wK={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},AK=function(e){return wK[e]},PO=function(e){return hS(gK(e),IK,AK)},pS=oK(function(e,t){CO(this,{type:RO,iterator:lS(Ln(e).entries),kind:t})},"Iterator",function(){var e=mK(this),t=e.kind,i=e.iterator.next(),r=i.value;return i.done||(i.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),i},!0),kO=function(e){this.entries=[],this.url=null,e!==void 0&&(TO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?SK(e,0)==="?"?vK(e,1):e:Mr(e)))};kO.prototype={type:hu,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,n,o,a,l,d=uK(e);if(d)for(i=(t=lS(e,d)).next;!(r=$p(i,t)).done;){if(o=(n=lS(lK(r.value))).next,(a=$p(o,n)).done||(l=$p(o,n)).done||!$p(o,n).done)throw EK("Expected sequence with length 2");ic(this.entries,{key:Mr(a.value),value:Mr(l.value)})}else for(var u in e)sK(e,u)&&ic(this.entries,{key:u,value:Mr(e[u])})},parseQuery:function(e){if(e)for(var t,i,r=bO(e,"&"),n=0;n<r.length;)(t=r[n++]).length&&(i=bO(t,"="),ic(this.entries,{key:DO(TK(i)),value:DO(AO(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],ic(i,PO(e.key)+"="+PO(e.value));return AO(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var tm=function(){SO(this,vl);var e=CO(this,new kO(arguments.length>0?arguments[0]:void 0));Sl||(this.size=e.entries.length)},vl=tm.prototype;if(rK(vl,{append:function(e,t){var i=Ln(this);Tl(arguments.length,2),ic(i.entries,{key:Mr(e),value:Mr(t)}),Sl||this.length++,i.updateURL()},delete:function(e){for(var t=Ln(this),i=Tl(arguments.length,1),r=t.entries,n=Mr(e),o=i<2?void 0:arguments[1],a=o===void 0?o:Mr(o),l=0;l<r.length;){var d=r[l];if(d.key!==n||a!==void 0&&d.value!==a)l++;else if(OO(r,l,1),a!==void 0)break}Sl||(this.size=r.length),t.updateURL()},get:function(e){var t=Ln(this).entries;Tl(arguments.length,1);for(var i=Mr(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){var t=Ln(this).entries;Tl(arguments.length,1);for(var i=Mr(e),r=[],n=0;n<t.length;n++)t[n].key===i&&ic(r,t[n].value);return r},has:function(e){for(var t=Ln(this).entries,i=Tl(arguments.length,1),r=Mr(e),n=i<2?void 0:arguments[1],o=n===void 0?n:Mr(n),a=0;a<t.length;){var l=t[a++];if(l.key===r&&(o===void 0||l.value===o))return!0}return!1},set:function(e,t){var i=Ln(this);Tl(arguments.length,1);for(var r,n=i.entries,o=!1,a=Mr(e),l=Mr(t),d=0;d<n.length;d++)(r=n[d]).key===a&&(o?OO(n,d--,1):(o=!0,r.value=l));o||ic(n,{key:a,value:l}),Sl||(this.size=n.length),i.updateURL()},sort:function(){var e=Ln(this);hK(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=Ln(this).entries,r=aK(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this)},keys:function(){return new pS(this,"keys")},values:function(){return new pS(this,"values")},entries:function(){return new pS(this,"entries")}},{enumerable:!0}),gO(vl,pK,vl.entries,{name:"entries"}),gO(vl,"toString",function(){return Ln(this).serialize()},{enumerable:!0}),Sl&&iK(vl,"size",{get:function(){return Ln(this).entries.length},configurable:!0,enumerable:!0}),nK(tm,hu),sS({global:!0,constructor:!0,forced:!EO},{URLSearchParams:tm}),!EO&&cS(pu)){var OK=Vo(IO.has),bK=Vo(IO.set),LO=function(e){if(TO(e)){var t,i=e.body;if(cK(i)===hu)return t=e.headers?new pu(e.headers):new pu,OK(t,"content-type")||bK(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),dK(e,{body:vO(0,Mr(i)),headers:vO(0,t)})}return e};if(cS(yO)&&sS({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return yO(e,arguments.length>1?LO(arguments[1]):{})}}),cS(em)){var mS=function(e){return SO(this,uS),new em(e,arguments.length>1?LO(arguments[1]):{})};uS.constructor=mS,mS.prototype=uS,sS({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:mS})}}var NK={URLSearchParams:tm,getState:Ln},MO=g(so.URLSearchParams),DK={isBrowser:!0,classes:{URLSearchParams:MO!==void 0?MO:Hg,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let UO=typeof window<"u"&&typeof document<"u",PK=(xO=typeof navigator<"u"&&navigator.product,UO&&["ReactNative","NativeScript","NS"].indexOf(xO)<0);var xO;let kK=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function VO(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function FO(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?VO(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VO(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Fo=FO(FO({},Object.freeze({__proto__:null,hasBrowserEnv:UO,hasStandardBrowserEnv:PK,hasStandardBrowserWebWorkerEnv:kK})),DK),LK=vr,MK=Me,UK=Fi,xK=Q,VK=function(){var e=LK(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},jO=RegExp.prototype,BO=function(e){var t=e.flags;return t!==void 0||"flags"in jO||UK(e,"flags")||!xK(jO,e)?t:MK(VK,e)},FK=vg.charAt,GO=Me,jK=vr,BK=hi,GK=Ae,WK=/./.exec,HK=TypeError,KK=Tt,WO=Me,HO=et,zK=BE,im=WE,KO=Zc,zO=Vy,mu=hn,YK=vr,qK=Qc,JK=Ae,XK=jy,YO=BO,QK=np,ZK=v,$K=qE,e8=function(e,t,i){return t+(i?FK(e,t).length:1)},t8=function(e,t){var i=e.exec;if(BK(i)){var r=GO(i,e,t);return r!==null&&jK(r),r}if(GK(e)==="RegExp")return GO(WK,e,t);throw HK("RegExp#exec called on incompatible receiver")},qO=Qa,i8=Jt("matchAll"),JO="RegExp String",XO=JO+" Iterator",r8=qO.set,n8=qO.getterFor(XO),o8=TypeError,_S=HO("".indexOf),rm=HO("".matchAll),fS=!!rm&&!ZK(function(){rm("a",/./)}),s8=zK(function(e,t,i,r){r8(this,{type:XO,regexp:e,string:t,global:i,unicode:r,done:!1})},JO,function(){var e=n8(this);if(e.done)return im(void 0,!0);var t=e.regexp,i=e.string,r=t8(t,i);return r===null?(e.done=!0,im(void 0,!0)):e.global?(mu(r[0])===""&&(t.lastIndex=e8(i,zO(t.lastIndex),e.unicode)),im(r,!1)):(e.done=!0,im(r,!1))}),QO=function(e){var t,i,r,n=YK(this),o=mu(e),a=$K(n,RegExp),l=mu(YO(n));return t=new a(a===RegExp?n.source:n,l),i=!!~_S(l,"g"),r=!!~_S(l,"u"),t.lastIndex=zO(n.lastIndex),new s8(t,o,i,r)};KK({target:"String",proto:!0,forced:fS},{matchAll:function(e){var t,i,r,n,o=KO(this);if(qK(e)){if(fS)return rm(o,e)}else{if(XK(e)&&(t=mu(KO(YO(e))),!~_S(t,"g")))throw o8("`.matchAll` does not allow non-global regexes");if(fS)return rm(o,e);if((r=QK(e,i8))===void 0&&JK(e)=="RegExp"&&(r=QO),r)return WO(r,e,o)}return i=mu(o),n=new RegExp(e,"g"),WO(QO,n,i)}});var a8=Pn("String").matchAll,c8=Q,l8=a8,ES=String.prototype,d8=function(e){var t=e.matchAll;return typeof e=="string"||e===ES||c8(ES,e)&&t===ES.matchAll?l8:t},u8=g(d8);function ZO(e){function t(i,r,n,o){let a=i[o++];if(a==="__proto__")return!0;let l=Number.isFinite(+a),d=o>=i.length;return a=!a&&ue.isArray(n)?n.length:a,d?(ue.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!l):(n[a]&&ue.isObject(n[a])||(n[a]=[]),t(i,r,n[a],o)&&ue.isArray(n[a])&&(n[a]=function(u){let p={},m=Object.keys(u),f,E=m.length,I;for(f=0;f<E;f++)I=m[f],p[I]=u[I];return p}(n[a])),!l)}if(ue.isFormData(e)&&ue.isFunction(e.entries)){let i={};return ue.forEachEntry(e,(r,n)=>{t(function(o){return u8(ue).call(ue,/\w+|\[(\w*)]/g,o).map(a=>a[0]==="[]"?"":a[1]||a[0])}(r),n,i,0)}),i}return null}let gS={transitional:sA,adapter:["xhr","http"],transformRequest:[function(e,t){let i=t.getContentType()||"",r=i.indexOf("application/json")>-1,n=ue.isObject(e);if(n&&ue.isHTMLForm(e)&&(e=new FormData(e)),ue.isFormData(e))return r?JSON.stringify(ZO(e)):e;if(ue.isArrayBuffer(e)||ue.isBuffer(e)||ue.isStream(e)||ue.isFile(e)||ue.isBlob(e))return e;if(ue.isArrayBufferView(e))return e.buffer;if(ue.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(n){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(a,l){return Hp(a,new Fo.classes.URLSearchParams,Object.assign({visitor:function(d,u,p,m){return Fo.isNode&&ue.isBuffer(d)?(this.append(u,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(e,this.formSerializer).toString();if((o=ue.isFileList(e))||i.indexOf("multipart/form-data")>-1){let a=this.env&&this.env.FormData;return Hp(o?{"files[]":e}:e,a&&new a,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),function(a,l,d){if(ue.isString(a))try{return(l||JSON.parse)(a),qi(ue).call(ue,a)}catch(u){if(u.name!=="SyntaxError")throw u}return(0,JSON.stringify)(a)}(e)):e}],transformResponse:[function(e){let t=this.transitional||gS.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(e&&ue.isString(e)&&(i&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(n)throw o.name==="SyntaxError"?Pt.from(o,Pt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Fo.classes.FormData,Blob:Fo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ue.forEach(["delete","get","head","post","put","patch"],e=>{gS.headers[e]={}});var SS=gS;let h8=ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$O=Symbol("internals");function _u(e){var t;return e&&qi(t=String(e)).call(t).toLowerCase()}function nm(e){return e===!1||e==null?e:ue.isArray(e)?e.map(nm):String(e)}function TS(e,t,i,r,n){return ue.isFunction(r)?r.call(this,t,i):(n&&(t=i),ue.isString(t)?ue.isString(r)?t.indexOf(r)!==-1:ue.isRegExp(r)?r.test(t):void 0:void 0)}class om{constructor(t){t&&this.set(t)}set(t,i,r){let n=this;function o(d,u,p){let m=_u(u);if(!m)throw new Error("header name must be a non-empty string");let f=ue.findKey(n,m);(!f||n[f]===void 0||p===!0||p===void 0&&n[f]!==!1)&&(n[f||u]=nm(d))}let a=(d,u)=>ue.forEach(d,(p,m)=>o(p,m,u));var l;return ue.isPlainObject(t)||t instanceof this.constructor?a(t,i):ue.isString(t)&&(t=qi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(qi(l=t).call(l))?a((d=>{let u={},p,m,f;return d&&d.split(`
`).forEach(function(E){var I,T;f=E.indexOf(":"),p=qi(I=E.substring(0,f)).call(I).toLowerCase(),m=qi(T=E.substring(f+1)).call(T),!p||u[p]&&h8[p]||(p==="set-cookie"?u[p]?u[p].push(m):u[p]=[m]:u[p]=u[p]?u[p]+", "+m:m)}),u})(t),i):t!=null&&o(i,t,r),this}get(t,i){if(t=_u(t)){let r=ue.findKey(this,t);if(r){let n=this[r];if(!i)return n;if(i===!0)return function(o){let a=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,d;for(;d=l.exec(o);)a[d[1]]=d[2];return a}(n);if(ue.isFunction(i))return i.call(this,n,r);if(ue.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=_u(t)){let r=ue.findKey(this,t);return!(!r||this[r]===void 0||i&&!TS(0,this[r],r,i))}return!1}delete(t,i){let r=this,n=!1;function o(a){if(a=_u(a)){let l=ue.findKey(r,a);!l||i&&!TS(0,r[l],l,i)||(delete r[l],n=!0)}}return ue.isArray(t)?t.forEach(o):o(t),n}clear(t){let i=Object.keys(this),r=i.length,n=!1;for(;r--;){let o=i[r];t&&!TS(0,this[o],o,t,!0)||(delete this[o],n=!0)}return n}normalize(t){let i=this,r={};return ue.forEach(this,(n,o)=>{var a;let l=ue.findKey(r,o);if(l)return i[l]=nm(n),void delete i[o];let d=t?function(u){return qi(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,f)=>m.toUpperCase()+f)}(o):qi(a=String(o)).call(a);d!==o&&delete i[o],i[d]=nm(n),r[d]=!0}),this}concat(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return this.constructor.concat(this,...i)}toJSON(t){let i=Object.create(null);return ue.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=t&&ue.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[i,r]=t;return i+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let i=new this(t);for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return n.forEach(a=>i.set(a)),i}static accessor(t){let i=(this[$O]=this[$O]={accessors:{}}).accessors,r=this.prototype;function n(o){let a=_u(o);i[a]||(function(l,d){let u=ue.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+u,{value:function(m,f,E){return this[p].call(this,d,m,f,E)},configurable:!0})})}(r,o),i[a]=!0)}return ue.isArray(t)?t.forEach(n):n(t),this}}om.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ue.reduceDescriptors(om.prototype,(e,t)=>{let{value:i}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(n){this[r]=n}}}),ue.freezeMethods(om);var us=om;function vS(e,t){let i=this||SS,r=t||i,n=us.from(r.headers),o=r.data;return ue.forEach(e,function(a){o=a.call(i,o,n.normalize(),t?t.status:void 0)}),n.normalize(),o}function eb(e){return!(!e||!e.__CANCEL__)}function fu(e,t,i){Pt.call(this,e??"canceled",Pt.ERR_CANCELED,t,i),this.name="CanceledError"}ue.inherits(fu,Pt,{__CANCEL__:!0});var p8=Fo.hasStandardBrowserEnv?{write(e,t,i,r,n,o){let a=[e+"="+encodeURIComponent(t)];ue.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),ue.isString(r)&&a.push("path="+r),ue.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function tb(e,t){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t)?function(i,r){return r?i.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):i}(e,t):t}var m8=Fo.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),i;function r(n){let o=n;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=r(window.location.href),function(n){let o=ue.isString(n)?r(n):n;return o.protocol===i.protocol&&o.host===i.host}}():function(){return!0};function ib(e,t){let i=0,r=function(n,o){n=n||10;let a=new Array(n),l=new Array(n),d,u=0,p=0;return o=o!==void 0?o:1e3,function(m){let f=Date.now(),E=l[p];d||(d=f),a[u]=m,l[u]=f;let I=p,T=0;for(;I!==u;)T+=a[I++],I%=n;if(u=(u+1)%n,u===p&&(p=(p+1)%n),f-d<o)return;let R=E&&f-E;return R?Math.round(1e3*T/R):void 0}}(50,250);return n=>{let o=n.loaded,a=n.lengthComputable?n.total:void 0,l=o-i,d=r(l);i=o;let u={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:d||void 0,estimated:d&&a&&o<=a?(a-o)/d:void 0,event:n};u[t?"download":"upload"]=!0,e(u)}}var _8=typeof XMLHttpRequest<"u"&&function(e){return new ne(function(t,i){let r=e.data,n=us.from(e.headers).normalize(),o,a,{responseType:l,withXSRFToken:d}=e;function u(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(ue.isFormData(r)){if(Fo.hasStandardBrowserEnv||Fo.hasStandardBrowserWebWorkerEnv)n.setContentType(!1);else if((a=n.getContentType())!==!1){let[I,...T]=a?a.split(";").map(R=>qi(R).call(R)).filter(Boolean):[];n.setContentType([I||"multipart/form-data",...T].join("; "))}}let p=new XMLHttpRequest;if(e.auth){let I=e.auth.username||"",T=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.set("Authorization","Basic "+btoa(I+":"+T))}let m=tb(e.baseURL,e.url);function f(){if(!p)return;let I=us.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());(function(T,R,w){let O=w.config.validateStatus;w.status&&O&&!O(w.status)?R(new Pt("Request failed with status code "+w.status,[Pt.ERR_BAD_REQUEST,Pt.ERR_BAD_RESPONSE][Math.floor(w.status/100)-4],w.config,w.request,w)):T(w)})(function(T){t(T),u()},function(T){i(T),u()},{data:l&&l!=="text"&&l!=="json"?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:I,config:e,request:p}),p=null}if(p.open(e.method.toUpperCase(),nA(m,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=f:p.onreadystatechange=function(){p&&p.readyState===4&&(p.status!==0||p.responseURL&&p.responseURL.indexOf("file:")===0)&&setTimeout(f)},p.onabort=function(){p&&(i(new Pt("Request aborted",Pt.ECONNABORTED,e,p)),p=null)},p.onerror=function(){i(new Pt("Network Error",Pt.ERR_NETWORK,e,p)),p=null},p.ontimeout=function(){let I=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",T=e.transitional||sA;e.timeoutErrorMessage&&(I=e.timeoutErrorMessage),i(new Pt(I,T.clarifyTimeoutError?Pt.ETIMEDOUT:Pt.ECONNABORTED,e,p)),p=null},Fo.hasStandardBrowserEnv&&(d&&ue.isFunction(d)&&(d=d(e)),d||d!==!1&&m8(m))){let I=e.xsrfHeaderName&&e.xsrfCookieName&&p8.read(e.xsrfCookieName);I&&n.set(e.xsrfHeaderName,I)}r===void 0&&n.setContentType(null),"setRequestHeader"in p&&ue.forEach(n.toJSON(),function(I,T){p.setRequestHeader(T,I)}),ue.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),l&&l!=="json"&&(p.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&p.addEventListener("progress",ib(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",ib(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=I=>{p&&(i(!I||I.type?new fu(null,e,p):I),p.abort(),p=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));let E=function(I){let T=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return T&&T[1]||""}(m);E&&Fo.protocols.indexOf(E)===-1?i(new Pt("Unsupported protocol "+E+":",Pt.ERR_BAD_REQUEST,e)):p.send(r||null)})};let RS={http:null,xhr:_8};ue.forEach(RS,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let rb=e=>"- ".concat(e),f8=e=>ue.isFunction(e)||e===null||e===!1;var nb={getAdapter:e=>{e=ue.isArray(e)?e:[e];let{length:t}=e,i,r,n={};for(let o=0;o<t;o++){let a;if(i=e[o],r=i,!f8(i)&&(r=RS[(a=String(i)).toLowerCase()],r===void 0))throw new Pt("Unknown adapter '".concat(a,"'"));if(r)break;n[a||"#"+o]=r}if(!r){let o=Object.entries(n).map(a=>{let[l,d]=a;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Pt("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map(rb).join(`
`):" "+rb(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:RS};function CS(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new fu(null,e)}function ob(e){return CS(e),e.headers=us.from(e.headers),e.data=vS.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),nb.getAdapter(e.adapter||SS.adapter)(e).then(function(t){return CS(e),t.data=vS.call(e,e.transformResponse,t),t.headers=us.from(t.headers),t},function(t){return eb(t)||(CS(e),t&&t.response&&(t.response.data=vS.call(e,e.transformResponse,t.response),t.response.headers=us.from(t.response.headers))),ne.reject(t)})}function sb(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}let ab=e=>e instanceof us?function(t){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sb(Object(r),!0).forEach(function(n){y(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sb(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}({},e):e;function Rl(e,t){t=t||{};let i={};function r(u,p,m){return ue.isPlainObject(u)&&ue.isPlainObject(p)?ue.merge.call({caseless:m},u,p):ue.isPlainObject(p)?ue.merge({},p):ue.isArray(p)?p.slice():p}function n(u,p,m){return ue.isUndefined(p)?ue.isUndefined(u)?void 0:r(void 0,u,m):r(u,p,m)}function o(u,p){if(!ue.isUndefined(p))return r(void 0,p)}function a(u,p){return ue.isUndefined(p)?ue.isUndefined(u)?void 0:r(void 0,u):r(void 0,p)}function l(u,p,m){return m in t?r(u,p):m in e?r(void 0,u):void 0}let d={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(u,p)=>n(ab(u),ab(p),!0)};return ue.forEach(Object.keys(Object.assign({},e,t)),function(u){let p=d[u]||n,m=p(e[u],t[u],u);ue.isUndefined(m)&&p!==l||(i[u]=m)}),i}let cb="1.6.8",yS={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{yS[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let lb={};yS.transitional=function(e,t,i){function r(n,o){return"[Axios v"+cb+"] Transitional option '"+n+"'"+o+(i?". "+i:"")}return(n,o,a)=>{if(e===!1)throw new Pt(r(o," has been removed"+(t?" in "+t:"")),Pt.ERR_DEPRECATED);return t&&!lb[o]&&(lb[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}};var IS={assertOptions:function(e,t,i){if(typeof e!="object")throw new Pt("options must be an object",Pt.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),n=r.length;for(;n-- >0;){let o=r[n],a=t[o];if(a){let l=e[o],d=l===void 0||a(l,o,e);if(d!==!0)throw new Pt("option "+o+" must be "+d,Pt.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Pt("Unknown option "+o,Pt.ERR_BAD_OPTION)}},validators:yS};let zs=IS.validators,sm=class{constructor(e){this.defaults=e,this.interceptors={request:new oA,response:new oA}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;let n=r.stack?r.stack.replace(/^.+\n/,""):"";i.stack?n&&!String(i.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+n):i.stack=n}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Rl(this.defaults,t);let{transitional:i,paramsSerializer:r,headers:n}=t;i!==void 0&&IS.assertOptions(i,{silentJSONParsing:zs.transitional(zs.boolean),forcedJSONParsing:zs.transitional(zs.boolean),clarifyTimeoutError:zs.transitional(zs.boolean)},!1),r!=null&&(ue.isFunction(r)?t.paramsSerializer={serialize:r}:IS.assertOptions(r,{encode:zs.function,serialize:zs.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=n&&ue.merge(n.common,n[t.method]);n&&ue.forEach(["delete","get","head","post","put","patch","common"],E=>{delete n[E]}),t.headers=us.concat(o,n);let a=[],l=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(l=l&&E.synchronous,a.unshift(E.fulfilled,E.rejected))});let d=[],u;this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)});let p,m=0;if(!l){let E=[ob.bind(this),void 0];for(E.unshift.apply(E,a),E.push.apply(E,d),p=E.length,u=ne.resolve(t);m<p;)u=u.then(E[m++],E[m++]);return u}p=a.length;let f=t;for(m=0;m<p;){let E=a[m++],I=a[m++];try{f=E(f)}catch(T){I.call(this,T);break}}try{u=ob.call(this,f)}catch(E){return ne.reject(E)}for(m=0,p=d.length;m<p;)u=u.then(d[m++],d[m++]);return u}getUri(e){return nA(tb((e=Rl(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ue.forEach(["delete","get","head","options"],function(e){sm.prototype[e]=function(t,i){return this.request(Rl(i||{},{method:e,url:t,data:(i||{}).data}))}}),ue.forEach(["post","put","patch"],function(e){function t(i){return function(r,n,o){return this.request(Rl(o||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}sm.prototype[e]=t(),sm.prototype[e+"Form"]=t(!0)});var am=sm;class wS{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ne(function(n){i=n});let r=this;this.promise.then(n=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](n);r._listeners=null}),this.promise.then=n=>{let o,a=new ne(l=>{r.subscribe(l),o=l}).then(n);return a.cancel=function(){r.unsubscribe(o)},a},t(function(n,o,a){r.reason||(r.reason=new fu(n,o,a),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}static source(){let t;return{token:new wS(function(i){t=i}),cancel:t}}}var E8=wS;let AS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(AS).forEach(e=>{let[t,i]=e;AS[i]=t});var g8=AS;let Hi=function e(t){let i=new am(t),r=Gw(am.prototype.request,i);return ue.extend(r,am.prototype,i,{allOwnKeys:!0}),ue.extend(r,i,null,{allOwnKeys:!0}),r.create=function(n){return e(Rl(t,n))},r}(SS);Hi.Axios=am,Hi.CanceledError=fu,Hi.CancelToken=E8,Hi.isCancel=eb,Hi.VERSION=cb,Hi.toFormData=Hp,Hi.AxiosError=Pt,Hi.Cancel=Hi.CanceledError,Hi.all=function(e){return ne.all(e)},Hi.spread=function(e){return function(t){return e.apply(null,t)}},Hi.isAxiosError=function(e){return ue.isObject(e)&&e.isAxiosError===!0},Hi.mergeConfig=Rl,Hi.AxiosHeaders=us,Hi.formToJSON=e=>ZO(ue.isHTMLForm(e)?new FormData(e):e),Hi.getAdapter=nb.getAdapter,Hi.HttpStatusCode=g8,Hi.default=Hi;var hr=Hi;let S8=()=>{};function Eu(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:S8};return e.promise=new ne((t,i)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(r))}}),e}let cm=new Map,lm=new Map,jo=new Map,pi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),ot=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),db=new j5,lo=db.getResult(),OS=null;function Xe(e){if(!OS){lo=db.getResult();let t=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return ot.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ot.CHROME;case"Safari":case"Mobile Safari":return ot.SAFARI;case"Edge":return ot.EDGE;case"Firefox":return ot.FIREFOX;case"QQ":case"QQBrowser":return ot.QQ;case"Opera":return ot.OPERA;case"WeChat":return ot.WECHAT;default:return l.browser.name||""}}(lo),i=ub(lo),r=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(lo),n=lo.os.version,o=ub(lo,!1),a=lo.device.type;if(!(t&&i&&r&&n))return{name:t,version:i,os:r,osVersion:n,browserVersion:o,deviceType:a};OS={name:t,version:i,os:r,osVersion:n,browserVersion:o,deviceType:a}}return OS}function ub(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function dm(){return Xe().os}function hb(){let e=Xe();return"".concat(e.os," ").concat(e.osVersion)}function um(){let e=Xe();return!!(lo.engine.name==="WebKit"&&e.os===pi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ot.SAFARI||ji()&&e.name!==ot.SAFARI)}function Ys(){return Xe().name===ot.CHROME}function mi(){return Xe().name===ot.SAFARI}function pb(){return Xe().name===ot.EDGE}function mt(){return Xe().name===ot.FIREFOX}function ji(){return Xe().os===pi.IOS}function bS(e){let t=Xe();return!(t.name!==ot.CHROME||!t.osVersion)&&Number(t.version)>=e}function mb(e){let t=Xe();return!(t.name!==ot.EDGE||!t.osVersion)&&Number(t.version)>=e}function _b(e){let t=Xe();return!(t.name!==ot.SAFARI||!t.osVersion)&&Number(t.version)>=e}function fb(e,t,i){let r=Xe();if(r.os!==pi.IOS||!r.osVersion)return!1;let n=r.osVersion.split(".");return t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e}function Eb(e,t,i){let r=Xe();if(r.name!==ot.SAFARI||!r.osVersion||!r.browserVersion)return!1;let n=r.browserVersion.split(".");return t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e}function gb(e){let t=Xe();return!(t.name!==ot.OPERA||!t.osVersion)&&Number(t.version)>=e}function Sb(){let e=Xe();return!(e.name!==ot.CHROME||!e.osVersion)&&Number(e.version)<=90}function Tb(){let e=Xe();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Cl(){let e=Xe();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function NS(){let e=Xe();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function vb(){let e=Xe();if(e.os!==pi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Mn(){return mi()&&navigator.maxTouchPoints>0}function Rb(){return Xe().name===ot.WECHAT}function Cb(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function DS(){let e=dm();return function(){let{deviceType:t}=Xe();return t==="mobile"||t==="tablet"}()||e===pi.ANDROID||e===pi.IOS||e===pi.HARMONY_OS}function qs(){let e=Xe();return e.name!==ot.EDGE&&e.name!==ot.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function hm(){return dm()===pi.ANDROID}function gu(){let e=Xe();return hm()&&(e.name===ot.CHROME||e.name===ot.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function yb(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function fe(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yb(Object(i),!0).forEach(function(r){wt(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yb(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function wt(e,t,i){return(t=function(r){var n=function(o,a){if(typeof o!="object"||o===null)return o;var l=o[Symbol.toPrimitive];if(l!==void 0){var d=l.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof n=="symbol"?n:String(n)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let A=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class B extends Error{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(i),wt(this,"code",void 0),wt(this,"message",void 0),wt(this,"data",void 0),wt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return t==="error"&&(i||console).error(this.toString()),t==="warning"&&(i||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function hs(e,t){if(typeof e!="boolean")throw new B(A.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function li(e,t,i){if(!se(i).call(i,e))throw new B(A.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function ht(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(n){return typeof n=="number"&&n%1==0}(e))throw new B(A.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(r,"]. integer only"))}function PS(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new B(A.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&ht(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&ht(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&ht(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&ht(e.ideal,"".concat(t,".ideal"),1,1/0)}else ht(e,t,1,1/0)}function Ai(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new B(A.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Ib(e,i,r,n))throw new B(A.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(r,"].").concat(n?" ASCII characters only.":""))}function ps(e,t){if(!Array.isArray(e))throw new B(A.INVALID_PARAMS,"".concat(t," should be an array"))}function Ut(e){return e==null}function Ib(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!r||function(n){if(typeof n!="string")return!1;for(let o=0;o<n.length;o+=1){let a=n.charCodeAt(o);if(a<0||a>255)return!1}return!0}(e))}function wb(e,t,i){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,i);let r=e.getUint32(t,i),n=e.getUint32(t+4,i),o=+!!i,a=+!i;return BigInt(r*a+n*o)<<BigInt(32)|BigInt(r*o+n*a)}function Ab(e,t,i,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,i,r);let n=Number(i>>BigInt(32)),o=Number(i&BigInt(4294967295));e.setUint32(t,n,r),e.setUint32(t+4,o,r)}var Su=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Su||{}),kS=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(kS||{});let Ob=new class{constructor(){wt(this,"_clientSize",null),wt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),wt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),wt(this,"getStyle",e=>window.getComputedStyle(e,null)),wt(this,"checkCssVisibleProperty",e=>{var t;let i=!0,r=this.getStyle(e),{display:n,visibility:o,opacity:a,filter:l}=r;return(n==="none"||se(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(i=!1),!!i&&(l&&l.split(" ").filter(d=>{var u;let p=d.split("(")[0];return se(u=["brightness","blur","opacity"]).call(u,p)}).map(d=>{let[u,p]=d.split(/\(|\)/);return[u,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{let[u,p]=d;switch(u){case"brightness":(p<.1||p>3)&&(i=!1);break;case"blur":p>3&&(i=!1);break;case"opacity":p<.1&&(i=!1)}}),i)}),wt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let i=!0,r=!0,n=a=>t(a),o=e;for(;o&&r;)n(o)||(i=!1,r=!1),o=o.parentElement,o||(r=!1);return i}),wt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),wt(this,"getSizeAboutClient",e=>{let{width:t,height:i,left:r,right:n,top:o,bottom:a}=e.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:t,height:i,left:r,right:n,top:o,bottom:a,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),wt(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)}),wt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),wt(this,"checkCoverForAPoint",(e,t,i)=>{let r=this.elementFromPoint(e,t);return r!==null&&r!==i}),wt(this,"getPointPositionList",()=>{let{width:e,height:t,left:i,top:r}=this._clientSize,n=e/6,o=t/6,a=[],l=10**6;for(let d=0;d<5;d++)for(let u=0;u<5;u++){let p=(i*l+(d===0?.1:d===4?(n*d*l-1e5)/l:n*d)*l)/l,m=(r*l+(u===0?.1:u===4?(o*u*l-1e5)/l:o*u)*l)/l;a.push({x:p,y:m})}return[...a]}),wt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),wt(this,"checkSizeIsVisible",(e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10)),wt(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:i,bottom:r,clientHeight:n,clientWidth:o,clientMin:a}=this._clientSize,l,d,u,p;if(e<0)l=0;else{if(!(e<o))return!1;l=e}if(t<0)return!1;if(d=t<o?t:o,i<0)u=0;else{if(!(i<n))return!1;u=i}if(r<0)return!1;p=r<n?r:n;let m=d-l,f=p-u;return this.checkSizeIsVisible(m,f,a)}),wt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),wt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Su.COVERED);{let t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(Su.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Su.SIZE)}}return this.returnHiddenResult(Su.STYLE)}return this.returnHiddenResult(kS.UNMOUNTED)}return this.returnHiddenResult(kS.INVALID_HTML_ELEMENT)}),wt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function LS(e){return new TextEncoder().encode(e)}let bb=function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},MS=async e=>function(t,i){let r="";return new Uint8Array(t).forEach(n=>{r+=n.toString(i).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",LS(e)),16),Ot=class{constructor(){wt(this,"_events",{}),wt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let i=this._events[e],r=this._indexOfListener(i,t);r!==-1&&i.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(o=>o);for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(let o=0;o<t.length;o+=1){let a=t[o];a.once&&this.off(e,a.listener),a.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];[...this._events[e]||[]].forEach(n=>{n.once&&this.off(e,n.listener);try{n.listener.apply(this,i)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}},Tu=null;function Nb(){if(Tu)return Tu;if(window.electron)return Tu=window.electron;if(!window.require)return null;try{return Tu=window.require("electron"),Tu}catch{return null}}let ti=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),xt=function(e){return e.TRACER="tracer",e}({});function Db(e){return ht(e.timeout,"config.timeout",0,1e5),ht(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ht(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ht(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let T8=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),We=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function yl(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function Pb(e){return Ai(e.turnServerURL,"turnServerURL"),Ai(e.username,"username"),Ai(e.password,"password"),e.udpport&&ht(e.udpport,"udpport",1,99999,!0),e.forceturn&&hs(e.forceturn,"forceturn"),e.security&&hs(e.security,"security"),e.tcpport&&ht(e.tcpport,"tcpport",1,99999,!0),!0}function kb(e){return e.level!==void 0&&li(e.level,"level",[1,2,3]),e.delay!==void 0&&ht(e.delay,"delay",0,3e3,!0),!0}let He=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ki=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ir=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),rc=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ii(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return e.getListeners(t).length===0?ne.reject(new B(A.UNEXPECTED_ERROR,"can not emit promise")):new ne((o,a)=>{e.emit(t,...r,o,a)})}function _t(e,t){if(e.getListeners(t).length===0)return ne.resolve();for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return ii(e,t,...r)}function Ur(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];return nc(e,t,...r)}function nc(e,t){let i=null,r=null;for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];if(e.emit(t,...o,l=>{i=l},l=>{r=l}),r!==null)throw r;if(i===null)throw new B(A.UNEXPECTED_ERROR,"handler is not sync");return i}let Vt=new class extends Ot{set networkState(e){this.emit(rc.NETWORK_STATE_CHANGE,e,this._networkState),e===ir.ONLINE?this.emit(rc.ONLINE):e===ir.OFFLINE&&(this.onlineWaiter=new ne(t=>{this.once(rc.ONLINE,()=>{this.onlineWaiter=void 0,t(ir.ONLINE)})}),this.emit(rc.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ir.ONLINE}constructor(){super(),wt(this,"_moduleName","network-indicator"),wt(this,"_networkState",ir.ONLINE),wt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ir.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ir.OFFLINE})}};function pm(e,t){let i=e.indexOf(t);i!==-1&&e.splice(i,1)}function Il(e){let t=[];return e.forEach(i=>{t.indexOf(i)===-1&&t.push(i)}),t}function mm(e){ne!==void 0?ne.resolve().then(e):setTimeout(e,0)}function vt(e){return JSON.parse(JSON.stringify(e))}function oc(e){try{return vt(e)}catch{return e}}let Lb={};function Js(e,t){Lb[t]||(Lb[t]=!0,e())}function sc(e){let t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)i[r]=t.charCodeAt(r);return i}function Xs(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function Mb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){let r=new Uint8Array(t);r.set(i),i=r}return i}function Ub(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=ao(t).call(t,(a,l)=>a+l.length,0),n=new Uint8Array(new ArrayBuffer(r)),o=0;return t.forEach(a=>{n.set(a,o),o+=a.length}),n}function Bo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function xb(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{t+=typeof i=="string"?Bo(i):i.size}),t+138}function v8(e){let t=new B(A.TIMEOUT,"timeout");return new ne((i,r)=>{window.setTimeout(()=>r(t),e)})}function _i(e){return new ne(t=>{window.setTimeout(t,e)})}function ft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+ft(e-i.length,"")}function vu(){return ft(32,"").toUpperCase()}let _m=()=>{},Vb=new class{constructor(){wt(this,"fnMap",new Map)}throttleByKey(e,t,i,r){for(var n=arguments.length,o=new Array(n>4?n-4:0),a=4;a<n;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let l=this.fnMap.get(t);if(l.threshold!==i){l.fn(...l.args),clearTimeout(l.timer);let d=window.setTimeout(()=>{let u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:d,args:o,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,fe(fe({},l),{},{fn:e,args:o,skipFn:r}))}else{let l=window.setTimeout(()=>{let d=this.fnMap.get(t);d&&d.fn(...d.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:l,args:o,skipFn:r})}}},Fb=Vb.throttleByKey.bind(Vb);function jb(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function US(e,t){if(!jb(e)||!jb(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let i=[...e];for(let r=0;r<t.length;r++)i[r]=US(e[r],t[r]);return i}{let i=fe({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?i[r]=US(e[r],t[r]):i[r]=t[r]);return i}}function Bb(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let r=0;for(;e>0&&(i[r]=255&e,e>>=8,r++,r!==t););return i}function xS(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Gb(e){let t="0123456789abcdef";function i(P){let M,V="";for(M=0;M<=3;M++)V+=t.charAt(P>>8*M+4&15)+t.charAt(P>>8*M&15);return V}function r(P,M){let V=(65535&P)+(65535&M);return(P>>16)+(M>>16)+(V>>16)<<16|65535&V}function n(P,M,V,F,q,J){return r(function(Z,pe){return Z<<pe|Z>>>32-pe}(r(r(M,P),r(F,J)),q),V)}function o(P,M,V,F,q,J,Z){return n(M&V|~M&F,P,M,q,J,Z)}function a(P,M,V,F,q,J,Z){return n(M&F|V&~F,P,M,q,J,Z)}function l(P,M,V,F,q,J,Z){return n(M^V^F,P,M,q,J,Z)}function d(P,M,V,F,q,J,Z){return n(V^(M|~F),P,M,q,J,Z)}let u=function(P){let M,V=1+(P.length+8>>6),F=new Array(16*V);for(M=0;M<16*V;M++)F[M]=0;for(M=0;M<P.length;M++)F[M>>2]|=P.charCodeAt(M)<<M%4*8;return F[M>>2]|=128<<M%4*8,F[16*V-2]=8*P.length,F}(e),p,m,f,E,I,T=1732584193,R=-271733879,w=-1732584194,O=271733878;for(p=0;p<u.length;p+=16)m=T,f=R,E=w,I=O,T=o(T,R,w,O,u[p+0],7,-680876936),O=o(O,T,R,w,u[p+1],12,-389564586),w=o(w,O,T,R,u[p+2],17,606105819),R=o(R,w,O,T,u[p+3],22,-1044525330),T=o(T,R,w,O,u[p+4],7,-176418897),O=o(O,T,R,w,u[p+5],12,1200080426),w=o(w,O,T,R,u[p+6],17,-1473231341),R=o(R,w,O,T,u[p+7],22,-45705983),T=o(T,R,w,O,u[p+8],7,1770035416),O=o(O,T,R,w,u[p+9],12,-1958414417),w=o(w,O,T,R,u[p+10],17,-42063),R=o(R,w,O,T,u[p+11],22,-1990404162),T=o(T,R,w,O,u[p+12],7,1804603682),O=o(O,T,R,w,u[p+13],12,-40341101),w=o(w,O,T,R,u[p+14],17,-1502002290),R=o(R,w,O,T,u[p+15],22,1236535329),T=a(T,R,w,O,u[p+1],5,-165796510),O=a(O,T,R,w,u[p+6],9,-1069501632),w=a(w,O,T,R,u[p+11],14,643717713),R=a(R,w,O,T,u[p+0],20,-373897302),T=a(T,R,w,O,u[p+5],5,-701558691),O=a(O,T,R,w,u[p+10],9,38016083),w=a(w,O,T,R,u[p+15],14,-660478335),R=a(R,w,O,T,u[p+4],20,-405537848),T=a(T,R,w,O,u[p+9],5,568446438),O=a(O,T,R,w,u[p+14],9,-1019803690),w=a(w,O,T,R,u[p+3],14,-187363961),R=a(R,w,O,T,u[p+8],20,1163531501),T=a(T,R,w,O,u[p+13],5,-1444681467),O=a(O,T,R,w,u[p+2],9,-51403784),w=a(w,O,T,R,u[p+7],14,1735328473),R=a(R,w,O,T,u[p+12],20,-1926607734),T=l(T,R,w,O,u[p+5],4,-378558),O=l(O,T,R,w,u[p+8],11,-2022574463),w=l(w,O,T,R,u[p+11],16,1839030562),R=l(R,w,O,T,u[p+14],23,-35309556),T=l(T,R,w,O,u[p+1],4,-1530992060),O=l(O,T,R,w,u[p+4],11,1272893353),w=l(w,O,T,R,u[p+7],16,-155497632),R=l(R,w,O,T,u[p+10],23,-1094730640),T=l(T,R,w,O,u[p+13],4,681279174),O=l(O,T,R,w,u[p+0],11,-358537222),w=l(w,O,T,R,u[p+3],16,-722521979),R=l(R,w,O,T,u[p+6],23,76029189),T=l(T,R,w,O,u[p+9],4,-640364487),O=l(O,T,R,w,u[p+12],11,-421815835),w=l(w,O,T,R,u[p+15],16,530742520),R=l(R,w,O,T,u[p+2],23,-995338651),T=d(T,R,w,O,u[p+0],6,-198630844),O=d(O,T,R,w,u[p+7],10,1126891415),w=d(w,O,T,R,u[p+14],15,-1416354905),R=d(R,w,O,T,u[p+5],21,-57434055),T=d(T,R,w,O,u[p+12],6,1700485571),O=d(O,T,R,w,u[p+3],10,-1894986606),w=d(w,O,T,R,u[p+10],15,-1051523),R=d(R,w,O,T,u[p+1],21,-2054922799),T=d(T,R,w,O,u[p+8],6,1873313359),O=d(O,T,R,w,u[p+15],10,-30611744),w=d(w,O,T,R,u[p+6],15,-1560198380),R=d(R,w,O,T,u[p+13],21,1309151649),T=d(T,R,w,O,u[p+4],6,-145523070),O=d(O,T,R,w,u[p+11],10,-1120210379),w=d(w,O,T,R,u[p+2],15,718787259),R=d(R,w,O,T,u[p+9],21,-343485551),T=r(T,m),R=r(R,f),w=r(w,E),O=r(O,I);return i(T)+i(R)+i(w)+i(O)}let R8=1,fm=console,vi=class{static setLogger(e){fm=e}constructor(e){wt(this,"lockingPromise",ne.resolve()),wt(this,"locks",0),wt(this,"name",""),wt(this,"lockId",void 0),this.lockId=R8++,e&&(this.name=e),fm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,fm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let i=new ne(n=>{t=()=>{this.locks-=1,fm.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),n()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),r}};function wl(e,t){return function(i,r,n){let o=n.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let l=await a.lock("From ".concat(e,".").concat(r));try{for(var d=arguments.length,u=new Array(d),p=0;p<d;p++)u[p]=arguments[p];return await o.apply(this,u)}finally{l()}},n}}let Xt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Em(e,t){let i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function uo(e,t,i,r){let n=Object.assign({},Xt,r),o=n.timeout,a=async()=>{await function(u){return new ne(p=>{window.setTimeout(p,u)})}(o),o*=n.timeoutFactor,o=Math.min(n.maxRetryTimeout,o)},l=!1,d=new ne(async(u,p)=>{t=t||(()=>!1),i=i||(()=>!0);for(let m=0;m<n.maxRetryCount;m+=1){if(l)return p(new B(A.OPERATION_ABORTED));try{let f=await e();if(!t(f,m)||m+1===n.maxRetryCount)return u(f);await a()}catch(f){if(!i(f,m)||m+1===n.maxRetryCount)return p(f);await a()}}});return d.cancel=()=>l=!0,d}class VS{constructor(t){wt(this,"input",[]),wt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ao(t=this.input).call(t,(i,r)=>i+r)/this.input.length}}let gm,Sm=0,FS=0;function jS(e,t,i,r){return new ne((n,o)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),Sm+=Bo(t.data)):i&&(t.data.size?Sm+=t.data.size:t.data instanceof FormData?Sm+=xb(t.data):Sm+=Bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,hr.request(t).then(a=>{typeof a.data=="string"?FS+=Bo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?FS+=a.data.byteLength:FS+=Bo(JSON.stringify(a.data)),n(a.data)}).catch(a=>{hr.isCancel(a)?o(new B(A.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new B(A.NETWORK_TIMEOUT,a.message)):a.response?o(new B(A.NETWORK_RESPONSE_ERROR,a.response.status)):o(new B(A.NETWORK_ERROR,a.message))})})}async function C8(e,t){let i=new Blob([t.data],{type:"buffer"});return await jS(e,fe(fe({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}let Wb=()=>window.isSecureContext!==void 0,mn=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let r=t[1],n=t[2];return"".concat(r,".").concat(n)}let i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){let r=i[1],n=i[2];return"".concat(r,".").concat(100*(Number(n)+1))}return"4.0.0.999"}("4.21.0"),BS=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),ac=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),GS={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},WS="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",si={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:GS,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function pt(e,t,i){var r,n,o;se(r=Object.keys(si)).call(r,e)&&(!i&&se(n=Object.keys(Qs)).call(n,e)||(si[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(si.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,si.USE_NEW_NETWORK_CONFIG=o,o&&(si.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],si.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],si.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],si.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],si.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",si.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",si.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function N(e){return si[e]}let Qs={};var Be=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Be||{});class y8{constructor(t,i,r,n){wt(this,"state",void 0),this.state={codec:t,audioCodec:i,mode:r,clientId:n,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:ac.Default}}dispatch(t){this.state=function(i,r){switch(r.type){case Be.SET_SESSION_ID:return fe(fe({},i),{},{sessionId:r.sessionId});case Be.SET_P2P_ID:return fe(fe({},i),{},{p2pId:r.p2pId});case Be.SET_UID:return fe(fe({},i),{},{uid:r.uid});case Be.SET_INT_UID:return fe(fe({},i),{},{intUid:r.intUid});case Be.SET_PUB_ID:return fe(fe({},i),{},{pubId:r.pubId});case Be.KEY_METRIC_CLIENT_CREATED:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{clientCreated:r.metric})});case Be.KEY_METRIC_JOIN_START:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{joinStart:r.metric})});case Be.AVOID_JOIN_START:return fe(fe({},i),{},{avoidJoinStart:r.avoidJoinStart});case Be.KEY_METRIC_JOIN_END:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{joinEnd:r.metric})});case Be.KEY_METRIC_REQUEST_AP_START:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{requestAPStart:r.metric})});case Be.KEY_METRIC_REQUEST_AP_END:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{requestAPEnd:r.metric})});case Be.KEY_METRIC_JOIN_GATEWAY_START:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{joinGatewayStart:r.metric})});case Be.KEY_METRIC_JOIN_GATEWAY_END:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{joinGatewayEnd:r.metric})});case Be.KEY_METRIC_PEER_CONNECTION_START:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{peerConnectionStart:r.metric})});case Be.KEY_METRIC_PEER_CONNECTION_END:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{peerConnectionEnd:r.metric})});case Be.KEY_METRIC_DESCRIPTION_START:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{descriptionStart:r.metric})});case Be.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{signalChannelOpen:r.metric})});case Be.KEY_METRIC_ICE_CONNECTION_END:return fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{iceConnectionEnd:r.metric})});case Be.KEY_METRIC_PUBLISH:{let n=i.keyMetrics.publish,o=n.findIndex(a=>a.trackId===r.metric.trackId);return o!==-1?(n[o]=fe(fe({},n[o]),r.metric),fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{publish:[...n]})})):fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,r.metric]})})}case Be.KEY_METRIC_SUBSCRIBE:{let n=i.keyMetrics.subscribe,o=n.findIndex(a=>a.userId===r.metric.userId&&a.type===r.metric.type);return o!==-1?(n[o]=fe(fe({},n[o]),r.metric),fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{subscribe:[...n]})})):fe(fe({},i),{},{keyMetrics:fe(fe({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,r.metric]})})}case Be.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=r.mode,i;case Be.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,r.record]:(i.joinChannelServiceRecords[r.index]=fe(fe({},i.joinChannelServiceRecords[r.index]),r.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case Be.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case Be.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case Be.SET_USE_DATACHANNEL:return fe(fe({},i),{},{useDataChannel:r.val});case Be.SET_USE_P2P:return fe(fe({},i),{},{useP2P:r.val});case Be.SET_TRANSPORT_TYPE:return fe(fe({},i),{},{p2pTransport:r.val});default:return i}}(this.state,t)}set sessionId(t){this.dispatch({type:Be.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Be.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Be.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Be.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Be.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Be.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Be.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:Be.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:Be.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Be.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Be.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Be.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Be.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Be.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Be.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Be.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Be.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Be.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Be.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Be.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Be.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Be.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,i,r,n){this.dispatch({type:Be.KEY_METRIC_PUBLISH,metric:fe(fe({trackId:t,type:i},r&&{publishStart:r}),n&&{publishEnd:n})})}subscribe(t,i,r,n,o,a,l){this.dispatch({type:Be.KEY_METRIC_SUBSCRIBE,metric:fe(fe(fe(fe(fe({userId:t,type:i},r&&{subscribeStart:r}),n&&{subscribeEnd:n}),o&&{firstFrame:o}),a&&{streamAdded:a}),l&&{firstDecoded:l})})}massSubscribe(t,i,r,n){t.forEach(o=>{this.dispatch({type:Be.KEY_METRIC_SUBSCRIBE,metric:fe(fe(fe({userId:o.userId,type:o.type},i&&{subscribeStart:i}),r&&{subscribeEnd:r}),n&&{firstFrame:n})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,i){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof i!="number"?(this.dispatch({type:Be.RECORD_JOIN_CHANNEL_SERVICE,record:fe(fe({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Be.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:i}),i)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Be.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Be.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Be.AVOID_JOIN_START,avoidJoinStart:t})}}let Al=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let Hb=128,I8=96,Kb=1e3,Ol=10,w8=0;function zb(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Ue(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zb(Object(i),!0).forEach(function(r){Wt(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zb(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Wt(e,t,i){return(t=function(r){var n=function(o,a){if(typeof o!="object"||o===null)return o;var l=o[Symbol.toPrimitive];if(l!==void 0){var d=l.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof n=="symbol"?n:String(n)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let Yb=new class extends Ot{constructor(){super(...arguments),Wt(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class A8{constructor(t){Wt(this,"logger",void 0),Wt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.debug(...this.prefixLists,...i)}info(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.info(...this.prefixLists,...i)}warning(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.warning(...this.prefixLists,...i)}error(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];this.logger.error(...this.prefixLists,...i)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function HS(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function qb(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let _n={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Tm=Date.now(),Ru=e=>{for(let t in _n)if(Object.prototype.hasOwnProperty.call(_n,t)&&_n[t]===e)return t;return"DEFAULT"},S=new class{constructor(){Wt(this,"proxyServerURL",void 0),Wt(this,"logLevel",_n.DEBUG),Wt(this,"uploadState","collecting"),Wt(this,"uploadLogWaitingList",[]),Wt(this,"uploadLogUploadingList",[]),Wt(this,"uploadErrorCount",0),Wt(this,"currentLogID",0),Wt(this,"url",void 0),Wt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[_n.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[_n.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[_n.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[_n.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=[_n.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){pt("UPLOAD_LOG",!0)}disableLogUpload(){pt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new A8(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-Tm<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Tm);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=HS()+" Agora-SDK [".concat(Ru(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let n=HS()+" %cAgora-SDK [".concat(Ru(r),"]:"),o=[];if(!N("USE_NEW_LOG"))switch(r){case _n.DEBUG:o=[n,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case _n.INFO:o=[n,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case _n.WARNING:o=[n,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case _n.ERROR:o=[n,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-Tm<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Tm);let r=Math.max(0,Math.min(4,t[0]));t[0]=HS()+" Agora-SDK [".concat(Ru(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!N("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Array.isArray(i[0])?i[0][0]=qb()+" Agora-SDK [".concat(Ru(e),"]:"):i[0]=qb()+" Agora-SDK [".concat(Ru(e),"]:");let n="";i.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),n+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:mn,process_id:N("PROCESS_ID"),payload:JSON.stringify(e)};return uo(async()=>{let i=await hr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(N("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(N("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){let r=new Error("unexpected upload log response");throw r.response=i,r}},()=>(this.uploadLogUploadingList=[],!1),i=>{let r={status:-1,message:i.message,errorRange:e.map(n=>n.log_item_id)};return i.response?(r.status=i.response.status,r.data=i.response.data,r.headers=i.response.headers):i.request&&(r.status=i.request.status),Yb.reportLogUploadError(r),!0},{timeout:N("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:N("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,N("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Jb;function O8(e){return Ai(e.reportId,"params.reportId",0,100,!1),Ai(e.category,"params.category",0,100,!1),Ai(e.event,"params.event",0,100,!1),Ai(e.label,"params.label",0,100,!1),ht(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(Jb={}).FREE="free",Jb.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let b8={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Ri=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),kt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class Cu{constructor(){Wt(this,"baseInfoMap",new Map),Wt(this,"proxyServer",void 0),Wt(this,"eventUploadTimer",void 0),Wt(this,"setSessionIdTimer",void 0),Wt(this,"url",void 0),Wt(this,"backupUrl",void 0),Wt(this,"_appId",void 0),Wt(this,"keyEventUploadPendingItems",[]),Wt(this,"normalEventUploadPendingItems",[]),Wt(this,"apiInvokeUploadPendingItems",[]),Wt(this,"apiInvokeCount",0),Wt(this,"ltsList",[]),Wt(this,"lastSendNormalEventTime",Date.now()),Wt(this,"customReportCounterTimer",void 0),Wt(this,"customReportCount",0),Wt(this,"extApiInvoke",async t=>{for(let i of t){let r=Ue(Ue({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xt.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),N("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),N("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void S.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let i=this.baseInfoMap.get(t),r=Date.now(),n=i.startTime;i.startTime=r,S.debug("rewrite session ".concat(t," startTime: ").concat(r," , ").concat(r-n,"ms")),this.baseInfoMap.set(t,i)}setAppId(t){this._appId=t}reportApiInvoke(t,i,r){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;let n=Date.now();this.apiInvokeCount+=1;let o=this.apiInvokeCount,a=()=>({tag:i.tag,invokeId:o,sid:t,name:i.name,apiInvokeTime:n,options:i.options,states:i.states||null}),l=!!N("SHOW_REPORT_INVOKER_LOG");l&&S.info("".concat(i.name," start"),i.options);let d=!1;_i(i.timeout).then(()=>{d||(this.sendApiInvoke(Ue(Ue({},a()),{},{error:A.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(i.name," timeout")))});let u=new B(A.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:p=>{let m=()=>{if(d)throw u;return d=!0,this.sendApiInvoke(Ue(Ue({},a()),{},{success:!0},i.reportResult&&{result:p})),l&&S.info("".concat(i.name," onSuccess")),p};return r?Fb(m,i.name+"Success",r,()=>d=!0):m()},onError:p=>{let m=()=>{if(d)throw p;d=!0,this.sendApiInvoke(Ue(Ue({},a()),{},{success:!1,error:p})),l&&S.info("".concat(i.name," onFailure"),p.toString())};return r?Fb(m,i.name+"Error",r,()=>d=!0):m()}}}sessionInit(t,i){if(this.baseInfoMap.has(t))return;let r=Date.now(),n=this.createBaseInfo(t,r);n.cname=i.cname;let o=Object.assign({},{willUploadConsoleLog:N("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:BS?"global":"oversea",areas:N("AREAS")&&N("AREAS").join(",")},i.extend),{stringUid:a,channelProfile:l,channelMode:d,isABTestSuccess:u,lsid:p,clientRole:m}=i,f=Date.now(),E=Ue(Ue({},n),{},{eventType:Ri.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:WS,lts:f,elapse:f-r,extend:JSON.stringify(o),mode:i.mode,process:N("PROCESS_ID"),appType:N("APP_TYPE"),success:!0,version:mn,stringUid:a,channelProfile:l,channelMode:d,isABTestSuccess:u,lsid:p,clientType:20,clientRole:m,serviceId:N("PROCESS_ID"),extensionID:N("PLUGIN_INFO").join(",")||"",preload:i.preload?1:0});this.send({type:kt.SESSION,data:E},!0)}joinChooseServer(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.JOIN_CHOOSE_SERVER,lts:o,eventElapse:i.elapse||o-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:o-r.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:kt.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.REQ_USER_ACCOUNT,lts:o,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||o-r.startTime,eventElapse:o-i.lts,extend:JSON.stringify(i.extend)});this.send({type:kt.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info;i.vid&&(n.vid=i.vid),n.uid=i.uid,n.cid=i.cid;let o=Date.now(),{firstSuccess:a,avoidJoinStartTime:l,isProxy:d,addr:u}=i,p=o-(a&&l?l:r.startTime),m=Ue(Ue({},n),{},{eventType:Ri.JOIN_GATEWAY,lts:o,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:p,eventElapse:o-i.lts,firstSuccess:a,signalChannel:i.signalChannel}),f=m.success?1:0;if(i.succ&&(r.lastJoinSuccessTime=o),a)this.send({type:kt.JOIN_GATEWAY,data:m},!0);else{let E;if(u)if(d){let T=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),R=u.match(/p=[0-9]{1,6}/g);E={isSuccess:f,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:R&&R.length?R[0].split("=")[1]:"",isProxy:d?1:0}}else{let T=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),R=u.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:f,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:R&&R.length?R[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else E={isSuccess:f,gatewayIp:"",port:"",isProxy:d?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);let I=Object.assign({},m,E,{eventType:Ri.REJOIN_GATEWAY});this.send({type:kt.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=Date.now(),o=Ue(Ue({},r.info),{},{lts:n,timeout:i,elapse:n-r.startTime});this.send({type:kt.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.PUBLISH,lts:o,eventElapse:i.eventElapse,elapse:o-r.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:kt.PUBLISH,data:a},!0)}subscribe(t,i,r){let n=this.baseInfoMap.get(t);if(!n)return;let o=n.info,a=Date.now(),l=Ue(Ue({},o),{},{eventType:Ri.SUBSCRIBE,lts:a,eventElapse:i.eventElapse,elapse:a-n.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?l.peerSuid=i.peerid:l.peer=i.peerid,this.send({type:kt.SUBSCRIBE,data:l},!0)}wsCompressorInit(t){var i;let r=[...Yr(i=this.baseInfoMap).call(i)],n=r.length?r[0]:"UnableToGetSid",o=this.baseInfoMap.get(n);if(!o)return;let a=o.info,l=Date.now(),d=Ue(Ue({},a),{},{eventType:Ri.WS_COMPRESSOR_INIT,lts:l,eventElapse:t.eventElapse,elapse:l-o.startTime,status:t.status?1:2});this.send({type:kt.WS_COMPRESSOR_INIT,data:d},!0)}firstRemoteVideoDecode(t,i,r,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),d=Ue(Ue(Ue({},a),n),{},{elapse:l-o.startTime,eventType:i,lts:l,firstDecodeFrame:Math.max(l-o.startTime,0),apEnd:Math.max(n.apEnd-o.startTime,0),apStart:Math.max(n.apStart-o.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-o.startTime,0),joinGwStart:Math.max(n.joinGwStart-o.startTime,0),pcEnd:Math.max(n.pcEnd-o.startTime,0),pcStart:Math.max(n.pcStart-o.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-o.startTime,0),subscriberStart:Math.max(n.subscriberStart-o.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-o.startTime,0)});this.send({type:r,data:d},!0)}firstRemoteFrame(t,i,r,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),d=Ue(Ue(Ue({},a),n),{},{elapse:l-o.startTime,eventType:i,lts:l});this.send({type:r,data:d},!0)}pcStats(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue(Ue({},n),i),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:o-r.startTime,eventType:Ri.PC_STATS,lts:o});this.send({type:kt.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(t,i){if(t){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue(Ue({},n),i),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:Ri.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:kt.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(t,i,r,n){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),d=Ue(Ue(Ue({},a),n),{},{eventType:i,lts:l});this.send({type:r,data:d},!0)}streamSwitch(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.STREAM_SWITCH,lts:o,isDual:i.isdual,elapse:o-r.startTime,success:i.succ});this.send({type:kt.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-i.lts,elapse:o-r.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:kt.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{eventType:Ri.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-i.lts,elapse:o-r.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:kt.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?S.debug("reportProxyServerurl: ".concat(t)):S.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue({},n),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:o,elapse:o-r.startTime,joinChannelSuccessElapse:o-(r.lastJoinSuccessTime||o),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:kt.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now();(function(a,l,d){let u=a[l];if(!u||typeof u!="string")return[a];a[l]="";let p=Bo(JSON.stringify(a)),m=0,f=[],E=0;for(let I=0;I<u.length;I++)E+=u.charCodeAt(I)<=127?1:3,E<=d-p||(f[f.length]=fe(fe({},a),{},{[l]:u.substring(m,I)}),m=I,E=u.charCodeAt(I)<=127?1:3);return m!==u.length-1&&(f[f.length]=fe(fe({},a),{},{[l]:u.substring(m)})),f})(Ue(Ue(Ue({},n),i),{},{elapse:o-r.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:kt.WORKER_EVENT,data:a},!0))}apworkerEvent(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue(Ue({},n),i),{},{elapse:o-r.startTime,lts:o});this.send({type:kt.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue(Ue({},n),i),{},{elapse:o-r.startTime,lts:o,extend:i.extend||void 0});this.send({type:kt.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,i){let r=this.baseInfoMap.get(t);if(!r)return;let n=r.info,o=Date.now(),a=Ue(Ue(Ue({},n),i),{},{elapse:o-r.startTime,lts:o});this.send({type:kt.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,i){if(this.customReportCount+=i.length,this.customReportCount>N("CUSTOM_REPORT_LIMIT"))throw new B(A.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),n=i.map(o=>({type:kt.USER_ANALYTICS,data:Ue(Ue({sid:t},o),{},{lts:r})}));try{N("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(o){throw S.error("send custom report message failed",o.toString()),new B(A.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(t){let i=N("NOT_REPORT_EVENT");if(t.tag&&se(i)&&se(i).call(i,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let r=this.baseInfoMap.get(t.sid);if(!r)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:n,uid:o,cid:a}=r.info,l;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof B){let{code:u,message:p}=t.error;l=u||p||t.error.toString()}else l=t.error.toString();let d={invokeId:t.invokeId,sid:t.sid,cname:n,cid:a,uid:o,lts:t.lts,success:t.success,elapse:t.lts-r.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?l:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:kt.API_INVOKE,data:d},!1),!0}appendSessionId(){Cu.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let i=this.apiInvokeUploadPendingItems.length;for(let r=0;r<i;r++){let n=this.apiInvokeUploadPendingItems.shift();n&&(n.sid=t._sessionId,this.sendApiInvoke(Object.assign({},n)))}}})}send(t,i){if(i)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,i){let r=[],n=[];for(;t.length;){let a=t.shift();r.length<20?r.push(a):n.push(a)}t.push(...n);for(let a of[...r]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),ru(o=this.ltsList).call(o,(l,d)=>l-d))}return i||(this.lastSendNormalEventTime=Date.now()),N("ENABLE_EVENT_REPORT")&&r.length&&(N("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((a=>l=>{N("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-N("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(r)),t}async postDataToStatsCollector2(t){Vt.networkState===ir.OFFLINE&&await ne.race([Vt.onlineWaiter,_i(2*Xt.maxRetryTimeout)]);let i=o=>{let a=new Uint8Array;return o.forEach(l=>{let d=LS(JSON.stringify(l.data)),u=new ArrayBuffer(5),p=(f=>{let E=0;return Object.entries(kt).forEach(I=>{let[T,R]=I;R===f.type&&(E=EventNameToID[T])}),E})(l),m=new DataView(u);m.setUint16(0,d.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),a=bb(a,new Uint8Array(u)),a=bb(a,d)}),a},r="event",n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let o=0;o<2;o+=1){o===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await jS(n,{timeout:1e4,data:i(t),headers:Ue(Ue({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(a=>JSON.stringify(a)),vid:(a=>{let l=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return l&&l.info.vid&&+l.info.vid||0})(t[0])};Vt.networkState===ir.OFFLINE&&await ne.race([Vt.onlineWaiter,_i(2*Xt.maxRetryTimeout)]);let n=i?"/events/proto-raws":"/events/messages",o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(N("EVENT_REPORT_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(n));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(n):"https://".concat(N("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(n)));try{i?await C8(o,{timeout:1e4,data:r}):await jS(o,{timeout:1e4,data:r})}catch(l){if(a===1)throw l;continue}return}}createBaseInfo(t,i){let r=Object.assign({},b8);return r.sid=t,this.baseInfoMap.set(t,{info:r,startTime:i}),r}reportResourceTiming(t,i){let r=performance.getEntriesByName(t),n=r[r.length-1];n&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:n,tag:xt.TRACER}).onSuccess()}}function ye(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,r){let n=r.value;if(typeof n=="function"){let o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];let u=l;if(e.argsMap)try{u=e.argsMap(this,...l)}catch(m){S.warning(m),u=[]}try{JSON.stringify(u)}catch{S.warning("arguments for method ".concat(o,".").concat(String(i)," not serializable for apiInvoke.")),u=[]}let p=(e.report||_e).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(i)),options:u,tag:xt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let m=n.apply(this,l);return m instanceof ne?m.then(f=>(p.onSuccess(e.reportResult&&f),f)).catch(f=>{throw p.onError(f),f}):(p.onSuccess(e.reportResult&&m),m)}catch(m){throw p.onError(m),m}}}return r}}Wt(Cu,"__CLIENT_LIST__",[]);let _e=new Cu;Yb.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Vt.networkState,_e.reportApiInvoke(null,{name:"logUploadError",options:e,tag:xt.TRACER}).onSuccess("logUploadError")});let N8=["CHINA","GLOBAL"],Li=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let r=i.join(""),n=[];for(let l=0;l<6;l++)n.push("1");let o=n.join(""),a={};return a[e]=r,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Li,BS||(si.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],si.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],si.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],si.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],si.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],si.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],si.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",si.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",si.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",si.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",si.AREAS=["NORTH_AMERICA","OVERSEA"]);let Xb=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Zs=[];function cc(e,t){return!!t&&Zs.some(i=>i.uid===e&&i.channelName===t)}Cu.__CLIENT_LIST__=Zs;var D8=yA.forEach,Qb=lp("forEach")?[].forEach:function(e){return D8(this,e,arguments.length>1?arguments[1]:void 0)};Tt({target:"Array",proto:!0,forced:[].forEach!=Qb},{forEach:Qb});var P8=Pn("Array").forEach,k8=Lo,L8=Fi,M8=Q,U8=P8,KS=Array.prototype,x8={DOMTokenList:!0,NodeList:!0},V8=function(e){var t=e.forEach;return e===KS||M8(KS,e)&&t===KS.forEach||L8(x8,k8(e))?U8:t},F8=g(V8),j8=ko,Zb=mp;Tt({target:"Object",stat:!0,forced:v(function(){Zb(1)})},{keys:function(e){return Zb(j8(e))}});var $b=g(so.Object.keys),B8=g(Ky),G8=Tt,W8=su,H8=K([].reverse),eN=[1,2];G8({target:"Array",proto:!0,forced:String(eN)===String(eN.reverse())},{reverse:function(){return W8(this)&&(this.length=this.length),H8(this)}});var K8=Pn("Array").reverse,z8=Q,Y8=K8,zS=Array.prototype,q8=function(e){var t=e.reverse;return e===zS||z8(zS,e)&&t===zS.reverse?Y8:t},tN=q8,J8=g(tN),X8=Tt,iN=su,Q8=wp,Z8=zr,rN=_E,$8=ls,ez=xs,tz=Fp,iz=Jt,rz=JE,nz=mA("slice"),oz=iz("species"),YS=Array,sz=Math.max;X8({target:"Array",proto:!0,forced:!nz},{slice:function(e,t){var i,r,n,o=ez(this),a=$8(o),l=rN(e,a),d=rN(t===void 0?a:t,a);if(iN(o)&&(i=o.constructor,(Q8(i)&&(i===YS||iN(i.prototype))||Z8(i)&&(i=i[oz])===null)&&(i=void 0),i===YS||i===void 0))return rz(o,l,d);for(r=new(i===void 0?YS:i)(sz(d-l,0)),n=0;l<d;l++,n++)l in o&&tz(r,n,o[l]);return r.length=n,r}});var az=Pn("Array").slice,cz=Q,lz=az,qS=Array.prototype,dz=function(e){var t=e.slice;return e===qS||cz(qS,e)&&t===qS.slice?lz:t},uz=g(dz);function ie(e,t,i,r,n){var o,a,l,d={};return F8(o=$b(r)).call(o,function(u){d[u]=r[u]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=B8(a=J8(l=uz(i).call(i)).call(l)).call(a,function(u,p){return p(e,t,u)||u},d),n&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(n):void 0,d.initializer=void 0),d.initializer===void 0&&(dA(e,t,d),d=null),d}var hz=Pn("Array").values,pz=Lo,mz=Fi,_z=Q,fz=hz,JS=Array.prototype,Ez={DOMTokenList:!0,NodeList:!0},gz=function(e){var t=e.values;return e===JS||_z(JS,e)&&t===JS.values||mz(Ez,pz(e))?fz:t},ho=g(gz);let Sz=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Jr=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),vm=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),XS=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Un=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),rr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ce=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Ge=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),de=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),Se=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),lc=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Ne=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),nr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Oe=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class U extends B{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),y(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,S)}throw(){super.throw(S)}}function Rm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw S.error("Invalid Channel Name ".concat(e)),new U(A.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Cm(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!Ib(e,1,255))throw new U(A.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Ci=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),bl=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({}),Tz={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},QS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ZS(e,t){Ai(e.url,"".concat(t,".url"),1,1e3,!1),Ut(e.x)||ht(e.x,"".concat(t,".x"),0,1e4),Ut(e.y)||ht(e.y,"".concat(t,".y"),0,1e4),Ut(e.width)||ht(e.width,"".concat(t,".width"),0,1e4),Ut(e.height)||ht(e.height,"".concat(t,".height"),0,1e4),Ut(e.zOrder)||ht(e.zOrder,"".concat(t,".zOrder"),0,255),Ut(e.alpha)||ht(e.alpha,"".concat(t,".alpha"),0,1,!1)}let vz={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Rz={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},Go=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),ym=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),ai=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function nN(e){if(!e.channelName)throw new U(A.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new U(A.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Ai(e.token,"info.token",1,2047),Cm(e.uid),Rm(e.channelName),!0}let or=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ms=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Rr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Nl=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),st=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Ht=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),yu=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),fi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),oN=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),tt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),sN=[tt.AFRICA,tt.ASIA,tt.CHINA,tt.EUROPE,tt.GLOBAL,tt.INDIA,tt.JAPAN,tt.NORTH_AMERICA,tt.OCEANIA,tt.OVERSEA,tt.SOUTH_AMERICA],Bi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),Im={CHINA:{},ASIA:{CODE:Bi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};BS&&(Im.CHINA={CODE:Bi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let $S=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class aN extends Ot{constructor(t,i){super(),y(this,"onICEConnectionStateChange",void 0),y(this,"onConnectionStateChange",void 0),y(this,"onDTLSTransportStateChange",void 0),y(this,"onDTLSTransportError",void 0),y(this,"onICETransportStateChange",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoReceived",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"getLocalVideoStats",void 0)}}class wm extends aN{constructor(t,i){super(t,i),y(this,"establishPromise",void 0)}}let me=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ji=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),_s=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),X=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),at=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ie=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),xn=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Vn=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),yi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),$s=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ri=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),Wo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),fn=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),po=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Dl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Kt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Pl=function(e){return e.ABORT="abort",e}({}),ea=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Cz=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),yz={[vm.ACCESS_POINT]:{[rr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[rr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[rr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[rr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[rr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[rr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[rr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[vm.UNILBS]:{[Un.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Un.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Un.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Un.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Un.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Un.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Un.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Un.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Un.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Un.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Un.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Un.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[vm.STRING_UID_ALLOCATOR]:{[XS.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[XS.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[XS.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function kl(e){let t=yz[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===vm.ACCESS_POINT){let r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}let Iz={[Ce.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ce.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ce.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ce.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ce.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ce.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ce.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ce.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ce.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ce.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ce.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ce.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ce.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ce.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ce.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ce.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ce.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ce.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ce.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ce.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ce.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ce.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ce.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ce.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ce.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ce.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ce.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ce.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ce.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ce.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ce.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ce.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ce.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ce.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ce.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ce.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ce.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ce.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ce.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ce.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ce.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ce.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ce.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ce.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ce.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ce.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ce.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ce.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ce.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ce.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ce.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ce.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ce.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ce.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ce.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ce.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ce.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ce.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ce.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ce.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function dc(e){return Iz[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function cN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function eT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cN(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function lN(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function dN(e,t){if(typeof e=="string")return e;let{proxy:i,host:r,port:n}=e;if(t){let o=N("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(r,"/ws/?p=").concat(Number(n)+150):"wss://".concat(r,":").concat(o,"/ws/?p=").concat(Number(n)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(r,"&p=").concat(n):"wss://".concat(r,":").concat(n)}let wz=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Az=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Oz=/wss:\/\/(.+):([0-9]+)\/?/,bz=/wss:\/\/(.[^\/]+)\/?/,Nz=0;class Dz{constructor(t,i){y(this,"id",0),y(this,"store",void 0),y(this,"recordIndex",void 0),y(this,"websockets",[]),y(this,"try443PortDuration",2e3),y(this,"forceCloseWSDuration",5e3),y(this,"try443PortTimeout",null),y(this,"forceCloseTimeout",null),y(this,"isTry443PortFailed",!1),y(this,"isNormalPortFailed",!1),y(this,"useDoubleDomain",!1),y(this,"useProxy",!1),y(this,"startTime",Date.now()),this.id=++Nz,this.try443PortDuration=N("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;let i=Date.now()-this.startTime;for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];S.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...n)}createWebSocket(t,i,r){this.logger("createWebSocket:",t,{isTry443Port:i,hasTimeoutDetection:r});let n=N("GATEWAY_DOMAINS"),o=Date.now(),a=[],l=n.find(p=>{var m;return se(m=t.host).call(m,p)});l||(this.useDoubleDomain=!1);let d=[];if(this.useDoubleDomain)n.forEach(p=>{d.push(dN(eT(eT({},t),{},{host:t.host.replace(l,p)}),i))});else{let p=eT({},t);if(i&&l){let m=n.find(f=>f!==l);m&&(p.host=p.host.replace(l,m))}d.push(dN(p,i))}try{d.forEach(p=>{let m=new WebSocket(p);m.binaryType="arraybuffer",a.push(m),this.logger("ws is connecting:",m.url)})}catch(p){if(this.logger("ws create failed"),a.forEach(m=>m.close()),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,i,r);if(!i&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new U(A.WS_ERR,"init websocket failed! Error: ".concat(p.toString()))}let u=Eu();return this.store&&this.store.recordJoinChannelService({urls:a.map(p=>p.url),service:"gateway"},this.recordIndex),a.forEach(p=>{p.onopen=()=>{this.logger("onopen: ws ".concat(p.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(m=>{m!==p&&(m.onopen=null,m.onclose=null,m.onmessage=null,m.close(),this.logger("close backup websocket: ".concat(m.url)))}),this.websockets.length=0,u.resolve(p)},p.onclose=m=>{this.logger("onclose: ws ".concat(p.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(p.readyState)),i?this.isTry443PortFailed=lN(a):this.isNormalPortFailed=lN(a),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(i&&this.isTry443PortFailed||!i&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(m.reason)),u.reject({code:m.code,reason:yu.A_ROUND_WS_FAILED}))},p.onmessage=m=>this.logger("".concat(p.url," onmessage: ").concat(m.data))}),this.websockets.push(...a),r||(()=>{let p=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())};if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(p,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u.isResolved),u.isResolved)return p();Xe().os===pi.MAC_OS&&mt()&&p(),this.createWebSocket(t,!0,!0).then(m=>u.resolve(m)).catch(m=>{this.isNormalPortFailed&&u.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(p,this.forceCloseWSDuration)},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(t,i,r,n){return this.useDoubleDomain=!!i,typeof t=="string"&&(t=function(o){let a,l,d;return[,a,l,d]=o.match(wz)||[],a||([,l,d]=o.match(Az)||[]),l&&d||([,l,d]=o.match(Oz)||[]),l&&d||([,l]=o.match(bz)||[]),l||S.warning("un-destructible url: ",o),{proxy:a,host:l,port:d||"443"}}(t)),this.recordIndex=n,this.useProxy=!!t.proxy,r&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function uN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}class hN extends Ot{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;se(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Oe.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Oe.CONNECTED):this._state==="closed"?this.emit(Oe.CLOSED):this._state==="failed"&&this.emit(Oe.FAILED))}resetReconnectCount(t){S.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),y(this,"connectionID",0),y(this,"currentURLIndex",0),y(this,"urls",[]),y(this,"_reconnectMode","tryNext"),y(this,"reconnectReason",void 0),y(this,"_initMutex",new vi("websocket")),y(this,"name",void 0),y(this,"_state","closed"),y(this,"reconnectInterrupter",void 0),y(this,"websocket",void 0),y(this,"retryConfig",void 0),y(this,"reconnectCount",0),y(this,"forceCloseTimeout",5e3),y(this,"onlineReconnectListener",void 0),y(this,"useCompress",void 0),y(this,"tryDoubleDomain",!1),y(this,"use443PortOnly",!1),y(this,"wsInflateLength",0),y(this,"wsDeflateLength",0),y(this,"closeEstablishingWs",()=>{}),y(this,"store",void 0),y(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(m){for(var f=1;f<arguments.length;f++){var E=arguments[f]!=null?arguments[f]:{};f%2?uN(Object(E),!0).forEach(function(I){y(m,I,E[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(E)):uN(Object(E)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(E,I))})}return m}({},i),this.useCompress=r,this.tryDoubleDomain=n,this.use443PortOnly=o;let{timeout:l,timeoutFactor:d}=i,u=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);ir.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p),Vt.on(rc.NETWORK_STATE_CHANGE,(m,f)=>{m!==f&&(this.resetReconnectCount("network state change: ".concat(f," -> ").concat(m)),m===ir.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=await this._initMutex.lock();this.forceCloseTimeout=i,this.urls=t,this.state="connecting";try{let n=Eu(),o=this.urls[this.currentURLIndex];this.createWebSocketConnection(o).then(n.resolve).catch(n.reject),this.once(Oe.CLOSED,()=>{n.reject(new B(A.WS_DISCONNECT))}),this.once(Oe.CONNECTED,n.resolve),await n.promise}catch{}finally{r()}}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;i?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,i){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:i})}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new B(A.WS_ABORT,"websocket is not ready");try{i||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new B(A.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var i;let r=Eu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},o=async p=>{var m;if(S.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new B(A.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");let f=Ur(this,Oe.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,E=await this.reconnectWithAction(f);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!E)return r.reject(new B(A.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);r.resolve()}},a=p=>{this.emit(Oe.ON_MESSAGE,p)},l=p=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),N("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=N("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),t);let d=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;let p=await this.chooseBestWebsocketConnection(t);this.websocket=p,n&&n(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=a,this.websocket.onerror=l,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){let m=this.state==="closed",f=p instanceof B,E=f&&p.code===A.WS_ABORT,I=f&&p.code===A.WS_ERR,T=f?p.message:p&&(p.reason||p.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(T)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:E?"aborted":"error",errors:[p]},d),m||I?(r.reject(m?new B(A.WS_DISCONNECT,"websocket is closed: ".concat(T)):new B(A.WS_ERR,"init websocket failed: ".concat(T))),I&&S.error("[".concat(this.name,"] init websocket failed: ").concat(T))):o&&o(p)}return r.promise}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Vt.isOnline||!Vt.onlineWaiter||(this.onlineReconnectListener=Vt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,i){let a=Em(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(a,"ms to reconnect websocket, mode: ").concat(t)),await ne.race([_i(a),this.onlineReconnectListener||new ne(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;let n=async(a,l)=>{this.emit(Oe.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(a)};try{if(t==="retry")this.emit(Oe.RECONNECT_WAITTING_FINISH,t),await n(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Oe.RECONNECT_WAITTING_FINISH,t),await n(this.urls[this.currentURLIndex],t)}else t==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Oe.RECONNECT_WAITTING_FINISH,t),this.urls=await ii(this,Oe.REQUEST_NEW_URLS),this.currentURLIndex=0,await n(this.urls[this.currentURLIndex],t))}catch(a){var o;S.error("[".concat(this.name,"] reconnect failed ").concat(a&&a.toString()));let l=a==null||(o=a.data)===null||o===void 0?void 0:o.desc;return Array.isArray(l)&&se(l).call(l,"dynamic key expired")?(this.emit(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,i)}return!0}}class Iu extends hN{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){let r=Eu(),n=function(a,l){return new Dz(a,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),r.reject(new B(A.WS_ABORT,"choose best websocket aborted"))};let o=N("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",t,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,i).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class wu extends hN{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){return new ne((r,n)=>{let o=!1,a=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),a.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),n(new B(A.WS_ABORT,"choose best websocket aborted"))};let l=N("GATEWAY_DOMAINS"),d,u=t.indexOf("?h="),p=l.find(I=>u!==-1?se(t).call(t,I,u):se(t).call(t,I));S.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var f;let I=Date.now();try{l.forEach(T=>{let R=u===-1?t.replace(p,T):t.substr(0,u)+t.substr(u).replace(p,T),w=new WebSocket(R);w.binaryType="arraybuffer",a.push(w),S.debug("[choose-best-ws] ws is connecting:",w.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(T=>T.close());a.length;)a.pop();m=!0}(f=this.store)===null||f===void 0||f.recordJoinChannelService({urls:a.map(T=>T.url),service:"gateway"},i),a.forEach(T=>{T.onopen=()=>{if(o)return;let R=Date.now()-I;S.debug("[choose-best-ws] ws open cost ".concat(R,"ms")),a.filter(w=>w!==T).forEach(w=>{S.debug("[choose-best-ws]close backup websocket: ".concat(w.url)),w.close()}),o=!0,r(T)},T.onclose=R=>{d=R,!o&&(a.find(w=>!(w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),o=!0,n(d)))},T.onmessage=R=>{S.debug("[choose-best-ws]".concat(T.url," onmessage: ").concat(R.data))}}),_i(this.forceCloseTimeout).then(()=>{a.forEach(T=>{T.readyState!==WebSocket.OPEN&&T.close()})})}if(m){var E;let I;S.debug("[choose-best-ws] use single url: ",t),(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:[t],service:"gateway"},i);try{I=new WebSocket(t),a.push(I),I.binaryType="arraybuffer"}catch(T){let R=new B(A.WS_ERR,"init websocket failed! Error: ".concat(T.toString()));return S.error("[".concat(this.name,"]").concat(R)),void n(R)}I.onopen=()=>{r(I)},I.onclose=T=>{n(T)},I.onmessage=T=>{S.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(T.data))},_i(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class pN extends Ot{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(de.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",Ge.CLOSED),y(this,"reconnectToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new VS(5)),y(this,"pingpongTimer",void 0),y(this,"wsInflateDataTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let o="res-@".concat(n._id);this.emit(o,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){if(this.emit(n._type,n._message),n._type===Ne.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===Ne.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(We.UID_BANNED);break;case 15:this.close(We.IP_BANNED);break;case 16:this.close(We.CHANNEL_BANNED)}if(n._type===Ne.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case Ce.ERR_LICENSE_MISSING:this.close(We.LICENSE_MISSING);break;case Ce.ERR_LICENSE_EXPIRED:this.close(We.LICENSE_EXPIRED);break;case Ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(We.LICENSE_MINUTES_EXCEEDED);break;case Ce.ERR_LICENSE_PERIOD_INVALID:this.close(We.LICENSE_PERIOD_INVALID);break;case Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(We.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ce.ERR_LICENSE_ILLEGAL:this.close(We.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new Iu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",ki.OFFLINE)})}async request(t,i,r,n){let o=ft(6,""),a={_id:o,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new ne((I,T)=>{if(this.connectionState===Ge.CONNECTED)return I();let R=()=>{this.off(de.WS_CLOSED,w),I()},w=()=>{this.off(de.WS_CONNECTED,R),T(new U(A.WS_ABORT))};this.once(de.WS_CONNECTED,R),this.once(de.WS_CLOSED,w),t!==Se.PUBLISH&&t!==Se.PUBLISH_DATASTREAM&&t!==Se.SUBSCRIBE&&t!==Se.SUBSCRIBE_DATASTREAM&&t!==Se.UNSUBSCRIBE&&t!==Se.UNSUBSCRIBE_DATASTREAM&&t!==Se.UNPUBLISH&&t!==Se.UNPUBLISH_DATASTREAM&&t!==Se.CONTROL&&t!==Se.RESTART_ICE||this.once(de.DISCONNECT_P2P,()=>{T(new U(A.DISCONNECT_P2P))}),t!==Se.PUBLISH&&t!==Se.RESTART_ICE||this.once(de.ABORT_P2P_EXECUTION,()=>{T(new U(A.DISCONNECT_P2P))})});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===Se.JOIN||t===Se.REJOIN||await d(),this.websocket.sendMessage(a,!0),n)return;let u=new ne((I,T)=>{let R=!1,w=(P,M)=>{R=!0,I({isSuccess:P==="success",message:M||{}}),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.emit(de.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(o),w);let O=()=>{T(new U(A.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.off("res-@".concat(o),w)};this.once(de.WS_CLOSED,O),this.once(de.WS_RECONNECTING,O),_i(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||R||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(de.REQUEST_TIMEOUT,t,i))})}),p=null;try{p=await u}catch(I){if(this.connectionState===Ge.CLOSED||t===Se.LEAVE)throw new U(A.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Se.JOIN||t===Se.REJOIN?null:(await d(),await this.request(t,i))}if(p.isSuccess)return p.message;let m=Number(p.message.error_code||p.message.code),f=dc(m),E=new U(A.UNEXPECTED_RESPONSE,"".concat(f.desc,": ").concat(p.message.error_str),{code:m,data:p.message});return f.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(f.desc,", action: ").concat(f.action)),m===Ce.ERR_TOO_MANY_BROADCASTERS?((t===Se.JOIN||t===Se.REJOIN)&&(this.initError=E,this.close()),E.throw()):f.action==="failed"?E.throw():f.action==="quit"?(this.initError=E,this.close(),E.throw()):(m===Ce.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ki.MULTI_IP)):this.reconnect(f.action,ki.SERVER_ERROR),t===Se.JOIN||t===Se.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new ne(r=>{let n=o=>{(!i||i(o))&&(this.off(t,n),r(o))};this.on(t,n)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(lc.WRTC_STATS,i)}upload(t,i){let r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{let n=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let r={_type:t,_message:i};this.websocket.sendMessage(r)}init(t,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ne((r,n)=>{this.once(de.WS_CONNECTED,()=>r(this.joinResponse)),this.once(de.WS_CLOSED,()=>n(this.initError||new U(A.WS_ABORT))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||We.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===We.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Iu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(de.ABORT_P2P_EXECUTION);let t=await ii(this,de.REQUEST_JOIN_INFO),i=await this.request(Se.JOIN,t);if(!i)return this.emit(de.REPORT_JOIN_GATEWAY,yu.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new U(A.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=nc(this,de.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(Se.REJOIN,t);return!!i&&(this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(r=>{this.emit(Ne.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ne.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ne.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ne.MUTE_AUDIO,{uid:r.uid}):this.emit(Ne.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ne.MUTE_VIDEO,{uid:r.uid}):this.emit(Ne.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ne.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ne.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ne.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let i=dc(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(We.UID_BANNED),void this.close()):void this.reconnect(i.action,ki.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=N("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ki.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-i;this.rttRolling.add(r),N("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:i}=this.websocket.getWsInflateData();t!==0&&i!==0&&this.upload(lc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Oe.RECONNECT_WAITTING_FINISH,t=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Oe.RECONNECT_CREATE_CONNECTION,t=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Oe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Oe.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(Oe.FAILED,()=>{this._disconnectedReason=We.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(Oe.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(Oe.WILL_RECONNECT,(t,i,r)=>{let n=nc(this,de.IS_P2P_DISCONNECTED),o=n||t!=="retry";n&&t==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",i=yu.P2P_DISCONNECTED),o&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(de.REPORT_JOIN_GATEWAY,i||yu.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":t),this.emit(de.DISCONNECT_P2P)),r(t)}),this.websocket.on(Oe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ki.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code||yu.UNKNOWN_REASON,this.url||""),t instanceof U){if(t.code===A.UNEXPECTED_RESPONSE&&t.data.code===Ce.ERR_NO_AUTHORIZED)return this.initError=new U(A.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ki.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ki.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Oe.REQUEST_NEW_URLS,(t,i)=>{ii(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let Qt=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function mN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Am(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mN(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function ta(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(N("TURN_DOMAIN")):(S.info("Unidentified as ip: ".concat(e,", use as host")),e)}function tT(e,t){e.addresses||(e.addresses=[]);let i=function(o,a){if(N("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return o.map(u=>{let{ip:p,port:m}=u;return{address:"".concat(p,":").concat(m)}});let l=N("GATEWAY_DOMAINS"),d=l[1]&&se(a).call(a,l[1])?1:0;return o.map(u=>{let{domain_prefix:p,port:m,ip:f}=u;if(p)return{address:"".concat(p,".").concat(l[d++%l.length],":").concat(m)};let E=/^[\.\:\d]+$/.test(f),I=E?"".concat(f.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(m):"".concat(f,":").concat(m);return E||S.info("Unidentified as ip: ".concat(f,", use as host")),{ip:f,port:m,address:I}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){let o=r.split(";");for(let a=0;a<o.length;a++){var n;let l=qi(n=o[a]).call(n);i[a]&&l&&(i[a].ip6=l)}}return{gatewayAddrs:i,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Cr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _N(e){let t=e._encoderConfig;if(!t)return{};let i={resolution:t.width&&t.height?"".concat(Cr(t.width),"x").concat(Cr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function fN(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Au(e,t){let i,r,n;switch(t){case Qt.CHOOSE_SERVER:r=4096,n="choose server";break;case Qt.CLOUD_PROXY:r=1048576,n="proxy";break;case Qt.CLOUD_PROXY_5:r=4194304,n="proxy5";break;case Qt.CLOUD_PROXY_FALLBACK:r=4194310,n="proxy fallback";break;default:throw new U(A.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===r&&(i={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(a=>Am(Am({},a),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:Am(Am({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!i)throw new U(A.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function EN(e,t){return await ne.all(e.addresses.map(async i=>({address:ta(i.ip),tcpport:i.port,udpport:i.port,username:t&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Li.username,password:t&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await MS(t.toString()):Li.password})))}function iT(e,t){let i=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||i.height,n=t.videoWidth||i.width;return r&&n?Math.max(Math.min(r,n)/Math.min(Cr(e.height),Cr(e.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ia(e){let{candidateType:t,relayProtocol:i,type:r,address:n,port:o,protocol:a}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:i,protocol:a}:{candidateType:t,relayProtocol:i,address:n,port:o,protocol:a}}function gN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}class Pz extends Ot{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;se(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ri.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ri.CONNECTED):this._state==="closed"?this.emit(ri.CLOSED):this._state==="failed"&&this.emit(ri.FAILED))}constructor(t,i,r,n){super(),y(this,"connectionID",0),y(this,"currentURLIndex",0),y(this,"reconnectReason",void 0),y(this,"_reconnectMode","tryNext"),y(this,"_initMutex",void 0),y(this,"_name",void 0),y(this,"_state","closed"),y(this,"_reconnectInterrupter",void 0),y(this,"_url",void 0),y(this,"_retryConfig",void 0),y(this,"_reconnectCount",0),y(this,"_forceCloseTimeout",5e3),y(this,"_onlineReconnectListener",void 0),y(this,"_closeEstablishingTransmitter",()=>{}),y(this,"_store",void 0),y(this,"_joinChannelServiceRecordIndex",void 0),y(this,"_transmitter",void 0),y(this,"_useCompress",void 0),y(this,"_inflateLength",0),y(this,"_deflateLength",0),this._store=n,this._name=t,this._retryConfig=function(o){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?gN(Object(l),!0).forEach(function(d){y(o,d,l[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):gN(Object(l)).forEach(function(d){Object.defineProperty(o,d,Object.getOwnPropertyDescriptor(l,d))})}return o}({},i),this._useCompress=r}resetReconnectCount(t){S.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let r=this._transmitter;i?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,i){if(!this._transmitter)return void S.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));let n=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),n&&n.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){let t=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:i}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let mo=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class kz{constructor(t,i,r){y(this,"version",1),y(this,"initialRTO",void 0),y(this,"maxBatchAckCount",void 0),y(this,"maxRTO",void 0),y(this,"initialRTT",void 0),y(this,"ID",void 0),y(this,"rtt",void 0),y(this,"packetNumber",1),y(this,"rtoRatioMap",new Map),y(this,"timeoutMap",new Map),y(this,"unorderedPacketQueue",[]),y(this,"batchAckPacketQueue",[]),y(this,"lastOrderedPacketNumber",0),y(this,"batchAckTimer",void 0),y(this,"sendImpl",void 0),y(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=i,this.ID=ft(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:N("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:N("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:N("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:N("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:N("TRANSMITTER_MAX_RTO")}packetize(t,i){return{type:mo.Default,version:this.version,packetNumber:i,payload:t}}serialize(t){switch(t.type){case mo.Default:{let i;typeof t.payload=="string"?i=new TextEncoder().encode(t.payload):i=t.payload;let r=new ArrayBuffer(i.length+15),n=new DataView(r);return n.setUint16(0,t.version),n.setUint8(2,t.type),n.setUint32(3,t.packetNumber),Ab(n,7,BigInt(t.sendTs)),new Uint8Array(n.buffer).set(i,15),r}case mo.Ack:{let i=new ArrayBuffer(16),r=new DataView(i);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),Ab(r,8,BigInt(t.ackSendTs)),i}}}deserialize(t){let i=new DataView(t),r=i.getUint16(0),n=i.getUint8(2);switch(n){case mo.Default:{let o=i.getUint32(3),a=wb(i,7),l=t.slice(15),d=new TextDecoder().decode(l);return{version:r,type:n,packetNumber:o,sendTs:Number(a),payload:d}}case mo.Ack:{let o=i.getUint32(3),a=i.getUint8(7),l=wb(i,8);return{version:r,type:n,maxAckPacketNumber:o,shift:a,ackSendTs:Number(l)}}default:throw S.error("[".concat(this.ID,"] Unrecognized packet type ").concat(n)),new Error("Unrecognized packet type ".concat(n))}}sendMessage(t){let i=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let r=this.calculateRTO(i),n=window.setTimeout(()=>{this.resendMessage(i)},r);this.timeoutMap.set(i.packetNumber,n),this.sendPacket(i)}onData(t){let i=this.deserialize(t);i.type===mo.Default?this.ack(i):i.type===mo.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[i,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let i=this.calculateRTO(t),r=window.setTimeout(()=>{this.resendMessage(t)},i);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){let i=this.rtoRatioMap.get(t.packetNumber);if(i===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let r=9*this.rtt/8*i;return this.rtoRatioMap.set(t.packetNumber,i+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,i){let r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(i-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let i={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:mo.Ack,version:this.version};this.sendPacket(i)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let i={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:mo.Ack,version:this.version};this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:mo.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===mo.Default&&(t.sendTs=Math.round(performance.now()));let i=this.serialize(t);this.sendImpl(i)}clearRTO(t){for(let i=t.maxAckPacketNumber-t.shift;i<=t.maxAckPacketNumber;i++){let r=this.timeoutMap.get(i);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class SN extends Pz{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),y(this,"_initMutex",void 0),y(this,"_reconnectInterrupter",void 0),y(this,"_url",void 0),y(this,"_transmitter",void 0),y(this,"_addresses",void 0),y(this,"_reliableTransmission",void 0),this._initMutex=new vi("datachannel");let{timeout:r,timeoutFactor:n}=i,o=Math.max(300,Math.floor(3*r/5)),a=Math.max(1.2,Math.floor(8*n)/10);ir.ONLINE&&(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=a),Vt.on(rc.NETWORK_STATE_CHANGE,(l,d)=>{l!==d&&(this.resetReconnectCount("network state change: ".concat(d," -> ").concat(l)),l===ir.ONLINE?(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=a):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=n))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;let r=(n,o)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||N("FINGERPRINT"));let a=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(a).then(n).catch(o),this.once(ri.CLOSED,()=>o(new U(A.WS_DISCONNECT))),this.once(ri.CONNECTED,()=>n())};return this._initMutex.lock().then(n=>new ne((o,a)=>{r(o,a)}).then(()=>{n()}).catch(()=>{n()}))}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new U(A.WS_ABORT,"datachannel is not ready");try{i||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(r){throw new U(A.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let i=JSON.stringify(t);return{compressed:i,compressedLength:i.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ne((i,r)=>{var n;let o=()=>{S.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i()},a=async p=>{var m;if((m=this._closeEstablishingTransmitter)===null||m===void 0||m.call(this),S.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");let f=Ur(this,ri.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,E=await this.reconnectWithAction(f);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!E)return r(new U(A.WS_DISCONNECT,"datachannel reconnect failed: ".concat(p.code))),void this.close(!0);i()}else r(new U(A.WS_DISCONNECT,"datachannel close: ".concat(p.code))),this.close()},l=p=>{var m;(m=this._reliableTransmission)===null||m===void 0||m.onData(p.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),S.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let d=(n=this._store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),u=Date.now();ii(this,ri.TO_CONNECT_DATACHANNEL,t).then(p=>{var m,f;if(!p)throw new Error("transmissonInfo not exist yet");let{transmitter:E,close:I}=p;this._transmitter=E,(m=this._store)===null||m===void 0||m.signalChannelOpen();let T=Date.now()-u;S.debug("[choose dc] dc open cost ".concat(T,"ms")),this._reliableTransmission=new kz(R=>{var w;this._transmitter&&this._transmitter.readyState==="open"&&((w=this._transmitter)===null||w===void 0||w.send(R))},R=>{typeof R=="string"&&this.emit(ri.ON_MESSAGE,R)}),this._closeEstablishingTransmitter=()=>{var R;(R=this._reliableTransmission)===null||R===void 0||R.close(),this._reliableTransmission=void 0,I()},o&&o(),E.onclose=a,E.onmessage=l,(f=this._store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this._joinChannelServiceRecordIndex=d}).catch(p=>{var m;if((m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:p instanceof U&&p.code===A.WS_ABORT?"aborted":"error",errors:[p]},d),this.state!=="closed"){if(p instanceof U&&p.code===A.WS_ERR){let f=new U(A.WS_ERR,"init datachannel failed! Error: ".concat(p.toString()));return S.error("[".concat(this._name,"]").concat(f)),void r(f)}a&&a(p)}else r(new U(A.WS_DISCONNECT,"datachannel is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Vt.networkState!==ir.OFFLINE||(this._onlineReconnectListener=Vt.onlineWaiter&&Vt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},i){let l=Em(this._reconnectCount,this._retryConfig);S.debug("[".concat(this._name,"] wait ").concat(l,"ms to reconnect datachannel, mode: ").concat(t)),await ne.race([_i(l),this._onlineReconnectListener||new ne(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;let n=async(l,d)=>{this.emit(ri.RECONNECT_CREATE_CONNECTION,d),await this.createTransmitterConnection(l)};try{if(t==="retry"){let l=this._addresses[this.currentURLIndex];this.emit(ri.RECONNECT_WAITTING_FINISH,t),await n(l,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let d=this.currentURLIndex;d<this._addresses.length;d++){if(this._addresses[d].fingerprint||N("FINGERPRINT")){this.currentURLIndex=d;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return S.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);S.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let l=this._addresses[this.currentURLIndex];this.emit(ri.RECONNECT_WAITTING_FINISH,t),await n(l,t)}else t==="recover"&&(S.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(ri.RECONNECT_WAITTING_FINISH,t),this.emit(ri.FAILBACK));return!0}catch(l){var o,a;return S.error("[".concat(this._name,"] reconnect failed"),l.toString()),l!=null&&(o=l.data)!==null&&o!==void 0&&o.desc&&Array.isArray(l.data.desc)&&l.data.desc.length&&se(a=l.data.desc).call(a,"dynamic key expired")?(this.emit(ri.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,i)}}}class fs extends Ot{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(de.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",Ge.CLOSED),y(this,"reconnectToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new VS(5)),y(this,"pingpongTimer",void 0),y(this,"inflateDataTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,r);let n=JSON.parse(r);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let o="res-@".concat(n._id);this.emit(o,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")&&(this.emit(n._type,n._message),n._type===Ne.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===Ne.ON_USER_BANNED))switch(n._message.error_code){case 14:this.close(We.UID_BANNED);break;case 15:this.close(We.IP_BANNED);break;case 16:this.close(We.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new SN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",$s.OFFLINE)})}async request(t,i,r,n){let o=ft(6,""),a={_id:o,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new ne((I,T)=>{if(this.connectionState===Ge.CONNECTED)return I();let R=()=>{this.off(de.WS_CLOSED,w),I()},w=()=>{this.off(de.WS_CONNECTED,R),T(new U(A.WS_ABORT))};this.once(de.WS_CONNECTED,R),this.once(de.WS_CLOSED,w),t!==Se.PUBLISH&&t!==Se.SUBSCRIBE&&t!==Se.UNSUBSCRIBE&&t!==Se.UNPUBLISH&&t!==Se.CONTROL&&t!==Se.RESTART_ICE||this.once(de.DISCONNECT_P2P,()=>{T(new U(A.DISCONNECT_P2P))}),t!==Se.PUBLISH&&t!==Se.RESTART_ICE||this.once(de.ABORT_P2P_EXECUTION,()=>{T(new U(A.DISCONNECT_P2P))})});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===Se.JOIN||t===Se.REJOIN||await d(),t===Se.LEAVE&&(this.websocket.unbindDcCloseEventListener(),n=!0),this.websocket.sendMessage(a,!0,!1),n)return;let u=new ne((I,T)=>{let R=!1,w=(P,M)=>{R=!0,I({isSuccess:P==="success",message:M||{}}),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.emit(de.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(o),w);let O=()=>{T(new U(A.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.off("res-@".concat(o),w)};this.once(de.WS_CLOSED,O),this.once(de.WS_RECONNECTING,O),_i(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||R||(S.warning("dc request timeout, type: ".concat(t)),this.emit(de.REQUEST_TIMEOUT,t,i))})}),p=null;try{p=await u}catch(I){if(this.connectionState===Ge.CLOSED||t===Se.LEAVE)throw new U(A.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Se.JOIN||t===Se.REJOIN?null:(await d(),await this.request(t,i))}if(p.isSuccess)return p.message;let m=Number(p.message.error_code||p.message.code),f=dc(m),E=new U(A.UNEXPECTED_RESPONSE,"".concat(f.desc,": ").concat(p.message.error_str),{code:m,data:p.message});return f.action==="success"?p.message:(S.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(f.desc,", action: ").concat(f.action)),m===Ce.ERR_TOO_MANY_BROADCASTERS?((t===Se.JOIN||t===Se.REJOIN)&&(this.initError=E,this.close()),E.throw()):f.action==="failed"?E.throw():f.action==="quit"?(this.initError=E,this.close(),E.throw()):(m===Ce.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$s.MULTI_IP)):this.reconnect(f.action,$s.SERVER_ERROR),t===Se.JOIN||t===Se.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new ne(r=>{let n=o=>{(!i||i(o))&&(this.off(t,n),r(o))};this.on(t,n)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(lc.WRTC_STATS,i)}upload(t,i){let r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{let n=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let r={_type:t,_message:i};this.websocket.sendMessage(r)}init(t,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ne((r,n)=>{this.once(de.WS_CONNECTED,()=>r(this.joinResponse)),this.once(de.WS_CLOSED,()=>n(this.initError||new U(A.WS_ABORT))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(n),this.websocket.once(ri.FAILBACK,()=>{this.openConnectionTime===void 0&&n(new U(A.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{i&&this.openConnectionTime===void 0&&(S.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),n(new U(A.INIT_DATACHANNEL_TIMEOUT)))},N("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||We.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===We.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new SN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(de.ABORT_P2P_EXECUTION);let t=await ii(this,de.DATACHANNEL_CONNECTING),i=await this.request(Se.JOIN,t);if(!i)return this.emit(de.REPORT_JOIN_GATEWAY,A.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new U(A.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=nc(this,de.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(Se.REJOIN,t);return!!i&&(this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(r=>{this.emit(Ne.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ne.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ne.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ne.MUTE_AUDIO,{uid:r.uid}):this.emit(Ne.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ne.MUTE_VIDEO,{uid:r.uid}):this.emit(Ne.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ne.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ne.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ne.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let i=dc(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(We.UID_BANNED),void this.close()):void this.reconnect(i.action,$s.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=N("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$s.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-i;this.rttRolling.add(r),N("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){let{inflateLength:t,deflateLength:i}=this.websocket.getInflateData();t!==0&&i!==0&&this.upload(lc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ri.RECONNECT_WAITTING_FINISH,t=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(ri.RECONNECT_CREATE_CONNECTION,t=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ri.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ri.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(ri.FAILED,()=>{this._disconnectedReason=We.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(ri.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(ri.WILL_RECONNECT,(t,i)=>{if(nc(this,de.IS_P2P_DISCONNECTED)&&t==="retry")return S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),i("tryNext");t!=="retry"&&(S.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),i(t)}),this.websocket.on(ri.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",$s.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof U&&t.code===A.UNEXPECTED_RESPONSE&&t.data.code===Ce.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$s.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$s.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ri.REQUEST_NEW_URLS,(t,i)=>{ii(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(ri.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ri.TO_CONNECT_DATACHANNEL,async(t,i,r)=>ii(this,de.DATACHANNEL_PRECONNECT,t).then(i).catch(r)),this.websocket.on(ri.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(de.DATACHANNEL_FAILBACK)})}}class uc extends Ot{constructor(t,i){super(),y(this,"signal",void 0),y(this,"token",void 0),y(this,"tokenTimeout",void 0),y(this,"tokenInterval",void 0),y(this,"_sequence",0),y(this,"userMap",new Map),y(this,"encoder",new TextEncoder),this.signal=t,this.token=i;let r=()=>{this.signal.connectionState===Ge.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*N("P2P_TOKEN_INTERVAL"))};r()}async send(t,i,r,n,o){var a,l,d;if(this.userMap.size===0)return;let u=Array.from(ho(a=this.userMap).call(a))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),n=(l=n)!==null&&l!==void 0?l:ft(6,""),o=(d=o)!==null&&d!==void 0?d:this._sequence++;let p={_id:n,_type:t,_seq:o,_message:i,token:"".concat(this.token,"_").concat(u)};N("SHOW_P2P_LOG")&&S.debug("send message",p,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(p)).forEach(f=>{this.signal.request(Se.DATA_STREAM,{payload:Xs(this.encoder.encode(f))})});let m=new ne((f,E)=>{let I=window.setTimeout(()=>{this.off("res-@".concat(n,"_ack"),T),this.off("res-@".concat(n),w),this.off(Pl.ABORT,R),S.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(n)),this.userMap.size===0?E(new B(A.INVALID_REMOTE_USER)):E(new B(A.TIMEOUT))},N("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{I&&window.clearTimeout(I),this.off(Pl.ABORT,R),r&&f()},R=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(n,"_ack"),T),this.off("res-@".concat(n),w),E(new B(A.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(n)))};this.once(Pl.ABORT,R),this.once("res-@".concat(n,"_ack"),T);let w=(P,M)=>{O=!0,I&&window.clearTimeout(I),this.off("res-@".concat(n,"_ack"),T),this.off(Pl.ABORT,R),P==="success"?f(M):E(new B(A.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(n)))},O=!1;r||(this.once("res-@".concat(n),w),_i(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||S.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(n,", ").concat(p))}))});try{return await m}catch(f){if(f.code===A.TIMEOUT)return await this.send(t,i,r,n,o);throw f}}onMessage(t){var i;let{_uid:r}=t,n,o=this.userMap.get(r);if(o)n=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Kt.CHECK)return;let{token:u}=t;n=new Map,o={uid:r,isStart:!0,token:u,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,o),this.signal.emit(Ne.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var a;let{id:u,total:p}=t,m=(a=n.get(u))!==null&&a!==void 0?a:[];if(m.push(t),n.has(u)||n.set(u,m),m.length!==p)return;{let f=ru(m).call(m,(E,I)=>E.index-I.index).map(E=>E.payload).join("");n.delete(u),(t=JSON.parse(f))._uid=r}}let{_type:l,token:d}=t;if(se(i=[Kt.ACK,Kt.CHECK]).call(i,l))return l===Kt.CHECK&&this.handleCheckToken(o,d),void this.receiveMessage(t);d==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):S.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){let t={_id:ft(6,""),token:this.token,_type:Kt.CHECK};N("SHOW_P2P_LOG")&&S.debug("send message",t),this.signal.request(Se.DATA_STREAM,{payload:Xs(this.encoder.encode(JSON.stringify(t)))})}ack(t){let i={_id:t,_type:Kt.ACK,token:this.token};N("SHOW_P2P_LOG")&&S.debug("send message",i),this.signal.request(Se.DATA_STREAM,{payload:Xs(this.encoder.encode(JSON.stringify(i)))})}response(t,i,r){this.send(Kt.RESPONSE,JSON.stringify({success:!r,message:i}),!0,t)}handleReceivedMessage(t){let i=()=>{this.userMap.forEach(u=>{let{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=u;for(;p.has(m);){let f=p.get(m);p.delete(m),this.receiveMessage(f),u.nextExpectedSequenceNumber++}})};if(!t)return void i();let{_uid:r,_seq:n}=t,o=this.userMap.get(r),{receivedMessagesMap:a,isStart:l,nextExpectedSequenceNumber:d}=o;if(n<d)return this.ack(t._id),void S.debug("[external-signal] receive old message, seq: ".concat(n,", ").concat(t._message));a.set(n,t),l&&n===d&&(this.receiveMessage(t),a.delete(d),o.nextExpectedSequenceNumber++,i())}receiveMessage(t){let{_id:i,_type:r,_message:n,_uid:o}=t;if(N("SHOW_P2P_LOG")&&S.debug("receive message",t),i){let a;switch(t._type!==Kt.ACK&&(n&&(a=JSON.parse(n)),this.ack(t._id)),t._type){case Kt.CANDIDATE:case Kt.CONTROL:this.signal.emit(r,a,o);break;case Kt.PUBLISH:case Kt.UNPUBLISH:case Kt.RESTART_ICE:case Kt.CALL:a.uid=o,ii(this.signal,r,a).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Kt.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Kt.RESPONSE:{let{success:l,message:d}=a;this.emit("res-@".concat(i),l?"success":"failed",d);break}}}}splitMessage(t){if(t.length<uc.MAX_MESSAGE_SIZE)return[t];let i=[],{remoteToken:r}=JSON.parse(t),n=ft(6,""),o=0,a=800,l=Math.ceil(t.length/a);for(;t.length>0;){o++;let d={id:n,index:o,total:l,payload:t.slice(0,a),token:"".concat(this.token,"_").concat(r)};JSON.stringify(d).length>uc.MAX_MESSAGE_SIZE?a-=50:(i.push(d),t=t.slice(a))}return i.map(d=>JSON.stringify(d))}handleCheckToken(t,i){return t.token!==i?(S.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(i)),this.reset(t.uid)},N("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await ii(this.signal,Kt.CALL,void 0),i=await this.send(Kt.CALL,t);this.signal.emit(de.P2P_CONNECTION,i,!0)}async reset(t,i){let r=this.userMap.get(t);r&&(this.emit(Pl.ABORT),this.signal.emit(Ne.ON_USER_OFFLINE,{uid:r.uid,reason:Cz.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(S.debug("change local token from ".concat(i," to ").concat(i)),this.token=ft(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Pl.ABORT)}}y(uc,"MAX_SIZE",1),y(uc,"MAX_MESSAGE_SIZE",1024);class TN extends Ot{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(de.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",Ge.CLOSED),y(this,"reconnectToken",void 0),y(this,"p2pToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new VS(5)),y(this,"pingpongTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"_external_signal",void 0),y(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,r.data);let n=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n,"_id")){let o="res-@".concat(n._id);this.emit(o,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")){switch(n._type){case Ne.ON_DATA_STREAM:return void this.handleDataStream(n._message);case Ne.MUTE_AUDIO:case Ne.MUTE_VIDEO:case Ne.ON_P2P_LOST:case Ne.ON_USER_ONLINE:return;case Ne.ON_USER_OFFLINE:let{uid:o}=n._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(n._type,n._message),n._type===Ne.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===Ne.ON_USER_BANNED)switch(n._message.error_code){case 14:this.close(We.UID_BANNED);break;case 15:this.close(We.IP_BANNED);break;case 16:this.close(We.CHANNEL_BANNED)}if(n._type===Ne.ON_USER_LICENSE_BANNED)switch(n._message.error_code){case Ce.ERR_LICENSE_MISSING:this.close(We.LICENSE_MISSING);break;case Ce.ERR_LICENSE_EXPIRED:this.close(We.LICENSE_EXPIRED);break;case Ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(We.LICENSE_MINUTES_EXCEEDED);break;case Ce.ERR_LICENSE_PERIOD_INVALID:this.close(We.LICENSE_PERIOD_INVALID);break;case Ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(We.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ce.ERR_LICENSE_ILLEGAL:this.close(We.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new Iu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",ki.OFFLINE)}),this.p2pToken=ft(6,""),this._external_signal=new uc(this,this.p2pToken)}async request(t,i,r,n){let o=ft(6,""),a={_id:o,_type:t,_message:i},l=this.websocket.connectionID,d=()=>new ne((I,T)=>{if(this.connectionState===Ge.CONNECTED)return I();let R=()=>{this.off(de.WS_CLOSED,w),I()},w=()=>{this.off(de.WS_CONNECTED,R),T(new B(A.WS_ABORT))};this.once(de.WS_CONNECTED,R),this.once(de.WS_CLOSED,w)});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===Se.JOIN||t===Se.REJOIN||await d(),this.websocket.sendMessage(a,!0),n)return;let u=new ne((I,T)=>{let R=!1,w=(P,M)=>{R=!0,I({isSuccess:P==="success",message:M||{}}),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.emit(de.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(o),w);let O=()=>{T(new B(A.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,O),this.off(de.WS_RECONNECTING,O),this.off("res-@".concat(o),w)};this.once(de.WS_CLOSED,O),this.once(de.WS_RECONNECTING,O),_i(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||R||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(de.REQUEST_TIMEOUT,t,i))})}),p=null;try{p=await u}catch(I){if(this.connectionState===Ge.CLOSED||t===Se.LEAVE)throw new B(A.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?I.throw():t===Se.JOIN||t===Se.REJOIN?null:(await d(),await this.request(t,i))}if(p.isSuccess)return p.message;let m=Number(p.message.error_code||p.message.code),f=dc(m),E=new B(A.UNEXPECTED_RESPONSE,"".concat(f.desc,": ").concat(p.message.error_str),{code:m,data:p.message});return f.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(f.desc,", action: ").concat(f.action)),m===Ce.ERR_TOO_MANY_BROADCASTERS?((t===Se.JOIN||t===Se.REJOIN)&&(this.initError=E,this.close()),E.throw()):f.action==="failed"?E.throw():f.action==="quit"?(this.initError=E,this.close(),E.throw()):(m===Ce.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ki.MULTI_IP)):this.reconnect(f.action,ki.SERVER_ERROR),t===Se.JOIN||t===Se.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new ne(r=>{let n=o=>{(!i||i(o))&&(this.off(t,n),r(o))};this.on(t,n)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(lc.WRTC_STATS,i)}upload(t,i){let r={_type:t,_message:i};try{this.websocket.sendMessage(r)}catch{let n=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>n&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let r={_type:t,_message:i};this.websocket.sendMessage(r)}async sendExtensionMessage(t,i,r){return await this._external_signal.send(t,i,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ne((i,r)=>{this.once(de.WS_CONNECTED,()=>i(this.joinResponse)),this.once(de.WS_CLOSED,()=>r(this.initError||new B(A.WS_ABORT))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||We.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===We.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Iu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=ft(6,""),this._external_signal.clear(),this._external_signal=new uc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(de.ABORT_P2P_EXECUTION);let t=await ii(this,de.REQUEST_JOIN_INFO),i=await this.request(Se.JOIN,t);if(!i)return this.emit(de.REPORT_JOIN_GATEWAY,A.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleDataStream(t){try{var i;let r=sc(t.payload),n=new TextDecoder().decode(r),o=JSON.parse(n);"total"in o&&"id"in o||se(i=Object.values(Kt)).call(i,o._type)?(o._uid=t.uid,this._external_signal.onMessage(o)):this.emit(Ne.ON_DATA_STREAM,t)}catch{this.emit(Ne.ON_DATA_STREAM,t)}}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let i=dc(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(We.UID_BANNED),void this.close()):void this.reconnect(i.action,ki.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=N("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ki.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-i;this.rttRolling.add(r),N("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Oe.RECONNECT_WAITTING_FINISH,t=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Oe.RECONNECT_CREATE_CONNECTION,t=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Oe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Oe.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(Oe.FAILED,()=>{this._disconnectedReason=We.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(Oe.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(Oe.WILL_RECONNECT,(t,i,r)=>{t!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION)):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Oe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof B&&t.code===A.UNEXPECTED_RESPONSE&&t.data.code===Ce.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ki.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ki.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Oe.REQUEST_NEW_URLS,(t,i)=>{ii(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function vN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Fn(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vN(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let rT=new Map;class Lz extends Ot{get state(){return this._state}set state(t){if(t===this._state)return;let i=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ht.CONNECTION_STATE_CHANGE,t,i,this._disconnectedReason):this.emit(Ht.CONNECTION_STATE_CHANGE,t,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,i){super(),y(this,"store",void 0),y(this,"joinInfo",void 0),y(this,"key",void 0),y(this,"ntpOffset",0),y(this,"signal",void 0),y(this,"role",void 0),y(this,"inChannelInfo",{joinAt:null,duration:0}),y(this,"spec",void 0),y(this,"_state","DISCONNECTED"),y(this,"_statsCollector",void 0),y(this,"_disconnectedReason",void 0),y(this,"isSignalRecover",!1),y(this,"hasChangeBGPAddress",!1),y(this,"trafficStatsInterval",void 0),y(this,"networkQualityInterval",void 0),y(this,"_joinGatewayStartTime",0),y(this,"_signalTimeout",!1),y(this,"_clientRoleOptions",void 0),y(this,"_isProactiveJoin",!1),this.store=t,this.spec=i,this.signal=this.store.useP2P?new TN(Fn(Fn({},i),{},{retryConfig:i.websocketRetryConfig}),t):this.store.useDataChannel?new fs(Fn(Fn({},i),{},{retryConfig:i.websocketRetryConfig}),t):new pN(Fn(Fn({},i),{},{retryConfig:i.websocketRetryConfig}),t),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(t,i,r){if(this.signal instanceof fs){let d=!1;t.cloudProxyServer!=="disabled"?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),d=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),d=!0):t.apResponse.addresses.some(u=>u.fingerprint)||N("FINGERPRINT")||(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),d=!0),d&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let n=Date.now(),o=rT.get(t.cname);if(o||(o=new Map,rT.set(t.cname,o)),this._isProactiveJoin=!0,o.has(t.uid)){let d=new U(A.UID_CONFLICT);throw _e.joinGateway(t.sid,{lts:n,succ:!1,ec:d.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof fs?"1":"0"}),this._isProactiveJoin=!1,d}o.set(t.uid,!0),this.joinInfo=t,this.key=i;let a=0;this.joinGatewayStartTime=n;let l=t.proxyServer;try{let d;if(S.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof fs?"datachannel":"websocket"," join uid ").concat(a)),this.signal instanceof fs)d=await this.signal.init(t.apResponse.addresses,r);else{let u=t.gatewayAddrs.map(p=>{let{address:m}=p,[f,E]=m.split(":"),I={host:f,port:E};return t.proxyServer&&(I.proxy=t.proxyServer),I});d=await this.signal.init(u,r)}a=d.uid,S.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof fs?"datachannel":"websocket"," join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(d){throw d&&d.code===A.INIT_WEBSOCKET_TIMEOUT?(S.warning("[".concat(this.store.clientId,"] User join failed"),d.toString()),d):d&&d.code===A.INIT_DATACHANNEL_TIMEOUT?(S.warning("[".concat(this.store.clientId,"] User join datachannel failed"),d.toString()),this.resetSignal(),d):(S.error("[".concat(this.store.clientId,"] User join failed"),d.toString()),_e.joinGateway(t.sid,{lts:n,succ:!1,ec:d.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof fs?"1":"0"}),this._isProactiveJoin=!1,o.delete(t.uid),this.signal.close(),d)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(d=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),d.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ht.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ht.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ht.NETWORK_QUALITY,{uplinkNetworkQuality:fN(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:fN(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ht.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),a}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==We.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ge.CONNECTED||await function(r,n){return n===1/0?r:ne.race([r,v8(n)])}(this.signal.request(Se.LEAVE,void 0,!0),3e3)}catch(r){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(i),i!==We.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:N("PUB_EXTEND"),twcc:!!N("PUBLISH_TWCC"),rtx:!!N("USE_PUB_RTX")};try{return(await this.signal.request(Se.PUBLISH,n,!0))._message}catch(o){if(r&&o.data&&o.data.code===Ce.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(t,i),this.publish(t,i,!1);throw o}}async publishDataChannel(t,i,r){var n;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let o={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(n=i.maxRetransmits)!==null&&n!==void 0?n:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Se.PUBLISH_DATASTREAM,o,!0)}catch(a){if(r&&a.data&&a.data.code===Ce.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),await this.tryUnpubDataChannelBeforeRepub(t,i),this.publishDataChannel(t,i,!1);throw a}}async unpublish(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Se.UNPUBLISH,{stream_id:i,ortc:t},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ne.all(t.map(i=>this.signal.request(Se.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){S.warning("unpublish datachannels warning: ",i)}}async presubscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let n={stream_id:t,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX")||void 0,extend:N("SUB_EXTEND"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(Se.PRE_SUBSCRIBE,n,!0)}catch(o){if(r&&o.data&&o.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(t,i,!1);throw o}}async subscribe(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let n={stream_id:t,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX"),extend:N("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return(await this.signal.request(Se.SUBSCRIBE,n,!0))._message}catch(o){if(r&&o.data&&o.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(t,i),await this.subscribe(t,i,!1);throw o}}async subscribeDataChannel(t,i,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let n={uid:t,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Se.SUBSCRIBE_DATASTREAM,n,!0)}catch(o){if(r&&o.data&&o.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(t,i),await this.subscribeDataChannel(t,i,!1);throw o}}async subscribeAll(t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!N("USE_SUB_RTX"),twcc:!!N("SUBSCRIBE_TWCC"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(Se.SUBSCRIBE_STREAMS,r,!0)}catch(n){if(i&&n.data&&n.data.code===Ce.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw n}}async setVideoProfile(t){let i=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let n=r.frameRate,o=r.width,a=r.height,l=!0;return typeof n!="number"&&(n=n.exact||n.ideal||n.max||n.min||0,n||(l=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,n||(l=!1)),l?{stream_type:0,width:o,height:a,fps:n,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(i)return this.signal.request(Se.SET_VIDEO_PROFILE,i);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,i){try{await this.signal.request(Se.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:i},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ne.all(t.map(r=>this.signal.request(Se.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:i},!0)))}catch(r){S.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Se.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(t){let{iceParameters:i,dtlsParameters:r,rtpCapabilities:n}=t;return{gatewayEstablishParams:await this.signal.request(Se.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:n}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Se.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Se.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),this.state!=="CONNECTED")return void(this.role=t);let r,n=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,n=1):n=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:n=0,await this.signal.request(Se.SET_CLIENT_ROLE,{role:t,level:n,delay:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,i){await this.signal.request(Se.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:i})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Se.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,i){await this.signal.request(Se.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:i})}async pickSVCLayer(t,i){await this.signal.request(Se.PICK_SVC_LAYER,{stream_id:t,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Se.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,i,r){if(this.signal instanceof TN)return this.signal.sendExtensionMessage(t,i,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Fn({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Se.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=rT.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(i){let r;return r=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Li.username,password:Li.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Fn(Fn({},Li),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(Se.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(i=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(n=>n.peer_uid===i.peer_uid);r&&r.B_st!==i.B_st&&mm(()=>{this.emit(Ht.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new U(A.UNEXPECTED_ERROR,"can not generate join message, no join info");let i=Object.assign({},this.joinInfo.apResponse),r=N("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);let n=Fn({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:mn,browser:navigator.userAgent,process_id:N("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:N("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:N("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:N("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof N("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?N("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof N("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?N("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof N("ENABLE_USER_LICENSE_CHECK")=="boolean"?N("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:N("USE_PUB_RTX")===!0||N("USE_SUB_RTX")===!0||void 0,disableFEC:N("DISABLE_FEC"),enableNTPReport:!!N("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!N("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof N("ENABLE_DATASTREAM_2")=="boolean"?N("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!N("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof N("USE_XR")=="boolean"?N("USE_XR"):void 0,enableLossbasedBwe:typeof N("ENABLE_LOSSBASED_BWE")=="boolean"?N("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof N("ENABLE_AUT_CC")=="boolean"?N("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof N("ENABLE_CC_FALLBACK")=="boolean"?N("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(n.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(n.aes_mode=this.joinInfo.aesmode,N("ENCRYPT_AES")?(n.aes_secret=this.joinInfo.aespassword,n.aes_encrypt=!0):n.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(n.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(n.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(n.default_video_stream=this.joinInfo.defaultVideoStream),n}getRejoinMessage(){if(!this.joinInfo)throw new U(A.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(de.WS_RECONNECT_WAITTING_FINISH,t=>{var i;se(i=["tryNext","recover"]).call(i,t)&&this.joinInfo&&_e.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(de.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(de.WS_RECONNECTING,t=>{this.joinInfo&&_e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ki.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",_e.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(de.WS_CLOSED,t=>{let i;switch(t){case We.LEAVE:i=ki.LEAVE;break;case We.UID_BANNED:case We.IP_BANNED:case We.CHANNEL_BANNED:case We.SERVER_ERROR:i=ki.SERVER_ERROR;break;case We.FALLBACK:i=ki.FALLBACK;break;case We.LICENSE_MISSING:case We.LICENSE_EXPIRED:case We.LICENSE_MINUTES_EXCEEDED:case We.LICENSE_PERIOD_INVALID:case We.LICENSE_MULTIPLE_SDK_SERVICE:case We.LICENSE_ILLEGAL:case We.TOKEN_EXPIRE:i=t;break;default:i=ki.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+ki.NETWORK_ERROR)),this.joinInfo&&_e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===We.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=t,t!==We.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),_e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof fs?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));pt("EVENT_REPORT_DOMAIN",t[1]),pt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),pt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Ne.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(de.REQUEST_RECOVER,(t,i,r)=>{if(!this.joinInfo)return r(new U(A.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ii(this,Ht.REQUEST_NEW_GATEWAY_LIST).then(i).catch(r)}),this.signal.on(de.REQUEST_JOIN_INFO,async t=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let{iceParameters:r,dtlsParameters:n,rtpCapabilities:o}=await ii(this,Ht.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(i=this.joinInfo)===null||i===void 0?void 0:i.turnServer});t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:n,rtpCapabilities:o,version:"2"}}))}),this.signal.on(de.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(t,i)=>{this.joinInfo&&(_e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof fs?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,t=>{t(nc(this,Ht.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(Ht.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,t=>{this.emit(Ht.NEED_RENEW_SESSION,t)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,t=>{let i=this.getCurrentGatewayAddress();this.emit(Ht.JOIN_RESPONSE,t,i)}),this.signal.on(de.DATACHANNEL_PRECONNECT,async(t,i,r)=>{this.updateTurnConfigFromSignal();let n=this.getCurrentGatewayAddress();return ii(this,Ht.DATACHANNEL_PRECONNECT,t,n).then(i).catch(r)}),this.signal.on(de.DATACHANNEL_CONNECTING,async t=>{let{iceParameters:i,dtlsParameters:r,rtpCapabilities:n}=await ii(this,Ht.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:n,version:"2"}}))}),this.signal.on(de.DATACHANNEL_FAILBACK,()=>{S.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Ht.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,i){try{await this.signal.request(Se.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[i]},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,i){try{await this.signal.request(Se.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(r){throw S.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,i){try{await this.signal.request(Se.UNPUBLISH,{stream_id:t,ortc:i},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,i){try{await this.signal.request(Se.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(r){throw S.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){let i={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Se.UNSUBSCRIBE_STREAMS,i,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,i){let r={action:t.find(n=>n.stream_type===st.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Se.CONTROL,r,!0,!0)}catch(n){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),n),n}}async unmuteLocal(t,i){let r={action:t.find(n=>n.stream_type===st.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Se.CONTROL,r,!0,!0)}catch(n){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),n),n}}async muteRemote(t,i){let r={action:t===me.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Se.CONTROL,r,!0,!0)}catch(n){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),n),n}}async unmuteRemote(t,i){let r={action:t===me.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Se.CONTROL,r,!0,!0)}catch(n){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),n),n}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,i){this.signal.upload(t,i)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Se.RESTART_ICE,i,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,ki.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!N("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Se.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(We.FALLBACK)),this.store.useDataChannel=!1,this.signal=new pN(Fn(Fn({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Ht.RESET_SIGNAL,oN.websocket)}}let Om=0,nT=0;function _o(e,t,i,r){return new ne((n,o)=>{t.timeout=t.timeout||N("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),Om+=Bo(t.data)):i&&(t.data.size?Om+=t.data.size:t.data instanceof FormData?Om+=xb(t.data):Om+=Bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,hr.request(t).then(a=>{typeof a.data=="string"?nT+=Bo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?nT+=a.data.byteLength:nT+=Bo(JSON.stringify(a.data)),r&&n({data:a.data,headers:a.headers}),n(a.data)}).catch(a=>{hr.isCancel(a)?o(new U(A.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?o(new U(A.NETWORK_TIMEOUT,a.message)):a.response?o(new U(A.NETWORK_RESPONSE_ERROR,a.response.status)):o(new U(A.NETWORK_ERROR,a.message))})})}(function(){var e;function t(z){var re=0;return function(){return re<z.length?{done:!1,value:z[re++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(z,re,he){return z==Array.prototype||z==Object.prototype||(z[re]=he.value),z},r,n=function(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var re=0;re<z.length;++re){var he=z[re];if(he&&he.Math==Math)return he}throw Error("Cannot find global object")}(this);function o(z,re){if(re)e:{var he=n;z=z.split(".");for(var ke=0;ke<z.length-1;ke++){var it=z[ke];if(!(it in he))break e;he=he[it]}(re=re(ke=he[z=z[z.length-1]]))!=ke&&re!=null&&i(he,z,{configurable:!0,writable:!0,value:re})}}function a(z){return(z={next:z})[Symbol.iterator]=function(){return this},z}function l(z){var re=typeof Symbol<"u"&&Symbol.iterator&&z[Symbol.iterator];return re?re.call(z):{next:t(z)}}if(o("Symbol",function(z){function re(it,oe){this.A=it,i(this,"description",{configurable:!0,writable:!0,value:oe})}if(z)return z;re.prototype.toString=function(){return this.A};var he="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function it(oe){if(this instanceof it)throw new TypeError("Symbol is not a constructor");return new re(he+(oe||"")+"_"+ke++,oe)}}),o("Symbol.iterator",function(z){if(z)return z;z=Symbol("Symbol.iterator");for(var re="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),he=0;he<re.length;he++){var ke=n[re[he]];typeof ke=="function"&&typeof ke.prototype[z]!="function"&&i(ke.prototype,z,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return z}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var d;e:{var u={};try{u.__proto__={a:!0},d=u.a;break e}catch{}d=!1}r=d?function(z,re){if(z.__proto__=re,z.__proto__!==re)throw new TypeError(z+" is not extensible");return z}:null}var p=r;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function f(z){if(z.m)throw new TypeError("Generator is already running");z.m=!0}function E(z,re){return z.h=3,{value:re}}function I(z){this.g=new m,this.G=z}function T(z,re,he,ke){try{var it=re.call(z.g.j,he);if(!(it instanceof Object))throw new TypeError("Iterator result "+it+" is not an object");if(!it.done)return z.g.m=!1,it;var oe=it.value}catch(C){return z.g.j=null,z.g.s(C),R(z)}return z.g.j=null,ke.call(z.g,oe),R(z)}function R(z){for(;z.g.h;)try{var re=z.G(z.g);if(re)return z.g.m=!1,{value:re.value,done:!1}}catch(he){z.g.v=void 0,z.g.s(he)}if(z.g.m=!1,z.g.l){if(re=z.g.l,z.g.l=null,re.F)throw re.D;return{value:re.return,done:!0}}return{value:void 0,done:!0}}function w(z){this.next=function(re){return z.o(re)},this.throw=function(re){return z.s(re)},this.return=function(re){return function(he,ke){f(he.g);var it=he.g.j;return it?T(he,"return"in it?it.return:function(oe){return{value:oe,done:!0}},ke,he.g.return):(he.g.return(ke),R(he))}(z,re)},this[Symbol.iterator]=function(){return this}}function O(z,re){return re=new w(new I(re)),p&&z.prototype&&p(re,z.prototype),re}if(m.prototype.o=function(z){this.v=z},m.prototype.s=function(z){this.l={D:z,F:!0},this.h=this.C||this.u},m.prototype.return=function(z){this.l={return:z},this.h=this.u},I.prototype.o=function(z){return f(this.g),this.g.j?T(this,this.g.j.next,z,this.g.o):(this.g.o(z),R(this))},I.prototype.s=function(z){return f(this.g),this.g.j?T(this,this.g.j.throw,z,this.g.o):(this.g.s(z),R(this))},o("Array.prototype.entries",function(z){return z||function(){return function(re,he){re instanceof String&&(re+="");var ke=0,it=!1,oe={next:function(){if(!it&&ke<re.length){var C=ke++;return{value:he(C,re[C]),done:!1}}return it=!0,{done:!0,value:void 0}}};return oe[Symbol.iterator]=function(){return oe},oe}(this,function(re,he){return[re,he]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var P=function(z,re){for(var he=0;he<z.length;he++)re(z[he])},M=function(z){return z.replace(/\r?\n|\r/g,`\r
`)},V=function(z,re,he){return re instanceof Blob?(he=he!==void 0?he+"":typeof re.name=="string"?re.name:"blob",re.name===he&&Object.prototype.toString.call(re)!=="[object Blob]"||(re=new File([re],he)),[String(z),re]):[String(z),String(re)]},F=function(z,re){if(z.length<re)throw new TypeError(re+" argument required, but only "+z.length+" present.")},q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,J=q.FormData,Z=q.XMLHttpRequest&&q.XMLHttpRequest.prototype.send,pe=q.Request&&q.fetch,ze=q.navigator&&q.navigator.sendBeacon,nt=q.Element&&q.Element.prototype,Ct=q.Symbol&&Symbol.toStringTag;Ct&&(Blob.prototype[Ct]||(Blob.prototype[Ct]="Blob"),"File"in q&&!File.prototype[Ct]&&(File.prototype[Ct]="File"));try{new File([],"")}catch{q.File=function(z,re,he){return z=new Blob(z,he||{}),Object.defineProperties(z,{name:{value:re},lastModified:{value:+(he&&he.lastModified!==void 0?new Date(he.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ct&&Object.defineProperty(z,Ct,{value:"File"}),z}}var $t=function(z){return z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Mt=function(z){this.i=[];var re=this;z&&P(z.elements,function(he){if(he.name&&!he.disabled&&he.type!=="submit"&&he.type!=="button"&&!he.matches("form fieldset[disabled] *"))if(he.type==="file"){var ke=he.files&&he.files.length?he.files:[new File([],"",{type:"application/octet-stream"})];P(ke,function(it){re.append(he.name,it)})}else he.type==="select-multiple"||he.type==="select-one"?P(he.options,function(it){!it.disabled&&it.selected&&re.append(he.name,it.value)}):he.type==="checkbox"||he.type==="radio"?he.checked&&re.append(he.name,he.value):(ke=he.type==="textarea"?M(he.value):he.value,re.append(he.name,ke))})};if((e=Mt.prototype).append=function(z,re,he){F(arguments,2),this.i.push(V(z,re,he))},e.delete=function(z){F(arguments,1);var re=[];z=String(z),P(this.i,function(he){he[0]!==z&&re.push(he)}),this.i=re},e.entries=function z(){var re,he=this;return O(z,function(ke){if(ke.h==1&&(re=0),ke.h!=3)return re<he.i.length?ke=E(ke,he.i[re]):(ke.h=0,ke=void 0),ke;re++,ke.h=2})},e.forEach=function(z,re){F(arguments,1);for(var he=l(this),ke=he.next();!ke.done;ke=he.next()){var it=l(ke.value);ke=it.next().value,it=it.next().value,z.call(re,it,ke,this)}},e.get=function(z){F(arguments,1);var re=this.i;z=String(z);for(var he=0;he<re.length;he++)if(re[he][0]===z)return re[he][1];return null},e.getAll=function(z){F(arguments,1);var re=[];return z=String(z),P(this.i,function(he){he[0]===z&&re.push(he[1])}),re},e.has=function(z){F(arguments,1),z=String(z);for(var re=0;re<this.i.length;re++)if(this.i[re][0]===z)return!0;return!1},e.keys=function z(){var re,he,ke,it,oe=this;return O(z,function(C){if(C.h==1&&(re=l(oe),he=re.next()),C.h!=3)return he.done?void(C.h=0):(ke=he.value,it=l(ke),E(C,it.next().value));he=re.next(),C.h=2})},e.set=function(z,re,he){F(arguments,2),z=String(z);var ke=[],it=V(z,re,he),oe=!0;P(this.i,function(C){C[0]===z?oe&&(oe=!ke.push(it)):ke.push(C)}),oe&&ke.push(it),this.i=ke},e.values=function z(){var re,he,ke,it,oe=this;return O(z,function(C){if(C.h==1&&(re=l(oe),he=re.next()),C.h!=3)return he.done?void(C.h=0):(ke=he.value,(it=l(ke)).next(),E(C,it.next().value));he=re.next(),C.h=2})},Mt.prototype._asNative=function(){for(var z=new J,re=l(this),he=re.next();!he.done;he=re.next()){var ke=l(he.value);he=ke.next().value,ke=ke.next().value,z.append(he,ke)}return z},Mt.prototype._blob=function(){var z="----formdata-polyfill-"+Math.random(),re=[],he="--"+z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ke,it){return typeof ke=="string"?re.push(he+$t(M(it))+`"\r
\r
`+M(ke)+`\r
`):re.push(he+$t(M(it))+'"; filename="'+$t(ke.name)+`"\r
Content-Type: `+(ke.type||"application/octet-stream")+`\r
\r
`,ke,`\r
`)}),re.push("--"+z+"--"),new Blob(re,{type:"multipart/form-data; boundary="+z})},Mt.prototype[Symbol.iterator]=function(){return this.entries()},Mt.prototype.toString=function(){return"[object FormData]"},nt&&!nt.matches&&(nt.matches=nt.matchesSelector||nt.mozMatchesSelector||nt.msMatchesSelector||nt.oMatchesSelector||nt.webkitMatchesSelector||function(z){for(var re=(z=(this.document||this.ownerDocument).querySelectorAll(z)).length;0<=--re&&z.item(re)!==this;);return-1<re}),Ct&&(Mt.prototype[Ct]="FormData"),Z){var $n=q.XMLHttpRequest.prototype.setRequestHeader;q.XMLHttpRequest.prototype.setRequestHeader=function(z,re){$n.call(this,z,re),z.toLowerCase()==="content-type"&&(this.B=!0)},q.XMLHttpRequest.prototype.send=function(z){z instanceof Mt?(z=z._blob(),this.B||this.setRequestHeader("Content-Type",z.type),Z.call(this,z)):Z.call(this,z)}}pe&&(q.fetch=function(z,re){return re&&re.body&&re.body instanceof Mt&&(re.body=re.body._blob()),pe.call(this,z,re)}),ze&&(q.navigator.sendBeacon=function(z,re){return re instanceof Mt&&(re=re._asNative()),ze.call(this,z,re)}),q.FormData=Mt}})();let Ou=()=>{let e=N("AREAS");return e.length===0&&e.push(tt.GLOBAL),ao(e).call(e,(t,i,r)=>{let n=RN(i);return n?r===0?n:"".concat(t,",").concat(n):t},"")},RN=e=>e===tt.OVERSEA?"".concat(Bi.ASIA,",").concat(Bi.EUROPE,",").concat(Bi.AFRICA,",").concat(Bi.NORTH_AMERICA,",").concat(Bi.SOUTH_AMERICA,",").concat(Bi.OCEANIA):Bi[e],Mz=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let r=Im[i],n=Object.keys(r);n&&n.map(o=>{o!=="CODE"&&(t[o]=t[o].concat(r[o]))})}),t},bm={GLOBAL:{ASIA:[tt.CHINA,tt.JAPAN,tt.INDIA,tt.KOREA,tt.HKMC],EUROPE:[],NORTH_AMERICA:[tt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Nm=Object.keys(bm[tt.GLOBAL]),oT=[tt.CHINA,tt.NORTH_AMERICA,tt.EUROPE,tt.ASIA,tt.JAPAN,tt.INDIA,tt.OCEANIA,tt.SOUTH_AMERICA,tt.AFRICA,tt.KOREA,tt.HKMC,tt.US],Uz=function(e,t){let i=[];if(se(e).call(e,tt.GLOBAL)){let o=[tt.GLOBAL,tt.OVERSEA],a=Object.keys(Im);if(t===tt.GLOBAL)throw new U(A.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===tt.CHINA)i=[tt.OVERSEA];else if(n=t,se(Nm).call(Nm,n)){let l=(r=t,bm[tt.GLOBAL][r]||[]),d=[...o,t,...l];i=a.filter(u=>!se(d).call(d,u))}else if(function(l){let d=!1;return Nm.forEach(u=>{var p;se(p=bm[tt.GLOBAL][u]).call(p,l)&&(d=!0)}),d}(t)){let l=function(u){let p;return Nm.forEach(m=>{var f;se(f=bm[tt.GLOBAL][m]).call(f,u)&&(p=m)}),p}(t),d=[...o,l,t];i=a.filter(u=>!se(d).call(d,u))}else i=e;i=function(l){let d=[];return oT.forEach(u=>{se(l).call(l,u)&&d.push(u)}),d.concat(l.filter(u=>!se(oT).call(oT,u)))}(i)}else i=e;var r,n;return i};function CN(e){var t,i;if(!e&&se(t=N("AREAS")).call(t,tt.EXTENSIONS))return S.debug("update area from ap : reset"),void sT(N8,!0);if(!se(i=N("AREAS")).call(i,tt.GLOBAL)||!e)return;let r=Im.EXTENSIONS;r&&(r={CODE:RN(tt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},S.debug("update area from ap success: ".concat(e,",config is "),r),pt("AREAS",[tt.EXTENSIONS],!0),Object.keys(r).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?pt(n,r[n][0]):pt(n,r[n])}))}function sT(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=_e.reportApiInvoke(null,{name:ti.SET_AREA,options:e,tag:xt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!se(sN).call(sN,o))throw new U(A.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:o,excludedArea:a}=e;if(!o)throw new U(A.INVALID_PARAMS,"area code is needed");let l=o;typeof o=="string"&&(l=[o]),r=a?Uz(l,a):l}if(!t){if(Qs.AREAS){let o=new U(A.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(o),void S.warning("setArea is prohibited because of config-distribute")}if(se(r).call(r,tt.GLOBAL)&&N("AREAS")===tt.EXTENSIONS){let o=new U(A.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(o),void S.warning("setArea is prohibited because of ap extensions")}}pt("AREAS",r,t);let n=Mz(r);Object.keys(n).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?pt(o,n[o][0]):pt(o,n[o])}),S.debug("set area success:",r.join(","))}catch(r){throw i.onError(r),r}i.onSuccess()}function yN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function aT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yN(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let cT=1;function xz(e,t,i,r,n){cT+=1;let o={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:cT,requestId:cT,version:mn,cname:i.cname},a={service_name:t,json_body:JSON.stringify(o)},l,d,u=e[0];return uo(async()=>{l=Date.now();let p=await _o(u,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){let E=new U(A.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw S.error(E.toString()),E}let m=JSON.parse(p.json_body);if(m.code!==200){let E=new U(A.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw S.error(E.toString()),E}if(!m.servers||m.servers.length===0){let E=new U(A.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw S.error(E.toString()),E}let f=function(E,I){return{addressList:E.servers.map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(T.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:E.workerToken,vid:E.vid}}(m,t);return N("LIVE_STREAMING_ADDRESS")&&(f.addressList=N("LIVE_STREAMING_ADDRESS")instanceof Array?N("LIVE_STREAMING_ADDRESS"):[N("LIVE_STREAMING_ADDRESS")]),aT(aT({},f),{},{responseTime:d})},(p,m)=>(_e.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:e[m%e.length]}),!1),(p,m)=>(_e.apworkerEvent(i.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:d,serverIp:e[m%e.length]}),!!(p.code!==A.OPERATION_ABORTED&&p.code!==A.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(u=e[(m+1)%e.length],!0)),n)}let lT=1;function IN(e,t,i,r){let{url:n,areaCode:o}=e,{clientId:a,sid:l}=t,d=Date.now(),u,[p,m]=uT(t,o,[Qt.CHOOSE_SERVER]),f=Vt.networkState;return uo(async()=>{f&&Vt.networkState===ir.OFFLINE&&Vt.onlineWaiter&&await ne.race([Vt.onlineWaiter,_i(r&&r.maxRetryTimeout||Xt.maxRetryTimeout)]),f=Vt.networkState;let{data:E,headers:I}=await _o(n,{data:p,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=I.http3==="1"?1:-1,_e.reportResourceTiming(n,l),AN(E,n,t,d,[Qt.CHOOSE_SERVER],u);let T=Au(E,Qt.CHOOSE_SERVER);return dT(T),tT(T,n)},E=>(E&&_e.joinChooseServer(l,{lts:d,succ:!0,csAddr:n,opid:m,serverList:E.gatewayAddrs.map(I=>I.address),ec:null,cid:E.cid.toString(),uid:E.uid.toString(),csIp:E.csIp,unilbsServerIds:[Qt.CHOOSE_SERVER].toString(),isHttp3:u}),!1),E=>E.code!==A.OPERATION_ABORTED&&(E.code===A.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(_e.joinChooseServer(l,{lts:d,succ:!1,csAddr:n,serverList:null,opid:m,ec:E.code,csIp:E.data&&E.data.csIp,unilbsServerIds:[Qt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:f}),isHttp3:u}),S.warning("[".concat(a||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),E),!0)),r)}function wN(e,t,i,r){let n,{url:o,areaCode:a,serviceIds:l}=e,d=Date.now(),[u,p]=uT(t,a,l),m;return uo(async()=>{m&&Vt.networkState===ir.OFFLINE&&Vt.onlineWaiter&&await ne.race([Vt.onlineWaiter,_i(r&&r.maxRetryTimeout||Xt.maxRetryTimeout)]),m=Vt.networkState;let{data:f,headers:E}=await _o(o,{data:u,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n=E.http3==="1"?1:-1,_e.reportResourceTiming(o,t.sid),AN(f,o,t,d,l,n);let I=Au(f,Qt.CHOOSE_SERVER),T=Au(f,t.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK);return dT(I),{gatewayInfo:tT(I,o),proxyInfo:T,url:o}},f=>(f.gatewayInfo&&_e.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:o,serverList:f.gatewayInfo.gatewayAddrs.map(E=>E.address),ec:null,opid:p,cid:f.gatewayInfo.cid.toString(),uid:f.gatewayInfo.uid.toString(),csIp:f.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:n}),f.proxyInfo&&_e.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:o,turnServerAddrList:f.proxyInfo.addresses.map(E=>E.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),f=>f.code!==A.OPERATION_ABORTED&&(f.code===A.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(_e.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:f.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:m})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),f),!0)),r)}let AN=(e,t,i,r,n,o)=>{let{sid:a,clientId:l,cloudProxyServer:d}=i,u=[],p=m=>{m.flag===4096?_e.joinChooseServer(a,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:n.toString(),isHttp3:o}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||_e.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:n.toString()})};if(e.response_body.forEach(m=>{let f=m.buffer.code;if(m.uri===23&&f===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{let E={error:new U(A.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:m.buffer.flag};u.push(E),p(E)}if(f!==0){let E=kl(f),I={error:new U(A.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:e.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?S.warning(I.error.toString()):u.push(I),p(I)}}),u.length)throw S.warning("[".concat(l||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new U(A.CAN_NOT_GET_GATEWAY_SERVER,u.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!u.find(m=>m.error.data.retry),csIp:e.detail[502],desc:[...new Set(u.map(m=>{var f;return m==null||(f=m.error)===null||f===void 0||(f=f.data)===null||f===void 0?void 0:f.desc}).filter(m=>!!m))]})},dT=e=>{var t,i,r,n;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new U(A.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(N("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((n=e.detail)===null||n===void 0?void 0:n[23])=="string"?CN(e.detail[23].toLowerCase()):CN()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let a=e.detail[19],l=a==null?void 0:a.split(";");for(let d=0;d<l.length;d++){var o;let u=qi(o=l[d]).call(o);e.addresses[d]&&l&&(e.addresses[d].fingerprint=u)}}if(N("GATEWAY_ADDRESS")&&N("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",N("GATEWAY_ADDRESS"));let a=N("GATEWAY_ADDRESS").map(l=>{var d,u;let p=(d=(u=e.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||u===void 0?void 0:u.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=a}},Vz=(e,t)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let r=kl(i.buffer.code);throw new U(A.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return i.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new U(A.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},uT=(e,t,i)=>{let r=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:aT({6:e.stringUid,11:t,12:N("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};n.request_bodies.forEach(a=>{e.multiIP&&e.multiIP.gateway_ip&&(a.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let o=new FormData;return o.append("request",JSON.stringify(n)),[o,r]},Fz=(e,t)=>{let i=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},n=new FormData;return n.append("request",JSON.stringify(r)),[n,i]},Ll=0;function Ml(e){return ne.all(e.map(t=>t.then(i=>{throw i},i=>i))).then(t=>{throw t},t=>t)}let bu=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:r,allFailedhandler:n,promisesCollector:o}=e,a=0,l=t,d,u=0,p=async()=>{let m=(()=>{let f=a*l,E=f+l;return i.slice(f,E).map(r)})();o&&o.push(...m);try{d=await Ml(m)}catch(f){if(u+=l,a++,!(u>=i.length))return void await p();n(f)}m.forEach(f=>f.cancel())};return await p(),d},ON=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:r}=e,n=t.length,o=0,a=async()=>{let l=i(t.shift());try{return await l}catch(d){if(o++,o>=n||r!=null&&r(d))throw d;return a()}};return a()};async function hT(e,t,i,r){return{gatewayInfo:await async function(n,o,a,l){let d=null,u=[],p=async()=>{let f=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(T=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(T+"/api/v2/transpond/webrtc?v=2"):"https://".concat(T,"/api/v2/transpond/webrtc?v=2"),areaCode:Ou()})),E=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(T=>T.url)}),I=await bu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:T=>(S.debug("[".concat(n.clientId,"] Connect to choose_server:"),T.url),IN(T,n,o,a)),allFailedhandler:T=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},E),T[0]},promisesCollector:u});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},E),I},m=async()=>{if(await _i(1e3),d!==null)return d;let f=N("WEBCS_DOMAIN_BACKUP_LIST").map(T=>({url:n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(T+"/api/v2/transpond/webrtc?v=2"):"https://".concat(T,"/api/v2/transpond/webrtc?v=2"),areaCode:Ou()})),E=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(T=>T.url)}),I=await bu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:T=>(S.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),T.url),IN(T,n,o,a)),allFailedhandler:T=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:T},E),T[0]},promisesCollector:u});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},E),I};try{return d=await Ml([p(),m()]),u.length&&u.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),d}catch(f){throw f[0]}}(e,t,i,r)}}async function bN(e,t,i,r,n){let o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await hT(e,t,i,n);if(N("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:f,proxyInfo:E}=await PN(e,t,i,n);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:f};let I=E.map(T=>({turnServerURL:T.address,tcpport:T.tcpport||Li.tcpport,udpport:T.udpport||Li.udpport,username:T.username||Li.username,password:T.password||Li.password,forceturn:!1,security:!0}));if(n.useP2P){var a;let T=(a=e.uid)!==null&&a!==void 0?a:f.uid,R="glb:".concat(T.toString()),w=await MS(R),O=E.map(P=>({turnServerURL:P.address,tcpport:P.tcpport||Li.tcpport,udpport:P.udpport||Li.udpport,username:R,password:w,forceturn:!1,security:!0}));I.push(...O)}return e.turnServer={mode:"manual",servers:I},{gatewayInfo:f}}return await hT(e,t,i,n)}let{proxyInfo:l,gatewayInfo:d}=await PN(e,t,i,n),u={gatewayInfo:d},p=l.map(f=>({turnServerURL:f.address,tcpport:o==="proxy3"?void 0:f.tcpport?f.tcpport:Li.tcpport,udpport:o==="proxy4"?void 0:f.udpport?f.udpport:Li.udpport,username:f.username||Li.username,password:f.password||Li.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(n.useP2P){var m;let f=(m=e.uid)!==null&&m!==void 0?m:d.uid,E="glb:".concat(f.toString()),I=await MS(E),T=l.map(R=>({turnServerURL:R.address,tcpport:o==="proxy3"?void 0:R.tcpport||Li.tcpport,udpport:o==="proxy4"?void 0:R.udpport||Li.udpport,username:E,password:I,forceturn:o!=="proxy4",security:o==="proxy5"}));p.push(...T)}return e.turnServer={mode:"manual",servers:p},S.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),u}async function NN(e,t,i,r,n){let o=N("ACCOUNT_REGISTER").slice(0,N("AJAX_REQUEST_CONCURRENT")),a=[];a=t.proxyServer?o.map(d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));let l=n==null?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let d=await async function(u,p,m,f,E){let I=Date.now(),T={sid:m.sid,opid:10,appid:m.appId,string_uid:p},R=u[0],w=await uo(()=>_o(R+"".concat(R.indexOf("?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,P)=>{if(O.code===0){if(O.uid<=0||O.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(p," => ").concat(O.uid),O),_e.reqUserAccount(T.sid,{lts:I,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:A.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new U(A.INVALID_UINT_UID_FROM_STRING_UID);return _e.reqUserAccount(T.sid,{lts:I,success:!0,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:null,extend:T}),!1}let M=kl(O.code);return M.retry&&(R=u[(P+1)%u.length]),_e.reqUserAccount(T.sid,{lts:I,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:M.desc,extend:T}),M.retry},(O,P)=>O.code!==A.OPERATION_ABORTED&&(_e.reqUserAccount(T.sid,{lts:I,success:!1,serverAddr:R,stringUid:T.string_uid,uid:null,errorCode:O.code,extend:T}),R=u[(P+1)%u.length],!0),E);if(w.code!==0){let O=kl(w.code);throw new U(A.UNEXPECTED_RESPONSE,O.desc)}return w}(a,e,t,i,r);return n==null||n.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw n==null||n.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function jz(e,t,i){let r=N("ACCOUNT_REGISTER"),n=[];n=t.proxyServer?r.map(o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1")):r.map(o=>"https://".concat(o,"/api/v1"));try{return await ON({referenceList:n,asyncMapHandler:o=>async function(a,l,d,u){let p=Date.now(),m={sid:d.sid,opid:10,appid:d.appId,string_uid:l};try{let f=await _o(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(f.code!==0){let E=kl(f.code);throw new U(A.UNEXPECTED_RESPONSE,"preload sua error:".concat(E.desc),E)}if(f.uid<=0||f.uid>=Math.pow(2,32))throw new U(A.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:p,url:a,req:m,uid:f.uid,elapse:Date.now()-p}}catch(f){throw f}}(o,e,t,i),closeFn:o=>o.code===A.OPERATION_ABORTED||o.code===A.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(o){throw o}}async function Bz(e,t,i){let r=N("CDS_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),n=r.map(d=>function(u,p,m,f){let E=Xe(),I={flag:64,cipher_method:0,features:{device:E.name,system:E.os,system_general:navigator.userAgent,vendor:p.appId,version:mn,cname:p.cname,sid:p.sid,session_id:p.sid,detail:"",proxyServer:p.proxyServer}};return uo(()=>_o(u,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,T=>T.code!==A.OPERATION_ABORTED,f)}(d,e,t,i)),o=null,a=null,l={};try{o=await Ml(n)}catch(d){if(d.code===A.OPERATION_ABORTED)throw d;a=d}if(n.forEach(d=>d.cancel()),_e.reportApiInvoke(e.sid,{name:ti.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{l=function(d){if(!d.test_tags)return{};let u=d.test_tags,p=Object.keys(u),m={};return p.forEach(f=>{var E;let I=qi(E=f.slice(4)).call(E),T=JSON.parse(u[f])[1];m[I]=T}),m}(o)}catch{}return l}async function DN(e,t){let i=N("WEBCS_DOMAIN").concat(N("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Ou(),serviceIds:[Qt.CHOOSE_SERVER,Qt.CLOUD_PROXY_FALLBACK]}));try{return await ON({referenceList:i,asyncMapHandler:r=>async function(n,o,a){let l,{url:d,areaCode:u,serviceIds:p}=n,m=Date.now(),[f,E]=uT(o,u,p),I=Vt.networkState;try{I&&Vt.networkState===ir.OFFLINE&&Vt.onlineWaiter&&await ne.race([Vt.onlineWaiter,_i(Xt.maxRetryTimeout)]),I=Vt.networkState;let{data:T,headers:R}=await _o(d,{data:f,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=R.http3==="1"?1:-1,(P=>{let M=[];if(P.response_body.forEach(V=>{let F=V.buffer.code;if(V.uri===23&&F===0&&!V.buffer.edges_services)if(V.buffer.flag===4194310)V.buffer.edges_services=[];else{let q={error:new U(A.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:P.detail[502]}),flag:V.buffer.flag};M.push(q)}if(F!==0){let q=kl(F),J={error:new U(A.CAN_NOT_GET_GATEWAY_SERVER,q.desc,{desc:q.desc,retry:q.retry,csIp:P.detail[502]}),flag:V.buffer.flag};V.buffer.flag===4194310?S.warning(J.error.toString()):M.push(J)}}),M.length)throw new U(A.CAN_NOT_GET_GATEWAY_SERVER,M.map(V=>"flag: ".concat(V.flag,", message: ").concat(V.error.message)).join(" | "),{retry:!!M.find(V=>V.error.data.retry),csIp:P.detail[502],desc:[...new Set(M.map(V=>{var F;return V==null||(F=V.error)===null||F===void 0||(F=F.data)===null||F===void 0?void 0:F.desc}).filter(V=>!!V))]})})(T);let w=Au(T,Qt.CHOOSE_SERVER),O=Au(T,Qt.CLOUD_PROXY_FALLBACK);return dT(w),{gatewayInfo:tT(w,d),proxyInfo:O,opid:E,requestTime:m,url:d,isHttp3:l,elapse:Date.now()-m}}catch(T){throw T}}(r,e,t),closeFn:r=>r.code===A.OPERATION_ABORTED||r.code===A.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(r){throw r}}async function PN(e,t,i,r){let n=N("PROXY_SERVER_TYPE3"),o=(E,I,T)=>{let R=T||n;return Array.isArray(R)&&(R=I%2==0?n[1]:n[0]),"https://".concat(R,"/ap/?url=").concat(E)},a=null,l=[],d=async()=>{let E=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map((R,w)=>{let O;return O=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(R,"/api/v2/transpond/webrtc?v=2"),w,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(R,"/api/v2/transpond/webrtc?v=2"):o("".concat(R,"/api/v2/transpond/webrtc?v=2"),w),{url:O,areaCode:Ou(),serviceIds:[Qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(R=>R.url)}),T=await bu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:R=>(S.debug("[".concat(e.clientId,"] Connect to choose_server:"),R.url),wN(R,e,t,i)),allFailedhandler:R=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},I),R[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),T},u=async()=>{if(await _i(1e3),a!==null)return a;let E=N("WEBCS_DOMAIN_BACKUP_LIST").map((R,w)=>{let O;return O=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(R,"/api/v2/transpond/webrtc?v=2"),w,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(R,"/api/v2/transpond/webrtc?v=2"):o("".concat(R,"/api/v2/transpond/webrtc?v=2"),w),{url:O,areaCode:Ou(),serviceIds:[Qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK]}}),I=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(R=>R.url)}),T=await bu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:R=>(S.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),R.url),wN(R,e,t,i)),allFailedhandler:R=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:R},I),R[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},I),T},p,m,f;try{({gatewayInfo:p,proxyInfo:m,url:f}=await Ml([d(),u()]))}catch(E){throw E[0]}if(l.length&&l.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),!p||!m)throw new U(A.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=f,e.cloudProxyServer!=="disabled"&&Array.isArray(n)&&f){let E=/^https?:\/\/(.+?)(\/.*)?$/.exec(f)[1];se(n).call(n,E)&&(e.proxyServer=E,S.setProxyServer(E),_e.setProxyServer(E))}return a={gatewayInfo:p,proxyInfo:await EN(m,p.uid)},a}async function kN(e,t,i,r){let n=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(o=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap"));return await xz(n,e,t,i,r)}async function Gz(e,t,i){let r=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),n=r.map(o=>function(a,l,d,u){let p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:mn,cname:l.cname,uid:l.uid.toString(),requestId:lT,seq:lT};lT+=1;let m={service_name:"tele_channel",json_body:JSON.stringify(p)};return uo(async()=>{let f=await _o(a,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(f.code!==0){let I=new U(A.UNEXPECTED_RESPONSE,"cross channel ap error, code"+f.code,{retry:!0});throw S.error(I.toString()),I}let E=JSON.parse(f.json_body);if(E.code!==200){let I=new U(A.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(E.code,", reason: ").concat(E.reason));throw S.error(I.toString()),I}if(!E.servers||E.servers.length===0){let I=new U(A.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(I.toString()),I}return{vid:E.vid,workerToken:E.workerToken,addressList:(N("CHANNEL_MEDIA_RELAY_SERVERS")||E.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,f=>!!(f.code!==A.OPERATION_ABORTED&&f.code!==A.UNEXPECTED_RESPONSE||f.data&&f.data.retry),u)}(o,e,t,i));try{let o=await Ml(n);return n.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function Wz(e,t,i){let r=null,n=[],o=async a=>{let l=N(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return a&&(await _i(1e3),r!==null)?r:await bu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(S.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),d),function(u,p,m,f){let[E]=Fz(p,[Qt.CHOOSE_SERVER]),I=Vt.networkState;return uo(async()=>{I&&Vt.networkState===ir.OFFLINE&&Vt.onlineWaiter&&await ne.race([Vt.onlineWaiter,_i(f&&f.maxRetryTimeout||Xt.maxRetryTimeout)]),I=Vt.networkState;let T=await _o(u,{data:E,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return Vz(T,u)},()=>!1,T=>T.code!==A.OPERATION_ABORTED&&(T.code===A.UPDATE_TICKET_FAILED?T.data.retry:(S.warning("[".concat(p.clientId,"] update ticket network error, retry"),T),!0)),f)}(d,e,t,i)),allFailedhandler:d=>{throw d[0]},promisesCollector:n})};try{return r=await Ml([o(!1),o(!0)]),n.length&&n.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),r}catch(a){throw a[0]}}function LN(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function MN(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?LN(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):LN(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class Hz extends Ot{get isSuccess(){return!!this.configs}constructor(){super(),y(this,"configs",void 0),y(this,"joinInfo",void 0),y(this,"cancelToken",void 0),y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),y(this,"interval",void 0),y(this,"mutex",new vi("config-distribute")),y(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,i){this.joinInfo=t,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),N("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},N("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,_e.reportApiInvoke(null,{options:void 0,name:ti.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xt.TRACER}).onSuccess(JSON.stringify(Qs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,i=await this.mutex.lock();try{t=await Bz(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(r){let n=new U(A.NETWORK_RESPONSE_ERROR,r);S.warning("[config-distribute] ".concat(n.toString()))}finally{i()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var i;(i=t)&&i.uplink&&i.id&&i.uplink.max_bitrate!==void 0&&i.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit($S.UPDATE_BITRATE_LIMIT,t):this.emit($S.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&MN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var i;let r=ru(i=Object.keys(t).filter(o=>/^webrtc_ng_global_parameter/.test(o))).call(i);for(let o=0;o<r.length;o++)for(let a=r.length-1;a>o;a--){let l=r[a];if(typeof t[l].__priority=="number"){let d=t[l].__priority,u=r[a-1];if(typeof t[u].__priority=="number"){if(!(d>t[u].__priority))continue;{let p=l;r[a]=r[a-1],r[a-1]=p}}else{let p=l;r[a]=r[a-1],r[a-1]=p}}}let n={};r.forEach(o=>{let a=t[o],l=a.__expires;Object.keys(a).forEach(d=>{d==="__priority"||d==="__expires"||Object.prototype.hasOwnProperty.call(n,d)||(n[d]=MN({value:a[d]},l&&{expires:l}))})});try{(function(l){try{let d=Date.now();Object.keys(l).forEach(u=>{switch(u){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(si,u)){let{value:p,expires:m}=l[u];if(m&&m<=d)return;Qs[u]=p,si[u]=p,S.debug("Update global parameters from config distribute",u,p)}}})}catch(d){S.error("Error update config immediately: ".concat(l),d.message)}})(n);let o=JSON.stringify(n),a=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",a),S.debug("Caching global parameters ".concat(o))}catch(o){S.error("Error caching global parameters:",o.message)}}}var jn,Kz=g(tN),UN=ur,zz=K,Yz=Me,qz=v,pT=mp,Jz=zd,Xz=dt,Qz=ko,Zz=rp,Ul=Object.assign,xN=Object.defineProperty,$z=zz([].concat),eY=!Ul||qz(function(){if(UN&&Ul({b:1},Ul(xN({},"a",{enumerable:!0,get:function(){xN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(n){t[n]=n}),Ul({},e)[i]!=7||pT(Ul({},t)).join("")!=r})?function(e,t){for(var i=Qz(e),r=arguments.length,n=1,o=Jz.f,a=Xz.f;r>n;)for(var l,d=Zz(arguments[n++]),u=o?$z(pT(d),o(d)):pT(d),p=u.length,m=0;p>m;)l=u[m++],UN&&!Yz(a,d,l)||(i[l]=d[l]);return i}:Ul,tY=vr,iY=mI,rY=Vs,nY=Me,oY=ko,sY=function(e,t,i,r){try{return r?t(tY(i)[0],i[1]):t(i)}catch(n){iY(e,"throw",n)}},aY=uI,cY=wp,lY=ls,VN=Fp,dY=DE,uY=Ep,FN=Array,hc=K,mT=2147483647,hY=/[^\0-\u007E]/,jN=/[.\u3002\uFF0E\uFF61]/g,BN="Overflow: input needs wider integers to process",GN=RangeError,pY=hc(jN.exec),xl=Math.floor,_T=String.fromCharCode,WN=hc("".charCodeAt),HN=hc([].join),ra=hc([].push),mY=hc("".replace),_Y=hc("".split),fY=hc("".toLowerCase),KN=function(e){return e+22+75*(e<26)},EY=function(e,t,i){var r=0;for(e=i?xl(e/700):e>>1,e+=xl(e/t);e>455;)e=xl(e/35),r+=36;return xl(r+36*e/(e+38))},gY=function(e){var t=[];e=function(w){for(var O=[],P=0,M=w.length;P<M;){var V=WN(w,P++);if(V>=55296&&V<=56319&&P<M){var F=WN(w,P++);(64512&F)==56320?ra(O,((1023&V)<<10)+(1023&F)+65536):(ra(O,V),P--)}else ra(O,V)}return O}(e);var i,r,n=e.length,o=128,a=0,l=72;for(i=0;i<e.length;i++)(r=e[i])<128&&ra(t,_T(r));var d=t.length,u=d;for(d&&ra(t,"-");u<n;){var p=mT;for(i=0;i<e.length;i++)(r=e[i])>=o&&r<p&&(p=r);var m=u+1;if(p-o>xl((mT-a)/m))throw GN(BN);for(a+=(p-o)*m,o=p,i=0;i<e.length;i++){if((r=e[i])<o&&++a>mT)throw GN(BN);if(r==o){for(var f=a,E=36;;){var I=E<=l?1:E>=l+26?26:E-l;if(f<I)break;var T=f-I,R=36-I;ra(t,_T(KN(I+T%R))),f=xl(T/R),E+=36}ra(t,_T(KN(f))),l=EY(a,m,u==d),a=0,u++}}a++,o++}return HN(t,"")},SY=Tt,fT=ur,TY=oS,ET=ce,zN=Vs,Bn=K,Dm=js,Gn=Ip,vY=HE,gT=Fi,ST=eY,Vl=function(e){var t=oY(e),i=cY(this),r=arguments.length,n=r>1?arguments[1]:void 0,o=n!==void 0;o&&(n=rY(n,r>2?arguments[2]:void 0));var a,l,d,u,p,m,f=uY(t),E=0;if(!f||this===FN&&aY(f))for(a=lY(t),l=i?new this(a):FN(a);a>E;E++)m=o?n(t[E],E):t[E],VN(l,E,m);else for(p=(u=dY(t,f)).next,l=i?new this:[];!(d=nY(p,u)).done;E++)m=o?sY(u,n,[d.value,E],!0):d.value,VN(l,E,m);return l.length=E,l},fo=kg,RY=vg.codeAt,CY=function(e){var t,i,r=[],n=_Y(mY(fY(e),jN,"."),".");for(t=0;t<n.length;t++)i=n[t],ra(r,pY(hY,i)?"xn--"+gY(i):i);return HN(r,".")},Es=hn,yY=Bs,IY=Ap,YN=NK,qN=Qa,wY=qN.set,Pm=qN.getterFor("URL"),AY=YN.URLSearchParams,OY=YN.getState,Nu=ET.URL,TT=ET.TypeError,km=ET.parseInt,bY=Math.floor,JN=Math.pow,Wn=Bn("".charAt),Eo=Bn(/./.exec),Du=Bn([].join),NY=Bn(1 .toString),DY=Bn([].pop),Fl=Bn([].push),vT=Bn("".replace),PY=Bn([].shift),kY=Bn("".split),Pu=Bn("".slice),Lm=Bn("".toLowerCase),LY=Bn([].unshift),RT="Invalid scheme",ku="Invalid host",XN="Invalid port",QN=/[a-z]/i,MY=/[\d+-.a-z]/i,CT=/\d/,UY=/^0x/i,xY=/^[0-7]+$/,VY=/^\d+$/,ZN=/^[\da-f]+$/i,FY=/[\0\t\n\r #%/:<>?@[\\\]^|]/,jY=/[\0\t\n\r #/:<>?@[\\\]^|]/,BY=/^[\u0000-\u0020]+/,GY=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,WY=/[\t\n\r]/g,Lu=function(e){var t,i,r,n;if(typeof e=="number"){for(t=[],i=0;i<4;i++)LY(t,e%256),e=bY(e/256);return Du(t,".")}if(typeof e=="object"){for(t="",r=function(o){for(var a=null,l=1,d=null,u=0,p=0;p<8;p++)o[p]!==0?(u>l&&(a=d,l=u),d=null,u=0):(d===null&&(d=p),++u);return u>l&&(a=d,l=u),a}(e),i=0;i<8;i++)n&&e[i]===0||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=NY(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},Mm={},$N=ST({},Mm,{" ":1,'"':1,"<":1,">":1,"`":1}),eD=ST({},$N,{"#":1,"?":1,"{":1,"}":1}),yT=ST({},eD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),na=function(e,t){var i=RY(e,0);return i>32&&i<127&&!gT(t,e)?e:encodeURIComponent(e)},Um={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Mu=function(e,t){var i;return e.length==2&&Eo(QN,Wn(e,0))&&((i=Wn(e,1))==":"||!t&&i=="|")},tD=function(e){var t;return e.length>1&&Mu(Pu(e,0,2))&&(e.length==2||(t=Wn(e,2))==="/"||t==="\\"||t==="?"||t==="#")},HY=function(e){return e==="."||Lm(e)==="%2e"},IT={},iD={},wT={},rD={},nD={},AT={},oD={},sD={},xm={},Vm={},OT={},bT={},NT={},DT={},aD={},PT={},jl={},Ho={},cD={},pc={},gs={},kT=function(e,t,i){var r,n,o,a=Es(e);if(t){if(n=this.parse(a))throw TT(n);this.searchParams=null}else{if(i!==void 0&&(r=new kT(i,!0)),n=this.parse(a,null,r))throw TT(n);(o=OY(new AY)).bindURL(this),this.searchParams=o}};kT.prototype={type:"URL",parse:function(e,t,i){var r,n,o,a,l,d=this,u=t||IT,p=0,m="",f=!1,E=!1,I=!1;for(e=Es(e),t||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,e=vT(e,BY,""),e=vT(e,GY,"$1")),e=vT(e,WY,""),r=Vl(e);p<=r.length;){switch(n=r[p],u){case IT:if(!n||!Eo(QN,n)){if(t)return RT;u=wT;continue}m+=Lm(n),u=iD;break;case iD:if(n&&(Eo(MY,n)||n=="+"||n=="-"||n=="."))m+=Lm(n);else{if(n!=":"){if(t)return RT;m="",u=wT,p=0;continue}if(t&&(d.isSpecial()!=gT(Um,m)||m=="file"&&(d.includesCredentials()||d.port!==null)||d.scheme=="file"&&!d.host))return;if(d.scheme=m,t)return void(d.isSpecial()&&Um[d.scheme]==d.port&&(d.port=null));m="",d.scheme=="file"?u=DT:d.isSpecial()&&i&&i.scheme==d.scheme?u=rD:d.isSpecial()?u=sD:r[p+1]=="/"?(u=nD,p++):(d.cannotBeABaseURL=!0,Fl(d.path,""),u=cD)}break;case wT:if(!i||i.cannotBeABaseURL&&n!="#")return RT;if(i.cannotBeABaseURL&&n=="#"){d.scheme=i.scheme,d.path=fo(i.path),d.query=i.query,d.fragment="",d.cannotBeABaseURL=!0,u=gs;break}u=i.scheme=="file"?DT:AT;continue;case rD:if(n!="/"||r[p+1]!="/"){u=AT;continue}u=xm,p++;break;case nD:if(n=="/"){u=Vm;break}u=Ho;continue;case AT:if(d.scheme=i.scheme,n==jn)d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=fo(i.path),d.query=i.query;else if(n=="/"||n=="\\"&&d.isSpecial())u=oD;else if(n=="?")d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=fo(i.path),d.query="",u=pc;else{if(n!="#"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=fo(i.path),d.path.length--,u=Ho;continue}d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,d.path=fo(i.path),d.query=i.query,d.fragment="",u=gs}break;case oD:if(!d.isSpecial()||n!="/"&&n!="\\"){if(n!="/"){d.username=i.username,d.password=i.password,d.host=i.host,d.port=i.port,u=Ho;continue}u=Vm}else u=xm;break;case sD:if(u=xm,n!="/"||Wn(m,p+1)!="/")continue;p++;break;case xm:if(n!="/"&&n!="\\"){u=Vm;continue}break;case Vm:if(n=="@"){f&&(m="%40"+m),f=!0,o=Vl(m);for(var T=0;T<o.length;T++){var R=o[T];if(R!=":"||I){var w=na(R,yT);I?d.password+=w:d.username+=w}else I=!0}m=""}else if(n==jn||n=="/"||n=="?"||n=="#"||n=="\\"&&d.isSpecial()){if(f&&m=="")return"Invalid authority";p-=Vl(m).length+1,m="",u=OT}else m+=n;break;case OT:case bT:if(t&&d.scheme=="file"){u=PT;continue}if(n!=":"||E){if(n==jn||n=="/"||n=="?"||n=="#"||n=="\\"&&d.isSpecial()){if(d.isSpecial()&&m=="")return ku;if(t&&m==""&&(d.includesCredentials()||d.port!==null))return;if(a=d.parseHost(m))return a;if(m="",u=jl,t)return;continue}n=="["?E=!0:n=="]"&&(E=!1),m+=n}else{if(m=="")return ku;if(a=d.parseHost(m))return a;if(m="",u=NT,t==bT)return}break;case NT:if(!Eo(CT,n)){if(n==jn||n=="/"||n=="?"||n=="#"||n=="\\"&&d.isSpecial()||t){if(m!=""){var O=km(m,10);if(O>65535)return XN;d.port=d.isSpecial()&&O===Um[d.scheme]?null:O,m=""}if(t)return;u=jl;continue}return XN}m+=n;break;case DT:if(d.scheme="file",n=="/"||n=="\\")u=aD;else{if(!i||i.scheme!="file"){u=Ho;continue}if(n==jn)d.host=i.host,d.path=fo(i.path),d.query=i.query;else if(n=="?")d.host=i.host,d.path=fo(i.path),d.query="",u=pc;else{if(n!="#"){tD(Du(fo(r,p),""))||(d.host=i.host,d.path=fo(i.path),d.shortenPath()),u=Ho;continue}d.host=i.host,d.path=fo(i.path),d.query=i.query,d.fragment="",u=gs}}break;case aD:if(n=="/"||n=="\\"){u=PT;break}i&&i.scheme=="file"&&!tD(Du(fo(r,p),""))&&(Mu(i.path[0],!0)?Fl(d.path,i.path[0]):d.host=i.host),u=Ho;continue;case PT:if(n==jn||n=="/"||n=="\\"||n=="?"||n=="#"){if(!t&&Mu(m))u=Ho;else if(m==""){if(d.host="",t)return;u=jl}else{if(a=d.parseHost(m))return a;if(d.host=="localhost"&&(d.host=""),t)return;m="",u=jl}continue}m+=n;break;case jl:if(d.isSpecial()){if(u=Ho,n!="/"&&n!="\\")continue}else if(t||n!="?")if(t||n!="#"){if(n!=jn&&(u=Ho,n!="/"))continue}else d.fragment="",u=gs;else d.query="",u=pc;break;case Ho:if(n==jn||n=="/"||n=="\\"&&d.isSpecial()||!t&&(n=="?"||n=="#")){if((l=Lm(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),n=="/"||n=="\\"&&d.isSpecial()||Fl(d.path,"")):HY(m)?n=="/"||n=="\\"&&d.isSpecial()||Fl(d.path,""):(d.scheme=="file"&&!d.path.length&&Mu(m)&&(d.host&&(d.host=""),m=Wn(m,0)+":"),Fl(d.path,m)),m="",d.scheme=="file"&&(n==jn||n=="?"||n=="#"))for(;d.path.length>1&&d.path[0]==="";)PY(d.path);n=="?"?(d.query="",u=pc):n=="#"&&(d.fragment="",u=gs)}else m+=na(n,eD);break;case cD:n=="?"?(d.query="",u=pc):n=="#"?(d.fragment="",u=gs):n!=jn&&(d.path[0]+=na(n,Mm));break;case pc:t||n!="#"?n!=jn&&(n=="'"&&d.isSpecial()?d.query+="%27":d.query+=n=="#"?"%23":na(n,Mm)):(d.fragment="",u=gs);break;case gs:n!=jn&&(d.fragment+=na(n,$N))}p++}},parseHost:function(e){var t,i,r;if(Wn(e,0)=="["){if(Wn(e,e.length-1)!="]"||(t=function(n){var o,a,l,d,u,p,m,f=[0,0,0,0,0,0,0,0],E=0,I=null,T=0,R=function(){return Wn(n,T)};if(R()==":"){if(Wn(n,1)!=":")return;T+=2,I=++E}for(;R();){if(E==8)return;if(R()!=":"){for(o=a=0;a<4&&Eo(ZN,R());)o=16*o+km(R(),16),T++,a++;if(R()=="."){if(a==0||(T-=a,E>6))return;for(l=0;R();){if(d=null,l>0){if(!(R()=="."&&l<4))return;T++}if(!Eo(CT,R()))return;for(;Eo(CT,R());){if(u=km(R(),10),d===null)d=u;else{if(d==0)return;d=10*d+u}if(d>255)return;T++}f[E]=256*f[E]+d,++l!=2&&l!=4||E++}if(l!=4)return;break}if(R()==":"){if(T++,!R())return}else if(R())return;f[E++]=o}else{if(I!==null)return;T++,I=++E}}if(I!==null)for(p=E-I,E=7;E!=0&&p>0;)m=f[E],f[E--]=f[I+p-1],f[I+--p]=m;else if(E!=8)return;return f}(Pu(e,1,-1)),!t))return ku;this.host=t}else if(this.isSpecial()){if(e=CY(e),Eo(FY,e)||(t=function(n){var o,a,l,d,u,p,m,f=kY(n,".");if(f.length&&f[f.length-1]==""&&f.length--,(o=f.length)>4)return n;for(a=[],l=0;l<o;l++){if((d=f[l])=="")return n;if(u=10,d.length>1&&Wn(d,0)=="0"&&(u=Eo(UY,d)?16:8,d=Pu(d,u==8?1:2)),d==="")p=0;else{if(!Eo(u==10?VY:u==8?xY:ZN,d))return n;p=km(d,u)}Fl(a,p)}for(l=0;l<o;l++)if(p=a[l],l==o-1){if(p>=JN(256,5-o))return null}else if(p>255)return null;for(m=DY(a),l=0;l<a.length;l++)m+=a[l]*JN(256,3-l);return m}(e),t===null))return ku;this.host=t}else{if(Eo(jY,e))return ku;for(t="",i=Vl(e),r=0;r<i.length;r++)t+=na(i[r],Mm);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return gT(Um,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Mu(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,o=e.port,a=e.path,l=e.query,d=e.fragment,u=t+":";return n!==null?(u+="//",e.includesCredentials()&&(u+=i+(r?":"+r:"")+"@"),u+=Lu(n),o!==null&&(u+=":"+o)):t=="file"&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+Du(a,"/"):"",l!==null&&(u+="?"+l),d!==null&&(u+="#"+d),u},setHref:function(e){var t=this.parse(e);if(t)throw TT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Bl(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+Lu(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Es(e)+":",IT)},getUsername:function(){return this.username},setUsername:function(e){var t=Vl(Es(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=na(t[i],yT)}},getPassword:function(){return this.password},setPassword:function(e){var t=Vl(Es(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=na(t[i],yT)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Lu(e):Lu(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,OT)},getHostname:function(){var e=this.host;return e===null?"":Lu(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,bT)},getPort:function(){var e=this.port;return e===null?"":Es(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Es(e))==""?this.port=null:this.parse(e,NT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Du(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,jl))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Es(e))==""?this.query=null:(Wn(e,0)=="?"&&(e=Pu(e,1)),this.query="",this.parse(e,pc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Es(e))!=""?(Wn(e,0)=="#"&&(e=Pu(e,1)),this.fragment="",this.parse(e,gs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bl=function(e){var t=vY(this,xr),i=IY(arguments.length,1)>1?arguments[1]:void 0,r=wY(t,new kT(e,!1,i));fT||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},xr=Bl.prototype,Hn=function(e,t){return{get:function(){return Pm(this)[e]()},set:t&&function(i){return Pm(this)[t](i)},configurable:!0,enumerable:!0}};if(fT&&(Gn(xr,"href",Hn("serialize","setHref")),Gn(xr,"origin",Hn("getOrigin")),Gn(xr,"protocol",Hn("getProtocol","setProtocol")),Gn(xr,"username",Hn("getUsername","setUsername")),Gn(xr,"password",Hn("getPassword","setPassword")),Gn(xr,"host",Hn("getHost","setHost")),Gn(xr,"hostname",Hn("getHostname","setHostname")),Gn(xr,"port",Hn("getPort","setPort")),Gn(xr,"pathname",Hn("getPathname","setPathname")),Gn(xr,"search",Hn("getSearch","setSearch")),Gn(xr,"searchParams",Hn("getSearchParams")),Gn(xr,"hash",Hn("getHash","setHash"))),Dm(xr,"toJSON",function(){return Pm(this).serialize()},{enumerable:!0}),Dm(xr,"toString",function(){return Pm(this).serialize()},{enumerable:!0}),Nu){var lD=Nu.createObjectURL,dD=Nu.revokeObjectURL;lD&&Dm(Bl,"createObjectURL",zN(lD,Nu)),dD&&Dm(Bl,"revokeObjectURL",zN(dD,Nu))}yY(Bl,"URL"),SY({global:!0,constructor:!0,forced:!TY,sham:!fT},{URL:Bl});var KY=Tt,zY=v,YY=Ap,uD=hn,qY=oS,hD=Lr("URL");KY({target:"URL",stat:!0,forced:!(qY&&zY(function(){hD.canParse()}))},{canParse:function(e){var t=YY(arguments.length,1),i=uD(e),r=t<2||arguments[1]===void 0?void 0:uD(arguments[1]);try{return!!new hD(i,r)}catch{return!1}}});var pD=g(so.URL),JY=Q,XY=BO,mD=RegExp.prototype,QY=function(e){return e===mD||JY(mD,e)?XY(e):e.flags},Xi=g(QY);function Gl(e){let t=e.length;for(;--t>=0;)e[t]=0}let LT=256,_D=286,Uu=30,xu=15,MT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fm=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ZY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),fD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ss=new Array(576);Gl(Ss);let Vu=new Array(60);Gl(Vu);let Fu=new Array(512);Gl(Fu);let ju=new Array(256);Gl(ju);let UT=new Array(29);Gl(UT);let jm=new Array(Uu);function xT(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}let ED,gD,SD;function VT(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Gl(jm);let TD=e=>e<256?Fu[e]:Fu[256+(e>>>7)],Bu=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Xr=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,Bu(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Ko=(e,t,i)=>{Xr(e,i[2*t],i[2*t+1])},vD=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},RD=(e,t,i)=>{let r=new Array(16),n,o,a=0;for(n=1;n<=xu;n++)a=a+i[n-1]<<1,r[n]=a;for(o=0;o<=t;o++){let l=e[2*o+1];l!==0&&(e[2*o]=vD(r[l]++,l))}},CD=e=>{let t;for(t=0;t<_D;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Uu;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},yD=e=>{e.bi_valid>8?Bu(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ID=(e,t,i,r)=>{let n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&r[t]<=r[i]},FT=(e,t,i)=>{let r=e.heap[i],n=i<<1;for(;n<=e.heap_len&&(n<e.heap_len&&ID(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!ID(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r},wD=(e,t,i)=>{let r,n,o,a,l=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+l++],r+=(255&e.pending_buf[e.sym_buf+l++])<<8,n=e.pending_buf[e.sym_buf+l++],r===0?Ko(e,n,t):(o=ju[n],Ko(e,o+LT+1,t),a=MT[o],a!==0&&(n-=UT[o],Xr(e,n,a)),r--,o=TD(r),Ko(e,o,i),a=Fm[o],a!==0&&(r-=jm[o],Xr(e,r,a)));while(l<e.sym_next);Ko(e,256,t)},jT=(e,t)=>{let i=t.dyn_tree,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems,a,l,d,u=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)i[2*a]!==0?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):i[2*a+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=u<2?++u:0,i[2*d]=1,e.depth[d]=0,e.opt_len--,n&&(e.static_len-=r[2*d+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)FT(e,i,a);d=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],FT(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=l,i[2*d]=i[2*a]+i[2*l],e.depth[d]=(e.depth[a]>=e.depth[l]?e.depth[a]:e.depth[l])+1,i[2*a+1]=i[2*l+1]=d,e.heap[1]=d++,FT(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,m)=>{let f=m.dyn_tree,E=m.max_code,I=m.stat_desc.static_tree,T=m.stat_desc.has_stree,R=m.stat_desc.extra_bits,w=m.stat_desc.extra_base,O=m.stat_desc.max_length,P,M,V,F,q,J,Z=0;for(F=0;F<=xu;F++)p.bl_count[F]=0;for(f[2*p.heap[p.heap_max]+1]=0,P=p.heap_max+1;P<573;P++)M=p.heap[P],F=f[2*f[2*M+1]+1]+1,F>O&&(F=O,Z++),f[2*M+1]=F,M>E||(p.bl_count[F]++,q=0,M>=w&&(q=R[M-w]),J=f[2*M],p.opt_len+=J*(F+q),T&&(p.static_len+=J*(I[2*M+1]+q)));if(Z!==0){do{for(F=O-1;p.bl_count[F]===0;)F--;p.bl_count[F]--,p.bl_count[F+1]+=2,p.bl_count[O]--,Z-=2}while(Z>0);for(F=O;F!==0;F--)for(M=p.bl_count[F];M!==0;)V=p.heap[--P],V>E||(f[2*V+1]!==F&&(p.opt_len+=(F-f[2*V+1])*f[2*V],f[2*V+1]=F),M--)}})(e,t),RD(i,u,e.bl_count)},AD=(e,t,i)=>{let r,n,o=-1,a=t[1],l=0,d=7,u=4;for(a===0&&(d=138,u=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=a,a=t[2*(r+1)+1],++l<d&&n===a||(l<u?e.bl_tree[2*n]+=l:n!==0?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,o=n,a===0?(d=138,u=3):n===a?(d=6,u=3):(d=7,u=4))},OD=(e,t,i)=>{let r,n,o=-1,a=t[1],l=0,d=7,u=4;for(a===0&&(d=138,u=3),r=0;r<=i;r++)if(n=a,a=t[2*(r+1)+1],!(++l<d&&n===a)){if(l<u)do Ko(e,n,e.bl_tree);while(--l!=0);else n!==0?(n!==o&&(Ko(e,n,e.bl_tree),l--),Ko(e,16,e.bl_tree),Xr(e,l-3,2)):l<=10?(Ko(e,17,e.bl_tree),Xr(e,l-3,3)):(Ko(e,18,e.bl_tree),Xr(e,l-11,7));l=0,o=n,a===0?(d=138,u=3):n===a?(d=6,u=3):(d=7,u=4)}},bD=!1,ND=(e,t,i,r)=>{Xr(e,0+(r?1:0),3),yD(e),Bu(e,i),Bu(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var $Y=e=>{bD||((()=>{let t,i,r,n,o,a=new Array(16);for(r=0,n=0;n<28;n++)for(UT[n]=r,t=0;t<1<<MT[n];t++)ju[r++]=n;for(ju[r-1]=n,o=0,n=0;n<16;n++)for(jm[n]=o,t=0;t<1<<Fm[n];t++)Fu[o++]=n;for(o>>=7;n<Uu;n++)for(jm[n]=o<<7,t=0;t<1<<Fm[n]-7;t++)Fu[256+o++]=n;for(i=0;i<=xu;i++)a[i]=0;for(t=0;t<=143;)Ss[2*t+1]=8,t++,a[8]++;for(;t<=255;)Ss[2*t+1]=9,t++,a[9]++;for(;t<=279;)Ss[2*t+1]=7,t++,a[7]++;for(;t<=287;)Ss[2*t+1]=8,t++,a[8]++;for(RD(Ss,287,a),t=0;t<Uu;t++)Vu[2*t+1]=5,Vu[2*t]=vD(t,5);ED=new xT(Ss,MT,257,_D,xu),gD=new xT(Vu,Fm,0,Uu,xu),SD=new xT(new Array(0),ZY,0,19,7)})(),bD=!0),e.l_desc=new VT(e.dyn_ltree,ED),e.d_desc=new VT(e.dyn_dtree,gD),e.bl_desc=new VT(e.bl_tree,SD),e.bi_buf=0,e.bi_valid=0,CD(e)},eq=(e,t,i,r)=>{let n,o,a=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let d,u=4093624447;for(d=0;d<=31;d++,u>>>=1)if(1&u&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<LT;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(e)),jT(e,e.l_desc),jT(e,e.d_desc),a=(l=>{let d;for(AD(l,l.dyn_ltree,l.l_desc.max_code),AD(l,l.dyn_dtree,l.d_desc.max_code),jT(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*fD[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(e),n=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=n&&(n=o)):n=o=i+5,i+4<=n&&t!==-1?ND(e,t,i,r):e.strategy===4||o===n?(Xr(e,2+(r?1:0),3),wD(e,Ss,Vu)):(Xr(e,4+(r?1:0),3),((l,d,u,p)=>{let m;for(Xr(l,d-257,5),Xr(l,u-1,5),Xr(l,p-4,4),m=0;m<p;m++)Xr(l,l.bl_tree[2*fD[m]+1],3);OD(l,l.dyn_ltree,d-1),OD(l,l.dyn_dtree,u-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),wD(e,e.dyn_ltree,e.dyn_dtree)),CD(e),r&&yD(e)},tq=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(ju[i]+LT+1)]++,e.dyn_dtree[2*TD(t)]++),e.sym_next===e.sym_end),iq=e=>{Xr(e,2,3),Ko(e,256,Ss),(t=>{t.bi_valid===16?(Bu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},rq={_tr_init:$Y,_tr_stored_block:ND,_tr_flush_block:eq,_tr_tally:tq,_tr_align:iq},Gu=(e,t,i,r)=>{let n=65535&e|0,o=e>>>16&65535|0,a=0;for(;i!==0;){a=i>2e3?2e3:i,i-=a;do n=n+t[r++]|0,o=o+n|0;while(--a);n%=65521,o%=65521}return n|o<<16|0};let nq=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var sr=(e,t,i,r)=>{let n=nq,o=r+i;e^=-1;for(let a=r;a<o;a++)e=e>>>8^n[255&(e^t[a])];return-1^e},mc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Wl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:oq,_tr_stored_block:BT,_tr_flush_block:sq,_tr_tally:oa,_tr_align:aq}=rq,{Z_NO_FLUSH:sa,Z_PARTIAL_FLUSH:cq,Z_FULL_FLUSH:lq,Z_FINISH:Kn,Z_BLOCK:DD,Z_OK:pr,Z_STREAM_END:PD,Z_STREAM_ERROR:zo,Z_DATA_ERROR:dq,Z_BUF_ERROR:GT,Z_DEFAULT_COMPRESSION:uq,Z_FILTERED:hq,Z_HUFFMAN_ONLY:Bm,Z_RLE:pq,Z_FIXED:mq,Z_DEFAULT_STRATEGY:_q,Z_UNKNOWN:fq,Z_DEFLATED:Gm}=Wl,WT=286,Eq=30,gq=19,Sq=2*WT+1,Tq=15,_c=258,Yo=262,Hl=42,fc=113,Wu=666,Ec=(e,t)=>(e.msg=mc[t],t),kD=e=>2*e-(e>4?9:0),aa=e=>{let t=e.length;for(;--t>=0;)e[t]=0},vq=e=>{let t,i,r,n=e.w_size;t=e.hash_size,r=t;do i=e.head[--r],e.head[r]=i>=n?i-n:0;while(--t);t=n,r=t;do i=e.prev[--r],e.prev[r]=i>=n?i-n:0;while(--t)},ca=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,En=e=>{let t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},gn=(e,t)=>{sq(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,En(e.strm)},Gt=(e,t)=>{e.pending_buf[e.pending++]=t},Hu=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},HT=(e,t,i,r)=>{let n=e.avail_in;return n>r&&(n=r),n===0?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),i),e.state.wrap===1?e.adler=Gu(e.adler,t,n,i):e.state.wrap===2&&(e.adler=sr(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)},LD=(e,t)=>{let i,r,n=e.max_chain_length,o=e.strstart,a=e.prev_length,l=e.nice_match,d=e.strstart>e.w_size-Yo?e.strstart-(e.w_size-Yo):0,u=e.window,p=e.w_mask,m=e.prev,f=e.strstart+_c,E=u[o+a-1],I=u[o+a];e.prev_length>=e.good_match&&(n>>=2),l>e.lookahead&&(l=e.lookahead);do if(i=t,u[i+a]===I&&u[i+a-1]===E&&u[i]===u[o]&&u[++i]===u[o+1]){o+=2,i++;do;while(u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&o<f);if(r=_c-(f-o),o=f-_c,r>a){if(e.match_start=t,a=r,r>=l)break;E=u[o+a-1],I=u[o+a]}}while((t=m[t&p])>d&&--n!=0);return a<=e.lookahead?a:e.lookahead},Kl=e=>{let t=e.w_size,i,r,n;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Yo)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),vq(e),r+=t),e.strm.avail_in===0)break;if(i=HT(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=ca(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=ca(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Yo&&e.strm.avail_in!==0)},MD=(e,t)=>{let i,r,n,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,l=e.strm.avail_in;do{if(i=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n||(n=e.strm.avail_out-n,r=e.strstart-e.block_start,i>r+e.strm.avail_in&&(i=r+e.strm.avail_in),i>n&&(i=n),i<o&&(i===0&&t!==Kn||t===sa||i!==r+e.strm.avail_in)))break;a=t===Kn&&i===r+e.strm.avail_in?1:0,BT(e,0,0,a),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,En(e.strm),r&&(r>i&&(r=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,i-=r),i&&(HT(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(a===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==sa&&t!==Kn&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(HT(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,o=n>e.w_size?e.w_size:n,r=e.strstart-e.block_start,(r>=o||(r||t===Kn)&&t!==sa&&e.strm.avail_in===0&&r<=n)&&(i=r>n?n:r,a=t===Kn&&e.strm.avail_in===0&&i===r?1:0,BT(e,e.block_start,i,a),e.block_start+=i,En(e.strm)),a?3:1)},KT=(e,t)=>{let i,r;for(;;){if(e.lookahead<Yo){if(Kl(e),e.lookahead<Yo&&t===sa)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=ca(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Yo&&(e.match_length=LD(e,i)),e.match_length>=3)if(r=oa(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ca(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ca(e,e.ins_h,e.window[e.strstart+1]);else r=oa(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(gn(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Kn?(gn(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(gn(e,!1),e.strm.avail_out===0)?1:2},zl=(e,t)=>{let i,r,n;for(;;){if(e.lookahead<Yo){if(Kl(e),e.lookahead<Yo&&t===sa)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=ca(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Yo&&(e.match_length=LD(e,i),e.match_length<=5&&(e.strategy===hq||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,r=oa(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=ca(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(gn(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=oa(e,0,e.window[e.strstart-1]),r&&gn(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=oa(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Kn?(gn(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(gn(e,!1),e.strm.avail_out===0)?1:2};function qo(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}let Ku=[new qo(0,0,0,0,MD),new qo(4,4,8,4,KT),new qo(4,5,16,8,KT),new qo(4,6,32,32,KT),new qo(4,4,16,16,zl),new qo(8,16,32,32,zl),new qo(8,16,128,128,zl),new qo(8,32,128,256,zl),new qo(32,128,258,1024,zl),new qo(32,258,258,4096,zl)];function Rq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gm,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Sq),this.dyn_dtree=new Uint16Array(2*(2*Eq+1)),this.bl_tree=new Uint16Array(2*(2*gq+1)),aa(this.dyn_ltree),aa(this.dyn_dtree),aa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Tq+1),this.heap=new Uint16Array(2*WT+1),aa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*WT+1),aa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let zu=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Hl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==fc&&t.status!==Wu?1:0},UD=e=>{if(zu(e))return Ec(e,zo);e.total_in=e.total_out=0,e.data_type=fq;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Hl:fc,e.adler=t.wrap===2?0:1,t.last_flush=-2,oq(t),pr},xD=e=>{let t=UD(e);return t===pr&&(i=>{i.window_size=2*i.w_size,aa(i.head),i.max_lazy_match=Ku[i.level].max_lazy,i.good_match=Ku[i.level].good_length,i.nice_match=Ku[i.level].nice_length,i.max_chain_length=Ku[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},VD=(e,t,i,r,n,o)=>{if(!e)return zo;let a=1;if(t===uq&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),n<1||n>9||i!==Gm||r<8||r>15||t<0||t>9||o<0||o>mq||r===8&&a!==1)return Ec(e,zo);r===8&&(r=9);let l=new Rq;return e.state=l,l.strm=e,l.status=Hl,l.wrap=a,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=o,l.method=i,xD(e)};var Cq=(e,t)=>{if(zu(e)||t>DD||t<0)return e?Ec(e,zo):zo;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===Wu&&t!==Kn)return Ec(e,e.avail_out===0?GT:zo);let r=i.last_flush;if(i.last_flush=t,i.pending!==0){if(En(e),e.avail_out===0)return i.last_flush=-1,pr}else if(e.avail_in===0&&kD(t)<=kD(r)&&t!==Kn)return Ec(e,GT);if(i.status===Wu&&e.avail_in!==0)return Ec(e,GT);if(i.status===Hl&&i.wrap===0&&(i.status=fc),i.status===Hl){let n=Gm+(i.w_bits-8<<4)<<8,o=-1;if(o=i.strategy>=Bm||i.level<2?0:i.level<6?1:i.level===6?2:3,n|=o<<6,i.strstart!==0&&(n|=32),n+=31-n%31,Hu(i,n),i.strstart!==0&&(Hu(i,e.adler>>>16),Hu(i,65535&e.adler)),e.adler=1,i.status=fc,En(e),i.pending!==0)return i.last_flush=-1,pr}if(i.status===57){if(e.adler=0,Gt(i,31),Gt(i,139),Gt(i,8),i.gzhead)Gt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gt(i,255&i.gzhead.time),Gt(i,i.gzhead.time>>8&255),Gt(i,i.gzhead.time>>16&255),Gt(i,i.gzhead.time>>24&255),Gt(i,i.level===9?2:i.strategy>=Bm||i.level<2?4:0),Gt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gt(i,255&i.gzhead.extra.length),Gt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=sr(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gt(i,0),Gt(i,0),Gt(i,0),Gt(i,0),Gt(i,0),Gt(i,i.level===9?2:i.strategy>=Bm||i.level<2?4:0),Gt(i,3),i.status=fc,En(e),i.pending!==0)return i.last_flush=-1,pr}if(i.status===69){if(i.gzhead.extra){let n=i.pending,o=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+o>i.pending_buf_size;){let l=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>n&&(e.adler=sr(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex+=l,En(e),i.pending!==0)return i.last_flush=-1,pr;n=0,o-=l}let a=new Uint8Array(i.gzhead.extra);i.pending_buf.set(a.subarray(i.gzindex,i.gzindex+o),i.pending),i.pending+=o,i.gzhead.hcrc&&i.pending>n&&(e.adler=sr(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let n,o=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>o&&(e.adler=sr(e.adler,i.pending_buf,i.pending-o,o)),En(e),i.pending!==0)return i.last_flush=-1,pr;o=0}n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gt(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>o&&(e.adler=sr(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let n,o=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>o&&(e.adler=sr(e.adler,i.pending_buf,i.pending-o,o)),En(e),i.pending!==0)return i.last_flush=-1,pr;o=0}n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gt(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>o&&(e.adler=sr(e.adler,i.pending_buf,i.pending-o,o))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(En(e),i.pending!==0))return i.last_flush=-1,pr;Gt(i,255&e.adler),Gt(i,e.adler>>8&255),e.adler=0}if(i.status=fc,En(e),i.pending!==0)return i.last_flush=-1,pr}if(e.avail_in!==0||i.lookahead!==0||t!==sa&&i.status!==Wu){let n=i.level===0?MD(i,t):i.strategy===Bm?((o,a)=>{let l;for(;;){if(o.lookahead===0&&(Kl(o),o.lookahead===0)){if(a===sa)return 1;break}if(o.match_length=0,l=oa(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,l&&(gn(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===Kn?(gn(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(gn(o,!1),o.strm.avail_out===0)?1:2})(i,t):i.strategy===pq?((o,a)=>{let l,d,u,p,m=o.window;for(;;){if(o.lookahead<=_c){if(Kl(o),o.lookahead<=_c&&a===sa)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(u=o.strstart-1,d=m[u],d===m[++u]&&d===m[++u]&&d===m[++u])){p=o.strstart+_c;do;while(d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&u<p);o.match_length=_c-(p-u),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(l=oa(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(l=oa(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),l&&(gn(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,a===Kn?(gn(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(gn(o,!1),o.strm.avail_out===0)?1:2})(i,t):Ku[i.level].func(i,t);if(n!==3&&n!==4||(i.status=Wu),n===1||n===3)return e.avail_out===0&&(i.last_flush=-1),pr;if(n===2&&(t===cq?aq(i):t!==DD&&(BT(i,0,0,!1),t===lq&&(aa(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),En(e),e.avail_out===0))return i.last_flush=-1,pr}return t!==Kn?pr:i.wrap<=0?PD:(i.wrap===2?(Gt(i,255&e.adler),Gt(i,e.adler>>8&255),Gt(i,e.adler>>16&255),Gt(i,e.adler>>24&255),Gt(i,255&e.total_in),Gt(i,e.total_in>>8&255),Gt(i,e.total_in>>16&255),Gt(i,e.total_in>>24&255)):(Hu(i,e.adler>>>16),Hu(i,65535&e.adler)),En(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?pr:PD)},yq=(e,t)=>{let i=t.length;if(zu(e))return zo;let r=e.state,n=r.wrap;if(n===2||n===1&&r.status!==Hl||r.lookahead)return zo;if(n===1&&(e.adler=Gu(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){n===0&&(aa(r.head),r.strstart=0,r.block_start=0,r.insert=0);let d=new Uint8Array(r.w_size);d.set(t.subarray(i-r.w_size,i),0),t=d,i=r.w_size}let o=e.avail_in,a=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Kl(r);r.lookahead>=3;){let d=r.strstart,u=r.lookahead-2;do r.ins_h=ca(r,r.ins_h,r.window[d+3-1]),r.prev[d&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=d,d++;while(--u);r.strstart=d,r.lookahead=2,Kl(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=l,e.avail_in=o,r.wrap=n,pr},Yu={deflateInit:(e,t)=>VD(e,t,Gm,15,8,_q),deflateInit2:VD,deflateReset:xD,deflateResetKeep:UD,deflateSetHeader:(e,t)=>zu(e)||e.state.wrap!==2?zo:(e.state.gzhead=t,pr),deflate:Cq,deflateEnd:e=>{if(zu(e))return zo;let t=e.state.status;return e.state=null,t===fc?Ec(e,dq):pr},deflateSetDictionary:yq,deflateInfo:"pako deflate (from Nodeca project)"};let Iq=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Wm={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let r in i)Iq(i,r)&&(e[r]=i[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;let i=new Uint8Array(t);for(let r=0,n=0,o=e.length;r<o;r++){let a=e[r];i.set(a,n),n+=a.length}return i}};let FD=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{FD=!1}let qu=new Uint8Array(256);for(let e=0;e<256;e++)qu[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;qu[254]=qu[254]=1;var Ju={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,r,n,o,a=e.length,l=0;for(n=0;n<a;n++)i=e.charCodeAt(n),(64512&i)==55296&&n+1<a&&(r=e.charCodeAt(n+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),n++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),o=0,n=0;o<l;n++)i=e.charCodeAt(n),(64512&i)==55296&&n+1<a&&(r=e.charCodeAt(n+1),(64512&r)==56320&&(i=65536+(i-55296<<10)+(r-56320),n++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},buf2string:(e,t)=>{let i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,n,o=new Array(2*i);for(n=0,r=0;r<i;){let a=e[r++];if(a<128){o[n++]=a;continue}let l=qu[a];if(l>4)o[n++]=65533,r+=l-1;else{for(a&=l===2?31:l===3?15:7;l>1&&r<i;)a=a<<6|63&e[r++],l--;l>1?o[n++]=65533:a<65536?o[n++]=a:(a-=65536,o[n++]=55296|a>>10&1023,o[n++]=56320|1023&a)}}return((a,l)=>{if(l<65534&&a.subarray&&FD)return String.fromCharCode.apply(null,a.length===l?a:a.subarray(0,l));let d="";for(let u=0;u<l;u++)d+=String.fromCharCode(a[u]);return d})(o,n)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+qu[e[i]]>t?i:t}},jD=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let BD=Object.prototype.toString,{Z_NO_FLUSH:wq,Z_SYNC_FLUSH:Aq,Z_FULL_FLUSH:Oq,Z_FINISH:bq,Z_OK:Hm,Z_STREAM_END:Nq,Z_DEFAULT_COMPRESSION:Dq,Z_DEFAULT_STRATEGY:Pq,Z_DEFLATED:kq}=Wl;function Xu(e){this.options=Wm.assign({level:Dq,method:kq,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pq},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jD,this.strm.avail_out=0;let i=Yu.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Hm)throw new Error(mc[i]);if(t.header&&Yu.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?Ju.string2buf(t.dictionary):BD.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=Yu.deflateSetDictionary(this.strm,r),i!==Hm)throw new Error(mc[i]);this._dict_set=!0}}function zT(e,t){let i=new Xu(t);if(i.push(e,!0),i.err)throw i.msg||mc[i.err];return i.result}Xu.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,n,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?bq:wq,typeof e=="string"?i.input=Ju.string2buf(e):BD.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(o===Aq||o===Oq)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=Yu.deflate(i,o),n===Nq)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Yu.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Hm;if(i.avail_out!==0){if(o>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},Xu.prototype.onData=function(e){this.chunks.push(e)},Xu.prototype.onEnd=function(e){e===Hm&&(this.result=Wm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lq={Deflate:Xu,deflate:zT,deflateRaw:function(e,t){return(t=t||{}).raw=!0,zT(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,zT(e,t)},constants:Wl};let Km=16209;var Mq=function(e,t){let i,r,n,o,a,l,d,u,p,m,f,E,I,T,R,w,O,P,M,V,F,q,J,Z,pe=e.state;i=e.next_in,J=e.input,r=i+(e.avail_in-5),n=e.next_out,Z=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),l=pe.dmax,d=pe.wsize,u=pe.whave,p=pe.wnext,m=pe.window,f=pe.hold,E=pe.bits,I=pe.lencode,T=pe.distcode,R=(1<<pe.lenbits)-1,w=(1<<pe.distbits)-1;e:do{E<15&&(f+=J[i++]<<E,E+=8,f+=J[i++]<<E,E+=8),O=I[f&R];t:for(;;){if(P=O>>>24,f>>>=P,E-=P,P=O>>>16&255,P===0)Z[n++]=65535&O;else{if(!(16&P)){if(!(64&P)){O=I[(65535&O)+(f&(1<<P)-1)];continue t}if(32&P){pe.mode=16191;break e}e.msg="invalid literal/length code",pe.mode=Km;break e}M=65535&O,P&=15,P&&(E<P&&(f+=J[i++]<<E,E+=8),M+=f&(1<<P)-1,f>>>=P,E-=P),E<15&&(f+=J[i++]<<E,E+=8,f+=J[i++]<<E,E+=8),O=T[f&w];i:for(;;){if(P=O>>>24,f>>>=P,E-=P,P=O>>>16&255,!(16&P)){if(!(64&P)){O=T[(65535&O)+(f&(1<<P)-1)];continue i}e.msg="invalid distance code",pe.mode=Km;break e}if(V=65535&O,P&=15,E<P&&(f+=J[i++]<<E,E+=8,E<P&&(f+=J[i++]<<E,E+=8)),V+=f&(1<<P)-1,V>l){e.msg="invalid distance too far back",pe.mode=Km;break e}if(f>>>=P,E-=P,P=n-o,V>P){if(P=V-P,P>u&&pe.sane){e.msg="invalid distance too far back",pe.mode=Km;break e}if(F=0,q=m,p===0){if(F+=d-P,P<M){M-=P;do Z[n++]=m[F++];while(--P);F=n-V,q=Z}}else if(p<P){if(F+=d+p-P,P-=p,P<M){M-=P;do Z[n++]=m[F++];while(--P);if(F=0,p<M){P=p,M-=P;do Z[n++]=m[F++];while(--P);F=n-V,q=Z}}}else if(F+=p-P,P<M){M-=P;do Z[n++]=m[F++];while(--P);F=n-V,q=Z}for(;M>2;)Z[n++]=q[F++],Z[n++]=q[F++],Z[n++]=q[F++],M-=3;M&&(Z[n++]=q[F++],M>1&&(Z[n++]=q[F++]))}else{F=n-V;do Z[n++]=Z[F++],Z[n++]=Z[F++],Z[n++]=Z[F++],M-=3;while(M>2);M&&(Z[n++]=Z[F++],M>1&&(Z[n++]=Z[F++]))}break}}break}}while(i<r&&n<a);M=E>>3,i-=M,E-=M<<3,f&=(1<<E)-1,e.next_in=i,e.next_out=n,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=n<a?a-n+257:257-(n-a),pe.hold=f,pe.bits=E};let zm=15,Uq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),xq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Vq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Fq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qu=(e,t,i,r,n,o,a,l)=>{let d=l.bits,u,p,m,f,E,I,T=0,R=0,w=0,O=0,P=0,M=0,V=0,F=0,q=0,J=0,Z=null,pe=new Uint16Array(16),ze=new Uint16Array(16),nt,Ct,$t,Mt=null;for(T=0;T<=zm;T++)pe[T]=0;for(R=0;R<r;R++)pe[t[i+R]]++;for(P=d,O=zm;O>=1&&pe[O]===0;O--);if(P>O&&(P=O),O===0)return n[o++]=20971520,n[o++]=20971520,l.bits=1,0;for(w=1;w<O&&pe[w]===0;w++);for(P<w&&(P=w),F=1,T=1;T<=zm;T++)if(F<<=1,F-=pe[T],F<0)return-1;if(F>0&&(e===0||O!==1))return-1;for(ze[1]=0,T=1;T<zm;T++)ze[T+1]=ze[T]+pe[T];for(R=0;R<r;R++)t[i+R]!==0&&(a[ze[t[i+R]]++]=R);if(e===0?(Z=Mt=a,I=20):e===1?(Z=Uq,Mt=xq,I=257):(Z=Vq,Mt=Fq,I=0),J=0,R=0,T=w,E=o,M=P,V=0,m=-1,q=1<<P,f=q-1,e===1&&q>852||e===2&&q>592)return 1;for(;;){nt=T-V,a[R]+1<I?(Ct=0,$t=a[R]):a[R]>=I?(Ct=Mt[a[R]-I],$t=Z[a[R]-I]):(Ct=96,$t=0),u=1<<T-V,p=1<<M,w=p;do p-=u,n[E+(J>>V)+p]=nt<<24|Ct<<16|$t|0;while(p!==0);for(u=1<<T-1;J&u;)u>>=1;if(u!==0?(J&=u-1,J+=u):J=0,R++,--pe[T]==0){if(T===O)break;T=t[i+a[R]]}if(T>P&&(J&f)!==m){for(V===0&&(V=P),E+=w,M=T-V,F=1<<M;M+V<O&&(F-=pe[M+V],!(F<=0));)M++,F<<=1;if(q+=1<<M,e===1&&q>852||e===2&&q>592)return 1;m=J&f,n[m]=P<<24|M<<16|E-o|0}}return J!==0&&(n[E+J]=T-V<<24|64<<16|0),l.bits=P,0};let{Z_FINISH:GD,Z_BLOCK:jq,Z_TREES:Ym,Z_OK:gc,Z_STREAM_END:Bq,Z_NEED_DICT:Gq,Z_STREAM_ERROR:zn,Z_DATA_ERROR:WD,Z_MEM_ERROR:HD,Z_BUF_ERROR:Wq,Z_DEFLATED:KD}=Wl,qm=16180,Jm=16190,Ts=16191,YT=16192,qT=16194,Xm=16199,Qm=16200,JT=16206,Ii=16209,zD=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Hq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Sc=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<qm||t.mode>16211?1:0},YD=e=>{if(Sc(e))return zn;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=qm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,gc},qD=e=>{if(Sc(e))return zn;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,YD(e)},JD=(e,t)=>{let i;if(Sc(e))return zn;let r=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?zn:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,qD(e))},XD=(e,t)=>{if(!e)return zn;let i=new Hq;e.state=i,i.strm=e,i.window=null,i.mode=qm;let r=JD(e,t);return r!==gc&&(e.state=null),r},XT,QT,QD=!0,Kq=e=>{if(QD){XT=new Int32Array(512),QT=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Qu(1,e.lens,0,288,XT,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Qu(2,e.lens,0,32,QT,0,e.work,{bits:5}),QD=!1}e.lencode=XT,e.lenbits=9,e.distcode=QT,e.distbits=5},ZD=(e,t,i,r)=>{let n,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(i-o.wsize,i),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>r&&(n=r),o.window.set(t.subarray(i-r,i-r+n),o.wnext),(r-=n)?(o.window.set(t.subarray(i-r,i),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};var zq=(e,t)=>{let i,r,n,o,a,l,d,u,p,m,f,E,I,T,R,w,O,P,M,V,F,q,J=0,Z=new Uint8Array(4),pe,ze,nt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Sc(e)||!e.output||!e.input&&e.avail_in!==0)return zn;i=e.state,i.mode===Ts&&(i.mode=YT),a=e.next_out,n=e.output,d=e.avail_out,o=e.next_in,r=e.input,l=e.avail_in,u=i.hold,p=i.bits,m=l,f=d,q=gc;e:for(;;)switch(i.mode){case qm:if(i.wrap===0){i.mode=YT;break}for(;p<16;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(2&i.wrap&&u===35615){i.wbits===0&&(i.wbits=15),i.check=0,Z[0]=255&u,Z[1]=u>>>8&255,i.check=sr(i.check,Z,2,0),u=0,p=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",i.mode=Ii;break}if((15&u)!==KD){e.msg="unknown compression method",i.mode=Ii;break}if(u>>>=4,p-=4,F=8+(15&u),i.wbits===0&&(i.wbits=F),F>15||F>i.wbits){e.msg="invalid window size",i.mode=Ii;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&u?16189:Ts,u=0,p=0;break;case 16181:for(;p<16;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(i.flags=u,(255&Xi(i))!==KD){e.msg="unknown compression method",i.mode=Ii;break}if(57344&Xi(i)){e.msg="unknown header flags set",i.mode=Ii;break}i.head&&(i.head.text=u>>8&1),512&Xi(i)&&4&i.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,i.check=sr(i.check,Z,2,0)),u=0,p=0,i.mode=16182;case 16182:for(;p<32;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.head&&(i.head.time=u),512&Xi(i)&&4&i.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,Z[2]=u>>>16&255,Z[3]=u>>>24&255,i.check=sr(i.check,Z,4,0)),u=0,p=0,i.mode=16183;case 16183:for(;p<16;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&Xi(i)&&4&i.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,i.check=sr(i.check,Z,2,0)),u=0,p=0,i.mode=16184;case 16184:if(1024&Xi(i)){for(;p<16;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.length=u,i.head&&(i.head.extra_len=u),512&Xi(i)&&4&i.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,i.check=sr(i.check,Z,2,0)),u=0,p=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Xi(i)&&(E=i.length,E>l&&(E=l),E&&(i.head&&(F=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(o,o+E),F)),512&Xi(i)&&4&i.wrap&&(i.check=sr(i.check,r,E,o)),l-=E,o+=E,i.length-=E),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Xi(i)){if(l===0)break e;E=0;do F=r[o+E++],i.head&&F&&i.length<65536&&(i.head.name+=String.fromCharCode(F));while(F&&E<l);if(512&Xi(i)&&4&i.wrap&&(i.check=sr(i.check,r,E,o)),l-=E,o+=E,F)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Xi(i)){if(l===0)break e;E=0;do F=r[o+E++],i.head&&F&&i.length<65536&&(i.head.comment+=String.fromCharCode(F));while(F&&E<l);if(512&Xi(i)&&4&i.wrap&&(i.check=sr(i.check,r,E,o)),l-=E,o+=E,F)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Xi(i)){for(;p<16;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(4&i.wrap&&u!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Ii;break}u=0,p=0}i.head&&(i.head.hcrc=Xi(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Ts;break;case 16189:for(;p<32;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}e.adler=i.check=zD(u),u=0,p=0,i.mode=Jm;case Jm:if(i.havedict===0)return e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=l,i.hold=u,i.bits=p,Gq;e.adler=i.check=1,i.mode=Ts;case Ts:if(t===jq||t===Ym)break e;case YT:if(i.last){u>>>=7&p,p-=7&p,i.mode=JT;break}for(;p<3;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}switch(i.last=1&u,u>>>=1,p-=1,3&u){case 0:i.mode=16193;break;case 1:if(Kq(i),i.mode=Xm,t===Ym){u>>>=2,p-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Ii}u>>>=2,p-=2;break;case 16193:for(u>>>=7&p,p-=7&p;p<32;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Ii;break}if(i.length=65535&u,u=0,p=0,i.mode=qT,t===Ym)break e;case qT:i.mode=16195;case 16195:if(E=i.length,E){if(E>l&&(E=l),E>d&&(E=d),E===0)break e;n.set(r.subarray(o,o+E),a),l-=E,o+=E,d-=E,a+=E,i.length-=E;break}i.mode=Ts;break;case 16196:for(;p<14;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(i.nlen=257+(31&u),u>>>=5,p-=5,i.ndist=1+(31&u),u>>>=5,p-=5,i.ncode=4+(15&u),u>>>=4,p-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Ii;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;p<3;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.lens[nt[i.have++]]=7&u,u>>>=3,p-=3}for(;i.have<19;)i.lens[nt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,pe={bits:i.lenbits},q=Qu(0,i.lens,0,19,i.lencode,0,i.work,pe),i.lenbits=pe.bits,q){e.msg="invalid code lengths set",i.mode=Ii;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;J=i.lencode[u&(1<<i.lenbits)-1],R=J>>>24,w=J>>>16&255,O=65535&J,!(R<=p);){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(O<16)u>>>=R,p-=R,i.lens[i.have++]=O;else{if(O===16){for(ze=R+2;p<ze;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(u>>>=R,p-=R,i.have===0){e.msg="invalid bit length repeat",i.mode=Ii;break}F=i.lens[i.have-1],E=3+(3&u),u>>>=2,p-=2}else if(O===17){for(ze=R+3;p<ze;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}u>>>=R,p-=R,F=0,E=3+(7&u),u>>>=3,p-=3}else{for(ze=R+7;p<ze;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}u>>>=R,p-=R,F=0,E=11+(127&u),u>>>=7,p-=7}if(i.have+E>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Ii;break}for(;E--;)i.lens[i.have++]=F}}if(i.mode===Ii)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Ii;break}if(i.lenbits=9,pe={bits:i.lenbits},q=Qu(1,i.lens,0,i.nlen,i.lencode,0,i.work,pe),i.lenbits=pe.bits,q){e.msg="invalid literal/lengths set",i.mode=Ii;break}if(i.distbits=6,i.distcode=i.distdyn,pe={bits:i.distbits},q=Qu(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,pe),i.distbits=pe.bits,q){e.msg="invalid distances set",i.mode=Ii;break}if(i.mode=Xm,t===Ym)break e;case Xm:i.mode=Qm;case Qm:if(l>=6&&d>=258){e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=l,i.hold=u,i.bits=p,Mq(e,f),a=e.next_out,n=e.output,d=e.avail_out,o=e.next_in,r=e.input,l=e.avail_in,u=i.hold,p=i.bits,i.mode===Ts&&(i.back=-1);break}for(i.back=0;J=i.lencode[u&(1<<i.lenbits)-1],R=J>>>24,w=J>>>16&255,O=65535&J,!(R<=p);){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(w&&!(240&w)){for(P=R,M=w,V=O;J=i.lencode[V+((u&(1<<P+M)-1)>>P)],R=J>>>24,w=J>>>16&255,O=65535&J,!(P+R<=p);){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}u>>>=P,p-=P,i.back+=P}if(u>>>=R,p-=R,i.back+=R,i.length=O,w===0){i.mode=16205;break}if(32&w){i.back=-1,i.mode=Ts;break}if(64&w){e.msg="invalid literal/length code",i.mode=Ii;break}i.extra=15&w,i.mode=16201;case 16201:if(i.extra){for(ze=i.extra;p<ze;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,p-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;J=i.distcode[u&(1<<i.distbits)-1],R=J>>>24,w=J>>>16&255,O=65535&J,!(R<=p);){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(!(240&w)){for(P=R,M=w,V=O;J=i.distcode[V+((u&(1<<P+M)-1)>>P)],R=J>>>24,w=J>>>16&255,O=65535&J,!(P+R<=p);){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}u>>>=P,p-=P,i.back+=P}if(u>>>=R,p-=R,i.back+=R,64&w){e.msg="invalid distance code",i.mode=Ii;break}i.offset=O,i.extra=15&w,i.mode=16203;case 16203:if(i.extra){for(ze=i.extra;p<ze;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,p-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Ii;break}i.mode=16204;case 16204:if(d===0)break e;if(E=f-d,i.offset>E){if(E=i.offset-E,E>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Ii;break}E>i.wnext?(E-=i.wnext,I=i.wsize-E):I=i.wnext-E,E>i.length&&(E=i.length),T=i.window}else T=n,I=a-i.offset,E=i.length;E>d&&(E=d),d-=E,i.length-=E;do n[a++]=T[I++];while(--E);i.length===0&&(i.mode=Qm);break;case 16205:if(d===0)break e;n[a++]=i.length,d--,i.mode=Qm;break;case JT:if(i.wrap){for(;p<32;){if(l===0)break e;l--,u|=r[o++]<<p,p+=8}if(f-=d,e.total_out+=f,i.total+=f,4&i.wrap&&f&&(e.adler=i.check=Xi(i)?sr(i.check,n,f,a-f):Gu(i.check,n,f,a-f)),f=d,4&i.wrap&&(Xi(i)?u:zD(u))!==i.check){e.msg="incorrect data check",i.mode=Ii;break}u=0,p=0}i.mode=16207;case 16207:if(i.wrap&&Xi(i)){for(;p<32;){if(l===0)break e;l--,u+=r[o++]<<p,p+=8}if(4&i.wrap&&u!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Ii;break}u=0,p=0}i.mode=16208;case 16208:q=Bq;break e;case Ii:q=WD;break e;case 16210:return HD;default:return zn}return e.next_out=a,e.avail_out=d,e.next_in=o,e.avail_in=l,i.hold=u,i.bits=p,(i.wsize||f!==e.avail_out&&i.mode<Ii&&(i.mode<JT||t!==GD))&&ZD(e,e.output,e.next_out,f-e.avail_out),m-=e.avail_in,f-=e.avail_out,e.total_in+=m,e.total_out+=f,i.total+=f,4&i.wrap&&f&&(e.adler=i.check=Xi(i)?sr(i.check,n,f,e.next_out-f):Gu(i.check,n,f,e.next_out-f)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Ts?128:0)+(i.mode===Xm||i.mode===qT?256:0),(m===0&&f===0||t===GD)&&q===gc&&(q=Wq),q},vs={inflateReset:qD,inflateReset2:JD,inflateResetKeep:YD,inflateInit:e=>XD(e,15),inflateInit2:XD,inflate:zq,inflateEnd:e=>{if(Sc(e))return zn;let t=e.state;return t.window&&(t.window=null),e.state=null,gc},inflateGetHeader:(e,t)=>{if(Sc(e))return zn;let i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,gc):zn},inflateSetDictionary:(e,t)=>{let i=t.length,r,n,o;return Sc(e)?zn:(r=e.state,r.wrap!==0&&r.mode!==Jm?zn:r.mode===Jm&&(n=1,n=Gu(n,t,i,0),n!==r.check)?WD:(o=ZD(e,t,i,i),o?(r.mode=16210,HD):(r.havedict=1,gc)))},inflateInfo:"pako inflate (from Nodeca project)"},Yq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let $D=Object.prototype.toString,{Z_NO_FLUSH:qq,Z_FINISH:Jq,Z_OK:Zu,Z_STREAM_END:ZT,Z_NEED_DICT:$T,Z_STREAM_ERROR:Xq,Z_DATA_ERROR:eP,Z_MEM_ERROR:Qq}=Wl;function $u(e){this.options=Wm.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jD,this.strm.avail_out=0;let i=vs.inflateInit2(this.strm,t.windowBits);if(i!==Zu)throw new Error(mc[i]);if(this.header=new Yq,vs.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Ju.string2buf(t.dictionary):$D.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=vs.inflateSetDictionary(this.strm,t.dictionary),i!==Zu)))throw new Error(mc[i])}function ev(e,t){let i=new $u(t);if(i.push(e),i.err)throw i.msg||mc[i.err];return i.result}$u.prototype.push=function(e,t){let i=this.strm,r=this.options.chunkSize,n=this.options.dictionary,o,a,l;if(this.ended)return!1;for(a=t===~~t?t:t===!0?Jq:qq,$D.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),o=vs.inflate(i,a),o===$T&&n&&(o=vs.inflateSetDictionary(i,n),o===Zu?o=vs.inflate(i,a):o===eP&&(o=$T));i.avail_in>0&&o===ZT&&i.state.wrap>0&&e[i.next_in]!==0;)vs.inflateReset(i),o=vs.inflate(i,a);switch(o){case Xq:case eP:case $T:case Qq:return this.onEnd(o),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(i.avail_out===0||o===ZT))if(this.options.to==="string"){let d=Ju.utf8border(i.output,i.next_out),u=i.next_out-d,p=Ju.buf2string(i.output,d);i.next_out=u,i.avail_out=r-u,u&&i.output.set(i.output.subarray(d,d+u),0),this.onData(p)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(o!==Zu||l!==0){if(o===ZT)return o=vs.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},$u.prototype.onData=function(e){this.chunks.push(e)},$u.prototype.onEnd=function(e){e===Zu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Wm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Zq={Inflate:$u,inflate:ev,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ev(e,t)},ungzip:ev,constants:Wl};let{Deflate:BQ,deflate:$q,deflateRaw:GQ,gzip:WQ}=Lq,{Inflate:HQ,inflate:e9,inflateRaw:KQ,ungzip:zQ}=Zq;var t9=$q,i9=e9;let Mi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ye(){return Mi}function tP(){return"setSinkId"in HTMLAudioElement.prototype&&(!N("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ys()||pb())&&!DS())}let Oi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Yl(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function Je(e,t,i,r,n){return{width:e,height:t,frameRate:i,bitrateMin:r,bitrateMax:n}}function Yn(e,t,i,r,n){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:r,bitrateMax:n}}function tv(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let r9={"90p":Je(160,90),"90p_1":Je(160,90),"120p":Je(160,120,15,30,65),"120p_1":Je(160,120,15,30,65),"120p_3":Je(120,120,15,30,50),"120p_4":Je(212,120),"180p":Je(320,180,15,30,140),"180p_1":Je(320,180,15,30,140),"180p_3":Je(180,180,15,30,100),"180p_4":Je(240,180,15,30,120),"240p":Je(320,240,15,40,200),"240p_1":Je(320,240,15,40,200),"240p_3":Je(240,240,15,40,140),"240p_4":Je(424,240,15,40,220),"360p":Je(640,360,15,80,400),"360p_1":Je(640,360,15,80,400),"360p_3":Je(360,360,15,80,260),"360p_4":Je(640,360,30,80,600),"360p_6":Je(360,360,30,80,400),"360p_7":Je(480,360,15,80,320),"360p_8":Je(480,360,30,80,490),"360p_9":Je(640,360,15,80,800),"360p_10":Je(640,360,24,80,800),"360p_11":Je(640,360,24,80,1e3),"480p":Je(640,480,15,100,500),"480p_1":Je(640,480,15,100,500),"480p_2":Je(640,480,30,100,1e3),"480p_3":Je(480,480,15,100,400),"480p_4":Je(640,480,30,100,750),"480p_6":Je(480,480,30,100,600),"480p_8":Je(848,480,15,100,610),"480p_9":Je(848,480,30,100,930),"480p_10":Je(640,480,10,100,400),"720p":Je(1280,720,15,120,1130),"720p_auto":Je(1280,720,30,900,3e3),"720p_1":Je(1280,720,15,120,1130),"720p_2":Je(1280,720,30,120,2e3),"720p_3":Je(1280,720,30,120,1710),"720p_5":Je(960,720,15,120,910),"720p_6":Je(960,720,30,120,1380),"1080p":Je(1920,1080,15,120,2080),"1080p_1":Je(1920,1080,15,120,2080),"1080p_2":Je(1920,1080,30,120,3e3),"1080p_3":Je(1920,1080,30,120,3150),"1080p_5":Je(1920,1080,60,120,4780),"1440p":Je(2560,1440,30,120,4850),"1440p_1":Je(2560,1440,30,120,4850),"1440p_2":Je(2560,1440,60,120,7350),"4k":Je(3840,2160,30,120,8910),"4k_1":Je(3840,2160,30,120,8910),"4k_3":Je(3840,2160,60,120,13500)},Zm=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],n9={"480p":Yn(640,480,5),"480p_1":Yn(640,480,5),"480p_2":Yn(640,480,30),"480p_3":Yn(640,480,15),"720p":Yn(1280,720,5),"720p_auto":Je(1280,720,30,900,3e3),"720p_1":Yn(1280,720,5),"720p_2":Yn(1280,720,30),"720p_3":Yn(1280,720,15),"1080p":Yn(1920,1080,5),"1080p_1":Yn(1920,1080,5),"1080p_2":Yn(1920,1080,30),"1080p_3":Yn(1920,1080,15)},o9={"1SL1TL":tv(1,1),"3SL3TL":tv(3,3),"2SL3TL":tv(2,3)};function Jo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},r9[e]):e}function iv(e){return typeof e=="string"?Object.assign({},n9[e]):e}function $m(e){return typeof e=="string"?Object.assign({},o9[e]):e}let s9={speech_low_quality:Yl(16e3,!1),speech_standard:Yl(32e3,!1,18),music_standard:Yl(48e3,!1),standard_stereo:Yl(48e3,!0,56),high_quality:Yl(48e3,!1,128),high_quality_stereo:Yl(48e3,!0,192)};function e_(e){return typeof e=="string"?Object.assign({},s9[e]):e}let ql=[];function iP(e){return li(e,"mediaSource",["screen","window","application"]),!0}let le=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Rt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Jl=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),a9=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),c9=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Tc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Xl=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ql=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Qr=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let rv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},nv={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},rP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},l9={uplinkNetworkQuality:0,downlinkNetworkQuality:0},nP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ar=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Zr=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),eh=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),vc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Qi=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Xo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),ov={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},t_=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function oP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function bt(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?oP(Object(i),!0).forEach(function(r){G(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function G(e,t,i){return(t=function(r){var n=function(o,a){if(typeof o!="object"||o===null)return o;var l=o[Symbol.toPrimitive];if(l!==void 0){var d=l.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof n=="symbol"?n:String(n)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function qe(e,t,i,r,n){var o,a,l={};return Object.keys(r).forEach(function(d){l[d]=r[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=ao(o=Kz(a=i.slice()).call(a)).call(o,function(d,u){return u(e,t,d)||d},l),n&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(n):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(e,t,l),l=null),l}class sP extends Ot{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Tc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,i){super(),G(this,"trackMediaType",void 0),G(this,"_ID",void 0),G(this,"_rtpTransceiver",void 0),G(this,"_lowRtpTransceiver",void 0),G(this,"_hints",[]),G(this,"_isClosed",!1),G(this,"_originMediaStreamTrack",void 0),G(this,"mediaStreamTrack",void 0),G(this,"_external",{}),this._ID=i||ft(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){se(ql).call(ql,r)||ql.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Js(()=>{var i;_e.reportApiInvoke(null,{name:ti.GET_MEDIA_STREAM_TRACK,options:[],tag:xt.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Jl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let i=ql.indexOf(t);i!==-1&&ql.splice(i,1)}(this),this.emit(Xl.CLOSED),this.removeAllListeners(Tc.SEI_RECEIVED)}_updateRtpTransceiver(t,i){if(i===Jl.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Tc.TRANSCEIVER_UPDATED,t,i)}}class Zl extends sP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,i){super(t,i),G(this,"_enabled",!0),G(this,"_muted",!1),G(this,"_isExternalTrack",!1),G(this,"_isClosed",!1),G(this,"_enabledMutex",void 0),G(this,"processor",void 0),G(this,"_processorContext",void 0),G(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new vi("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,i;return(t=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(le.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,i){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,le.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xl.TRACK_ENDED)}stateCheck(t,i){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(i,"]")),hs(i,t),this._enabled&&this._muted&&t==="enabled"&&i===!1)throw new B(A.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&t==="muted"&&i===!0)throw new B(A.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ne.resolve([])}}let aP=window.AudioContext||window.webkitAudioContext,$r=null,ut=new class extends Ot{constructor(){super(...arguments),G(this,"prevState",void 0),G(this,"curState",void 0),G(this,"currentTime",void 0),G(this,"currentTimeStuckAt",void 0),G(this,"interruptDetectorTrack",void 0),G(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(Oi.IOS_15_16_INTERRUPTION_START)}),G(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):($r&&await $r.suspend(),this.emit(Oi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){S.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){S.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function $l(){if(!$r){if(function(){if(!aP)return void S.error("your browser is not support web audio");S.info("create audio context");let e=bt({},N("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(e)),$r=new aP(e),ut.curState=$r.state,$r.onstatechange=()=>{ut.prevState=ut.curState,ut.curState=$r?$r.state:void 0;let{prevState:t,curState:i}=ut,r=i==="running",n=i==="interrupted",o=t==="running",a=t==="suspended",l=t==="interrupted",d=Xe().osVersion;(ji()||Mn())&&o&&n&&(S.info("ios".concat(d,"-interruption-start")),ut.emit(Oi.IOS_INTERRUPTION_START)),(ji()||Mn())&&(a||l)&&r&&(S.info("ios".concat(d,"-interruption-end")),ut.emit(Oi.IOS_INTERRUPTION_END)),t!==i&&ut.emit(Oi.STATE_CHANGE,i,t)},setInterval(()=>{var t;let i=(t=$r)===null||t===void 0?void 0:t.currentTime;ut.currentTime!==i?(ut.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(i)),ut.currentTimeStuckAt=void 0),ut.currentTime=i):(i!==ut.currentTimeStuckAt&&(_e.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:xt.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(i))),ut.currentTimeStuckAt=i)},5e3),async function(t){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,n=!1,o=!1,a=!1;function l(T){t.state==="running"?d(!1):ji()||Mn()?t.state==="suspended"&&(d(!0),T&&t.resume().then(u,u)):t.state!=="closed"&&(d(!0),T&&t.resume().then(u,u))}function d(T){if(n!==T){n=T;for(let R=0,w=i;R<w.length;R+=1){let O=w[R];T?window.addEventListener(O,p,{capture:!0,passive:!0}):window.removeEventListener(O,p,{capture:!0,passive:!0})}}}function u(){l(!1)}function p(){l(!0)}function m(T){if(!a)if(r.paused)if(T){let R;f(!1),a=!0;try{R=r.play(),R?R.then(E,E):(r.addEventListener("playing",E),r.addEventListener("abort",E),r.addEventListener("error",E))}catch{E()}}else f(!0);else f(!1)}function f(T){if(o!==T){o=T;for(let R=0,w=i;R<w.length;R++){let O=w[R];T?window.addEventListener(O,I,{capture:!0,passive:!0}):window.removeEventListener(O,I,{capture:!0,passive:!0})}}}function E(){r.removeEventListener("playing",E),r.removeEventListener("abort",E),r.removeEventListener("error",E),a=!1,m(!1)}function I(){m(!0)}if(ji()){let T=t.createMediaStreamDestination(),R=document.createElement("div");R.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=R.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=T.stream,m(!0)}ut.on(Oi.STATE_CHANGE,function(){l(!0)}),l(!1)}($r)}(),!$r)throw new B(A.NOT_SUPPORTED,"can not create audio context");return $r}return $r}function Rc(e){if(function(){if(sv!==null)return sv;let r=$l(),n=r.createBufferSource(),o=r.createGain(),a=r.createGain();n.connect(o),n.connect(a),n.disconnect(o);let l=!1;try{n.disconnect(o)}catch{l=!0}return n.disconnect(),sv=l,l}())return;let t=e.connect,i=e.disconnect;e.connect=(r,n,o)=>{var a;return e._inputNodes||(e._inputNodes=[]),se(a=e._inputNodes).call(a,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,n,o)):t.call(e,r,n)),e},e.disconnect=(r,n,o)=>{i.call(e),r?pm(e._inputNodes,r):e._inputNodes=[];for(let a of e._inputNodes)t.call(e,a)}}let sv=null;function av(e,t){let i=!1,r=1/t;if(N("DISABLE_WEBAUDIO")){let n=window.setInterval(()=>{i?window.clearInterval(n):e(performance.now()/1e3)},1e3*r)}else{let n=$l(),o=n.createGain();o.gain.value=0,o.connect(n.destination);let a=()=>{if(i)return void(o=null);let l=n.createOscillator();l.onended=a,l.connect(o),l.start(0),l.stop(n.currentTime+r),e(n.currentTime)};a()}return()=>{i=!0}}class cP{constructor(){G(this,"context",void 0),G(this,"analyserNode",void 0),G(this,"sourceNode",void 0),this.context=$l(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ji()||Mn()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let n=0;n<t.length;++n)t[n]=r[n]/128-1}let i=ao(t).call(t,(r,n)=>r+n*n,0)/t.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,i;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class lP extends Ot{get processSourceNode(){return this.sourceNode}set processedNode(t){var i;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),G(this,"outputNode",void 0),G(this,"outputTrack",void 0),G(this,"isPlayed",!1),G(this,"sourceNode",void 0),G(this,"context",void 0),G(this,"audioBufferNode",void 0),G(this,"destNode",void 0),G(this,"audioOutputLevel",0),G(this,"volumeLevelAnalyser",void 0),G(this,"_processedNode",void 0),G(this,"playNode",void 0),G(this,"isDestroyed",!1),G(this,"onNoAudioInput",void 0),G(this,"isNoAudioInput",!1),G(this,"_noAudioInputCount",0),this.context=$l(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Rc(this.outputNode),this.volumeLevelAnalyser=new cP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Qr.ON_AUDIO_BUFFER,function(r){for(let n=0;n<r.outputBuffer.numberOfChannels;n+=1){let o=r.outputBuffer.getChannelData(n);for(let a=0;a<o.length;a+=1)o[a]=0}return r.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ye().webAudioMediaStreamDest)throw new B(A.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&mm(()=>{ut.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ji()||Mn()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let i=this.volumeLevelAnalyser.getAnalyserNode(),r;i.getFloatTimeDomainData?(r=new Float32Array(i.fftSize),i.getFloatTimeDomainData(r)):(r=new Uint8Array(i.fftSize),i.getByteTimeDomainData(r));let n=!1;for(let o=0;o<r.length;o++)r[o]!==0&&(n=!0);return n?(this.isNoAudioInput=!1,!0):(await _i(200),await this.checkHasAudioInput(t?t+1:1)&&n)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,i;(t=this.processedNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class dP extends lP{get isFreeze(){return!1}constructor(t,i,r){var n;if(super(),G(this,"sourceNode",void 0),G(this,"track",void 0),G(this,"clonedTrack",void 0),G(this,"audioElement",void 0),G(this,"isCurrentTrackCloned",!1),G(this,"isRemoteTrack",!1),G(this,"originVolumeLevelAnalyser",void 0),G(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;let d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),Rc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),Rc(this.outputNode),this.emit(Qr.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new B(A.UNEXPECTED_ERROR);this.track=t;let o=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(o),Rc(this.sourceNode),r){let l=r.clone();l.enabled=!0,this.clonedTrack=l,S.debug("create an unmuted track ".concat(l.id," from the original track ").concat(r.id," to get the volume"));let d=this.context.createMediaStreamSource(new MediaStream([l]));Rc(d),this.originVolumeLevelAnalyser=new cP,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;let a=Xe();i&&a.os===pi.IOS&&Number((n=a.osVersion)===null||n===void 0?void 0:n.split(".")[0])<15&&(ut.on(Oi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let i=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(i),Rc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Qr.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),ut.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let i=t.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),S.debug("create an unmuted track ".concat(i.id," from the original track ").concat(t.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([i]));Rc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function uP(e,t,i){let r=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,n={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(n.video.mandatory.maxFrameRate=t.frameRate.max,n.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(n.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(n)}async function d9(e,t){let i=await hP(e.mediaSource),{sourceId:r,audio:n}=await function(o){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ne((l,d)=>{let u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");let f=document.createElement("div");f.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let E=document.createElement("div");E.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(w);let O=new Error("NotAllowedError");O.name="NotAllowedError",d(O)};let T=a,R=document.createElement("div");if(a){let O=document.createElement("input");O.setAttribute("type","checkbox");let P=document.createElement("span");O.setAttribute("style","margin-right: 6px;"),P.innerText="Share audio",O.checked=T,O.onchange=()=>{T=O.checked},R.appendChild(O),R.appendChild(P)}E.appendChild(R),E.appendChild(I),p.appendChild(m),p.appendChild(f),p.appendChild(E);let w=document.createElement("div");w.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),w.appendChild(u),w.appendChild(p),document.body.appendChild(w),o.map(O=>{if(O.id){let P=document.createElement("div");P.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let M=O.thumbnail;try{let{width:V}=M.getSize();V>1920&&(M=M.resize({width:1920}))}catch(V){throw V&&V.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),V}P.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+M.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+O.name.replace(/[\u00A0-\u9999<>\&]/g,function(V){return"&#"+V.charCodeAt(0)+";"})+"</span>",P.onclick=()=>{document.body.removeChild(w),l({sourceId:O.id,audio:T})},f.appendChild(P)}})})}(i,t);return await uP(r,e,n)}async function hP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let i=Nb();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new B(A.ELECTRON_IS_NULL);let r=null;try{var n;r=((n=i.desktopCapturer)===null||n===void 0?void 0:n.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ne((o,a)=>{i.desktopCapturer.getSources({types:t},(l,d)=>{l?a(l):o(d)})}));try{return await r}catch(o){throw new B(A.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}let cv=new vi("safari"),pP=!1,mP=!1;async function en(e,t){let i=0,r=null;for(;i<2;)try{r=await u9(e,t,i>0);break}catch(n){if(n instanceof B)throw S.error("[".concat(t,"] ").concat(n.toString())),n;let o=i_(n.name||n.code||n,n.message);if(o.code===A.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await _i(500);continue}throw S.error("[".concat(t,"] ").concat(o.toString())),o}if(!r)throw new B(A.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function u9(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new B(A.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=Ye(),n=new MediaStream;if(e.audioSource&&n.addTrack(e.audioSource),e.videoSource&&n.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return S.debug("Using Video Source/ Audio Source"),n;if(e.screen)if(Nb())e.screen.sourceId?ed(n,await uP(e.screen.sourceId,e.screen,e.screenAudio)):ed(n,await d9(e.screen,e.screenAudio));else if(Ys()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new B(A.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let f=await(a=e.screen.extensionId,l=t,new ne((E,I)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},T=>{if(!T||!T.streamId)return S.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),T),void I(new B(A.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));E(T.streamId)})}catch(T){S.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),T.toString()),I(new B(A.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=f,ed(n,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&iP(e.screen.mediaSource);let f={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:E,surfaceSwitching:I,systemAudio:T}=e.screen,R={selfBrowserSurface:E,surfaceSwitching:I,systemAudio:T};!E&&delete R.selfBrowserSurface,!I&&delete R.surfaceSwitching,!T&&delete R.systemAudio,S.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:f,audio:!!e.screenAudio,controls:R})),ed(n,await navigator.mediaDevices.getDisplayMedia(bt({video:f,audio:!!e.screenAudio},R)))}else{if(!mt())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new B(A.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&iP(e.screen.mediaSource);let f={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};S.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(f))),ed(n,await navigator.mediaDevices.getUserMedia(f))}}var a,l;if(!e.video&&!e.audio)return n;let d={video:e.video,audio:e.audio},u=N("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),d=US(d,u)}catch{}S.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(d)),Xe();let p,m=null;(mi()||ji()||um())&&(m=await cv.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(f){throw m&&m(),f}return d.audio&&(pP=!0),d.video&&(mP=!0),ed(n,p),m&&m(),n}function i_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new B(A.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new B(A.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new B(A.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new B(A.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new B(A.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new B(A.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return S.error("getUserMedia unexpected error",e),new B(A.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function ed(e,t){let i=e.getVideoTracks()[0],r=e.getAudioTracks()[0],n=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),n&&(i&&e.removeTrack(i),e.addTrack(n))}let tn=new class extends Ot{get state(){return this._state}set state(e){e!==this._state&&(this.emit(vc.STATE_CHANGE,e),this._state=e)}constructor(){super(),G(this,"_state",eh.IDLE),G(this,"isAccessMicrophonePermission",!1),G(this,"isAccessCameraPermission",!1),G(this,"lastAccessMicrophonePermission",!1),G(this,"lastAccessCameraPermission",!1),G(this,"checkdeviceMatched",!1),G(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(N("ENUMERATE_DEVICES_INTERVAL")||(hm()||dm()===pi.HARMONY_OS)&&qs())&&this.updateDevicesInfo()},N("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>S.error(e.toString()))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new B(A.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let r=await navigator.mediaDevices.enumerateDevices(),n=this.checkMediaDeviceInfoIsOk(r),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;n.audio&&(o=!1),n.video&&(a=!1);let l=null,d=null,u=null;if(!i&&(o||a)){if(cv.isLocked&&(S.debug("[device manager] wait GUM lock"),(await cv.lock())(),S.debug("[device manager] GUM unlock")),pP&&(o=!1,this.isAccessMicrophonePermission=!0),mP&&(a=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){let m=i_(p.name||p.code||p,p.message);if(m.code===A.PERMISSION_DENIED)throw m;S.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){let m=i_(p.name||p.code||p,p.message);if(m.code===A.PERMISSION_DENIED)throw m;S.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(a){try{d=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){let m=i_(p.name||p.code||p,p.message);if(m.code===A.PERMISSION_DENIED)throw m;S.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",e,"cam permission",t)}try{let p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),l=null,d=null,u=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),l=null,d=null,u=null,new B(A.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(t=i.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!t)throw new B(A.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=eh.INITING;try{await this.updateDevicesInfo(),this.state=eh.INITEND}catch(e){throw S.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=eh.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new B(A.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let n=e.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),o=e.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");n&&o?o.groupId===n.groupId?S.debug("[device-check] default input ".concat(n.label," and output ").concat(o.label," is the same group")):S.warning("[device-check] default input ".concat(n.label," and output ").concat(o.label," is not the same group")):S.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(n=>{if(!n.deviceId)return;let o=this.deviceInfoMap.get("".concat(n.kind,"_").concat(n.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){let a={initAt:t,updateAt:t,device:n,state:"ACTIVE"};this.deviceInfoMap.set("".concat(n.kind,"_").concat(n.deviceId),a),i.push(a)}o&&(o.updateAt=t)}),this.deviceInfoMap.forEach((n,o)=>{n.state==="ACTIVE"&&n.updateAt!==t&&(n.state="INACTIVE",i.push(n))}),this.state!==eh.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(n=>{switch(n.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vc.RECORDING_DEVICE_CHANGED,n);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(vc.CAMERA_DEVICE_CHANGED,n);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(vc.PLAYOUT_DEVICE_CHANGED,n)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(n=>n.kind==="audioinput"),i=e.filter(n=>n.kind==="videoinput"),r={audio:!1,video:!1};for(let n of t)if(n.label&&n.deviceId){r.audio=!0;break}for(let n of i)if(n.label&&n.deviceId){r.video=!0;break}return r}},lv=!1,rn=new class extends Ot{constructor(){super(...arguments),G(this,"onAutoplayFailed",void 0),G(this,"onAudioAutoplayFailed",void 0)}};function _P(){if(Xe(),!lv){let e=t=>{t.preventDefault(),lv=!1,gu()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};lv=!0,gu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),rn.onAutoplayFailed?rn.onAutoplayFailed():rn.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),rn.emit("autoplay-failed")}}function fP(e,t,i,r){if(!e)return;let n=_e.getBaseInfoBySessionId(e);if(!n)return;let o=n.info,a=Date.now(),l=bt(bt({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:a,elapse:a-n.startTime,cbRegistered:rn.onAutoplayFailed||rn.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:r,extend:void 0});_e.send({type:kt.AUTOPLAY_FAILED,data:l},!0)}let h9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mr=new class{constructor(){G(this,"onAutoplayFailed",void 0),G(this,"elementMap",new Map),G(this,"elementStateMap",new Map),G(this,"elementsNeedToResume",[]),G(this,"sinkIdMap",new Map),G(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[i,r]=t,n=this.elementStateMap.get(i),o=r.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(S.debug("resume after interrupted, ele: ".concat(n," audio: ").concat(a," ").concat(e)),a==="live"){if(e)return r.pause(),void r.play();if(ut.curState==="running")return Cl()?(r.pause(),void r.play()):void(n&&n==="paused"&&r.play())}})}),G(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,r=i.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),ut.on(Oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.on(Oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ut.on(Oi.STATE_CHANGE,()=>{ji()&&ut.prevState==="suspended"&&ut.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(r){throw new B(A.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,i,r){if(this.elementMap.has(t))return;let n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,n),this.elementMap.set(t,n),this.elementStateMap.set(t,Qi.INIT),this.setVolume(t,i);let o=this.sinkIdMap.get(t);if(o)try{n.setSinkId(o).catch(l=>{S.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){S.warning("[".concat(t,"] set sink id failed"),l.toString())}let a=n.play();a&&a.then&&a.catch(l=>{r&&fP(r,"audio",l.message,t),S.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),mm(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_P()}))})}updateTrack(e,t){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){h9.forEach(i=>{t.addEventListener(i,r=>{let n=this.elementStateMap.get(e),o=r.type==="pause"?"paused":r.type;if(S.debug("[".concat(e,"] audio-element-status change ").concat(n," => ").concat(o)),r.type==="error"){let a=t==null?void 0:t.error;a&&S.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(i=>{S.debug("Auto resume audio element success")}).catch(i=>{S.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ne(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{gu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function zt(){return function(e,t,i){let r=i.value;return typeof r=="function"&&(i.value=function(){this._isClosed&&new B(A.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];let l=r.apply(this,o);return l instanceof ne?new ne((d,u)=>{l.then(d).catch(u)}):l}),i}}class EP extends Ot{constructor(t){super(),G(this,"name","VideoProcessorDestination"),G(this,"ID","0"),G(this,"_source",void 0),G(this,"videoContext",void 0),G(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new B(A.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new B(A.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ar.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ar.ON_TRACK,void 0)}}class gP extends Ot{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i){super(),G(this,"constraintsMap",new Map),G(this,"statsRegistry",[]),G(this,"usageRegistry",[]),G(this,"trackId",void 0),G(this,"direction",void 0),G(this,"_chained",!1),this.trackId=t,this.direction=i}async getConstraints(){return await ii(this,Zr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,i){var r;return S.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),_t(this,Zr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return S.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),_t(this,Zr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){let r=this.statsRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:r,type:n,cb:o}of this.statsRegistry)try{let a=o();t.push({processorID:i,processorName:r,type:n,stats:a})}catch(a){S.error(new B(A.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,i){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let r=i();r instanceof ne&&(r=await r),t.push(bt(bt({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class SP extends Ot{constructor(t){super(),G(this,"name","AudioProcessorDestination"),G(this,"ID","0"),G(this,"inputTrack",void 0),G(this,"inputNode",void 0),G(this,"audioProcessorContext",void 0),G(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new B(A.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new B(A.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ar.ON_TRACK,void 0),this.emit(ar.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ar.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ar.ON_NODE,this.inputNode))}}class TP extends Ot{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i,r){super(),G(this,"constraintsMap",new Map),G(this,"statsRegistry",[]),G(this,"audioContext",void 0),G(this,"trackId",void 0),G(this,"direction",void 0),G(this,"usageRegistry",[]),G(this,"_chained",!1),this.audioContext=t,this.trackId=i,this.direction=r}async getConstraints(){return ii(this,Zr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,i){var r;return S.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),_t(this,Zr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),_t(this,Zr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ho(i=this.constraintsMap).call(i)))}registerStats(t,i,r){this.statsRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:r})}unregisterStats(t,i){let r=this.statsRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===i);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:r,type:n,cb:o}of this.statsRegistry)try{let a=o();t.push({processorID:i,processorName:r,type:n,stats:a})}catch(a){S.error(new B(A.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,i){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let r=i();r instanceof ne&&(r=await r),t.push(bt(bt({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class dv extends Ot{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),G(this,"context",void 0),G(this,"processSourceNode",void 0),G(this,"outputTrack",void 0),G(this,"processedNode",void 0),G(this,"clonedTrack",void 0),G(this,"outputNode",void 0),this.outputNode=new p9}setVolume(){}createOutputTrack(){throw new B(A.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class p9{disconnect(){}connect(){}}function vP(e){return new ne((t,i)=>{let r=!1,n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.muted=!0,n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(n);let o=ji()?"canplay":"playing";n.addEventListener(o,()=>{let a=n.videoWidth,l=n.videoHeight;!a&&mt()||(r=!0,n.srcObject=null,n.remove(),t([a,l]))}),n.srcObject=new MediaStream([e]),n.play().catch(_m),setTimeout(()=>{r||(n.srcObject=null,n.remove(),t([n.videoWidth,n.videoHeight]))},4e3)})}function r_(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let i=Jo(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!Cb()&&i.frameRate&&(t.frameRate=i.frameRate),pb()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),mt()&&(t.frameRate={ideal:30,max:30}),t}function RP(e){let t={};if(Cb()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Ys()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let i=e_(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),hm()&&(t.sampleRate=void 0),t}let m9=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:i,width:r,height:n}=e.getMediaStreamTrackSettings(),{frameRate:o=i,width:a=r,height:l=n}=t;if(!o||!a||!l)return;a=xS(a),l=xS(l),o=xS(o);let{max:d,min:u}=function(E,I,T){let R=200*Math.pow(T/15,.6)*Math.pow(E*I/640/360,.75);return{min:Math.floor(R),max:Math.floor(4*R)}}(a,l,o),{bitrateMax:p,bitrateMin:m}=t||{};p||S.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(l,", fps: ").concat(o,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));let{maxFramerate:f}=N("ENCODER_CONFIG_LIMIT");return f&&typeof f=="number"&&(o=Math.min(o,f)),{frameRate:o,bitrateMax:p||d,bitrateMin:m||u,scaleResolutionDownBy:1,scale:0}},CP=async(e,t,i)=>await(async(r,n,o)=>{let a=function(u){let p=[];for(let m=0;m<u.length;m+=2)p.push(parseInt(u.slice(m,m+2),16));return Uint8Array.from(p)}(Gb(""+n+o)).slice(0,16),l=a.slice(0,12),d=await window.crypto.subtle.importKey("raw",a,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,r))})(e.buffer,t,i),uv=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new ne((i,r)=>{t.toBlob(async n=>{if(t.remove(),n){let o=await yP(n);i({buffer:o,width:t.width,height:t.height})}else r(new B(A.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},yP=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var IP,wP,AP,OP,bP,NP,DP,PP,kP,LP,MP,UP,xP,VP,FP,jP,BP,GP,Lt,WP,HP,KP,zP,YP,qP,Qo,JP,XP,QP,ZP,$P,ek,tk,ik,rk,nk,ok,sk,ak,Ui;let jt=(IP=ye({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wP=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),AP=zt(),OP=wl("LocalAudioTrack","_enabledMutex"),bP=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),NP=zt(),DP=wl("LocalAudioTrack","_enabledMutex"),PP=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),kP=zt(),LP=zt(),MP=zt(),UP=ye({argsMap:e=>[e.getTrackId()]}),xP=zt(),VP=ye({argsMap:e=>[e.getTrackId()]}),FP=zt(),jP=ye({argsMap:e=>[e.getTrackId()]}),BP=ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),GP=ye({argsMap:e=>[e.getTrackId()]}),qe((Lt=class extends Zl{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,r){super(e,i),G(this,"trackMediaType","audio"),G(this,"_encoderConfig",void 0),G(this,"_trackSource",void 0),G(this,"_enabled",!0),G(this,"_volume",100),G(this,"_useAudioElement",!0),G(this,"_bypassWebAudio",!1),G(this,"processor",void 0),G(this,"_processorContext",void 0),G(this,"_processorDestination",void 0),G(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new dv,N("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),N("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),mi()&&!$r?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){ht(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&mr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,_t(this,le.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!tP())throw new B(A.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await _t(this,le.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw i||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await _t(this,le.NEED_DISABLE_TRACK,this)}catch(r){throw i||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await _t(this,le.NEED_MUTE_TRACK,this):await _t(this,le.NEED_UNMUTE_TRACK,this))}getStats(){return Js(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ur(this,le.GET_STATS)||bt({},rv)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qr.ON_AUDIO_BUFFER),this._source.on(Qr.ON_AUDIO_BUFFER,i=>e(i))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,le.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ne.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new B(A.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new B(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ar.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await _t(this,le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,le.NEED_REPLACE_TRACK,this))}),e.on(ar.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ar.ON_TRACK),e.removeAllListeners(ar.ON_NODE)}bindProcessorContextEvents(e){e.on(Zr.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Zr.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof dv&&(this._trackSource=new dP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new TP(this._source.context,this.getTrackId(),"local"),t=new SP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Qr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(mr.stop(this.getTrackId()),this._source.play()),_t(this,le.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[IP],Object.getOwnPropertyDescriptor(Lt.prototype,"setVolume"),Lt.prototype),qe(Lt.prototype,"setPlaybackDevice",[wP,AP],Object.getOwnPropertyDescriptor(Lt.prototype,"setPlaybackDevice"),Lt.prototype),qe(Lt.prototype,"setEnabled",[OP,bP,NP],Object.getOwnPropertyDescriptor(Lt.prototype,"setEnabled"),Lt.prototype),qe(Lt.prototype,"setMuted",[DP,PP,kP],Object.getOwnPropertyDescriptor(Lt.prototype,"setMuted"),Lt.prototype),qe(Lt.prototype,"getStats",[LP],Object.getOwnPropertyDescriptor(Lt.prototype,"getStats"),Lt.prototype),qe(Lt.prototype,"setAudioFrameCallback",[MP],Object.getOwnPropertyDescriptor(Lt.prototype,"setAudioFrameCallback"),Lt.prototype),qe(Lt.prototype,"play",[UP,xP],Object.getOwnPropertyDescriptor(Lt.prototype,"play"),Lt.prototype),qe(Lt.prototype,"stop",[VP,FP],Object.getOwnPropertyDescriptor(Lt.prototype,"stop"),Lt.prototype),qe(Lt.prototype,"close",[jP],Object.getOwnPropertyDescriptor(Lt.prototype,"close"),Lt.prototype),qe(Lt.prototype,"pipe",[BP],Object.getOwnPropertyDescriptor(Lt.prototype,"pipe"),Lt.prototype),qe(Lt.prototype,"unpipe",[GP],Object.getOwnPropertyDescriptor(Lt.prototype,"unpipe"),Lt.prototype),Lt),n_=(WP=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),HP=zt(),KP=wl("MicrophoneAudioTrack","_enabledMutex"),zP=ye({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),YP=zt(),qP=ye({argsMap:e=>[e.getTrackId()]}),qe((Qo=class extends jt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,r){super(e,t.encoderConfig?e_(t.encoderConfig):{},r,N("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),G(this,"_config",void 0),G(this,"_deviceName","default"),G(this,"_constraints",void 0),G(this,"_originalConstraints",void 0),G(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Cl()||NS())&&ut.bindInterruptDetectorTrack(this)}async setDevice(e){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await tn.getDeviceById(e),i={};i.audio=bt({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await en(i,this.getTrackId())}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),n.toString()),r=await en({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await tn.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}S.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),N("AUTO_RESET_AUDIO_ROUTE")&&(ji()||Mn())){let a=navigator.audioSession;a&&(e||(a.type="playback"),a.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),i||(this._enabled=!1);try{await _t(this,le.NEED_DISABLE_TRACK,this)}catch(a){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}let n=bt({},this._constraints),o=tn.searchDeviceIdByName(this._deviceName);o&&!n.deviceId&&(n.deviceId=o);try{i||(this._enabled=!0);let a=await en({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),await _t(this,le.NEED_ENABLE_TRACK,this)}catch(a){throw i||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Cl()||NS())&&ut.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ji()||Mn())&&this._enabled&&!this._isClosed&&ut.duringInterruption){let e=async()=>{ut.off(Oi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ut.on(Oi.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xl.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=tn.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let r=await en({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Zr.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),i()}catch(n){r(n)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Zr.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[WP,HP],Object.getOwnPropertyDescriptor(Qo.prototype,"setDevice"),Qo.prototype),qe(Qo.prototype,"setEnabled",[KP,zP,YP],Object.getOwnPropertyDescriptor(Qo.prototype,"setEnabled"),Qo.prototype),qe(Qo.prototype,"close",[qP],Object.getOwnPropertyDescriptor(Qo.prototype,"close"),Qo.prototype),Qo),_9=(JP=ye({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),XP=zt(),QP=ye({argsMap:e=>[e.getTrackId()]}),ZP=zt(),$P=ye({argsMap:e=>[e.getTrackId()]}),ek=zt(),tk=ye({argsMap:e=>[e.getTrackId()]}),ik=zt(),rk=ye({argsMap:e=>[e.getTrackId()]}),nk=zt(),ok=ye({argsMap:e=>[e.getTrackId()]}),sk=ye({argsMap:e=>[e.getTrackId()]}),ak=zt(),qe((Ui=class extends jt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,r){super(t.createOutputTrack(),i,r),G(this,"source",void 0),G(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Qr.AUDIO_SOURCE_STATE_CHANGE,n=>{this.safeEmit(Xl.SOURCE_STATE_CHANGE,n)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ht(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[JP,XP],Object.getOwnPropertyDescriptor(Ui.prototype,"startProcessAudioBuffer"),Ui.prototype),qe(Ui.prototype,"pauseProcessAudioBuffer",[QP,ZP],Object.getOwnPropertyDescriptor(Ui.prototype,"pauseProcessAudioBuffer"),Ui.prototype),qe(Ui.prototype,"seekAudioBuffer",[$P,ek],Object.getOwnPropertyDescriptor(Ui.prototype,"seekAudioBuffer"),Ui.prototype),qe(Ui.prototype,"resumeProcessAudioBuffer",[tk,ik],Object.getOwnPropertyDescriptor(Ui.prototype,"resumeProcessAudioBuffer"),Ui.prototype),qe(Ui.prototype,"stopProcessAudioBuffer",[rk,nk],Object.getOwnPropertyDescriptor(Ui.prototype,"stopProcessAudioBuffer"),Ui.prototype),qe(Ui.prototype,"close",[ok],Object.getOwnPropertyDescriptor(Ui.prototype,"close"),Ui.prototype),qe(Ui.prototype,"setAudioBufferPlaybackSpeed",[sk,ak],Object.getOwnPropertyDescriptor(Ui.prototype,"setAudioBufferPlaybackSpeed"),Ui.prototype),Ui);class ci extends jt{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=$l().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ft(8,"track-mix-")),G(this,"trackList",void 0),G(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}pm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(i=>{i instanceof ci?i.emit(Tc.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)}))}}class f9 extends lP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Qr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),G(this,"audioBuffer",void 0),G(this,"sourceNode",void 0),G(this,"startPlayTime",0),G(this,"startPlayOffset",0),G(this,"pausePlayTime",0),G(this,"options",void 0),G(this,"currentLoopCount",0),G(this,"currentPlaybackSpeed",100),G(this,"_currentState","stopped"),this.audioBuffer=t,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let ck=new Map;class hv{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let t=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var i;t!==this._videoState&&(this._videoState=t,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(t){G(this,"trackId",void 0),G(this,"config",void 0),G(this,"onFirstVideoFrameDecoded",void 0),G(this,"onVideoStateChanged",void 0),G(this,"freezeTimeCounterList",[]),G(this,"renderFreezeAccTime",0),G(this,"isKeepLastFrame",!1),G(this,"timeUpdatedCount",0),G(this,"freezeTime",0),G(this,"playbackTime",0),G(this,"lastTimeUpdatedTime",0),G(this,"autoplayFailed",!1),G(this,"videoTrack",void 0),G(this,"videoElement",void 0),G(this,"cacheVideoElement",void 0),G(this,"renderStats",void 0),G(this,"_videoState",Xo.VideoStateStopped),G(this,"videoElementCheckInterval",void 0),G(this,"videoElementFreezeTimeout",void 0),G(this,"_videoElementStatus",Qi.NONE),G(this,"isGettingVideoDimensions",!1),G(this,"startGetVideoDimensions",()=>{let i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),G(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ut.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(hb())),vb()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),G(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qi.PLAYING;break;case"loadeddata":if(this.videoState=Xo.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qi.CANPLAY;break;case"stalled":this.videoElementStatus=Qi.STALLED;break;case"suspend":this.videoElementStatus=Qi.SUSPEND;break;case"pause":this.videoElementStatus=Qi.PAUSED,ji()||Mn()||mi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qi.WAITING;break;case"abort":this.videoElementStatus=Qi.ABORT;break;case"ended":this.videoElementStatus=Qi.ENDED;break;case"emptied":this.videoElementStatus=Qi.EMPTIED;break;case"error":{let r=this.videoElement.error;r?(this.videoElementStatus=Qi.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):S.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let n=r-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Rs.lastVisibleTime<Rs.lastHiddenTime||o<Rs.lastHiddenTime||o<Rs.lastVisibleTime)return;for(n>N("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=n),this.playbackTime+=n;this.playbackTime>=6e3;){this.playbackTime-=6e3;let a=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(a),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),G(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(hb())),vb()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),ut.on(Oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.on(Oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let i=this.videoElement.play();i&&i.catch&&i.catch(n=>{t&&fP(t,"video",n.message,this.trackId),n.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",n),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),n)});let r=Xe();if((r.name==="Safari"&&Number(r.version)===15||Cl())&&i&&i.then){let n=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(n).catch(n)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let i=t.getContext("2d");if(!i)return S.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let n=r.getContext("2d");return n?(n.drawImage(this.videoElement,0,0,r.width,r.height),new ne((o,a)=>{r.toBlob(async l=>{if(r.remove(),l){let d=await yP(l);o({buffer:d,width:r.width,height:r.height})}else a(new B(A.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,i<0?.1:i>1?1:i)})):await uv(t)}destroy(){this.renderStats=void 0,ut.off(Oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.off(Oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Xo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qi.INIT,!this.videoElementCheckInterval&&(lk.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=Qi.DESTROYED)},1e3),N("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,i;let o,a=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",a),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Xo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Xo.VideoStateFrozen:document.addEventListener("visibilitychange",a))},d=(u,p)=>{if(this.videoElementStatus===Qi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},o){let E=p.presentationTime-o.presentationTime;this.videoState===Xo.VideoStateStarting&&(this.videoState=Xo.VideoStateDecoding),this.videoState===Xo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION"))),E<N("VIDEO_FREEZE_DURATION")&&this.videoState===Xo.VideoStateFrozen&&(this.videoState=Xo.VideoStateDecoding),E>N("VIDEO_FREEZE_DURATION")&&Rs.lastVisibleTime>=Rs.lastHiddenTime&&o.timestamp>Rs.lastVisibleTime&&o.timestamp>Rs.lastHiddenTime&&(this.renderFreezeAccTime+=E)}o=bt(bt({},p),{},{timestamp:u})}var m,f;N("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(f=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(f,d))};(t=(i=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(i,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),hm()&&!N("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=Xe();r.name==="Safari"&&Number(r.version)===15||Cl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mt()&&this.videoElement.load());let n=this.videoElement.play();n!==void 0&&n.catch(o=>{S.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){lk.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qi.NONE}handleAutoPlayFailed(){let t=i=>{i.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{S.error(r)}),this.autoplayFailed=!1,gu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};gu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),_P()}}let lk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class dk extends hv{constructor(t){super(t),G(this,"container",void 0),G(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let i=t.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var i;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await uv(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",N("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var uk,hk,pk,mk,_k,fk,Ek,gk,Sk,Tk,vk,Rk,Ck,yk,Ik,wk,Ak,Ok,bk,Nk,Dk,Pk,kk,Lk,Mk,Ke,Uk,xk,Vk,Fk,jk,Bk,Gk,Wk,nn;let Et=(uk=ye({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),hk=zt(),pk=ye({argsMap:e=>[e.getTrackId()]}),mk=wl("LocalVideoTrack","_enabledMutex"),_k=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),fk=zt(),Ek=wl("LocalVideoTrack","_enabledMutex"),gk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),Sk=zt(),Tk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),vk=zt(),Rk=zt(),Ck=ye({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),yk=zt(),Ik=zt(),wk=zt(),Ak=zt(),Ok=zt(),bk=zt(),Nk=zt(),Dk=ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Pk=ye({argsMap:e=>[e.getTrackId()]}),kk=ye({argsMap:e=>[e.getTrackId()]}),Lk=ye({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),Mk=ye(),Ke=class dV extends Zl{get videoHeight(){if(mi()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(mi()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,r,n,o,a){if(super(t,o),G(this,"trackMediaType","video"),G(this,"_player",void 0),G(this,"isUseScaleResolutionDownBy",!1),G(this,"_videoVisibleTimer",null),G(this,"_statsTimer",null),G(this,"_previousVideoVisibleStatus",void 0),G(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),G(this,"_encoderConfig",void 0),G(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),G(this,"_optimizationMode",void 0),G(this,"_videoHeight",void 0),G(this,"_videoWidth",void 0),G(this,"_forceBitrateLimit",void 0),G(this,"_enabled",!0),G(this,"_processorDestination",void 0),G(this,"_processorContext",void 0),mi()){let{width:l,height:d}=t.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=r,this._optimizationMode=n,this._hints=a||[],this._hints.indexOf(Rt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(l,d,u){let p=Xe();return!(p.name!==l||!p.osVersion)&&Number(p.version)===d}(ot.CHROME,115)&&dm().indexOf("Windows")!==-1){let l=function(d,u){if("VideoFrame"in window&&"TransformStream"in window&&Ye().supportWebRTCInsertableStream){let p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"}),f,E,I=Date.now(),T=()=>{R&&(clearInterval(R),R=void 0),f&&(f.close(),f=void 0),d.stop(),E=void 0,m.removeEventListener("ended",T)},R=window.setInterval(()=>{if(E&&f&&Date.now()-I>1e3)try{m.readyState==="live"?E.enqueue(f.clone()):T()}catch{T()}},1e3),w=new TransformStream({transform:(O,P)=>{m.readyState==="live"?(E=P,I=Date.now(),f===void 0?(f=O,P.enqueue(O.clone())):(P.enqueue(f),f=O)):O.close()}});return m.addEventListener("ended",T),p.readable.pipeThrough(w).pipeTo(m.writable),m}}(t);l&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}i&&this._hints.indexOf(Rt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new gP(this.getTrackId(),"local"),this._processorDestination=new EP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let n=document.getElementById(t);n?t=n:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let r=bt(bt(bt({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new hv(r):this._player=new dk(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(Xl.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await _t(this,le.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return i||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await _t(this,le.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await _t(this,le.NEED_MUTE_TRACK,this):await _t(this,le.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,i){if(!this._enabled)throw new B(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=Jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let r=r_({encoderConfig:t});(mi()||ji()||Mn())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(n){let o=new B(A.UNEXPECTED_ERROR,n.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(S)}}getStats(){return Js(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ur(this,le.GET_STATS)||bt({},nv)}async setBeautyEffect(t){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await uv(t)}async setBitrateLimit(t){if(S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await _t(this,le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(A.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=t,await _t(this,le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=i,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(A.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){vP(this._originMediaStreamTrack).then(t=>{let[i,r]=t;this._videoHeight=r,this._videoWidth=i}).catch(_m)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new B(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:i,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!i||!r)return;let{bitrateMax:n,bitrateMin:o}=this._encoderConfig;if(o==null||n==null){let{max:a,min:l}=function(d,u,p,m,f){let E=N("BITRATE_ADAPTER_TYPE");if(E==="DEFAULT_BITRATE")return{min:m,max:f};if(f===void 0){var I;let R=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*u/640/360,.75));f=E==="STANDARD_BITRATE"?4*R:2*R,m=(I=m)!==null&&I!==void 0?I:R}else{var T;m=(T=m)!==null&&T!==void 0?T:Math.floor(f/10)}return{min:m,max:f}}(t,i,r,o,n);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=a,S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(r,"] => [brMax: ").concat(a,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var t,i;let r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),n={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:o,slot:a}=n;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){let l=Ob.checkOneElementVisible(o),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;let u=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(r){throw new B(A.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new B(A.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=bt(bt({},r),Jo(t))),r=oc(r);let n=ft(8,"track-video-cloned-"),o=new dV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,oc(this._scalabilityMode),this._optimizationMode,n,oc(this._hints));return t&&r&&o.setEncoderConfiguration(r),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(i)),o}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new B(A.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new B(A.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!mi()&&!ji())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,i=Zm[t],r=-1,n=Date.now(),o=a=>{a>2||a<0||(n=Date.now(),i=Zm[a],this.setSenderConfiguration(i))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{let a=this.getStats(),l=Ur(this,le.GET_RTC_STATS);if(a.sendPackets>0&&l){r===-1&&(r=Date.now());let d=Date.now();if(d-r<1e3||d-n<N("PROFILE_SWITCH_INTERVAL"))return;let u=a.sendFrameRate,p=.6*i.frameRate,m=.9*i.frameRate;typeof u=="number"&&u>0&&u<p?t>0&&(t--,o(t),S.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(u,", switchProfile to ").concat(t))):l.OutgoingAvailableBandwidth<i.bitrateMin?t>0&&(t--,o(t),S.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", bitrateMin ").concat(i.bitrateMin,", switchProfile to ").concat(t))):typeof u=="number"&&u>m&&t<Zm.length-1&&l.OutgoingAvailableBandwidth>1.2*Zm[t+1].bitrateMin&&(t++,o(t),S.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(u,", OutgoingAvailableBandwidth ").concat(l.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},N("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(t){if(Js(()=>{_e.reportApiInvoke(null,{name:ti.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!N("ENABLE_VIDEO_SEI")||!N("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new B(A.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void S.warning("Video track is not published, SEI can not be send");let r=i.sender.getParameters();if(r.codecs.length===0)return;let n=r.codecs[0].mimeType.toLocaleLowerCase();n==="video/h264"?this.safeEmit("sei-to-send",t):S.warning("SEI is not supported by ".concat(n))}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await _t(this,le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _t(this,le.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Zr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Zr.REQUEST_CONSTRAINTS)}},qe(Ke.prototype,"play",[uk,hk],Object.getOwnPropertyDescriptor(Ke.prototype,"play"),Ke.prototype),qe(Ke.prototype,"stop",[pk],Object.getOwnPropertyDescriptor(Ke.prototype,"stop"),Ke.prototype),qe(Ke.prototype,"setEnabled",[mk,_k,fk],Object.getOwnPropertyDescriptor(Ke.prototype,"setEnabled"),Ke.prototype),qe(Ke.prototype,"setMuted",[Ek,gk,Sk],Object.getOwnPropertyDescriptor(Ke.prototype,"setMuted"),Ke.prototype),qe(Ke.prototype,"setEncoderConfiguration",[Tk,vk],Object.getOwnPropertyDescriptor(Ke.prototype,"setEncoderConfiguration"),Ke.prototype),qe(Ke.prototype,"getStats",[Rk],Object.getOwnPropertyDescriptor(Ke.prototype,"getStats"),Ke.prototype),qe(Ke.prototype,"setBeautyEffect",[Ck,yk],Object.getOwnPropertyDescriptor(Ke.prototype,"setBeautyEffect"),Ke.prototype),qe(Ke.prototype,"getCurrentFrameData",[Ik],Object.getOwnPropertyDescriptor(Ke.prototype,"getCurrentFrameData"),Ke.prototype),qe(Ke.prototype,"getCurrentFrameImage",[wk],Object.getOwnPropertyDescriptor(Ke.prototype,"getCurrentFrameImage"),Ke.prototype),qe(Ke.prototype,"setBitrateLimit",[Ak],Object.getOwnPropertyDescriptor(Ke.prototype,"setBitrateLimit"),Ke.prototype),qe(Ke.prototype,"setOptimizationMode",[Ok],Object.getOwnPropertyDescriptor(Ke.prototype,"setOptimizationMode"),Ke.prototype),qe(Ke.prototype,"setScalabiltyMode",[bk],Object.getOwnPropertyDescriptor(Ke.prototype,"setScalabiltyMode"),Ke.prototype),qe(Ke.prototype,"updateMediaStreamTrackResolution",[Nk],Object.getOwnPropertyDescriptor(Ke.prototype,"updateMediaStreamTrackResolution"),Ke.prototype),qe(Ke.prototype,"pipe",[Dk],Object.getOwnPropertyDescriptor(Ke.prototype,"pipe"),Ke.prototype),qe(Ke.prototype,"unpipe",[Pk],Object.getOwnPropertyDescriptor(Ke.prototype,"unpipe"),Ke.prototype),qe(Ke.prototype,"close",[kk],Object.getOwnPropertyDescriptor(Ke.prototype,"close"),Ke.prototype),qe(Ke.prototype,"replaceTrack",[Lk],Object.getOwnPropertyDescriptor(Ke.prototype,"replaceTrack"),Ke.prototype),qe(Ke.prototype,"startMonitorStats",[Mk],Object.getOwnPropertyDescriptor(Ke.prototype,"startMonitorStats"),Ke.prototype),Ke),pv=(Uk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),xk=zt(),Vk=wl("CameraVideoTrack","_enabledMutex"),Fk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),jk=zt(),Bk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),Gk=zt(),Wk=ye({argsMap:e=>[e.getTrackId()]}),nn=class uV extends Et{get __className__(){return"CameraVideoTrack"}constructor(t,i,r,n,o,a){super(t,Jo(i.encoderConfig),n,o,a),G(this,"_config",void 0),G(this,"_originalConstraints",void 0),G(this,"_constraints",void 0),G(this,"_enabled",!0),G(this,"_deviceName","default"),G(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Cl()||NS())&&!function(){let l=Xe();if(l.os!==pi.IOS||!l.osVersion)return!1;let d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&Rb()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Jo(this._config.encoderConfig),ut.on(Oi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ut.on(Oi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let i=await tn.getDeviceById(t),r={};r.video=bt({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let n=null;try{n=await en(r,this.getTrackId())}catch(o){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),n=await en({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await tn.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let i={video:bt(bt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await en(i,this.getTrackId())}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),n.toString()),r=await en({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=bt({},i.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let r=await en({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await _t(this,le.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await _t(this,le.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new B(A.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=Jo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let r=vt(this._config);r.encoderConfig=t;let n=r_(r);(mi()||ji()||Mn())&&(n.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(o){let a=new B(A.UNEXPECTED_ERROR,o.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=r,this._constraints=n,this._originalConstraints=n,this._encoderConfig=t,this._hints.indexOf(Rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _t(this,le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ji()||Mn())&&this._enabled&&!this._isClosed&&ut.duringInterruption){let t=async()=>{ut.off(Oi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ut.on(Oi.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xl.TRACK_ENDED)}async renewMediaStreamTrack(t){let i=t||this._constraints,r=tn.searchDeviceIdByName(this._deviceName);if(r&&!i.deviceId&&(i.deviceId={exact:r}),this._enabled){let n=await en({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ut.off(Oi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ut.off(Oi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=bt(bt({},r),Jo(t))),r=oc(r);let n=ft(8,"track-cam-cloned-"),o=new uV(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,oc(bt(bt({},this._config),{},{encoderConfig:r})),oc(this._constraints),oc(this._scalabilityMode),this._optimizationMode,n);return t&&r&&o.setEncoderConfiguration(r),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(i)),o}bindProcessorContextEvents(){this.processorContext.on(Zr.REQUEST_UPDATE_CONSTRAINTS,async(t,i,r)=>{try{let n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),i()}catch(n){r(n)}}),this.processorContext.on(Zr.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},qe(nn.prototype,"setDevice",[Uk,xk],Object.getOwnPropertyDescriptor(nn.prototype,"setDevice"),nn.prototype),qe(nn.prototype,"setEnabled",[Vk,Fk,jk],Object.getOwnPropertyDescriptor(nn.prototype,"setEnabled"),nn.prototype),qe(nn.prototype,"setEncoderConfiguration",[Bk,Gk],Object.getOwnPropertyDescriptor(nn.prototype,"setEncoderConfiguration"),nn.prototype),qe(nn.prototype,"close",[Wk],Object.getOwnPropertyDescriptor(nn.prototype,"close"),nn.prototype),nn);function mv(e,t,i,r){i.optimizationMode&&(r&&r.width&&r.height?(i.encoderConfig=bt(bt({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?S.debug("[".concat(e,"] set content hint to"),i.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Hk,Kk,zk,Yk,Sn,qk,Jk,Xk,Qk,Zk,$k,Zi;class eL extends sP{getUserId(){return this._userId}constructor(t,i,r,n){super(t,"track-".concat(t.kind,"-").concat(i,"-").concat(n.clientId,"_").concat(ft(5,""))),G(this,"_userId",void 0),G(this,"_uintId",void 0),G(this,"_isDestroyed",!1),G(this,"store",void 0),G(this,"processor",void 0),G(this,"processorContext",void 0),this._userId=i,this._uintId=r,this.store=n}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let td=(Hk=ye({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Kk=ye({argsMap:e=>[e.getTrackId()]}),zk=ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Yk=ye({argsMap:e=>[e.getTrackId()]}),qe((Sn=class extends eL{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,r){super(e,t,i,r),G(this,"_videoVisibleTimer",null),G(this,"_previousVideoVisibleStatus",void 0),G(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),G(this,"trackMediaType","video"),G(this,"_videoWidth",void 0),G(this,"_videoHeight",void 0),G(this,"_player",void 0),G(this,"processorDestination",void 0),G(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new gP(this.getTrackId(),"remote"),this.processorDestination=new EP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Js(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ur(this,le.GET_STATS)||bt({},nP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let r=document.getElementById(e);r?e=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=bt(bt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new hv(i):this._player=new dk(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ql.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(Ql.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(Ql.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){vP(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(_m)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:n,slot:o}=r;if(this.isPlaying&&n instanceof HTMLVideoElement&&o instanceof HTMLElement){let a=Ob.checkOneElementVisible(n),l=Object.assign({},a);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;let d=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(i){throw new B(A.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new B(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Tc.SEI_RECEIVED,e)}}).prototype,"play",[Hk],Object.getOwnPropertyDescriptor(Sn.prototype,"play"),Sn.prototype),qe(Sn.prototype,"stop",[Kk],Object.getOwnPropertyDescriptor(Sn.prototype,"stop"),Sn.prototype),qe(Sn.prototype,"pipe",[zk],Object.getOwnPropertyDescriptor(Sn.prototype,"pipe"),Sn.prototype),qe(Sn.prototype,"unpipe",[Yk],Object.getOwnPropertyDescriptor(Sn.prototype,"unpipe"),Sn.prototype),Sn),id=(qk=ye({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Jk=ye({argsMap:(e,t)=>[e.getTrackId(),t]}),Xk=ye({argsMap:e=>[e.getTrackId()]}),Qk=ye({argsMap:e=>[e.getTrackId()]}),Zk=ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),$k=ye({argsMap:e=>[e.getTrackId()]}),qe((Zi=class extends eL{get isPlaying(){return this._useAudioElement?mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,r){super(e,t,i,r),G(this,"trackMediaType","audio"),G(this,"_source",void 0),G(this,"_useAudioElement",!0),G(this,"_volume",100),G(this,"processorContext",void 0),G(this,"processorDestination",void 0),G(this,"_played",!1),G(this,"_bypassWebAudio",!1),N("DISABLE_WEBAUDIO")?(this._source=new dv,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new dP(e,!0),N("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Qr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ql.FIRST_FRAME_DECODED)}),this.processorContext=new TP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new SP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Qr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qr.ON_AUDIO_BUFFER),this._source.on(Qr.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?mr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!tP())throw new B(A.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Js(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ur(this,le.GET_STATS)||bt({},rP)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new B(A.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new B(A.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new B(A.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ar.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK),this.processorDestination.removeAllListeners(ar.ON_NODE)}}).prototype,"setVolume",[qk],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),qe(Zi.prototype,"setPlaybackDevice",[Jk],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),qe(Zi.prototype,"play",[Xk],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),qe(Zi.prototype,"stop",[Qk],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),qe(Zi.prototype,"pipe",[Zk],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),qe(Zi.prototype,"unpipe",[$k],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi),Rs=new class extends Ot{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),G(this,"_lastHiddenTime",0),G(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var tL=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(tL||{});class E9{constructor(){G(this,"_sequence",0),G(this,"_startTime",Date.now()),G(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let l=new Uint8Array(4);l.set([1,0,0,0]);let d={id:0,length:4,data:l.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};i.commonPacketHeader.extension=1,i.extension=u,i.payload=this.compress(t),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;N("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));let r=new ArrayBuffer(i.commonPacketHeader.length),n=new Uint8Array(r),o=new DataView(r),a=0;if(o.setUint16(a,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),a+=2,o.setUint32(a,i.commonPacketHeader.sequence,!0),a+=4,o.setUint16(a,i.commonStreamHeader,!0),a+=2,i.extension){let l=this.serializeExtension(i.extension);n.set(new Uint8Array(l),a),a+=l.byteLength}if(n.set(new Uint8Array(i.payload),a),a+=i.payload.byteLength,a!==i.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let i=new DataView(t),r=0,n=i.getUint16(r,!0);r+=2;let o={length:16383&n,reserved:(16384&n)>>14,extension:(32768&n)>>15,sequence:i.getUint16(r+2,!0)<<16|i.getUint16(r,!0)},a,l;if(r+=4,N("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(o))),i.getUint16(r,!0),r+=2,o.extension){l=this.deserializeExtension(t.slice(r)),r+=2+l.length,a=t.slice(r);let d=!1;if(l.datas.length>0){let u=l.datas.find(p=>p.id===0);u&&(d=(1&new DataView(u.data).getUint32(0,!0))==1)}a=d?this.decompress(a):a}else a=t.slice(8);return a}serializeExtension(t){let{profile:i,length:r,datas:n}=t,o=new ArrayBuffer(r+2),a=new Uint8Array(o),l=new DataView(o),d=0;if(l.setUint8(d++,i),l.setUint8(d++,r),n.forEach(u=>{i?(l.setUint8(d++,u.id),l.setUint8(d++,u.length),a.set(new Uint8Array(u.data),d),d+=u.data.byteLength):(l.setUint8(d++,u.id|u.length<<4),a.set(new Uint8Array(u.data),d),d+=u.data.byteLength)}),d!==r+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(r+2));return o}deserializeExtension(t){let i=new DataView(t),r=0,n=i.getUint8(r);r++;let o=i.getUint8(r);r++;let a=n===tL.TWO_BYTE,l=[],d=new DataView(t,2),u=0;for(;u<o;){let p=0,m=0,f=new ArrayBuffer(0);a?(p=d.getUint8(u),u++,m=d.getUint8(u),u++):(p=15&d.getUint8(u),m=d.getUint8(u)>>4,u++),m>0&&(f=d.buffer.slice(u+2,u+2+m),u+=f.byteLength),l.push({id:p,length:m,data:f})}if(u!==o)throw Error("parse error");return{profile:n,length:o,datas:l}}decompress(t){return i9(new Uint8Array(t))}compress(t){return t9(new Uint8Array(t))}}class iL extends Ot{constructor(t,i){super(),G(this,"_version",1),G(this,"_type",3),G(this,"_config",void 0),G(this,"_originDataChannel",void 0),G(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),G(this,"_dataStreamPacketHandler",void 0),G(this,"_datachannelEventMap",new Map),this._config=t,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader(),this._dataStreamPacketHandler=new E9}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return N("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ne((t,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let r=setTimeout(()=>{var n;i(new B(A.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((n=this._originDataChannel)===null||n===void 0?void 0:n.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new B(A.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new B(A.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[t_.OPEN,t_.CLOSE,t_.ERROR].forEach(i=>{let r=()=>{this.emit(i)};this._datachannelEventMap.set(i,r),t.addEventListener(i,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[r,n]=i;t.removeEventListener(r,n)}),this._datachannelEventMap.clear()}}class g9 extends iL{constructor(t){super(t),G(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=i.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(r).getUint8(3);if(n!==this.id)return void(N("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let o=i.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(t_.MESSAGE,o)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class rL extends iL{send(t){if(this._originDataChannel){let i=t;i=this._dataStreamPacketHandler.serialize(t);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function o_(){let e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>pD.revokeObjectURL(e),0),new Worker(pD.createObjectURL(e))}let s_=new Map,a_=new Map,c_=new Map;async function S9(e,t){if(!Ye().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(c_.has(e)||!e.track)return;let i={track:e.track};if(Ys()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(l){return void S.error("create video-encoded-streams error",l&&l.message)}let o=[];t.on("sei-to-send",l=>{o.push(l)});let a=new TransformStream({transform(l,d){i.controller||(i.controller=d),e.track&&e.track.id!==i.track.id&&(S.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let u=o.shift();u&&(l.data=function(p,m){let f=function(O){let P=O.length,M=[],V=0;for(;V<P;)V+2<P&&O[V]===0&&O[V+1]===0&&(O[V+2]===0||O[V+2]===1||O[V+2]===2||O[V+2]===3)?(M.push(O[V],O[V+1],3,O[V+2]),V+=3):(M.push(O[V]),V++);return new Uint8Array(M)}(m),E=f.length,I=Math.floor(E/255),T=E%255,R=new Uint8Array(6+I+1+E+p.byteLength);R[0]=0,R[1]=0,R[2]=0,R[3]=1,R[4]=6,R[5]=101;let w=0;for(;w<I;)R[6+w]=255,w++;return R[6+w]=T,w++,R.set(f,6+w),R.set(new Uint8Array(p),6+w+E),R.buffer}(l.data,u)),d.enqueue(l)}});n.readable.pipeThrough(a).pipeTo(n.writable)}else{if(!mi())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let n=o_(),o=new MessageChannel;await new ne(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let a=new RTCRtpScriptTransform(n,{name:"tx",port:o.port2},[o.port2]);e.transform=a,await new ne(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{o.port1.postMessage({sei:l})}),o.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id&&(S.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r))},i.worker=n}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let n=c_.get(e);if(n){c_.delete(e);try{var o,a;(o=n.controller)===null||o===void 0||o.terminate(),(a=n.worker)===null||a===void 0||a.terminate()}catch(l){S.warning(l&&l.message)}}}c_.set(e,i),e.track.addEventListener("ended",r)}let th=new Map;async function T9(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ye().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!e.track)return;if(th.has(e)){let n=th.get(e);return void(n&&(n.onSei=t.onSei))}let i={track:e.track,onSei:t.onSei};if(Ys()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(a){return void S.error("create video-encoded-streams error",a&&a.message)}let o=new TransformStream({transform(a,l){i.controller||(i.controller=l),e.track&&e.track.id!==i.track.id&&(S.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r));let d=function(u){let p=new DataView(u.data);if(p.getUint8(0)===0&&p.getUint8(1)===0&&p.getUint8(2)===0&&p.getUint8(3)===1&&p.getUint8(4)===6){let m=6,f=0,E=0;for(;(E=p.getUint8(m++))===255;)f+=255;f+=E;let I=function(T,R,w){let O=new Uint8Array(T,R,w),P=[],M=0;for(;M<w;)M+3<w&&O[M]===0&&O[M+1]===0&&O[M+2]===3&&(O[M+3]===0||O[M+3]===1||O[M+3]===2||O[M+3]===3)?(P.push(O[M],O[M+1],O[M+3]),M+=4):(P.push(O[M]),M++);return new Uint8Array(P)}(u.data,m,f);return new Uint8Array(I)}return null}(a);d&&i.onSei&&i.onSei(d),l.enqueue(a)}});n.readable.pipeThrough(o).pipeTo(n.writable)}else if(mi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let n=o_(),o=new MessageChannel;await new ne(l=>n.onmessage=d=>{d.data==="registered"&&l(void 0)});let a=new RTCRtpScriptTransform(n,{name:"rx",port:o.port2},[o.port2]);e.transform=a,await new ne(l=>n.onmessage=d=>{d.data==="started"&&l(void 0)}),o.port1.onmessage=l=>{var d;l.data.transformed&&e.track&&((d=e.track)===null||d===void 0?void 0:d.id)!==i.track.id?(S.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",r),i.track=e.track,i.track.addEventListener("ended",r)):l.data.sei&&i.onSei&&i.onSei(l.data.sei)},i.worker=n}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(n){let o=th.get(n);if(o){th.delete(n);try{var a,l;(a=o.controller)===null||a===void 0||a.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(d){S.warning(d&&d.message)}}})(e)}th.set(e,i),e.track.addEventListener("ended",r)}(function(){let e=Xe();Mi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Mi.getStreamFromExtension=e.name===ot.CHROME&&Number(e.version)>34,Mi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i}(),Mi.supportMinBitrate=e.name===ot.CHROME||e.name===ot.EDGE,Mi.supportSetRtpSenderParameters=function(){let t=Xe();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!qs()||!(!mi()&&!um())||t.name===ot.FIREFOX&&Number(t.version)>=64)}(),e.name===ot.SAFARI&&(Number(e.version)>=14?Mi.supportDualStream=!0:Mi.supportDualStream=!1),Mi.webAudioMediaStreamDest=function(){let t=Xe();return!(t.name===ot.SAFARI&&Number(t.version)<12)}(),Mi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Mi.supportWebGL=typeof WebGLRenderingContext<"u",Mi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,qs()||(Mi.webAudioWithAEC=!0),Mi.supportShareAudio=function(){let t=Xe();return(t.os===pi.WIN_10||t.os===pi.WIN_81||t.os===pi.WIN_7||t.os===pi.LINUX||t.os===pi.MAC_OS||t.os===pi.CHROMIUM_OS)&&t.name===ot.CHROME&&Number(t.version)>=74}(),Mi.supportDataChannel=!!(bS(76)||function(t){let i=Xe();return!(i.name!==ot.FIREFOX||!i.osVersion)&&Number(i.version)>=t}(68)||_b(14)),Mi.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!mt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Mi.supportWebRTCEncodedTransform=function(){let t=Xe();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Mi.supportWebRTCInsertableStream=function(){let t=Xe();return(t.name===ot.CHROME||t.name===ot.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Mi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Mi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,mm(()=>{Mi.supportDualStreamEncoding=function(){let t=Xe();return!!N("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&N("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.info("browser compatibility",JSON.stringify(Mi),JSON.stringify(e))})})();class v9 extends Ot{constructor(){super(...arguments),y(this,"resultStorage",new Map)}setLocalAudioStats(t,i,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,i))}setLocalVideoStats(t,i,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,i)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,i)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,i){let r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(i))}setRemoteVideoStats(t,i){let r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(i))}record(t,i,r){if(N("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let n=this.resultStorage.get(t);if(n&&(n.result.push(r),n.result.length>=5)){var o;let a=se(o=n.result).call(o,!0);n.isPrevNormal&&!a&&this.emit("exception",nL[t],t,i),!n.isPrevNormal&&a&&this.emit("exception",nL[t]+2e3,t+"_RECOVER",i),n.isPrevNormal=a,n.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,i){return i instanceof ci&&!i.isActive||!!i.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,i){let r=null;i._encoderConfig&&i._encoderConfig.frameRate&&(r=Cr(i._encoderConfig.frameRate));let n=t.captureFrameRate;return!r||!n||!(r>10&&n<5||r<10&&r>=5&&n<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,i){return!!i.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,i){return i instanceof ci&&!i.isActive||!!i.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let nL={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Gi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){let r=i[i.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function _v(e,t){this.v=e,this.k=t}function xe(e){return new _v(e,0)}var R9=W0,C9=Uo;Tt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=C9.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var y9=Uo,I9=ll;Tt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=y9.f(this),i=I9(e);return(i.error?t.reject:t.resolve)(i.value),t.promise}});var fv=g(R9),oL=ml.f("asyncIterator"),w9=g(oL);function ih(e){var t,i;function r(o,a){try{var l=e[o](a),d=l.value,u=d instanceof _v;fv.resolve(u?d.v:d).then(function(p){if(u){var m=o==="return"?"return":"next";if(!d.k||p.done)return r(m,p);p=e[m](p).value}n(l.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){n("throw",p)}}function n(o,a){switch(o){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(o,a){return new fv(function(l,d){var u={key:o,arg:a,resolve:l,reject:d,next:null};i?i=i.next=u:(t=i=u,r(o,a))})},typeof e.return!="function"&&(this.return=void 0)}function Vr(e){return function(){return new ih(e.apply(this,arguments))}}ih.prototype[typeof El=="function"&&w9||"@@asyncIterator"]=function(){return this},ih.prototype.next=function(e){return this._invoke("next",e)},ih.prototype.throw=function(e){return this._invoke("throw",e)},ih.prototype.return=function(e){return this._invoke("return",e)};var sL=g(so.Object.getOwnPropertySymbols),A9=Tt,O9=fE.indexOf,b9=lp,Ev=et([].indexOf),aL=!!Ev&&1/Ev([1],1,-0)<0;A9({target:"Array",proto:!0,forced:aL||!b9("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return aL?Ev(this,e,t)||0:O9(this,e,t)}});var N9=Pn("Array").indexOf,D9=Q,P9=N9,gv=Array.prototype,k9=function(e){var t=e.indexOf;return e===gv||D9(gv,e)&&t===gv.indexOf?P9:t},cL=g(k9);function L9(e,t){if(e==null)return{};var i,r,n=function(a,l){if(a==null)return{};var d,u,p={},m=$b(a);for(u=0;u<m.length;u++)d=m[u],cL(l).call(l,d)>=0||(p[d]=a[d]);return p}(e,t);if(sL){var o=sL(e);for(r=0;r<o.length;r++)i=o[r],cL(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var lL={exports:{}};(function(e,t){e.exports=(()=>{var i={8:(o,a,l)=>{l.r(a),l.d(a,{Parser:()=>ze,Printer:()=>$n,parse:()=>ke,print:()=>it});let d=`
`,u="".concat("\r").concat(d),p=" ",m;function f(oe){return oe>="0"&&oe<="9"}function E(oe){return oe>="!"&&oe<="~"}function I(oe){return E(oe)||oe>=""&&oe<="ÿ"}function T(oe){return oe==="!"||oe>="#"&&oe<="'"||oe>="*"&&oe<="+"||oe>="-"&&oe<="."||oe>="0"&&oe<="9"||oe>="A"&&oe<="Z"||oe>="^"&&oe<="~"}function R(oe){return oe>="1"&&oe<="9"}function w(oe){return oe>="A"&&oe<="Z"||oe>="a"&&oe<="z"}function O(oe){return oe==="d"||oe==="h"||oe==="m"||oe==="s"}function P(oe){return oe>""&&oe<"	"||oe>"\v"&&oe<"\f"||oe>""&&oe<"ÿ"}function M(oe){return w(oe)||f(oe)||oe==="+"||oe==="/"}function V(oe){return f(oe)||w(oe)||oe==="+"||oe==="/"||oe==="-"||oe==="_"}function F(oe){return w(oe)||f(oe)||oe==="+"||oe==="/"}function q(oe,C){var D=Object.keys(oe);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(oe);C&&(k=k.filter(function(ee){return Object.getOwnPropertyDescriptor(oe,ee).enumerable})),D.push.apply(D,k)}return D}function J(oe){for(var C=1;C<arguments.length;C++){var D=arguments[C]!=null?arguments[C]:{};C%2?q(Object(D),!0).forEach(function(k){Z(oe,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(D)):q(Object(D)).forEach(function(k){Object.defineProperty(oe,k,Object.getOwnPropertyDescriptor(D,k))})}return oe}function Z(oe,C,D){return C in oe?Object.defineProperty(oe,C,{value:D,enumerable:!0,configurable:!0,writable:!0}):oe[C]=D,oe}(function(oe){oe.VERSION="v",oe.ORIGIN="o",oe.SESSION_NAME="s",oe.INFORMATION="i",oe.URI="u",oe.EMAIL="e",oe.PHONE="p",oe.CONNECTION="c",oe.BANDWIDTH="b",oe.TIME="t",oe.REPEAT="r",oe.ZONE_ADJUSTMENTS="z",oe.KEY="k",oe.ATTRIBUTE="a",oe.MEDIA="m"})(m||(m={}));class pe{consumeText(C,D){let k=D;for(;k<C.length;){let ee=C[k];if(ee==="\0"||ee==="\r"||ee===d)break;k+=1}if(k-D==0)throw new Error("Invalid text, at ".concat(C));return k}consumeUnicastAddress(C,D,k){return this.consumeTill(C,D,p)}consumeOneOrMore(C,D,k){let ee=D;for(;k(C[ee]);)ee++;if(ee-D==0)throw new Error("Invalid rule at ".concat(D,"."));return ee}consumeSpace(C,D){if(C[D]===p)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(C,D){let k=D;for(let ee=0;ee<4;ee++)if(k=this.consumeDecimalUChar(C,k),ee!==3){if(C[k]!==".")throw new Error("Invalid IP4 address.");k++}return k}consumeDecimalUChar(C,D){let k=D;for(let De=0;De<3&&f(C[k]);De++,k++);if(k-D==0)throw new Error("Invalid decimal uchar.");let ee=parseInt(C.slice(D,k));if(ee>=0&&ee<=255)return k;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,D){let k=this.consumeHexpart(C,D);return C[k]===":"&&(k+=1,k=this.consumeIP4Address(C,k)),k}consumeHexpart(C,D){let k=D;if(C[k]===":"&&C[k+1]===":"){k+=2;try{k=this.consumeHexseq(C,k)}catch{}return k}if(k=this.consumeHexseq(C,k),C[k]===":"&&C[k+1]===":"){k+=2;try{k=this.consumeHexseq(C,k)}catch{}return k}return k}consumeHexseq(C,D){let k=D;for(;k=this.consumeHex4(C,k),C[k]===":"&&C[k+1]!==":";)k+=1;return k}consumeHex4(C,D){let k=0;for(;k<4;k++)if(!((ee=C[D+k])>="0"&&ee<="9"||ee>="a"&&ee<="f"||ee>="A"&&ee<="F")){if(k===0)throw new Error("Invalid hex 4");break}var ee;return D+k}consumeFQDN(C,D){let k=D;for(;f(C[k])||w(C[k])||C[k]==="-"||C[k]===".";)k+=1;if(k-D<4)throw new Error("Invalid FQDN");return k}consumeExtnAddr(C,D){return this.consumeOneOrMore(C,D,I)}consumeMulticastAddress(C,D,k){switch(k){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,D);default:try{return this.consumeFQDN(C,D)}catch{return this.consumeExtnAddr(C,D)}}}consumeIP6MulticastAddress(C,D){let k=this.consumeHexpart(C,D);return C[k]==="/"?this.consumeInteger(C,k+1):k}consumeIP4MulticastAddress(C,D){let k=D+3,ee=C.slice(D,k),De=parseInt(ee);if(De<224||De>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let St=0;St<3;St++){if(C[k]!==".")throw new Error("Invalid IP4 multicast address.");k+=1,k=this.consumeDecimalUChar(C,k)}return C[k]==="/"&&(k+=1),k=this.consumeTTL(C,k),C[k]==="/"&&(k=this.consumeInteger(C,k)),k}consumeInteger(C,D){if(!R(C[D]))throw new Error("Invalid integer.");for(D+=1;f(C[D]);)D+=1;return D}consumeTTL(C,D){if(C[D]==="0")return D+1;if(!R(C[D]))throw new Error("Invalid TTL.");D+=1;for(let k=0;k<2&&f(C[D]);k++)D+=1;return D}consumeToken(C,D){return this.consumeOneOrMore(C,D,T)}consumeTime(C,D){let k=D;if(C[k]==="0")return k+1;for(R(C[k])&&(k+=1);f(C[k]);)k++;if(k-D<10)throw new Error("Invalid time");return k}consumeAddress(C,D){return this.consumeTill(C,D,p)}consumeTypedTime(C,D){let k=D;return k=this.consumeOneOrMore(C,k,f),O(C[k])?k+1:k}consumeRepeatInterval(C,D){if(!R(C[D]))throw new Error("Invalid repeat interval");for(D+=1;f(C[D]);)D+=1;return O(C[D])&&(D+=1),D}consumePort(C,D){return this.consumeOneOrMore(C,D,f)}consume(C,D,k){for(let ee=0;ee<k.length;ee++){if(D+ee>=C.length)throw new Error("consume exceeding value length");if(C[D+ee]!==k[ee])throw new Error("consume ".concat(k," failed at ").concat(ee))}return D+k.length}consumeTill(C,D,k){let ee=D;for(;ee<C.length&&(typeof k!="string"||C[ee]!==k)&&(typeof k!="function"||!k(C[ee]));)ee++;return ee}}class ze extends pe{constructor(){super(),Z(this,"records",[]),Z(this,"currentLine",0)}parse(C){let D=this.probeEOL(C);this.records=C.split(D).filter(oi=>!!qi(oi).call(oi)).map(this.parseLine),this.currentLine=0;let k=this.parseVersion(),ee=this.parseOrigin(),De=this.parseSessionName(),St=this.parseInformation(),di=this.parseUri(),Ar=this.parseEmail(),Is=this.parsePhone(),P_=this.parseConnection(),k_=this.parseBandWidth(),Cn=this.parseTimeFields(),Sa=this.parseKey(),ud=this.parseSessionAttribute(),Yt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:k,origin:ee,sessionName:De,information:St,uri:di,emails:Ar,phones:Is,connection:P_,bandwidths:k_,timeFields:Cn,key:Sa,attributes:ud,mediaDescriptions:Yt}}getCurrentRecord(){let C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let D=0;D<C.length;D++)if(C[D]===d)return C[D-1]==="\r"?u:d;throw new Error("Invalid newline character.")}parseLine(C,D){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let k=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:k,value:C.slice(2),line:D,cur:0}}parseSessionAttribute(){let C=new Ct;for(;this.currentLine<this.records.length;){let D=this.getCurrentRecord();if(D.type!==m.ATTRIBUTE)break;let k={attField:this.extractOneOrMore(D,ee=>T(ee)&&ee!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,k.attValue=this.extractOneOrMore(D,P)),C.parse(k),this.currentLine++}return C.digest()}parseMediaAttributes(C){let D=new $t(C);for(;this.currentLine<this.records.length;){let k=this.getCurrentRecord();if(k.type!==m.ATTRIBUTE)break;let ee={attField:this.extractOneOrMore(k,De=>T(De)&&De!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,ee.attValue=this.extractOneOrMore(k,P)),D.parse(ee),this.currentLine++}return D.digest()}parseKey(){let C=this.getCurrentRecord();if(C.type===m.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let C=this.getCurrentRecord();if(C.type===m.ZONE_ADJUSTMENTS){let D=[];for(;;)try{let k=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let ee=!1;C.value[C.cur]==="-"&&(ee=!0,C.cur+=1);let De=this.extract(C,this.consumeTypedTime);D.push({time:k,typedTime:De,back:ee})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){let C=[];for(;;){let D=this.getCurrentRecord();if(D.type!==m.REPEAT)break;{let k=this.extract(D,this.consumeRepeatInterval),ee=this.parseTypedTime(D);C.push({repeatInterval:k,typedTimes:ee}),this.currentLine++}}return C}parseTypedTime(C){let D=[];for(;;)try{this.consumeSpaceForRecord(C),D.push(this.extract(C,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){let C=this.getCurrentRecord(),D=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let k=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:k}}parseBandWidth(){let C=[];for(;this.currentLine<this.records.length;){let D=this.getCurrentRecord();if(D.type!==m.BANDWIDTH)break;{let k=this.extractOneOrMore(D,T);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;let ee=this.extractOneOrMore(D,f);C.push({bwtype:k,bandwidth:ee}),this.currentLine++}}return C}parseVersion(){let C=this.getCurrentRecord();if(C.type!==m.VERSION)throw new Error("first sdp record must be version");let D=C.value.slice(0,this.consumeOneOrMore(C.value,0,f));if(D.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,D}parseOrigin(){let C=this.getCurrentRecord();if(C.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");let D=this.extractOneOrMore(C,I);this.consumeSpaceForRecord(C);let k=this.extractOneOrMore(C,f);this.consumeSpaceForRecord(C);let ee=this.extractOneOrMore(C,f);this.consumeSpaceForRecord(C);let De=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);let St=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);let di=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:k,sessVersion:ee,nettype:De,addrtype:St,unicastAddress:di}}parseSessionName(){let C=this.getCurrentRecord();if(C.type===m.SESSION_NAME){let D=this.extract(C,this.consumeText);return this.currentLine++,D}}parseInformation(){let C=this.getCurrentRecord();if(C.type!==m.INFORMATION)return;let D=this.extract(C,this.consumeText);return this.currentLine++,D}parseUri(){let C=this.getCurrentRecord();if(C.type===m.URI)return this.currentLine++,C.value}parseEmail(){let C=[];for(;;){let D=this.getCurrentRecord();if(D.type!==m.EMAIL)break;C.push(D.value),this.currentLine++}return C}parsePhone(){let C=[];for(;;){let D=this.getCurrentRecord();if(D.type!==m.PHONE)break;C.push(D.value),this.currentLine++}return C}parseConnection(){let C=this.getCurrentRecord();if(C.type===m.CONNECTION){let D=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);let k=this.extractOneOrMore(C,T);this.consumeSpaceForRecord(C);let ee=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:k,address:ee}}}parseMedia(){let C=this.getCurrentRecord(),D=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let k=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,k+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);let ee=[];for(ee.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,ee.push(this.extract(C,this.consumeToken));if(ee.length===0)throw new Error("Invalid proto");let De=this.parseFmt(C);return this.currentLine++,{mediaType:D,port:k,protos:ee,fmts:De}}parseTimeFields(){let C=[];for(;this.getCurrentRecord().type===m.TIME;){let D=this.parseTime(),k=this.parseRepeat(),ee=this.parseZone();C.push({time:D,repeats:k,zones:ee})}return C}parseMediaDescription(){let C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){let D=this.parseMedia(),k=this.parseInformation(),ee=this.parseConnections(),De=this.parseBandWidth(),St=this.parseKey(),di=this.parseMediaAttributes(D);C.push({media:D,information:k,connections:ee,bandwidths:De,key:St,attributes:di})}return C}parseConnections(){let C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){let D=[];for(;;)try{this.consumeSpaceForRecord(C),D.push(this.extract(C,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(C,D){for(var k=arguments.length,ee=new Array(k>2?k-2:0),De=2;De<k;De++)ee[De-2]=arguments[De];let St=D.call(this,C.value,C.cur,...ee),di=C.value.slice(C.cur,St);return C.cur=St,di}extractOneOrMore(C,D){let k=this.consumeOneOrMore(C.value,C.cur,D),ee=C.value.slice(C.cur,k);return C.cur=k,ee}consumeSpaceForRecord(C){if(C.value[C.cur]!==p)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class nt extends pe{constructor(){super(...arguments),Z(this,"attributes",void 0),Z(this,"digested",!1)}extractOneOrMore(C,D,k){let ee=this.consumeOneOrMore(C.attValue,C._cur,D),De=C.attValue.slice(C._cur,ee),[St,di]=k||[];if(typeof St=="number"&&De.length<St)throw new Error("error in length, should be more or equal than ".concat(St," characters."));if(typeof di=="number"&&De.length>di)throw new Error("error in length, should be less or equal than ".concat(di," characters."));return C._cur=ee,De}consumeAttributeSpace(C){if(C.attValue[C._cur]!==p)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,D){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var k=arguments.length,ee=new Array(k>2?k-2:0),De=2;De<k;De++)ee[De-2]=arguments[De];let St=D.call(this,C.attValue,C._cur,...ee),di=C.attValue.slice(C._cur,St);return C._cur=St,di}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,D){if(!C.attValue)throw new Error;for(let k=0;k<D.length;k++)if(D[k]!==C.attValue[C._cur+k])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,M,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,M,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let D=[];for(;!this.atEnd(C);){D.push(this.extractOneOrMore(C,M));try{this.consumeAttributeSpace(C)}catch(k){if(this.atEnd(C))break;throw k}}this.attributes.iceOptions=D}parseFingerprint(C){let D=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);let k=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:k})}parseExtmap(C){let D=this.extractOneOrMore(C,f),k;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),k=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);let ee=this.extract(C,this.consumeTill,p),De=J(J({entry:parseInt(D,10)},k&&{direction:k}),{},{extensionName:ee});this.peekChar(C)===p&&(this.consumeAttributeSpace(C),De.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(De)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let D=this.extract(C,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class Ct extends nt{constructor(){super(...arguments),Z(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(D){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),D}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){let D=this.extract(C,this.consumeToken),k=[];for(;!this.atEnd(C)&&this.peekChar(C)===p;)this.consumeAttributeSpace(C),k.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:k})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,V)}parseIdentity(C){let D=this.extractOneOrMore(C,F),k=[];for(;!this.atEnd(C)&&this.peekChar(C)===p;){this.consumeAttributeSpace(C);let ee=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");let De=this.extractOneOrMore(C,St=>St!==p&&P(St));k.push({name:ee,value:De})}this.attributes.identities.push({assertionValue:D,extensions:k})}parseMsidSemantic(C){this.peekChar(C)===p&&this.consumeAttributeSpace(C);let D={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),D.applyForAll=!0;break}{let k=this.extract(C,this.consumeTill,p);D.identifierList.push(k)}}this.attributes.msidSemantic=D}}class $t extends nt{constructor(C){super(),Z(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(D){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),D}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){let D=this.extractOneOrMore(C,M,[1,32]);this.consumeAttributeSpace(C);let k=this.extractOneOrMore(C,f,[1,5]);this.consumeAttributeSpace(C);let ee=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);let De=this.extractOneOrMore(C,f,[1,10]);this.consumeAttributeSpace(C);let St=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);let di=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);let Ar={foundation:D,componentId:k,transport:ee,priority:De,connectionAddress:St,port:di,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),Ar.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),Ar.relPort=this.extract(C,this.consumePort));this.peekChar(C)===p;){this.consumeAttributeSpace(C);let Is=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),Ar.extension[Is]=this.extractOneOrMore(C,E)}this.attributes.candidates.push(Ar)}parseRemoteCandidate(C){let D=[];for(;;){let k=this.extractOneOrMore(C,f,[1,5]);this.consumeAttributeSpace(C);let ee=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);let De=this.extract(C,this.consumePort);D.push({componentId:k,connectionAddress:ee,port:De});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){let D=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);let k=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");let ee={encodingName:k,clockRate:this.extractOneOrMore(C,f)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),ee.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));let De=this.attributes.payloads.find(St=>St.payloadType===parseInt(D,10));De?De.rtpMap=ee:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:ee,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){let D=this.extractOneOrMore(C,f);this.consumeAttributeSpace(C);let k=this.extract(C,this.consumeTill,":"),ee;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),ee=this.extract(C,this.consumeTill));let De=this.attributes.ssrcs.find(St=>St.ssrcId===parseInt(D,10));De?De.attributes[k]=ee:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[k]:ee}})}parseFmtp(C){let D=this.extract(C,this.consumeTill,p);this.consumeAttributeSpace(C);let k=this.extract(C,this.consumeTill),ee={};k.split(";").forEach(St=>{let[di,Ar]=St.split("=");di=qi(di).call(di);let Is=typeof Ar=="string"?qi(Ar).call(Ar):null;typeof di=="string"&&di.length>0&&(ee[di]=Is)});let De=this.attributes.payloads.find(St=>St.payloadType===parseInt(D,10));De?De.fmtp={parameters:ee}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:ee}})}parseFmtParameters(C){let D={},k=this.extract(C,this.consumeTill,"=");C._cur++;let ee=this.extract(C,this.consumeTill,";");for(D[k]=ee;C.attValue[C._cur]===";";){let De=this.extract(C,this.consumeTill,"=");C._cur++;let St=this.extract(C,this.consumeTill,";");D[De]=St}return D}parseRtcpFb(C){let D="";D=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,p),this.consumeAttributeSpace(C);let k=this.extract(C,this.consumeTill,p),ee;if(k==="trr-int")ee={type:k,interval:this.extract(C,this.consumeTill)};else{let De={type:k};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),De.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===p&&(De.additional=this.extract(C,this.consumeTill))),ee=De}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(ee);else{let De=this.attributes.payloads.find(St=>St.payloadType===parseInt(D,10));De?De.rtcpFeedbacks.push(ee):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[ee]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let D={port:this.extract(C,this.consumePort)};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),D.netType=this.extractOneOrMore(C,T),this.consumeAttributeSpace(C),D.addressType=this.extractOneOrMore(C,T),this.consumeAttributeSpace(C),D.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(C){let D={id:this.extractOneOrMore(C,T,[1,64])};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),D.appdata=this.extractOneOrMore(C,T,[1,64])),this.attributes.msids.push(D)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){let D=this.extractOneOrMore(C,ee=>w(ee)||f(ee)||ee==="_"||ee==="-");this.consumeAttributeSpace(C);let k={id:D,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===p){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");let ee=[];for(;;){let De=this.extract(C,this.consumeToken);ee.push(De);try{this.extract(C,this.consume,",")}catch{break}}k.payloads=ee,this.peekChar(C)===p&&this.extract(C,this.consume,p)}for(;;){let ee=this.extract(C,this.consumeToken);switch(ee){case"depend":{let De={type:ee,rids:this.extract(C,this.consume,"=").split(",")};k.params.push(De);break}default:{let De={type:ee};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),De.val=this.extract(C,this.consumeTill,";")),k.params.push(De)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(k)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,f,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,f,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){let D=this.extract(C,this.consumeToken),k=[];for(;;)try{this.consumeAttributeSpace(C);let ee=this.extract(C,this.consumeInteger);k.push(parseInt(ee,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:k})}}function Mt(oe,C,D){return C in oe?Object.defineProperty(oe,C,{value:D,enumerable:!0,configurable:!0,writable:!0}):oe[C]=D,oe}class $n{constructor(){Mt(this,"eol",u)}print(C,D){let k="";return D&&(this.eol=D),k+=this.printVersion(C.version),k+=this.printOrigin(C.origin),k+=this.printSessionName(C.sessionName),k+=this.printInformation(C.information),k+=this.printUri(C.uri),k+=this.printEmail(C.emails),k+=this.printPhone(C.phones),k+=this.printConnection(C.connection),k+=this.printBandwidth(C.bandwidths),k+=this.printTimeFields(C.timeFields),k+=this.printKey(C.key),k+=this.printSessionAttributes(C.attributes),k+=this.printMediaDescription(C.mediaDescriptions),k}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let D="";for(let k of C)D+="e=".concat(k).concat(this.eol);return D}printPhone(C){let D="";for(let k of C)D+="e=".concat(k).concat(this.eol);return D}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let D="";for(let k of C)D+="b=".concat(k.bwtype,":").concat(k.bandwidth).concat(this.eol);return D}printTimeFields(C){let D="";for(let k of C){D+="t=".concat(k.time.startTime," ").concat(k.time.startTime).concat(this.eol);for(let ee of k.repeats)D+="r=".concat(ee.repeatInterval," ").concat(ee.typedTimes.join(" ")).concat(this.eol);k.zoneAdjustments&&(D+="z=",D+="z=".concat(k.zoneAdjustments.map(ee=>"".concat(ee.time," ").concat(ee.back?"-":""," ").concat(ee.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let D="";for(let k of C)D+="a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol);return D}printMediaDescription(C){let D="";for(let k of C)D+=this.printMedia(k.media),D+=this.printInformation(k.information),D+=this.printConnections(k.connections),D+=this.printBandwidth(k.bandwidths),D+=this.printKey(k.key),D+=this.printMediaAttributes(k);return D}printConnections(C){let D="";for(let k of C)D+=this.printConnection(k);return D}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new re(this.eol).print(C)}printMediaAttributes(C){return new he(this.eol).print(C)}}class z{constructor(C){Mt(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(p)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(p).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(p).concat(D.extensionName).concat(D.extensionAttributes?"".concat(p).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class re extends z{print(C){let D="";return D+=this.printGroups(C.groups),D+=this.printMsidSemantic(C.msidSemantic),D+=this.printIceLite(C.iceLite),D+=this.printIceUfrag(C.iceUfrag),D+=this.printIcePwd(C.icePwd),D+=this.printIceOptions(C.iceOptions),D+=this.printFingerprints(C.fingerprints),D+=this.printSetup(C.setup),D+=this.printTlsId(C.tlsId),D+=this.printIdentity(C.identities),D+=this.printExtmap(C.extmaps),D+=this.printUnrecognized(C.unrecognized),D}printGroups(C){let D="";return C.length>0&&(D+=C.map(k=>"a=group:".concat(k.semantic).concat(k.identificationTag.map(ee=>"".concat(p).concat(ee)).join("")).concat(this.eol)).join("")),D}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(k=>"".concat(p).concat(k.name).concat(k.value?"=".concat(k.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let D="a=msid-semantic:".concat(C.semantic);return C.applyForAll?D+="".concat(p,"*"):C.identifierList.length>0&&(D+=C.identifierList.map(k=>"".concat(p).concat(k))),D+this.eol}}class he extends z{print(C){let D=C.attributes,k="";return k+=this.printRTCP(D.rtcp),k+=this.printIceUfrag(D.iceUfrag),k+=this.printIcePwd(D.icePwd),k+=this.printIceOptions(D.iceOptions),k+=this.printCandidates(D.candidates),k+=this.printRemoteCandidatesList(D.remoteCandidatesList),k+=this.printEndOfCandidates(D.endOfCandidates),k+=this.printFingerprints(D.fingerprints),k+=this.printSetup(D.setup),k+=this.printMid(D.mid),k+=this.printExtmap(D.extmaps),k+=this.printRTPRelated(D),k+=this.printPtime(D.ptime),k+=this.printMaxPtime(D.maxPtime),k+=this.printDirection(D.direction),k+=this.printSSRCGroups(D.ssrcGroups),k+=this.printSSRC(D.ssrcs),k+=this.printRTCPMux(D.rtcpMux),k+=this.printRTCPMuxOnly(D.rtcpMuxOnly),k+=this.printRTCPRsize(D.rtcpRsize),k+=this.printMSId(D.msids),k+=this.printImageattr(D.imageattr),k+=this.printRid(D.rids),k+=this.printSimulcast(D.simulcast),k+=this.printSCTPPort(D.sctpPort),k+=this.printMaxMessageSize(D.maxMessageSize),k+=this.printUnrecognized(D.unrecognized),k}printCandidates(C){return C.map(D=>"a=candidate:".concat(D.foundation).concat(p).concat(D.componentId).concat(p).concat(D.transport).concat(p).concat(D.priority).concat(p).concat(D.connectionAddress).concat(p).concat(D.port).concat(p,"typ").concat(p).concat(D.type).concat(D.relAddr?"".concat(p,"raddr").concat(p).concat(D.relAddr):"").concat(D.relPort?"".concat(p,"rport").concat(p).concat(D.relPort):"").concat(Object.keys(D.extension).map(k=>"".concat(p).concat(k).concat(p).concat(D.extension[k])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(D=>"a=remote-candidates:".concat(D.join(p)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";let D=C.payloads,k="";k+=C.rtcpFeedbackWildcards.map(ee=>this.printRTCPFeedback("*",ee)).join("");for(let ee of D)k+=this.printRtpMap(ee.payloadType,ee.rtpMap),k+=this.printFmtp(ee.payloadType,ee.fmtp),k+=ee.rtcpFeedbacks.map(De=>this.printRTCPFeedback(ee.payloadType,De)).join("");return k}printFmtp(C,D){if(!D)return"";let k=Object.keys(D.parameters);return k.length===1&&D.parameters[k[0]]===null?"a=fmtp:".concat(C).concat(p).concat(k[0]).concat(this.eol):"a=fmtp:".concat(C).concat(p).concat(Object.keys(D.parameters).map(ee=>"".concat(ee,"=").concat(D.parameters[ee])).join(";")).concat(this.eol)}printRtpMap(C,D){return D?"a=rtpmap:".concat(C).concat(p).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,D){let k="a=rtcp-fb:".concat(C).concat(p),ee=D;return ee.type==="trr-int"?k+="ttr-int".concat(p).concat(ee.interval):(k+="".concat(ee.type),ee.parameter&&(k+="".concat(p).concat(ee.parameter),ee.additional&&(k+="".concat(p).concat(ee.additional)))),k+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(D=>Object.keys(D.attributes).map(k=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(p).concat(k).concat(D.attributes[k]?":".concat(D.attributes[k]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let D="a=rtcp:".concat(C.port);return C.netType&&(D+="".concat(p).concat(C.netType)),C.addressType&&(D+="".concat(p).concat(C.addressType)),C.address&&(D+="".concat(p).concat(C.address)),D+this.eol}printMSId(C){return C.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(p).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(C){return C.map(D=>{let k="a=rid:".concat(D.id).concat(p).concat(D.direction);return D.payloads&&(k+="".concat(p,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(k+="".concat(p).concat(D.params.map(ee=>ee.type==="depend"?"depend=".concat(ee.rids.join(",")):"".concat(ee.type,"=").concat(ee.val)).join(";"))),k+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(k=>"".concat(p).concat(k.toString(10))).join("")).concat(this.eol)).join("")}}function ke(oe){return new ze().parse(oe)}function it(oe,C){return new $n().print(oe,C)}}},r={};function n(o){if(r[o])return r[o].exports;var a=r[o]={exports:{}};return i[o](a,a.exports,n),a.exports}return n.d=(o,a)=>{for(var l in a)n.o(a,l)&&!n.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:a[l]})},n.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),n.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},n(8)})()})(lL);var Nt=lL.exports;function qn(e){if(Array.isArray(e))return e.map(i=>i);if(!dL(e))return e;let t={};for(let i in e){let r=e[i];dL(r)||Array.isArray(r)?t[i]=qn(r):t[i]=r}return t}function dL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class Sv{constructor(t){y(this,"input",[]),y(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}let Zo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},rh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Zo,remoteCandidate:Zo}},uL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},hL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},pL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},mL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function _L(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function fL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_L(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_L(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class Tv{constructor(t,i){y(this,"onFirstVideoReceived",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"videoIsReady",!1),y(this,"videoIsReady2",{}),y(this,"pc",void 0),y(this,"options",void 0),y(this,"intervalTimer",void 0),y(this,"stats",qn(rh)),y(this,"isFirstVideoReceived",{}),y(this,"isFirstVideoDecoded",{}),y(this,"isFirstAudioReceived",{}),y(this,"isFirstAudioDecoded",{}),y(this,"isFirstVideoDecodedTimeout",{}),y(this,"lossRateWindowStats",[]),this.pc=t,this.options=i,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ne(t=>{t({local:fL({},Zo),remote:fL({},Zo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,i){this.videoIsReady2[t]=i}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let i=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],n=0,o=0,a=0,l=0;for(let d of r)t[d].forEach((u,p)=>{if(!this.lossRateWindowStats[i-1][d][p]||!this.lossRateWindowStats[0][d][p])return;let m=this.lossRateWindowStats[i-1][d][p].packets-this.lossRateWindowStats[0][d][p].packets,f=this.lossRateWindowStats[i-1][d][p].packetsLost-this.lossRateWindowStats[0][d][p].packetsLost;d==="videoSend"||d==="audioSend"?(n+=m,a+=f):(o+=m,l+=f),Number.isNaN(m)||Number.isNaN(m)?u.packetLostRate=0:u.packetLostRate=m<=0||f<=0?0:f/(m+f)});t.sendPacketLossRate=n<=0||a<=0?0:a/(n+a),t.recvPacketLossRate=o<=0||l<=0?0:l/(o+l)}}function EL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function M9(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?EL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):EL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class U9 extends Tv{constructor(){super(...arguments),y(this,"_stats",rh),y(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let t=await this._getStats(),i=this.statsResponsesToObjects(t);this._stats=qn(rh);let r=i.filter(o=>o.type==="ssrc");this.processSSRCStats(r);let n=i.find(o=>o.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(i=>{var r;let n=se(r=i.id).call(r,"send");switch("".concat(i.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let o=qn(hL);o.codec=i.googCodecName,o.adaptionChangeReason="none",i.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(i.googAvgEncodeMs),o.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},o.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},o.firsCount=Number(i.googFirReceived),o.nacksCount=Number(i.googNacksReceived),o.plisCount=Number(i.googPlisReceived),o.frameCount=Number(i.framesEncoded),o.bytes=Number(i.bytesSent),o.packets=Number(i.packetsSent),o.packetsLost=Number(i.packetsLost),o.ssrc=Number(i.ssrc),o.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{let o=qn(uL),a=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(o.codec=i.googCodecName,o.targetDelayMs=Number(i.googTargetDelayMs),o.renderDelayMs=Number(i.googRenderDelayMs),o.currentDelayMs=Number(i.googCurrentDelayMs),o.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),o.decodeMs=Number(i.googDecodeMs),o.maxDecodeMs=Number(i.googMaxDecodeMs),o.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},o.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},o.decodeFrameRate=Number(i.googFrameRateDecoded),o.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},o.jitterBufferMs=Number(i.googJitterBufferMs),o.firsCount=Number(i.googFirsSent),o.nacksCount=Number(i.googNacksSent),o.plisCount=Number(i.googPlisSent),o.framesDecodeCount=Number(i.framesDecoded),o.bytes=Number(i.bytesReceived),o.packets=Number(i.packetsReceived),o.packetsLost=Number(i.packetsLost),o.ssrc=Number(i.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),a){let l=a.stats,d=Date.now()-a.lts;o.framesDecodeFreezeTime=l.framesDecodeFreezeTime,o.framesDecodeInterval=l.framesDecodeInterval,o.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=d,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):o.framesDecodeCount<a.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:M9({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{let o=qn(mL);o.codec=i.googCodecName,o.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,o.decodingCNG=Number(i.googDecodingCNG),o.decodingCTN=Number(i.googDecodingCTN),o.decodingCTSG=Number(i.googDecodingCTSG),o.decodingNormal=Number(i.googDecodingNormal),o.decodingPLC=Number(i.googDecodingPLC),o.decodingPLCCNG=Number(i.googDecodingPLCCNG),o.expandRate=Number(i.googExpandRate),o.accelerateRate=Number(i.googAccelerateRate),o.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),o.speechExpandRate=Number(i.googSpeechExpandRate),o.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),o.jitterBufferMs=Number(i.googJitterBufferMs),o.jitterMs=Number(i.googJitterReceived),o.bytes=Number(i.bytesReceived),o.packets=Number(i.packetsReceived),o.packetsLost=Number(i.packetsLost),o.ssrc=Number(i.ssrc),o.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),o.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{let o=qn(pL);o.codec=i.googCodecName,o.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,o.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(i.bytesSent),o.packets=Number(i.packetsSent),o.packetsLost=Number(i.packetsLost),o.ssrc=Number(i.ssrc),o.rttMs=Number(i.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new ne((t,i)=>{this.pc.getStats(t,i)})}statsResponsesToObjects(t){let i=[];return t.result().forEach(r=>{let n={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(o=>{n[o]=r.stat(o)}),i.push(n)}),i}}function gL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Cc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?gL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class SL extends Tv{constructor(){super(...arguments),y(this,"_stats",rh),y(this,"report",void 0),y(this,"lastDecodeVideoReceiverStats",new Map),y(this,"lastVideoFramesRecv",new Map),y(this,"lastVideoFramesSent",new Map),y(this,"lastVideoFramesDecode",new Map),y(this,"lastVideoFramesOutput",new Map),y(this,"lastVideoJBDelay",new Map),y(this,"lastAudioJBDelay",new Map),y(this,"mediaBytesSent",new Map),y(this,"mediaBytesRetransmit",new Map),y(this,"mediaBytesTargetEncode",new Map),y(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=qn(rh),this.report.forEach(t=>{switch(t.type){case Jr.OUTBOUND:case Jr.INBOUND:{let i=t.mediaType||t.kind,r=!i&&"frameWidth"in t,n=!i&&!("frameWidth"in t);t.type===Jr.OUTBOUND?i==="audio"||n?this.processAudioOutboundStats(t):(i==="video"||r)&&this.processVideoOutboundStats(t):t.type===Jr.INBOUND&&(i==="audio"||n?this.processAudioInboundStats(t):(i==="video"||r)&&this.processVideoInboundStats(t));break}case Jr.TRANSPORT:{let i=this.report.get(t.selectedCandidatePairId);i&&this.processCandidatePairStats(i);break}case Jr.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let t=await this.pc.getStats(),i={local:Cc({},Zo),remote:Cc({},Zo)};return t.forEach(r=>{let n;if(r.type===Jr.TRANSPORT&&(n=t.get(r.selectedCandidatePairId)),r.type===Jr.CANDIDATE_PAIR&&r.selected&&(n=r),n){let o=(a,l)=>{a.type=l.type,a.id=l.id,l.address&&(a.address=l.address),l.candidateType&&(a.candidateType=l.candidateType),l.port&&(a.port=l.port),l.priority&&(a.priority=l.priority),l.protocol&&(a.protocol=l.protocol),l.relayProtocol&&(a.relayProtocol=l.relayProtocol)};if(n.localCandidateId){let a=t.get(n.localCandidateId);a&&o(i.local,a)}if(n.remoteCandidateId){let a=t.get(n.remoteCandidateId);a&&o(i.remote,a)}}}),i}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(i=>{t.currentRoundTripTime&&(i.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{t.currentRoundTripTime&&(i.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){let i=this.report.get(t.localCandidateId);i&&this.processCandidateStats(i)}if(t.remoteCandidateId){let i=this.report.get(t.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(t){let i;t.type===Jr.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),t.type===Jr.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=t.type,i.id=t.id,t.address&&(i.address=t.address),t.candidateType&&(i.candidateType=t.candidateType),t.port&&(i.port=t.port),t.priority&&(i.priority=t.priority),t.protocol&&(i.protocol=t.protocol),t.relayProtocol&&(i.relayProtocol=t.relayProtocol),t.type===Jr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Cc({},i),Cc({},this.stats.selectedCandidatePair.localCandidate)),t.type===Jr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Cc({},i),Cc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let i=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);i||(i=qn(mL),this._stats.audioRecv.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsReceived,i.packetsLost=t.packetsLost,i.bytes=t.bytesReceived,i.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),i.receivedFrames||(i.receivedFrames=t.packetsReceived),i.droppedFrames||(i.droppedFrames=t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),typeof t.concealedSamples=="number"&&(i.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let i=this._stats.videoRecv.find(l=>l.ssrc===t.ssrc);i||(i=qn(uL),this._stats.videoRecv.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsReceived,i.packetsLost=t.packetsLost,i.bytes=t.bytesReceived,i.firsCount=t.firCount,i.nacksCount=t.nackCount,i.plisCount=t.pliCount,i.framesDecodeCount=t.framesDecoded,i.framesDroppedCount=t.framesDropped,i.totalInterFrameDelay=t.totalInterFrameDelay,i.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,i.totalFreezesDuration=t.totalFreezesDuration;let r=this.lastDecodeVideoReceiverStats.get(i.ssrc),n=this.lastVideoFramesDecode.get(i.ssrc),o=this.lastVideoFramesOutput.get(i.ssrc),a=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){let l=i.decodedFrame?i.decodedFrame.width:0,d=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,l,d),this.isFirstVideoDecoded[i.ssrc]=!0}if(r){let l=r.stats,d=a-r.lts;i.framesDecodeFreezeTime=l.framesDecodeFreezeTime,i.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&d>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(r.lts=Date.now(),i.framesDecodeInterval=d,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<l.framesDecodeCount&&(i.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?i.qpSumPerFrame=t.qpSum/t.framesDecoded:i.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}n&&a-n.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-n.count)/((a-n.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:a,rate:i.decodeFrameRate})):n?i.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:a,rate:0}),i.framesDroppedCount&&t.framesReceived&&(o&&a-o.lts>=800?(i.outputFrameRate=Math.round((t.framesReceived-i.framesDroppedCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesOutput.set(i.ssrc,{count:t.framesReceived-i.framesDroppedCount,lts:a,rate:Math.max(i.outputFrameRate,0)})):o?i.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(i.ssrc,{count:t.framesReceived-i.framesDroppedCount,lts:a,rate:0})),t.totalDecodeTime&&(i.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(i.framesRateFirefox=t.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Cc({},i),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let i=this._stats.videoSend.find(n=>n.ssrc===t.ssrc);i||(i=qn(hL),this._stats.videoSend.push(i));let r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{let n=new Sv(10);n.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,n)}if(t.retransmittedBytesSent!==void 0){let n=this.mediaBytesRetransmit.get(t.ssrc);if(n)n.add(t.retransmittedBytesSent);else{let o=new Sv(10);o.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,o)}}if(t.totalEncodedBytesTarget){let n=this.mediaBytesTargetEncode.get(t.ssrc);if(n)n.add(t.totalEncodedBytesTarget);else{let o=new Sv(10);o.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,o)}}if(i.ssrc=t.ssrc,i.bytes=t.bytesSent,i.packets=t.packetsSent,i.firsCount=t.firCount,i.nacksCount=t.nackCount,i.plisCount=t.pliCount,i.frameCount=t.framesEncoded,i.adaptionChangeReason=t.qualityLimitationReason,i.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){let n=this.lastEncoderMs.get(t.ssrc);if(!n||n.lastFrameCount>t.framesEncoded)i.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{let o=t.framesEncoded-n.lastFrameCount,a=t.totalEncodeTime-n.lastEncoderTime;i.avgEncodeMs=1e3*a/o}}if(t.framesEncoded&&t.qpSum){let n=this.lastEncoderMs.get(t.ssrc);!n||n.lastFrameCount>t.framesEncoded?i.qpSumPerFrame=t.qpSum/t.framesEncoded:i.qpSumPerFrame=(t.qpSum-n.lastQpSum)/(t.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,i),this.processVideoTrackSenderStats(t,t.trackId,i),t.remoteId)this.processRemoteInboundStats(t.remoteId,i);else{let n=this.findRemoteStatsId(t.ssrc,Jr.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,i)}}processAudioOutboundStats(t){let i=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(i||(i=qn(pL),this._stats.audioSend.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsSent,i.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,i),t.remoteId)this.processRemoteInboundStats(t.remoteId,i);else{let r=this.findRemoteStatsId(t.ssrc,Jr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,i)}}findRemoteStatsId(t,i){var r;let n=Array.from(ho(r=this.report).call(r)).find(o=>o.type===i&&o.ssrc===t);return n?n.id:null}processVideoMediaSource(t,i){let r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(i.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,i){let r=this.report.get(t);r&&(i.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,i,r){var n,o,a,l;let d=i?this.report.get(i):void 0,u=(n=d==null?void 0:d.framesSent)!==null&&n!==void 0?n:t.framesSent;if(typeof u!="number")return;let p=(o=d==null?void 0:d.frameWidth)!==null&&o!==void 0?o:t.frameWidth,m=(a=d==null?void 0:d.frameHeight)!==null&&a!==void 0?a:t.frameHeight,f=(l=d==null?void 0:d.framesPerSecond)!==null&&l!==void 0?l:t.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),f==null){let E=Date.now(),I=this.lastVideoFramesSent.get(r.ssrc);I&&E-I.lts>=800?(f=Math.round((u-I.count)/((E-I.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:u,lts:E,rate:f})):I?f=I.rate:this.lastVideoFramesSent.set(r.ssrc,{count:u,lts:E,rate:0})}r.sentFrame={width:p,height:m,frameRate:Math.max(0,f)}}processVideoTrackReceiverStats(t,i,r){var n,o,a,l,d;let u=i?this.report.get(i):void 0,p=(n=u==null?void 0:u.framesReceived)!==null&&n!==void 0?n:t.framesReceived,m=(o=u==null?void 0:u.frameWidth)!==null&&o!==void 0?o:t.frameWidth,f=(a=u==null?void 0:u.frameHeight)!==null&&a!==void 0?a:t.frameHeight,E=(l=u==null?void 0:u.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,I=(d=u==null?void 0:u.jitterBufferEmittedCount)!==null&&d!==void 0?d:t.jitterBufferEmittedCount;if(typeof p=="number"){let T=this.lastVideoFramesRecv.get(r.ssrc),R=Date.now();r.framesReceivedCount=p;let w=0;T&&R-T.lts>=800?(w=Math.round((p-T.count)/((R-T.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:p,lts:R,rate:w})):T?w=T.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:p,lts:R,rate:0}),r.receivedFrame={width:m||0,height:f||0,frameRate:w||0},r.decodedFrame={width:m||0,height:f||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:m||0,height:f||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(E&&I){let T=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},R=T.jitterBufferMs,w=I-T.jitterBufferEmittedCount;w>0&&(R=1e3*(E-T.jitterBufferDelay)/w),r.jitterBufferMs=R,r.currentDelayMs=Math.round(R),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:I,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(t,i,r){var n,o,a,l;let d=i?this.report.get(i):void 0,u=(n=(o=d==null?void 0:d.echoReturnLoss)!==null&&o!==void 0?o:t.echoReturnLoss)!==null&&n!==void 0?n:0,p=(a=(l=d==null?void 0:d.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;r.aecReturnLoss=u,r.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(t,i,r){var n,o,a,l,d,u,p;let m=i?this.report.get(i):void 0,f=(n=m==null?void 0:m.removedSamplesForAcceleration)!==null&&n!==void 0?n:t.removedSamplesForAcceleration,E=(o=m==null?void 0:m.totalSamplesReceived)!==null&&o!==void 0?o:t.totalSamplesReceived,I=(a=m==null?void 0:m.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,T=(l=m==null?void 0:m.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,R=(d=m==null?void 0:m.audioLevel)!==null&&d!==void 0?d:t==null?void 0:t.audioLevel,w=(u=m==null?void 0:m.totalSamplesDuration)!==null&&u!==void 0?u:t==null?void 0:t.totalSamplesDuration,O=(p=m==null?void 0:m.concealedSamples)!==null&&p!==void 0?p:t.concealedSamples;if(f&&E&&(r.accelerateRate=f/E),I&&T){let M=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},V=M.jitterBufferMs,F=T-M.jitterBufferEmittedCount;F>0&&(V=1e3*(I-M.jitterBufferDelay)/F),r.jitterBufferMs=Math.round(V),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:T,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=R;let P=1920;w&&E&&(P=E/w/50,r.receivedFrames=Math.round(E/P)),O&&(r.droppedFrames=Math.round(O/P))}processRemoteInboundStats(t,i){let r=this.report.get(t);r&&(i.packetsLost=r.packetsLost,r.roundTripTime&&(i.rttMs=1e3*r.roundTripTime),r.jitter&&(i.jitterMs=1e3*r.jitter),r.timestamp&&(i.timestamp=r.timestamp))}getCodecFromCodecStats(t){let i=this.report.get(t);if(!i)return"";let r=i.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,i=null,r=null;this.mediaBytesSent.forEach(o=>{t+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{i=i===null?o.diffMean():i+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{r=r===null?o.diffMean():r+o.diffMean()});let n=i!==null?t-i:t;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class x9 extends Tv{updateStats(){return ne.resolve()}}function l_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,o=function(){let a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return o?o<76?new U9(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):new SL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):function(a){return!!window.RTCStatsReport&&a.getStats()instanceof ne}(e)?new SL(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n}):new x9(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:r,firstVideoDecodedTimeout:n})}function TL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function vL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?TL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function nh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:n,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:l,filterVideoCodec:d}=t,{useXR:u}=i,p=[],m=[],f=[],E=[],I=!1,T=!1;if(Nt.parse(e).mediaDescriptions.forEach(w=>{r&&r!==w.attributes.direction||(w.media.mediaType!=="video"||I||(m=w.attributes.payloads,E=w.attributes.extmaps,I=!0),w.media.mediaType!=="audio"||T||(p=w.attributes.payloads,f=w.attributes.extmaps,T=!0))}),!E||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!f||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(w=>{var O;(O=w.rtpMap)!==null&&O!==void 0&&O.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),u&&w.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(w=>{var O;(O=w.rtpMap)!==null&&O!==void 0&&O.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),u&&w.rtcpFeedbacks.push({type:"rrtr"})}),n&&(p=p.filter(w=>{var O;return((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"}),m=m.filter(w=>{var O;return((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"})),o&&(m=m.filter(w=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),a&&(p=p.filter(w=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(w=>{var O;return se(l).call(l,((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){let w=m.filter(O=>{var P;return se(d).call(d,((P=O.rtpMap)===null||P===void 0?void 0:P.encodingName.toLowerCase())||"")});m=w.concat(n?[]:Iv(w,m))}let R=N("UNSUPPORTED_VIDEO_CODEC");return R&&R.length>0&&(m=m.filter(w=>!(w.rtpMap&&se(R).call(R,w.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:m,audioExtensions:f,videoExtensions:E}}function go(e){let t=Nt.parse(e),i,r;for(let n of t.mediaDescriptions){if(!i){let o=n.attributes.iceUfrag,a=n.attributes.icePwd;if(!o||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:o,icePwd:a}}if(!r){let o=n.attributes.fingerprints;o.length>0&&(r={fingerprints:o})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:r}}function vv(e,t){let i=[],r=e.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),n=e.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),o=e.attributes.ssrcs;if(n)n.ssrcIds.forEach(a=>{var l;let d=(l=r.find(u=>u.ssrcIds[0]===a))===null||l===void 0?void 0:l.ssrcIds[1];i.push({ssrcId:a,rtx:t?d:void 0})});else if(r.length>0){let a=r[0].ssrcIds[0],l=r[0].ssrcIds[1];i.push({ssrcId:a,rtx:t?l:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:o[0].ssrcId})}return i}function RL(e,t){let{cname:i}=e,r;t&&t.ip&&typeof t.port=="number"?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));let n={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},a;switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}return{dtlsParameters:n,iceParameters:o,candidates:r,rtpCapabilities:nd(e.rtpCapabilities),setup:a,cname:i}}function on(e,t,i){let r=[],n=[];return e.forEach(o=>{let{ssrcId:a,rtx:l}=o,d=ft(8,"track-"),u={ssrcId:a,attributes:vL({label:d,mslabel:i=i||ft(10,""),msid:"".concat(i," ").concat(d)},t&&{cname:t})};if(r.push(u),l!==void 0){let p={ssrcId:l,attributes:vL({label:d,mslabel:i,msid:"".concat(i," ").concat(d)},t&&{cname:t})};r.push(p),n.push({semantic:"FID",ssrcIds:[a,l]})}}),e.length>1&&n.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:a}=o;return a})}),{ssrcs:r,ssrcGroups:n}}function la(e,t){t instanceof jt&&e.attributes.payloads.forEach(i=>{var r;let n=(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!n||["opus","pcmu","pcma","g722"].indexOf(n)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let o=t._encoderConfig;o&&n!=="pcmu"&&n!=="pcma"&&n!=="g722"&&(o.bitrate&&!mt()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function d_(e){let t=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function u_(e,t){var i;if(!(t instanceof Et&&t._encoderConfig&&t._hints.indexOf(Rt.SCREEN_TRACK)===-1))return;let r=t._encoderConfig;Ye().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(n=>{var o,a;se(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=n.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ye().supportMinBitrate&&!se(i=t._hints).call(i,Rt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(n=>{var o,a;se(o=["h264","h265","vp8","vp9","av1"]).call(o,((a=n.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters["x-google-start-bitrate"]="".concat(N("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function Rv(e){if(e.media.mediaType!=="video")return;let t=Xe();if(t.name!==ot.SAFARI&&t.os!==pi.IOS)return;let i=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function rd(e,t,i){if(!t)return;let r,n;if(e.media.mediaType==="video"?(r=i.videoExtensions,n=i.videoCodecs):(r=i.audioExtensions,n=i.audioCodecs),t.twcc===!0){let o=r.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,l){return l.filter(d=>!!a.find(u=>u.payloadType===d.payloadType&&!!u.rtcpFeedbacks.find(p=>p.type==="transport-cc")))}(n,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(l=>l.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let l=a.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&a.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){let o=r.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o&&(e.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,l){return l.filter(d=>!!a.find(u=>u.payloadType===d.payloadType&&!!u.rtcpFeedbacks.find(p=>p.type==="goog-remb")))}(n,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(l=>l.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let o=e.attributes.extmaps.findIndex(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(a=>{let l=a.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&a.rtcpFeedbacks.splice(l,1)})}}function Cv(e,t,i){if(mt()||e.media.mediaType!=="video"||!(t instanceof Et)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!N("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let r=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,n=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===n.ssrcId),a={semantic:"SIM",ssrcIds:[n.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:n.ssrcId+l,attributes:vt(n.attributes)}),a.ssrcIds.push(n.ssrcId+l),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+l,attributes:vt(n.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[n.ssrcId+l,o.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(a)}async function yv(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let r=(await i.createOffer()).sdp,{send:n,recv:o,sendrecv:a}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0,p=nh(u,l,d,"sendonly"),m=nh(u,l,d,"recvonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jn(p,m,"videoExtensions",f,E,I),Jn(p,m,"videoCodecs",f,E,I),Jn(p,m,"audioExtensions",f,E,I),Jn(p,m,"audioCodecs",f,E,I),N("RAISE_H264_BASELINE_PRIORITY")){let T=I.videoCodecs.findIndex(R=>{var w,O;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLocaleLowerCase())==="h264"&&((O=R.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])==="42001f"});if(T!==-1){let R=I.videoCodecs.findIndex(w=>{var O;return((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"});if(R<T){S.debug("raising H264 baseline profile priority");let w=I.videoCodecs[T];I.videoCodecs.splice(T,1),I.videoCodecs.splice(R,0,w)}R!==-1&&(E.videoCodecs=E.videoCodecs.filter(w=>{var O,P;return!(((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((P=w.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")})),R!==-1&&N("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter(w=>{var O,P;return!(((O=w.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((P=w.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")}))}}return{send:f,recv:E,sendrecv:I}}(e,t,r);try{i.close()}catch{}return{send:n,recv:o,sendrecv:a}}function CL(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=nh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jn(e,t,"videoExtensions",i,r,n),Jn(e,t,"videoCodecs",i,r,n),Jn(e,t,"audioExtensions",i,r,n),Jn(e,t,"audioCodecs",i,r,n),N("RAISE_H264_BASELINE_PRIORITY")){let o=n.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){let a=n.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(a<o){S.debug("raising H264 baseline profile priority");let l=n.videoCodecs[o];n.videoCodecs.splice(o,1),n.videoCodecs.splice(a,0,l)}a!==-1&&(r.videoCodecs=r.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:r,sendrecv:n}}function Jn(e,t,i,r,n,o){if(i==="videoExtensions"||i==="audioExtensions"){let a=[];return e[i].forEach(l=>{t[i].some((d,u)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return a.push(u),!0})?o[i].push(l):r[i].push(l)}),void t[i].forEach((l,d)=>{a.indexOf(d)===-1&&n[i].push(l)})}if(i==="videoCodecs"||i==="audioCodecs"){let a=[];return e[i].forEach(l=>{t[i].some((d,u)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return a.push(u),!0})?o[i].push(l):r[i].push(l)}),void t[i].forEach((l,d)=>{a.indexOf(d)===-1&&n[i].push(l)})}}function nd(e){let{send:t,recv:i,sendrecv:r}=e;if(!r){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let n,o;return t?(n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n.audioCodecs=[...t.audioCodecs,...r.audioCodecs],n.videoCodecs=[...t.videoCodecs,...r.videoCodecs],n.audioExtensions=[...t.audioExtensions,...r.audioExtensions],n.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):n=r,i?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...i.audioCodecs,...r.audioCodecs],o.videoCodecs=[...i.videoCodecs,...r.videoCodecs],o.audioExtensions=[...i.audioExtensions,...r.audioExtensions],o.videoExtensions=[...i.videoExtensions,...r.videoExtensions]):o=r,{send:n,recv:o}}function So(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function h_(e){e.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(i=>{i.rtcpFeedbacks.findIndex(r=>r.type==="rrtr")===-1&&i.rtcpFeedbacks.push({type:"rrtr"})})})}function yc(e,t,i,r){let n=[];if(e===me.VIDEO){if(N("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(n=t.videoCodecs.filter(o=>{var a;return se(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,r)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===N("H264_PROFILE_LEVEL_ID")})),!Array.isArray(n)||n.length===0){let o=[],a=[],l=[],d=[];if(i.videoCodecs.forEach(u=>{let p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"";se(p).call(p,r)?o.push(u):se(p).call(p,"vp9")?a.push(u):se(p).call(p,"vp8")?l.push(u):se(p).call(p,"h264")&&d.push(u)}),o.length===0){let u="";a.length!==0?(o=a,u="vp9"):l.length!==0?(o=l,u="vp8"):d.length!==0&&(o=d,u="h264"),S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}o.length!==0&&(n=t.videoCodecs.filter(u=>o.some(p=>p.payloadType===u.payloadType)))}if(n.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),n=t.videoCodecs),N("USE_PUB_RTX")||N("USE_SUB_RTX")){let o=Iv(n,t.videoCodecs);n=[...n,...o]}}else n=t.audioCodecs.filter(o=>{var a;return se(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,r)}),n.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),n=t.audioCodecs.filter(o=>{var a;return se(a=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(a,"opus")}));return n}function Iv(e,t){let i=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&se(i).call(i,r.fmtp&&r.fmtp.parameters.apt))}let yL=class{get localCapabilities(){return vt(this._localCapabilities)}get rtpCapabilities(){return vt(this._rtpCapabilities)}get candidates(){return vt(this._candidates)}get iceParameters(){return vt(this._iceParameters)}get dtlsParameters(){return vt(this._dtlsParameters)}constructor(e){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname","o/i14u9pJrxRKAsu"),y(this,"firefoxSsrcMidMap",new Map),e=vt(e);let{remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:n,localCapabilities:o,direction:a,setup:l,videoCodec:d,audioCodec:u}=e,p;this.setup=l,p=a===nr.RECEIVE_ONLY?Nt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Nt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=n,this._candidates=r,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=o;let m=a===nr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,f=a===nr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,E=a===nr.RECEIVE_ONLY?n.send.videoCodecs:yc(me.VIDEO,m,f,d),I=a===nr.RECEIVE_ONLY?n.send.audioCodecs:yc(me.AUDIO,m,f,u);for(let T of p.mediaDescriptions)T.attributes.iceUfrag=t.iceUfrag,T.attributes.icePwd=t.icePwd,T.attributes.fingerprints=i.fingerprints,T.attributes.candidates=r,T.attributes.setup=this.setup,T.media.mediaType==="application"&&(T.attributes.sctpPort="5000"),T.media.mediaType==="video"&&(T.media.fmts=E.map(R=>R.payloadType.toString(10)),T.attributes.payloads=E,T.attributes.extmaps=m.videoExtensions),T.media.mediaType==="audio"&&(T.media.fmts=I.map(R=>R.payloadType.toString(10)),T.attributes.payloads=I,T.attributes.extmaps=m.audioExtensions,So(T));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Nt.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,i,r,n){i=i.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:a}=on(t,this.cname,N("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(o);if(l){if(mt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),n&&(n.twcc||n.remb)){let d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,n),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let d=this.findAvailableMediaIndex(e,o,r),u;return d===-1?(u=this.createOrRecycleSendMedia(e,o,a,"sendonly",r,n),this.updateBundleMids()):(u=vt(this.sessionDesc.mediaDescriptions[d]),u.attributes.direction="sendonly",u.attributes.ssrcs=o,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(u,n)),mt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),{needExchangeSDP:!0,mid:u.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,i){let r=[];return e.forEach(n=>{let o=n._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(o),l,d=!1;a===-1?(d=!0,l=this.createOrRecycleRecvMedia(n,[],"recvonly",t,i),this.updateBundleMids()):(l=vt(this.sessionDesc.mediaDescriptions[a]),l.attributes.direction="recvonly"),r.push({mid:l.attributes.mid,needCreateTransceiver:d})}),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:i,address:r,port:n,type:o,relatedAddress:a,relatedPort:l,priority:d}=new RTCIceCandidate(e),u={foundation:t??"",componentId:"1",transport:i??"",priority:d?d+"":"",connectionAddress:r??"",port:n?n+"":"",type:o?o+"":"",relAddr:a??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===u.priority&&p.connectionAddress===u.connectionAddress&&p.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,r,n){let o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,l=yc(o,a,this.localCapabilities.send,o===me.AUDIO?n:r),d=o===me.VIDEO?a.videoExtensions:a.audioExtensions,u="".concat(++this.currentMidIndex),p={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(f=>f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};p=this.mungRecvMediaDsec(p,e);let m=this.findFirstClosedMedia(o);if(m){let f=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[f]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>se(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>se(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let n=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(mt()){if(n){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!o||o!==r.attributes.mid)}return!1}return n&&r.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=vt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,i,r,n,o){let a=this.rtpCapabilities.send,l=e===me.VIDEO?a.videoCodecs:a.audioCodecs,d=e===me.VIDEO?a.videoExtensions:a.audioExtensions;mt()&&(n="".concat(++this.currentMidIndex));let u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:n}};u=this.mungSendMediaDesc(u,o);let p=this.findFirstClosedMedia(e);if(p){let m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(e,t,i){let r=vt(e);return d_(r),la(r,t),u_(r,t),Rv(r),rd(r,i,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let i=vt(e);return rd(i,t,this.localCapabilities.recv),So(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>mt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},V9=["sdp"];var yt;function IL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function da(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?IL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):IL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let wL=(yt=class pd extends aN{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,r){super(t,i),y(this,"direction",void 0),y(this,"name",void 0),y(this,"store",void 0),y(this,"spec",void 0),y(this,"peerConnection",void 0),y(this,"initialOffer",void 0),y(this,"transport",void 0),y(this,"statsFilter",void 0),y(this,"localCandidateCount",0),y(this,"_isInRestartIce",!1),y(this,"mutex",new vi("P2PConnection-mutex")),y(this,"onLocalCandidate",void 0),y(this,"remoteSDP",void 0),y(this,"pendingCandidates",[]),y(this,"localCapabilities",void 0),y(this,"isReady",!1),y(this,"restartCnt",0),y(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.peerConnection=new RTCPeerConnection(pd.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??nr.SEND_ONLY,this.name=this.direction===nr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=l_(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let i=await yv();if(this.localCapabilities=nd(i),t){let{sdp:r}=t,n=L9(t,V9),o=function(){let p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=nh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jn(m,p,"videoExtensions",f,E,I),Jn(m,p,"videoCodecs",f,E,I),Jn(m,p,"audioExtensions",f,E,I),Jn(m,p,"audioCodecs",f,E,I),N("RAISE_H264_BASELINE_PRIORITY")){let T=I.videoCodecs.findIndex(R=>R.rtpMap&&R.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&R.fmtp&&R.fmtp.parameters["profile-level-id"]==="42001f");if(T!==-1){let R=I.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(R<T){S.debug("raising H264 baseline profile priority");let w=I.videoCodecs[T];I.videoCodecs.splice(T,1),I.videoCodecs.splice(R,0,w)}R!==-1&&N("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter(w=>!(w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:f,recv:E,sendrecv:I}}({},{},r);this.remoteSDP=new yL({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let a=await this.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let l=go(a.sdp);await this.peerConnection.setLocalDescription(a);let d=await CL({},{},a.sdp);this.localCapabilities=nd(d);let u=this.peerConnection.getTransceivers()[0];return u!=null&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),da(da({},l),{},{sdp:a.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=go(r.sdp);return this.initialOffer=r,da(da({},n),{},{sdp:r.sdp})}}catch(i){throw new B(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:r,dtlsParameters:n}=t,o=await CL({},{},i);this.remoteSDP=new yL({remoteIceParameters:r,remoteDtlsParameters:n,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let a=this.peerConnection.getTransceivers()[0];a!=null&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new B(A.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,r){var n=this;return Vr(function*(){let o=yield xe(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[],l=n.remoteSDP.receive(t,i,r);t.forEach((R,w)=>{if(l[w].needCreateTransceiver){let O=n.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});a.push(O),R._updateRtpTransceiver(O)}else{let O=n.peerConnection.getTransceivers().find(P=>P.mid===l[w].mid);if(!O)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[w].mid));a.push(O),R._updateRtpTransceiver(O)}}),mt()&&N("SIMULCAST")===!0&&(yield xe(n.applySimulcastForFirefox(a,t)));let d=l.map(R=>R.mid),u=yield xe(n.peerConnection.createOffer()),p=n.mungSendOfferSDP(u.sdp,t,d),m=Nt.parse(p),f=d.map(R=>{let w=m.mediaDescriptions.find(O=>O.attributes.mid===R);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return vv(w,N("USE_PUB_RTX"))}),E=a.map((R,w)=>{let O=d[w];return{localSSRC:f[w],id:O}});yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield E}catch(R){let w=n.remoteSDP.toString();throw yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield xe(n.stopSending(d,!0)),R}yield xe(n.applySimulcastEncodings(a,t)),yield xe(n.applySendEncodings(a,t));let I=n.remoteSDP.toString(),T=n.logSDPExchange(p,"offer","local","send");return T==null||T(I),yield xe(n.setRemoteDescription({type:"answer",sdp:I})),a.map((R,w)=>{let O=d[w];return{localSSRC:f[w],id:O}})}catch(a){throw a instanceof B?a:new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length (".concat(n.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));n.map(d=>{var u;d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{r&&r()}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,i,r,n);if(a){let d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});let p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,o,t);u==null||u(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(o){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,i,r,n);if(a){let l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});let u=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(u.sdp,o,t);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ac.Auto&&(this.store.p2pTransport=ac.SdRtn,Ye().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pd.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ye().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pd.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:r}=go(i.sdp);return this.store.descriptionStart(),this.direction===nr.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===nr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:r}=go(i.sdp);return await this.peerConnection.setLocalDescription(i),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let o=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new B(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(n=>n.mid===t);r.length===1&&(this.isVP8Simulcast(i)?mt()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(n=>n.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:n}=i.getSelectedCandidatePair();return{local:da(da({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:da(da({},Zo),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;se(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n={iceServers:[]};var o;return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yl(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...pd.turnServerConfigToIceServers(t.turnServer.servers,i,r)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...pd.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,r)),se(o=[ac.Relay,ac.SdRtn]).call(o,i)&&(n.iceTransportPolicy="relay"),N("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&Ye().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(i)),n}static turnServerConfigToIceServers(t,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=[],o=t.filter(l=>l.tcpport);S.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(r));let a=o.length>r?o[r]:o[0];switch(i){case ac.SdRtn:let l=t.filter(u=>{var p;return se(p=u.username).call(p,"glb:")&&u.turnServerURL==u.turnServerURL}),d=l.length>r?l[r]:l[0];d&&(n.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(ta(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),n.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(ta(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case ac.Relay:a&&(n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(ta(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(ta(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return n}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var n;(n=this.onDTLSTransportError)===null||n===void 0||n.call(this,"error"in r?r.error:r)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let r=t==null?void 0:t.iceTransport.state;var n;r&&((n=this.onICETransportStateChange)===null||n===void 0||n.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:r,remote:n}=i.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(p=>p.track===t._mediaStreamTrack)),!i)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ye().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let n={},o={};switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(t._encoderConfig){var a;let{bitrateMax:p,frameRate:m,scaleResolutionDownBy:f}=t._encoderConfig;p&&(o.maxBitrate=1e3*p),se(a=t._hints).call(a,Rt.LOW_STREAM)&&(m&&(o.maxFramerate=Cr(m)),f&&f>=1&&(o.scaleResolutionDownBy=f))}if(N("DSCP_TYPE")&&qs()){var l;let p=N("DSCP_TYPE");se(l=["very-low","low","medium","high"]).call(l,p)&&(o.networkPriority=p)}let d=i.getParameters(),u=(r=d.encodings)===null||r===void 0?void 0:r[0];mt()&&!u&&(n.encodings=[o]),u&&Object.assign(u,o),Object.assign(d,n),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await i.setParameters(d)}async applySendEncodings(t,i){try{if(!Ye().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],o=i[r];o instanceof Et&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,n.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let n=Nt.parse(t);return i.forEach((o,a)=>{let l=r[a],d=n.mediaDescriptions.find(u=>u.attributes.mid===l);d&&(la(d,o),Cv(d,o,this.store.codec))}),Nt.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,n,o,a,l;let u=t[d],p=i[d];if(p instanceof Et&&!se(r=p._hints).call(r,Rt.LOW_STREAM)&&(n=p._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((o=p._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let m={},f={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:f.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:f.high}];let E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,m))}}}async applySimulcastEncodings(t,i){if(!mt()&&t.length===i.length)for(let r=0;r<t.length;r++){let n=i[r];if(n instanceof Et&&this.isVP8Simulcast(n)){let o=t[r],a={},l={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,a))}}}isVP8Simulcast(t){var i,r,n,o,a;return!!(t instanceof Et&&N("SIMULCAST")&&this.store.codec==="vp8"&&!se(i=t._hints).call(i,Rt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,i,r,n){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(n,`
`),t),i==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",n)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(a=>{a.direction="inactive"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async a=>{a.direction="sendonly"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var r,n;if(i=(r=i)!==null&&r!==void 0?r:(n=this.currentRemoteDescription)===null||n===void 0?void 0:n.sdp){var o;let a=(o=Nt.parse(i).mediaDescriptions.find(l=>l.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return a==null?void 0:a[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),se(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,r){let n=Nt.parse(t),o=n.mediaDescriptions.find(a=>a.attributes.mid===i);return o&&r===me.AUDIO&&o.media.mediaType==="audio"&&So(o),Nt.print(n)}},ie(yt.prototype,"establish",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"establish"),yt.prototype),ie(yt.prototype,"connect",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"connect"),yt.prototype),ie(yt.prototype,"receive",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"receive"),yt.prototype),ie(yt.prototype,"mockReceive",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"mockReceive"),yt.prototype),ie(yt.prototype,"stopReceiving",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"stopReceiving"),yt.prototype),ie(yt.prototype,"restartICE",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"restartICE"),yt.prototype),ie(yt.prototype,"close",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"close"),yt.prototype),ie(yt.prototype,"updateEncoderConfig",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"updateEncoderConfig"),yt.prototype),ie(yt.prototype,"updateSendParameters",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"updateSendParameters"),yt.prototype),ie(yt.prototype,"replaceTrack",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"replaceTrack"),yt.prototype),ie(yt.prototype,"muteLocal",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"muteLocal"),yt.prototype),ie(yt.prototype,"unmuteLocal",[Xn],Object.getOwnPropertyDescriptor(yt.prototype,"unmuteLocal"),yt.prototype),yt);function Xn(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}function wv(e,t){let i=document.createElement("video"),r=document.createElement("canvas");i.setAttribute("style","display:none"),r.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),r.width=Cr(t.width),r.height=Cr(t.height);let n=Cr(t.framerate||15);document.body.append(i),document.body.append(r);let o=e._mediaStreamTrack;i.srcObject=new MediaStream([o]),i.play();let a=r.getContext("2d");if(!a)throw new U(A.UNEXPECTED_ERROR,"can not get canvas context");let l=Ye(),d=r.captureStream(l.supportRequestFrame?0:n).getVideoTracks()[0];d.canvas||(d.canvas=r),r.startCapture=()=>{if(!i)return r.stopCapture&&r.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let p=i.videoWidth,m=i.videoHeight/p,f=r.width*m;Math.abs(f-r.height)>=2&&(S.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(f)),r.height=f)}a.drawImage(i,0,0,r.width,r.height),d.requestFrame&&d.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,i.srcObject=new MediaStream([o]))},r.stopCapture=av(()=>r.startCapture&&r.startCapture(),n);let u=d.stop;return d.stop=()=>{u.call(d),i&&(i.remove(),i.srcObject=null,i=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),S.debug("clean low stream renderer")},d}var p_=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(p_||{}),Ei=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Ei||{}),Ic=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Ic||{}),Ki=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Ki||{}),wc=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(wc||{}),AL=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(AL||{}),ua=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(ua||{}),Qn=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(Qn||{}),OL=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(OL||{}),Tn=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Tn||{});let Cs=1e3,Ac=3;function je(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function bL(e){let t={[Tn.CONN_TYPE]:0,[Tn.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[Tn.CONN_TYPE]=1),i==="tcp"&&(t[Tn.CONN_TYPE]=3),i==="tls"&&(t[Tn.CONN_TYPE]=4);break}case"srflx":t[Tn.CONN_TYPE]=2}return t}function NL(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class DL extends Ot{constructor(t){super(),y(this,"store",void 0),y(this,"uploadWRTCStatsTimer",void 0),y(this,"uploadOutboundDenoiserStatsTimer",void 0),y(this,"uploadExtStatsTimer",void 0),y(this,"uploadExtUsageStatsTimer",void 0),y(this,"uploadInboundExtStatsTimer",void 0),y(this,"requestStats",void 0),y(this,"requestTransportStats",void 0),y(this,"requestLocalMedia",void 0),y(this,"requestRemoteMedia",void 0),y(this,"requestAllTracks",void 0),y(this,"requestVideoIsReady",void 0),y(this,"requestUploadStats",void 0),y(this,"requestUpload",void 0),y(this,"uploadOutboundStarted",!1),y(this,"uploadInboundStarted",!1),y(this,"uploadTransportStarted",!1),y(this,"uploadExtensionUsageStarted",!1),y(this,"lastRecvStats",void 0),y(this,"lastSendStats",void 0),y(this,"lastFullRecvStats",void 0),y(this,"lastFullSendStats",void 0),y(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let i,r;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),i||r){let n={};if(this.uploadTransportStarted&&i){let o=this.getTransportStats(i,r,t);o&&(n.misc=[o])}if(this.uploadOutboundStarted&&i){let o=this.getOutboundStats(i,t?this.lastSendStats:this.lastFullSendStats,t);o&&(n.outbound=[o])}if(this.uploadInboundStarted&&r){let o=this.getInboundStats(r,t?this.lastRecvStats:this.lastFullRecvStats,t);o&&(n.inbound=o)}this.requestUploadStats(n)}this.lastRecvStats=r,this.lastSendStats=i,t||(this.lastFullRecvStats=r,this.lastFullSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Ac),++t===Ac+1&&(t=1)},Cs)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,i,r){if(!this.requestStats)return;if(r)return t.rtt==null?void 0:{addition:{[Tn.RTT]:t.rtt,[Tn.CONN_TYPE]:void 0}};let n=bL(t);if(this.store.useP2P){if(i){let o=bL(i);n[Tn.CONN_TYPE]+=o[Tn.CONN_TYPE]<<3}n[Tn.CONN_TYPE]+=110}else n[Tn.CONN_TYPE]+=100;return{addition:n}}getOutboundStats(t,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;let n=this.requestLocalMedia();if(!n||n.length===0)return;let o,a,l;return n.forEach(d=>{let[u,{track:p,ssrcs:m}]=d;switch(u){case X.LocalVideoLowTrack:case X.LocalVideoTrack:if(u===X.LocalVideoTrack){let f=function(T,R,w,O,P){let M=R.videoSend.find(pe=>pe.ssrc===T);if(!M)return;let V={},{sentFrame:F,inputFrame:q}=M;if(q&&F){let pe=q.frameRate,ze=F.frameRate;V[Ei.FREEZE]=function(nt,Ct){let $t=!0;return $t=!(nt<=5)&&(nt<=10?Ct<3:nt<=20?Ct<4:Ct<5),$t}(pe,ze)?1:0}if(je(V,Ei.QP_SUM,M.qpSumPerFrame),P)return V;switch(F&&(je(V,Ei.HEIGHT,F.height),je(V,Ei.WIDTH,F.width),je(V,Ei.FRAME_RATE,F.frameRate)),V[Ei.DISABLED]=O._originMediaStreamTrack&&!O._originMediaStreamTrack.enabled||O._mediaStreamTrack&&!O._mediaStreamTrack.enabled?1:0,M.adaptionChangeReason){case"none":V[Ei.ADAPTATION]=0;break;case"cpu":V[Ei.ADAPTATION]=1;break;case"bandwidth":V[Ei.ADAPTATION]=2;break;case"other":V[Ei.ADAPTATION]=3}let J=0;M.adaptionChangeReason&&(J+=NL(M.adaptionChangeReason)),R.qualityLimitationReason&&(J+=NL(R.qualityLimitationReason)<<3),V[Ei.ADAPTATION]=J,V[Ei.PLAYER_STATUS]=ov[O._player?O._player.videoElementStatus:"uninit"],je(V,Ei.NACKS,M.nacksCount),je(V,Ei.PLIS,M.plisCount),je(V,Ei.FIRS,M.firsCount),je(V,Ei.AVG_ENCODE,M.avgEncodeMs);let Z=w&&w.videoSend.find(pe=>pe.ssrc===T);if(Z){let pe=P?Cs:Cs*Ac;Z.timestamp&&M.timestamp&&(pe=M.timestamp-Z.timestamp),Z.packets!=null&&M.packets!=null&&je(V,Ei.PACKAGE_RATE,1e3*(M.packets-Z.packets)/pe),M.packetsLost!=null&&Z.packetsLost!=null&&je(V,Ei.PACKAGE_LOST,M.packetsLost-Z.packetsLost),Z.bytes!=null&&M.bytes!=null&&je(V,Ei.BITRATE,8*(M.bytes-Z.bytes)/pe)}return V}(m[0].ssrcId,t,i,p,r),E=r?null:function(T,R,w){let O=R.videoSend.find(J=>J.ssrc===T);if(!O)return null;let P={},M=O.inputFrame,V=M&&M.height||w&&w.videoHeight||0,F=M&&M.width||w&&w.videoWidth||0,q=M&&M.frameRate||0;return je(P,p_.HEIGHT,V),je(P,p_.WIDTH,F),je(P,p_.FRAME_RATE,q),P}(m[0].ssrcId,t,p),I=r?null:function(T){let R={};return je(R,Ei.RETRANSMIT,T.bitrate.retransmit),je(R,Ei.TARGET_ENCODED,T.bitrate.targetEncoded),je(R,Ei.ACTUAL_ENCODED,T.bitrate.actualEncoded),je(R,Ei.TRANSMIT,T.bitrate.transmit),je(R,Ei.BANDWIDTH,T.sendBandwidth),R}(t);a=Object.assign({},f,E,I)}else l=r?void 0:function(f,E,I){let T=E.videoSend.find(O=>O.ssrc===f);if(!T)return;let R={},w=T.sentFrame;if(w&&(je(R,Ic.HEIGHT,w.height),je(R,Ic.WIDTH,w.width),je(R,Ic.FRAME_RATE,w.frameRate)),I){let O=I.videoSend.find(P=>P.ssrc===f);if(O){let P=Cs*Ac;O.timestamp&&T.timestamp&&(P=T.timestamp-O.timestamp),O.packets!=null&&T.packets!=null&&je(R,Ic.PACKAGE_RATE,1e3*(T.packets-O.packets)/P),T.packetsLost!=null&&O.packetsLost!=null&&je(R,Ic.PACKAGE_LOST,T.packetsLost-O.packetsLost),O.bytes!=null&&T.bytes!=null&&je(R,Ic.BITRATE,8*(T.bytes-O.bytes)/P)}}return R}(m[0].ssrcId,t,i);break;case X.LocalAudioTrack:o=r?void 0:function(f,E,I,T){let R=E.audioSend.find(V=>V.ssrc===f);if(!R)return;let w={};w[ua.DISABLED]=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||T._mediaStreamTrack&&!T._mediaStreamTrack.enabled?1:0;let O=100*T._source.getAccurateVolumeLevel(),P=R.inputLevel;if(P!=null){let V=Math.ceil(50*Math.log10(100*P+1));je(w,ua.LEVEL,V)}je(w,AL.PCM_LEVEL,O),je(w,ua.AEC_RETURN_LOSS,R.aecReturnLoss),je(w,ua.AEC_RETURN_LOSS_ENH,R.aecReturnLossEnhancement),w[ua.FREEZE]=0;let M=I&&I.audioSend.find(V=>V.ssrc===f);if(M){let V=Cs*Ac;M.timestamp&&R.timestamp&&(V=R.timestamp-M.timestamp),M.bytes!=null&&R.bytes!=null&&je(w,ua.BITRATE,8*(R.bytes-M.bytes)/V),M.packets!=null&&R.packets!=null&&je(w,ua.PACKAGE_RATE,1e3*(R.packets-M.packets)/V)}return w}(m[0].ssrcId,t,i,p)}}),{high:a,low:l,audio:o}}getInboundStats(t,i,r){if(!this.requestRemoteMedia)return;let n=this.requestRemoteMedia()||[],o=[];return n.forEach(a=>{let[l,d]=a,u={peer:l.uid};if(d.has(me.VIDEO)&&l.videoTrack){let p=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,m=l.videoTrack?function(f,E,I,T,R,w,O){var P;let M=E.videoRecv.find(ze=>ze.ssrc===f);if(!M)return;let V={},{receivedFrame:F,outputFrame:q,decodeFrameRate:J}=M,Z=I&&I.videoRecv.find(ze=>ze.ssrc===f);if(V[Ki.FREEZE]=R&&oh.isRemoteVideoFreeze(T,M,Z)?1:0,je(V,wc.FRAME_RATE_DECODE,J),je(V,Ki.QP_SUM,M.qpSumPerFrame),M.framesRateFirefox&&je(V,Ki.FRAME_RATE,M.framesRateFirefox),F&&je(V,Ki.FRAME_RATE,F.frameRate),Z){let ze=E.timestamp-I.timestamp||(O?Cs:Ac*Cs);M.packetsLost!=null&&Z.packetsLost!=null&&je(V,Ki.PACKAGE_LOST,M.packetsLost-Z.packetsLost),Z.bytes!=null&&M.bytes!=null&&je(V,Ki.BITRATE,8*(M.bytes-Z.bytes)/ze),Z.packets!=null&&M.packets!=null&&je(V,Ki.PACKAGE_RATE,1e3*(M.packets-Z.packets)/ze)}if(O)return V;F?(je(V,Ki.HEIGHT,F.height),je(V,Ki.WIDTH,F.width)):T&&(je(V,Ki.HEIGHT,T._videoHeight||0),je(V,Ki.WIDTH,T._videoWidth||0)),q&&je(V,wc.FRAME_RATE_OUTPUT,q.frameRate);let pe=(P=T._player)===null||P===void 0?void 0:P.rendFrameRate.toFixed(0);if(pe&&je(V,wc.FRAME_RATE_RENDER,+pe),je(V,Ki.JITTER_BUFFER,M.jitterBufferMs),je(V,Ki.CURRENT_DELAY,M.currentDelayMs),je(V,Ki.FIRS,M.firsCount),je(V,Ki.NACKS,M.nacksCount),je(V,Ki.PLIS,M.plisCount),T){V[Ki.DISABLED]=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?0:1;let ze=T._player;if(ze){let{freezeTimeCounterList:nt,renderFreezeAccTime:Ct,videoElementStatus:$t}=ze;if(nt&&nt.length>0&&je(V,wc.FREEZE_TIME,nt.splice(0,1)[0]),w&&Rs.visibility==="visible"&&$t===Qi.PLAYING&&Ye().supportRequestVideoFrameCallback){let Mt=Math.min(6e3,Ct);ze.renderFreezeAccTime=Math.max(0,Ct-Mt),je(V,wc.FREEZE_TIME_RENDER,Mt)}if(typeof M.totalFreezesDuration=="number"){let Mt=Z&&Z.totalFreezesDuration?M.totalFreezesDuration-Z.totalFreezesDuration:M.totalFreezesDuration;je(V,wc.FREEZE_DURATION,1e3*Mt)}}}if(V[Ki.PLAYER_STATUS]=ov[T._player?T._player.videoElementStatus:"uninit"],Z&&M.totalInterFrameDelay!==void 0&&M.totalSquaredInterFrameDelay!==void 0&&Z.totalInterFrameDelay!==void 0&&Z.totalSquaredInterFrameDelay!==void 0){let ze=M.totalInterFrameDelay-Z.totalInterFrameDelay,nt=M.totalSquaredInterFrameDelay-Z.totalSquaredInterFrameDelay,Ct=M.framesDecodeCount-Z.framesDecodeCount,$t=ze/Ct*1e3,Mt=Math.round(1e3*Math.sqrt((nt-Math.pow(ze,2)/Ct)/Ct));!isNaN(Mt)&&$t+Mt>Math.max(3*$t,$t+150)&&(V[Ki.I_FRAME_DELAY]=Mt)}return V}(l._videoSSRC,t,i,l.videoTrack,p===!0,this.needUploadRenderFreezeTime,r):void 0;m&&(u.video=m)}if(d.has(me.AUDIO)&&l.audioTrack){let p=l.audioTrack?function(m,f,E,I,T){let R=f.audioRecv.find(Z=>Z.ssrc===m);if(!R)return;let w={},O=E&&E.audioRecv.find(Z=>Z.ssrc===m),{receivedFrames:P,droppedFrames:M}=R;var V,F;if(je(w,Qn.JITTER,R.jitterMs),P!=null&&M!=null&&(w[Qn.FREEZE]=(F=M,(V=P)===0||100*F/V>20?1:0)),O){let Z=f.timestamp-E.timestamp||(T?Cs:Cs*Ac);R.packets!=null&&O.packets!=null&&je(w,Qn.PACKAGE_RATE,1e3*(R.packets-O.packets)/Z),O.bytes!=null&&R.bytes!=null&&je(w,Qn.BITRATE,8*(R.bytes-O.bytes)/Z),R.packetsLost!=null&&O.packetsLost!=null&&je(w,Qn.PACKAGE_LOST,R.packetsLost-O.packetsLost)}if(T)return w;let q=100*I._source.getAccurateVolumeLevel(),J=R.outputLevel;if(J!=null){let Z=Math.ceil(50*Math.log10(100*J+1));je(w,OL.LEVEL,Z)}if(je(w,Qn.PCM_LEVEL,q),I&&(w[Qn.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),je(w,Qn.JITTER_BUFFER,R.jitterBufferMs),je(w,Qn.CURRENT_DELAY,R.jitterBufferMs),w[Qn.PLAYER_STATUS]=ov[mr.getPlayerState(I.getTrackId())],O){let Z=R.concealedSamples-O.concealedSamples;Z>0&&je(w,Qn.CONCEALED_SAMPLES,Z)}return w}(l._audioSSRC,t,i,l.audioTrack,r):void 0;p&&(u.audio=p)}(u.video||u.audio)&&o.push(u)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(i=>i instanceof n_);if(t&&t._external.getDenoiserStats){let i=t._external.getDenoiserStats();i&&this.requestUpload(lc.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[i,r]=t;r.has(me.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}),r.has(me.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let i=Date.now(),r={connectionInterval:N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i},n=[],o=this.requestAllTracks&&this.requestAllTracks()||[];for(let u of o)!u.muted&&u.enabled&&(n=n.concat(await u.getProcessorUsage()));let a=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[u,p]of a)p.has(me.VIDEO)&&u.videoTrack&&(n=n.concat(await u.videoTrack.getProcessorUsage())),p.has(me.AUDIO)&&u.audioTrack&&(n=n.concat(await u.audioTrack.getProcessorUsage()));if(n.length===0)return;r.details=function(u,p){let m={};for(let{id:T,value:R,level:w,direction:O}of u){var f;let P=(f=p.get(T))!==null&&f!==void 0?f:0,M=R===2?P+N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:P;var E,I;p.set(T,M),m[T]?(R===2&&(m[T].value=R),w>m[T].level&&(m[T].level=w),O==="remote"&&(m[T].remoteUidCount+=1),m[T].totalTs=(E=p.get(T))!==null&&E!==void 0?E:0):m[T]={value:R,level:w,remoteUidCount:O==="local"?0:1,totalTs:(I=p.get(T))!==null&&I!==void 0?I:0}}return Object.keys(m).map(T=>{let{level:R,value:w,totalTs:O}=m[T];return{id:T,level:R,value:w,totalTs:O}})}(n,t);let l=Date.now(),d=l>i?l:i+1;this.requestUpload&&this.requestUpload(lc.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:d})},N("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class ha{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,i){y(this,"uid",void 0),y(this,"_uintid",void 0),y(this,"_trust_in_room_",!0),y(this,"_trust_audio_enabled_state_",!0),y(this,"_trust_video_enabled_state_",!0),y(this,"_trust_audio_mute_state_",!0),y(this,"_trust_video_mute_state_",!0),y(this,"_audio_muted_",!1),y(this,"_video_muted_",!1),y(this,"_audio_enabled_",!0),y(this,"_video_enabled_",!0),y(this,"_audio_added_",!1),y(this,"_video_added_",!1),y(this,"_is_pre_created",!1),y(this,"_video_pre_subscribed",!1),y(this,"_audio_pre_subscribed",!1),y(this,"_trust_video_stream_added_state_",!0),y(this,"_trust_audio_stream_added_state_",!0),y(this,"_audioTrack",void 0),y(this,"_videoTrack",void 0),y(this,"_dataChannels",[]),y(this,"_audioSSRC",void 0),y(this,"_videoSSRC",void 0),y(this,"_audioOrtc",void 0),y(this,"_videoOrtc",void 0),y(this,"_cname",void 0),y(this,"_rtxSsrcId",void 0),y(this,"_videoMid",void 0),y(this,"_audioMid",void 0),this.uid=t,this._uintid=i}}let To=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function F9(e,t){var i;let r;switch(t){case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoTrack:r=se(i=e._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:r=st.Low}return r}function Av(e){let t=Ye();if(e.some(i=>i._bypassWebAudio))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Ov(e,t){Av(e);let i=new ci;return e.forEach(r=>i.addAudioTrack(r)),i}var PL,kL,LL,ML,UL,xL,VL,FL,jL,BL,GL,Dt;function WL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function m_(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?WL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Fr=(PL=vo(To.SEND_ONLY),kL=vo(To.SEND_ONLY),LL=vo(),ML=vo(To.RECEIVE_ONLY),UL=vo(To.RECEIVE_ONLY),xL=vo(To.RECEIVE_ONLY),VL=vo(To.RECEIVE_ONLY),FL=vo(To.RECEIVE_ONLY),jL=vo(To.RECEIVE_ONLY),BL=vo(),GL=vo(To.RECEIVE_ONLY),Dt=class extends Ot{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Ie.StateChange,t,this._state)}constructor(e,t){super(),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"sendConnection",void 0),y(this,"recvConnection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"statsCollector",void 0),y(this,"dtlsFailedCount",0),y(this,"sendMutex",new vi("P2PChannel2-send-mutex")),y(this,"recvMutex",new vi("P2PChannel2-recv-mutex")),y(this,"_state",at.Disconnected),y(this,"_restartStates",["disconnected","failed"]),y(this,"reconnectInterval",void 0),y(this,"uploadUnplinkStarted",!1),y(this,"uploadDownlinkStarted",!1),y(this,"uplinkStateUploadInterval",void 0),y(this,"downlinkStatsUploadInterval",void 0),y(this,"handleMuteLocalTrack",async(i,r,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==at.Connected)return void n(new B(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let d=this.filterTobeMutedTracks(i);if(d.length===0)return void r();let u=d.find(E=>E[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(E=>{let[,{id:I}]=E;return I}));let p=!1;var a,l;i.trackMediaType==="video"?p=!((a=this.localTrackMap.get(X.LocalAudioTrack))===null||a===void 0||!a.track._muted):p=((l=this.localTrackMap.get(X.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;let m=this.createMuteMessage(d);await _t(this,Ie.RequestMuteLocal,m);let f=i.trackMediaType==="video"?ea.MUTE_LOCAL_VIDEO:ea.MUTE_LOCAL_AUDIO;await _t(this,Ie.RequestP2PMuteLocal,{action:f,message:m,isMuteAll:p}),r()}catch(d){n(d)}finally{o()}}),y(this,"handleUnmuteLocalTrack",async(i,r,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==at.Connected)return void n(new B(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let a=this.filterTobeUnmutedTracks(i);if(a.length===0)return void r();await this.sendConnection.unmuteLocal(a.map(u=>{let[,{id:p}]=u;return p}));let l=this.createUnmuteMessage(a),d=i.trackMediaType==="video"?ea.UNMUTE_LOCAL_VIDEO:ea.UNMUTE_LOCAL_AUDIO;await _t(this,Ie.RequestP2PMuteLocal,{action:d,message:l}),r()}catch(a){n(a)}finally{o()}}),y(this,"handleUpdateVideoEncoder",async(i,r,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let a=this.localTrackMap.get(X.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==i||this.state!==at.Connected)return void r();let{id:l,track:d}=a;l&&(await this.sendConnection.updateSendParameters(l,d),await this.sendConnection.updateEncoderConfig(l,d),this.emit(Ie.UpdateVideoEncoder,d)),r()}catch(a){n(a)}finally{o()}}),y(this,"handleUpdateVideoSendParameters",async(i,r,n)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(X.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==i||this.state!==at.Connected)return void r();let{id:l,track:d}=a;l&&await this.sendConnection.updateSendParameters(l,d),r()}catch(a){n(a)}finally{o()}}),y(this,"handleReplaceTrack",async(i,r,n,o)=>{let a;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;let u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return i===m});if(!this.sendConnection||!u||u[1].id===void 0||this.state!==at.Connected)return void r();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(i,u[1].id)),u[0]===X.LocalVideoTrack&&Ye().supportDualStreamEncoding){let p=this.localTrackMap.get(X.LocalVideoLowTrack);if(p){let m=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new ne((f,E)=>{this.handleReplaceTrack(p.track,f,E,!0)})}}r()}catch(u){n(u)}finally{var d;(d=a)===null||d===void 0||d()}}),y(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),y(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new DL(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},N("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new B(A.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,i,r,n,o){throw new B(A.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new wL(e,this.store,nr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=at.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new wL(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=at.Connected}async addRemoteCandidate(e,t){if(t===nr.RECEIVE_ONLY){if(!this.sendConnection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var r=this;return Vr(function*(){let n=yield xe(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==at.Connected){r.throwIfTrackTypeNotMatch(e);let u=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(u))}r.store.pubId=r.store.pubId+1,Gi.markPublishStart(r.store.clientId,r.store.pubId);let o=r.filterTobePublishedTracks(e,t,i);if(o.length===0)return void(yield xe(r.tryToUnmuteAudio(e)));o.forEach(u=>{let{track:p,type:m}=u,f=Date.now();r.store.publish(p.getTrackId(),m===X.LocalAudioTrack?"audio":"video",f)}),r.bindLocalTrackEvents(o);let a=yield xe(r.sendConnection.send(o.map(u=>{let{track:p}=u;return p}),r.store.codec,r.store.audioCodec)),l=(yield xe(a.next())).value,d=r.createGatewayPublishMessage(o,l);try{yield d}catch(u){throw a.throw(u),(u==null?void 0:u.code)===A.WS_ABORT&&o.forEach(p=>{let{track:m}=p;r.pendingLocalTracks.indexOf(m)===-1&&r.pendingLocalTracks.push(m)}),r.unbindLocalTrackEvents(o),u}yield xe(a.next()),o.forEach(u=>{let{type:p}=u;r.statsCollector.addLocalStats(p)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(o,l),o.forEach(u=>{let{track:p,type:m}=u,f=Date.now();r.store.publish(p.getTrackId(),m===X.LocalAudioTrack?"audio":"video",void 0,f)}),r.startUploadUplinkState()}finally{n()}})()}async unpublish(e){if(!this.sendConnection||this.state!==at.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(n=>!se(e).call(e,n)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(n=>n[0]==="videoLowTrack");i&&i[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(n=>{let[,{id:o}]=n;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[o,{track:a}]=n;return{type:o,track:a}})),t.forEach(n=>{let[o]=n;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===at.Connected)return i&&i[1].track.close(),r;e.forEach(n=>{let o=this.pendingLocalTracks.indexOf(n);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[n,{track:o,ssrcs:a}]=r,l={stream_type:F9(o,n),ssrcs:a};o._muted||!o._enabled?t.push(l):i.push(l)}),t.length>0&&t.forEach(r=>{_t(this,Ie.RequestMuteLocal,[r])}),i.length>0&&i.forEach(r=>{_t(this,Ie.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Vr(function*(){throw new B(A.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ii(this,Ie.RequestRePublish,this.pendingLocalTracks),this.emit(Ie.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new B(A.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,r){var n;if(!this.recvConnection)throw new B(A.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((n=this.remoteUserMap.get(e))!==null&&n!==void 0&&n.has(t))return;let{track:o,mid:a,transceiver:l}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),r);t===me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new id(o,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new td(o,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));let d=this.remoteUserMap.get(e);d?d.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let u=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:f}=p;return m.uid===e.uid&&t===f});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(Ie.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,r){if(!this.recvConnection)throw new B(A.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),r)}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:l}=o;return t!==void 0?a.uid===e.uid&&t===l:a.uid===e.uid});if(r.forEach(o=>{let a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.recvConnection||i||r.forEach(o=>{let{kind:a}=o;var l;if(a===me.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(a===me.VIDEO){var d;(d=e._videoTrack)===null||d===void 0||d._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let n=this.filterTobeUnSubscribedTracks(e,t);n.length!==0&&(await this.recvConnection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a})),this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),n.forEach(o=>{let[a,{kind:l}]=o;var d,u;if(l===me.VIDEO&&a._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),l===me.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),i||((u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0);else if(l===me.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),!i&&((p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0)}}),n.forEach(o=>{let[,{kind:a}]=o;_t(this,Ie.RequestP2PMuteRemote,a)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[me.VIDEO,me.AUDIO].forEach(r=>{i.has(r)?_t(this,Ie.RequestP2PUnmuteRemote,r):_t(this,Ie.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new B(A.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new B(A.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new B(A.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new B(A.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(X.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ci){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return n!==X.LocalAudioTrack}).filter(r=>{let[n]=r;return!(e&&n===X.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===X.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}reportPublishEvent(e,t,i,r,n){if(e){let a=this.localTrackMap.get(X.LocalAudioTrack),l=r?this.localTrackMap.get(X.LocalVideoLowTrack):this.localTrackMap.get(X.LocalVideoTrack);_e.publish(this.store.sessionId,{eventElapse:Gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!a,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;i||(i=[]);let a=i.find(d=>d instanceof jt),l=r?(o=this.localTrackMap.get(X.LocalVideoTrack))===null||o===void 0?void 0:o.track:i.find(d=>d instanceof Et);_e.publish(this.store.sessionId,{eventElapse:Gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!a,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,i,r){let n=r===me.VIDEO?i._videoSSRC:i._audioSSRC;n&&_e.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===me.VIDEO,audio:r===me.AUDIO,peerid:i.uid,subscribeRequestid:r===me.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Gi.measureFromSubscribeStart(this.store.clientId,n)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new vi("P2PChannel2-send-mutex"),this.sendMutex=new vi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(X.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ci){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=at.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(X.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(X.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Et||t&&t.track instanceof jt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Yr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(X.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ru(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=at.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case X.LocalVideoTrack:se(t=r._hints).call(t,Rt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case X.LocalAudioTrack:r instanceof ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case X.LocalVideoLowTrack:}}),this.emit(Ie.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Yr(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ie.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:n}=i;if((e instanceof ha?e.uid:e)===r.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,r;if(e===nr.SEND_ONLY){if(!this.sendConnection)throw new B(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new B(A.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let n=await r.restartICE(t);return r.isInRestartIce=!1,n}{let n=await r.restartICE();if(n){let o=await ii(this,Ie.RequestP2PRestartICE,{direction:nr.RECEIVE_ONLY,iceParameter:n});await r.restartICE(o),r.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(X.LocalVideoTrack),i=this.localTrackMap.get(X.LocalAudioTrack),r=e.videoSend.find(E=>{var I;return E.ssrc===(t==null||(I=t.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),n=e.audioSend.find(E=>{var I;return E.ssrc===(i==null||(I=i.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!r||!n)return 1;let o=Ur(this,Ie.NeedSignalRTT),a=r?r.rttMs:void 0,l=n?n.rttMs:void 0,d=a&&l?(a+l)/2:a||l,u=(d&&o?(d+o)/2:d||o)||0,p=100*e.sendPacketLossRate*.7/50+.3*u/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,f=t==null?void 0:t.track;if(f&&f._encoderConfig&&f._hints.indexOf(Rt.SCREEN_TRACK)===-1){let E=f._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(E&&I){let T=(1e3*E-I)/(1e3*E);return Xb[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,n=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find(I=>I.ssrc===n),l=e.videoRecv.find(I=>I.ssrc===o);if(!a&&!l)return void(t+=1);let d=Ur(this,Ie.NeedSignalRTT),u=e.rtt,p=(u&&d?(u+d)/2:u||d)||0,m=a?a.jitterMs:void 0,f=e.recvPacketLossRate,E=.7*f*100/50+.3*p/1500;m&&(E=.6*f*100/50+.2*p/1500+.2*m/400),t+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ne((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){let r=[],n=Ye(),o=this.getAllTracks();e=Il(e=e.filter(d=>o.indexOf(d)===-1));let a=!1,l=!1;for(let d of e){if(d instanceof Et&&(this.localTrackMap.has(X.LocalVideoTrack)||a?new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:X.LocalVideoTrack}),a=!0),t)){let u=this.getLowVideoTrack(d,i);r.push({track:u,type:X.LocalVideoLowTrack})}if(d instanceof jt){let u=this.localTrackMap.get(X.LocalAudioTrack);if(u){if(!(u.track instanceof ci))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){let p=r.find(m=>{let{type:f}=m;return f===X.LocalAudioTrack});if(!(p.track instanceof ci))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!n.webAudioMediaStreamDest||d instanceof ci||d._bypassWebAudio)r.push({track:d,type:X.LocalAudioTrack});else{let p=new ci;p.addAudioTrack(d),r.push({track:p,type:X.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Il(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof jt){let n=this.localTrackMap.get(X.LocalAudioTrack);if(!n)continue;n.track instanceof ci?(n.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),n.track.trackList.length===0&&(t.push([X.LocalAudioTrack,n]),n.track.close())):t.push([X.LocalAudioTrack,n])}if(r instanceof Et){let n=this.localTrackMap.get(X.LocalVideoTrack);if(!n)continue;t.push([X.LocalVideoTrack,n]);let o=this.localTrackMap.get(X.LocalVideoLowTrack);o&&t.push([X.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case X.LocalVideoTrack:i.addListener(le.GET_STATS,this.handleGetLocalVideoStats),i.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case X.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ci?e.trackList.forEach(i=>{i.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(le.GET_STATS,this.handleGetLocalAudioStats),i.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(le.GET_STATS,this.handleGetLocalAudioStats),e.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(le.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case X.LocalVideoTrack:i.off(le.GET_STATS,this.handleGetLocalVideoStats),i.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case X.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ci?e.trackList.forEach(t=>{t.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(le.GET_STATS,this.handleGetLocalAudioStats),t.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(le.GET_STATS,this.handleGetLocalAudioStats),e.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof td&&t.addListener(le.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof id&&t.addListener(le.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(le.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var n;let o,{track:a,type:l}=i;switch(l){case X.LocalAudioTrack:o=st.Audio;break;case X.LocalVideoTrack:o=se(n=a._hints).call(n,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:o=st.Low}return{kind:l===X.LocalAudioTrack?me.AUDIO:me.VIDEO,stream_type:o,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:n,type:o}=i;this.localTrackMap.set(o,{track:n,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ie.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),se(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await _i(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),_e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:xt.TRACER}).onSuccess(),this.emit(Ie.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(o=>o._audioSSRC===t);var n;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(n=r.audioTrack)===null||n===void 0||n.emit(Ql.FIRST_FRAME_DECODED),_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_AUDIO_DECODE,kt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(n=>n._audioSSRC===t);r&&_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_AUDIO_RECEIVED,kt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(n=>n._videoSSRC===t);r&&_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_VIDEO_RECEIVED,kt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",n=i.candidateType==="relay";i.candidateType!=="unknown"&&r===n||this.emit(Ie.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ia(i))," -> ").concat(JSON.stringify(ia(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ia(i))," -> ").concat(JSON.stringify(ia(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ie.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===nr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===nr.SEND_ONLY?this.restartICE(e):ii(this,Ie.RequestP2PRestartICE,{direction:nr.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(X.LocalAudioTrack);if(e instanceof jt&&(i==null?void 0:i.track)instanceof ci)return i.track.isActive||t.push([X.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(r&&(t.push(r),r[0]===X.LocalVideoTrack)){let n=this.localTrackMap.get(X.LocalVideoLowTrack);n&&t.push([X.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(X.LocalAudioTrack);if(e instanceof jt&&(i==null?void 0:i.track)instanceof ci)return i.track.isActive&&t.push([X.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(r)if(r[0]===X.LocalVideoTrack){t.push(r);let n=this.localTrackMap.get(X.LocalVideoLowTrack);n&&t.push([X.LocalVideoLowTrack,n])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let n=r.get(t);if(!n)return i;i.push([e,{kind:t,id:n}])}else Array.from(r.entries()).forEach(n=>{let[o,a]=n;i.push([e,{kind:o,id:a}])});return i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:n,id:o}]=i;switch(n){case me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:me.VIDEO,ssrcId:r._videoSSRC}));case me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:me.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,n=this.remoteUserMap.get(i);n&&(n.delete(r),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(X.LocalVideoTrack),i=this.localTrackMap.get(X.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof jt){let i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;let r=this.createUnmuteMessage(i);return void await _t(this,Ie.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ie.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ie.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _i(Em(this.dtlsFailedCount,Xt)),this.emit(Ie.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(X.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Et)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Et).length>1)throw new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof jt).length>1&&(e.some(t=>t instanceof jt&&t._bypassWebAudio)||!Ye().webAudioMediaStreamDest))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Et&&this.pendingLocalTracks.some(i=>i instanceof Et))throw new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof jt&&this.pendingLocalTracks.some(i=>i instanceof jt)&&(!Ye().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jt&&i._bypassWebAudio)))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding,r=m_(m_({},{width:160,height:120,framerate:15,bitrate:50}),t),n;n=i?e._mediaStreamTrack.clone():wv(e,r);let o=ft(8,"track-low-"),a=new Et(n,m_(m_({},i&&{scaleResolutionDownBy:iT(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return a.on(Tc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Jl.LOW_STREAM)}),a._hints.push(Rt.LOW_STREAM),e.addListener(le.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,r){var n;let o=Array.from(Yr(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,l=a.subscribe.find(d=>d.userId===o.uid&&d.type==="video");_e.firstRemoteVideoDecode(this.store.sessionId,Ri.FIRST_VIDEO_DECODE,kt.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:i,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let n=r.get(t);if(!n)return!1;let o=await this.recvConnection.getRemoteSSRC(n);return o!==void 0&&o!==i}resetConnection(e){S.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===at.Connected?(S.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new B(A.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new B(A.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new B(A.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new B(A.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new B(A.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new B(A.NOT_SUPPORTED)}async preConnect(e,t,i,r,n,o){throw new B(A.NOT_SUPPORTED)}getEstablishParams(){throw new B(A.NOT_SUPPORTED)}async reSubscribe(e){throw new B(A.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new B(A.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===X.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Jl.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ie(Dt.prototype,"p2pConnect",[PL],Object.getOwnPropertyDescriptor(Dt.prototype,"p2pConnect"),Dt.prototype),ie(Dt.prototype,"unpublish",[kL],Object.getOwnPropertyDescriptor(Dt.prototype,"unpublish"),Dt.prototype),ie(Dt.prototype,"unpublishLowStream",[LL],Object.getOwnPropertyDescriptor(Dt.prototype,"unpublishLowStream"),Dt.prototype),ie(Dt.prototype,"subscribe",[ML],Object.getOwnPropertyDescriptor(Dt.prototype,"subscribe"),Dt.prototype),ie(Dt.prototype,"mockSubscribe",[UL],Object.getOwnPropertyDescriptor(Dt.prototype,"mockSubscribe"),Dt.prototype),ie(Dt.prototype,"unsubscribe",[xL],Object.getOwnPropertyDescriptor(Dt.prototype,"unsubscribe"),Dt.prototype),ie(Dt.prototype,"muteRemote",[VL],Object.getOwnPropertyDescriptor(Dt.prototype,"muteRemote"),Dt.prototype),ie(Dt.prototype,"unmuteRemote",[FL],Object.getOwnPropertyDescriptor(Dt.prototype,"unmuteRemote"),Dt.prototype),ie(Dt.prototype,"hasRemoteMediaWithLock",[jL],Object.getOwnPropertyDescriptor(Dt.prototype,"hasRemoteMediaWithLock"),Dt.prototype),ie(Dt.prototype,"disconnectForReconnect",[BL],Object.getOwnPropertyDescriptor(Dt.prototype,"disconnectForReconnect"),Dt.prototype),ie(Dt.prototype,"remoteMediaSsrcChanged",[GL],Object.getOwnPropertyDescriptor(Dt.prototype,"remoteMediaSsrcChanged"),Dt.prototype),Dt);function vo(e){return function(t,i,r){let n=t[i];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];switch(e){case To.SEND_ONLY:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,a)}finally{d()}}case To.RECEIVE_ONLY:{let d=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,a)}finally{d()}}default:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(i)),u=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await n.apply(this,a)}finally{d(),u()}}}},r}}function HL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Oc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class oh{constructor(t){y(this,"store",void 0),y(this,"onStatsException",void 0),y(this,"onUploadPublishDuration",void 0),y(this,"onStatsChanged",void 0),y(this,"localStats",new Map),y(this,"remoteStats",new Map),y(this,"updateStatsInterval",void 0),y(this,"trafficStats",void 0),y(this,"trafficStatsPeerList",[]),y(this,"uplinkStats",void 0),y(this,"exceptionMonitor",void 0),y(this,"p2pChannel",void 0),y(this,"scalabilityMode",Sz.L1T1),y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new v9,this.exceptionMonitor.on("exception",(i,r,n)=>{this.onStatsException&&this.onStatsException(i,r,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(X.LocalAudioTrack)||Oc({},rv)}getLocalVideoTrackStats(){return this.localStats.get(X.LocalVideoTrack)||Oc({},nv)}getRemoteAudioTrackStats(t){let i=(o,a)=>{if(!this.trafficStats)return a;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return l&&(a.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var n;let o=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.audioStats;o&&(r[t]=i(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{audioStats:l}]=o;l&&(r[a]=i(a,l))});return r}getRemoteNetworkQualityStats(t){let i={};if(t){var r;let n=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;n&&(i[t]=n)}else Array.from(this.remoteStats.entries()).forEach(n=>{let[o,{networkStats:a}]=n;a&&(i[o]=a)});return i}getRemoteVideoTrackStats(t){let i=(o,a)=>{if(!this.trafficStats)return a;let l=this.trafficStats.peer_delay.find(d=>d.peer_uid===o);return l&&(a.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var n;let o=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.videoStats;o&&(r[t]=i(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{videoStats:l}]=o;l&&(r[a]=i(a,l))});return r}getRTCStats(){let t=0,i=0,r=0,n=0,o=this.localStats.get(X.LocalAudioTrack);o&&(t+=o.sendBytes,i+=o.sendBitrate);let a=this.localStats.get(X.LocalVideoTrack);a&&(t+=a.sendBytes,i+=a.sendBitrate);let l=this.localStats.get(X.LocalVideoLowTrack);l&&(t+=l.sendBytes,i+=l.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:p,videoStats:m}=u;p&&(r+=p.receiveBytes,n+=p.receiveBitrate),m&&(r+=m.receiveBytes,n+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:i,SendBytes:t,RecvBytes:r,RecvBitrate:n,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),t.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var r;let n=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(i.peer_uid),o=n!=null&&n.videoSSRC?Gi.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,a=n!=null&&n.audioSSRC?Gi.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,o>a?o:a),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,r){if(!t)return!1;let n=!!r&&i.framesDecodeFreezeTime>r.framesDecodeFreezeTime,o=!r||i.framesDecodeCount>r.framesDecodeCount;return n||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(i=>{let[r,n]=i;switch(r){case X.LocalVideoTrack:case X.LocalVideoLowTrack:{let a=n,l=Oc({},nv),d=t.getStats(),u=t.getLocalMedia(r);if(d){let p=d.videoSend.find(m=>m.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(p){let m=t.getLocalVideoSize(),f=t.getEncoderConfig(X.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=a?8*Math.max(0,l.sendBytes-a.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),f&&f.bitrateMax&&(l.targetSendBitrate=1e3*f.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=a?a.totalDuration+1:1,l.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,l),((a==null?void 0:a.sendResolutionWidth)!==l.sendResolutionWidth||(a==null?void 0:a.sendResolutionHeight)!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&u&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u.track,l);break}case X.LocalAudioTrack:{let a=n,l=Oc({},rv),d=t.getStats(),u=t.getLocalMedia(r);if(d){let p=d.audioSend.find(m=>m.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{let m=t.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=a?8*Math.max(0,l.sendBytes-a.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(X.LocalAudioTrack,l),l&&u&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(i=>{var r,n;let[o,{videoStats:a,audioStats:l,videoPcStats:d}]=i,u=l,p=a,m=d,f=Oc({},rP),E=Oc({},nP),I=Oc({},l9),{audioTrack:T,videoTrack:R,audioSSRC:w,videoSSRC:O}=t.getRemoteMedia(o),P;P=t instanceof Fr?t.getStats(!0):t.getStats();let M=(r=P)===null||r===void 0?void 0:r.audioRecv.find(q=>q.ssrc===w),V=(n=P)===null||n===void 0?void 0:n.videoRecv.find(q=>q.ssrc===O),F=this.trafficStats&&this.trafficStats.peer_delay.find(q=>q.peer_uid===o);if(M&&(M.codec!=="opus"&&M.codec!=="aac"&&M.codec!=="PCMU"&&M.codec!=="PCMA"&&M.codec!=="G722"||(f.codecType=M.codec),M.outputLevel?f.receiveLevel=Math.round(32767*M.outputLevel):T&&(f.receiveLevel=Math.round(32767*T.getVolumeLevel())),f.receiveBytes=M.bytes,f.receivePackets=M.packets,f.receivePacketsLost=M.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.receiveBitrate=u?8*Math.max(0,f.receiveBytes-u.receiveBytes):0,f.totalDuration=u?u.totalDuration+1:1,f.totalFreezeTime=u?u.totalFreezeTime:0,f.freezeRate=f.totalFreezeTime/f.totalDuration,f.receiveDelay=M.jitterBufferMs,f.totalDuration>10&&oh.isRemoteAudioFreeze(T)&&(f.totalFreezeTime+=1)),V){V.codec!=="H264"&&V.codec!=="H265"&&V.codec!=="VP8"&&V.codec!=="VP9"&&V.codec!=="AV1X"&&V.codec!=="AV1"||(E.codecType=V.codec),E.receiveBytes=V.bytes,E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.decodeFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,E.renderFrameRate=V.decodeFrameRate<0?0:V.decodeFrameRate,V.outputFrame&&(E.renderFrameRate=V.outputFrame.frameRate),V.receivedFrame?(E.receiveFrameRate=V.receivedFrame.frameRate,E.receiveResolutionHeight=V.receivedFrame.height,E.receiveResolutionWidth=V.receivedFrame.width):R&&(E.receiveResolutionHeight=R._videoHeight||0,E.receiveResolutionWidth=R._videoWidth||0),V.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(V.framesRateFirefox)),E.receivePackets=V.packets,E.receivePacketsLost=V.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.receiveDelay=V.jitterBufferMs||0;let q=!!O&&t.getRemoteVideoIsReady(O);R&&q&&oh.isRemoteVideoFreeze(R,V,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration}F&&(f.end2EndDelay=F.B_ad,E.end2EndDelay=F.B_vd,f.transportDelay=F.B_ed,E.transportDelay=F.B_ed,f.currentPacketLossRate=F.B_ealr4/100,E.currentPacketLossRate=F.B_evlr4/100,I.uplinkNetworkQuality=F.B_punq?F.B_punq:0,I.downlinkNetworkQuality=F.B_pdnq?F.B_pdnq:0),this.remoteStats.set(o,{audioStats:f,videoStats:E,videoPcStats:V,networkStats:I}),T&&this.exceptionMonitor.setRemoteAudioStats(T,f),R&&this.exceptionMonitor.setRemoteVideoStats(R,E)})}}function KL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function sh(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?KL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):KL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class j9 extends Ot{constructor(t,i,r,n){super(),y(this,"spec",void 0),y(this,"token",void 0),y(this,"websocket",void 0),y(this,"pingpongTimer",void 0),y(this,"reconnectMode","retry"),y(this,"serviceMode",void 0),y(this,"reqId",0),y(this,"commandReqId",0),y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),y(this,"handleWebSocketMessage",o=>{if(!o.data)return;let a=JSON.parse(o.data);a.requestId?this.emit("@".concat(a.requestId,"-").concat(a.sid),a):this.serviceMode===Ci.INJECT?this.emit(Go.INJECT_STREAM_STATUS,a):(_e.workerEvent(this.spec.sid,{actionType:"status",serverCode:a.code,workerType:this.serviceMode===Ci.TRANSCODE?1:2}),this.emit(Go.PUBLISH_STREAM_STATUS,a))}),this.spec=i,this.token=t,this.serviceMode=n,this.websocket=new wu("live-streaming",r),this.websocket.on(Oe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Oe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Oe.REQUEST_NEW_URLS,(o,a)=>{ii(this,Go.REQUEST_NEW_ADDRESS).then(o).catch(a)}),this.websocket.on(Oe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,i,r,n){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let o=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new U(A.UNEXPECTED_ERROR);let l=sh({command:t,sdkVersion:mn==="4.21.0"?"0.0.1":mn,seq:a,requestId:a,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new U(A.WS_DISCONNECT);let d=()=>new ne((f,E)=>{this.websocket.once(Oe.CLOSED,()=>E(new U(A.WS_ABORT))),this.websocket.once(Oe.CONNECTED,f)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);let u=new ne((f,E)=>{let I=()=>{E(new U(A.WS_ABORT))};this.websocket.once(Oe.RECONNECTING,I),this.websocket.once(Oe.CLOSED,I),this.once("@".concat(a,"-").concat(this.spec.sid),T=>{f(T)})});n&&_e.workerEvent(this.spec.sid,sh(sh({},n),{},{requestId:o,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));let p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await u}catch(f){if(this.websocket.state==="closed")throw f;return await d(),await this.request(t,i,r)}return n&&_e.workerEvent(this.spec.sid,sh(sh({},n),{},{requestId:o,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=mn==="4.21.0"?"0.0.1":mn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case ai.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case ai.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ai.LIVE_STREAM_RESPONSE_BAD_STREAM:case ai.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new U(A.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case ai.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ai.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new U(A.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case ai.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let i=new U(A.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Go.WARNING,i,t.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let i=new U(A.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Go.WARNING,i,t.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ai.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new U(A.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case ai.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let i=new U(A.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Go.WARNING,i,t.serverResponse.url)}case ai.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case ai.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ai.LIVE_STREAM_RESPONSE_WORKER_LOST:case ai.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ai.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ai.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new U(A.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(_m)},6e3)}}function zL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function _r(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}class B9 extends Ot{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xt;super(),y(this,"onLiveStreamWarning",void 0),y(this,"onLiveStreamError",void 0),y(this,"onInjectStatusChange",void 0),y(this,"spec",void 0),y(this,"retryTimeout",1e4),y(this,"connection",void 0),y(this,"httpRetryConfig",void 0),y(this,"wsRetryConfig",void 0),y(this,"streamingTasks",new Map),y(this,"isStartingStreamingTask",!1),y(this,"taskMutex",new vi("live-streaming")),y(this,"cancelToken",hr.CancelToken.source()),y(this,"transcodingConfig",void 0),y(this,"injectConfig",_r({},Rz)),y(this,"injectLoopTimes",0),y(this,"uapResponse",void 0),y(this,"lastTaskId",1),y(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=i}async setTranscodingConfig(t){let i=_r(_r({},vz),t);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(a=>_r(_r(_r({},Tz),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),function(a){Ut(a.width)||ht(a.width,"config.width",0,1e4),Ut(a.height)||ht(a.height,"config.height",0,1e4),Ut(a.videoBitrate)||ht(a.videoBitrate,"config.videoBitrate",1,1e6),Ut(a.videoFrameRate)||ht(a.videoFrameRate,"config.videoFrameRate"),Ut(a.lowLatency)||hs(a.lowLatency,"config.lowLatency"),Ut(a.audioSampleRate)||li(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ut(a.audioBitrate)||ht(a.audioBitrate,"config.audioBitrate",1,128),Ut(a.audioChannels)||li(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ut(a.videoGop)||ht(a.videoGop,"config.videoGop"),Ut(a.videoCodecProfile)||li(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ut(a.userCount)||ht(a.userCount,"config.userCount",0,17),Ut(a.backgroundColor)||ht(a.backgroundColor,"config.backgroundColor",0,16777215),Ut(a.userConfigExtraInfo)||Ai(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!Ut(a.transcodingUsers)&&(ps(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((l,d)=>{Cm(l.uid),Ut(l.x)||ht(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),Ut(l.y)||ht(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),Ut(l.width)||ht(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),Ut(l.height)||ht(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),Ut(l.zOrder)||ht(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Ut(l.alpha)||ht(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),Ut(a.watermark)||ZS(a.watermark,"watermark"),Ut(a.backgroundImage)||ZS(a.backgroundImage,"backgroundImage"),a.images&&!Ut(a.images)&&(ps(a.images,"config.images"),a.images.forEach((l,d)=>{ZS(l,"images[".concat(d,"]"))}))}(i);let r=[];i.images&&r.push(...i.images.map(a=>_r(_r(_r({},QS),a),{},{zOrder:255}))),i.backgroundImage&&(r.push(_r(_r(_r({},QS),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(r.push(_r(_r(_r({},QS),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=r,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(a=>_r({},a)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let n=(i.userConfigs||[]).map(a=>typeof a.uid=="number"?ne.resolve(a.uid):NN(a.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ne.all(n)).forEach((a,l)=>{i.userConfigs&&i.userConfigs[l]&&(i.userConfigs[l].uid=a)}),this.transcodingConfig=i,this.connection)try{var o;let a=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ho(o=this.streamingTasks).call(o)).map(l=>l.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,a).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}setInjectStreamConfig(t,i){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=i}async startLiveStreamingTask(t,i,r){var n;if(Array.from(ho(n=this.streamingTasks).call(n)).find(d=>d.mode===Ci.INJECT)&&i===Ci.INJECT)return new U(A.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&i===Ci.TRANSCODE)throw new U(A.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(i));let a=await this.taskMutex.lock();if(!this.connection&&r)return void a();if(this.streamingTasks.get(t)&&!r)return a(),new U(A.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(d){throw a(),d}switch(i){case Ci.TRANSCODE:o.transcodingConfig=_r({},this.transcodingConfig);break;case Ci.RAW:break;case Ci.INJECT:o={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let l=this.lastTaskId++;try{let d=new ne((p,m)=>{_i(this.retryTimeout).then(()=>{if(r)return m(r);let f=this.statusError.get(t);return f?(this.statusError.delete(t),m(f)):void 0})}),u=await ne.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:i===Ci.TRANSCODE?1:2,requestByUser:!r,tid:l.toString()}),d]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(t,{clientRequest:o,mode:i,url:t,taskId:l}),a()}catch(d){if(a(),this.isStartingStreamingTask=!1,!d.data||!d.data.retry||r)throw d;return d.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,i,d)):await this.startLiveStreamingTask(t,i,d)}}stopLiveStreamingTask(t){return new ne((i,r)=>{let n=this.streamingTasks.get(t);if(!n||!this.connection)return new U(A.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let o=n.mode;n.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),i()},this.connection.request("request",{clientRequest:{command:o===Ci.INJECT?"UninjectStream":"UnpublishStream",url:n.url}},!1,{url:t,command:"UnPublishStream",workerType:o===Ci.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(a=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(a.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&o!==Ci.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),i(),o===Ci.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(r)})}async controlInjectStream(t,i,r,n){let o=this.streamingTasks.get(t);if(!o||!this.connection||o.mode!==Ci.INJECT)throw new U(A.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:i,audioVolume:r,position:n}})).serverResponse}resetAllTask(){var t;let i=Array.from(ho(t=this.streamingTasks).call(t));this.terminate();for(let r of i)this.startLiveStreamingTask(r.url,r.mode).catch(n=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,n)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=hr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new U(A.UNEXPECTED_ERROR,"live streaming connection has already connected");let i=await ii(this,ym.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=i,this.connection=new j9(i.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Go.WARNING,(r,n)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(n,r)),this.connection.on(Go.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Go.INJECT_STREAM_STATUS,r=>this.handleInjectStreamServerStatus(r)),this.connection.on(Go.REQUEST_NEW_ADDRESS,(r,n)=>{if(!this.connection)return n(new U(A.UNEXPECTED_ERROR,"can not get new live streaming address list"));ii(this,ym.REQUEST_WORKER_MANAGER_LIST,t).then(o=>{this.uapResponse=o,r(o.addressList)}).catch(n)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(t){let i=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(i),n=t.reason;switch(t.code){case ai.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ai.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let a=new U(A.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return S.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,a);if(!this.isStartingStreamingTask)return;this.statusError.set(i,a)}case ai.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let a=new U(A.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,n);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,a)}case ai.LIVE_STREAM_RESPONSE_WORKER_LOST:case ai.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();let a=Array.from(ho(o=this.streamingTasks).call(o));for(let l of a)l.abortTask?l.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new U(A.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{S.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}handleInjectStreamServerStatus(t){let i=Number(t.uid),r=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_START_SUCCESS,i,r));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,i,r),void this.streamingTasks.delete(r);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_START_UNAUTHORIZED,i,r),void this.streamingTasks.delete(r);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_BROKEN,i,r),void this.streamingTasks.delete(r);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(bl.INJECT_STREAM_STATUS_START_TIMEOUT,i,r),void this.streamingTasks.delete(r);default:return void S.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class YL{constructor(){y(this,"destChannelMediaInfos",new Map),y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){nN(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){nN(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Rm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function qL(e){if(!(e instanceof YL))return new U(A.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new U(A.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new U(A.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class G9 extends Ot{constructor(t,i,r){super(),y(this,"ws",void 0),y(this,"requestId",1),y(this,"heartBeatTimer",void 0),y(this,"joinInfo",void 0),y(this,"clientId",void 0),y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),y(this,"onClose",n=>{this.emit("close"),this.dispose()}),y(this,"onMessage",n=>{let o=JSON.parse(n.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=t,this.clientId=i,this.ws=new wu("cross-channel-".concat(this.clientId),r),this.ws.on(Oe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Oe.CONNECTED,this.onOpen),this.ws.on(Oe.ON_MESSAGE,this.onMessage),this.ws.on(Oe.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let i=this.requestId++;return t.requestId=i,t.seq=i,this.ws.sendMessage(t),i}waitStatus(t){return new ne((i,r)=>{let n=window.setTimeout(()=>{r(new U(A.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,o=>{window.clearTimeout(n),o.state&&o.state!==0?r(new U(A.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(n),r(new U(A.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new U(A.WS_DISCONNECT);let i=()=>new ne((a,l)=>{this.ws.once(Oe.CLOSED,()=>l(new U(A.WS_ABORT))),this.ws.once(Oe.CONNECTED,a)});this.ws.state!=="connected"&&await i();let r=this.sendMessage(t),n=new ne((a,l)=>{let d=()=>{l(new U(A.WS_ABORT))};this.ws.once(Oe.RECONNECTING,d),this.ws.once(Oe.CLOSED,d),this.once("req_".concat(r),a),_i(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Oe.RECONNECTING,d),this.ws.off(Oe.CLOSED,d),l(new U(A.TIMEOUT,"cross channel ws request timeout"))})}),o=await n;if(!o||o.code!==200)throw new U(A.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(t){this.ws.removeAllListeners(Oe.REQUEST_NEW_URLS),this.ws.on(Oe.REQUEST_NEW_URLS,i=>{i(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let i=this.requestId++;return t.requestId=i,this.ws.sendMessage(t),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class W9 extends Ot{set state(t){t!==this._state&&(t!==Rr.RELAY_STATE_FAILURE&&(this.errorCode=Nl.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,i,r,n,o){super(),y(this,"joinInfo",void 0),y(this,"sid",void 0),y(this,"clientId",void 0),y(this,"cancelToken",hr.CancelToken.source()),y(this,"workerToken",void 0),y(this,"requestId",0),y(this,"signal",void 0),y(this,"prevChannelMediaConfig",void 0),y(this,"httpRetryConfig",void 0),y(this,"_resolution",void 0),y(this,"_state",Rr.RELAY_STATE_IDLE),y(this,"errorCode",Nl.RELAY_OK),y(this,"onStatus",a=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",ms.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",ms.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Nl.SRC_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Nl.DEST_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE))}),y(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ms.NETWORK_DISCONNECTED),this.state=Rr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==Rr.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",a.toString()),this.errorCode=Nl.SERVER_CONNECTION_LOST,this.state=Rr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=i,this.sid=vu(),this.signal=new G9(this.joinInfo,this.clientId,r),this.httpRetryConfig=n,this._resolution=o}async startChannelMediaRelay(t){if(this.state!==Rr.RELAY_STATE_IDLE)throw new U(A.INVALID_OPERATION);this.state=Rr.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new U(A.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new U(A.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new U(A.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Rr.RELAY_STATE_RUNNING)throw new U(A.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Rr.RELAY_STATE_RUNNING)throw new U(A.INVALID_OPERATION);let i=this.genMessage(or.SetVideoProfile);await this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Rr.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=hr.CancelToken.source(),this.state=Rr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await Gz(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ms.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let i=this.genMessage(or.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(or.SetSdkProfile,t);await this.signal.request(r),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let n=this.genMessage(or.SetSourceChannel,t);await this.signal.request(n),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ms.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let o=this.genMessage(or.SetSourceUserId,t);await this.signal.request(o),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let a=this.genMessage(or.SetDestChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ms.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let l=this.genMessage(or.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",ms.PACKET_SENT_TO_DEST_CHANNEL),this.state=Rr.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let i=this.genMessage(or.UpdateDestChannel,t);await this.signal.request(i),this.emit("event",ms.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(or.StopPacketTransfer);await this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,i){let r=[],n=[],o=[];this.requestId+=1;let a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:mn,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};a.sdkVersion==="4.21.0"&&(a.sdkVersion="0.0.1");let l=null,d=null;switch(t){case or.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case or.SetSourceChannel:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new U(A.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},a;case or.SetSourceUserId:if(d=i&&i.getSrcChannelMediaInfo(),!d)throw new U(A.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:d.uid+""},a;case or.SetDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new U(A.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(u=>{r.push(u.channelName),n.push(u.uid+""),o.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:r,uid:n,token:o},a;case or.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case or.Reconnect:return a.clientRequest={command:"Reconnect"},a;case or.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case or.UpdateDestChannel:if(l=i&&i.getDestChannelMediaInfo(),!l)throw new U(A.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(u=>{r.push(u.channelName),n.push(u.uid+""),o.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:n,token:o},a;case or.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}function __(e){var t={},i=!1;function r(n,o){return i=!0,{done:!1,value:new _v(o=new fv(function(a){a(e[n](o))}),1)}}return t[El!==void 0&&fO||"@@iterator"]=function(){return this},t.next=function(n){return i?(i=!1,n):r("next",n)},typeof e.throw=="function"&&(t.throw=function(n){if(i)throw i=!1,n;return r("throw",n)}),typeof e.return=="function"&&(t.return=function(n){return i?(i=!1,n):r("return",n)}),t}var JL=g(oL);function XL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function QL(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var gt;function ZL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function $L(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ZL(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let od=(gt=class yh extends wm{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return se(i=Object.keys(Al)).call(i,t)}))]}constructor(t,i){super(t,i),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"statsFilter",void 0),y(this,"useRTX",!1),y(this,"localCapabilities",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"establishPromise",void 0),y(this,"mutex",new vi("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(yh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=l_(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=go(t.sdp),r=nh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,$L($L({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new B(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,i,r,n,o,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(d){y(this,"sessionDesc",void 0),y(this,"localCapabilities",void 0),y(this,"rtpCapabilities",void 0),y(this,"candidates",void 0),y(this,"iceParameters",void 0),y(this,"dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),d=vt(d);let{remoteIceParameters:u,remoteDtlsParameters:p,candidates:m,remoteRTPCapabilities:f,remoteSetup:E,localCapabilities:I,sdkCodec:T,cname:R}=d,w=Nt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=f,this.candidates=m,this.iceParameters=u,this.dtlsParameters=p,this.setup=E,this.localCapabilities=I,this.cname=R;for(let O=0;O<w.mediaDescriptions.length;O++){let P=w.mediaDescriptions[O];if(P.attributes.iceUfrag=u.iceUfrag,P.attributes.icePwd=u.icePwd,P.attributes.fingerprints=p.fingerprints,P.attributes.candidates=m,P.attributes.setup=E,P.media.mediaType==="video"){P.media.fmts=f.videoCodecs.map(V=>V.payloadType.toString(10));let M=f.videoCodecs.filter(V=>{var F,q;return(F=V.rtpMap)===null||F===void 0?void 0:se(q=F.encodingName.toLowerCase()).call(q,T)});M.length===0&&(M=f.videoCodecs),P.attributes.payloads=M,P.attributes.extmaps=f.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=f.audioCodecs.map(M=>M.payloadType.toString(10)),P.attributes.payloads=f.audioCodecs,P.attributes.extmaps=f.audioExtensions),w.mediaDescriptions[O]=this.mungMediaDesc(P)}this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Nt.print(this.sessionDesc)}send(d,u,p){let{ssrcs:m,ssrcGroups:f}=on(u,this.cname),E=this.sessionDesc.mediaDescriptions.find(R=>d===me.VIDEO?R.media.mediaType==="video":R.media.mediaType==="audio"),I=m[0].attributes.label,T=m[0].attributes.mslabel;return E.attributes.ssrcs=E.attributes.ssrcs.concat(m),E.attributes.ssrcGroups=E.attributes.ssrcGroups.concat(f),{id:I,mslabel:T}}batchSend(d){return d.map(u=>{let{kind:p,ssrcMsg:m}=u;return this.send(p,m,void 0)})}stopSending(d){this.sessionDesc.mediaDescriptions.forEach(u=>{let p=[],m=[],f=[];u.attributes.ssrcs.forEach(E=>{se(d).call(d,E.attributes.label||"")?f.push(E):p.push(E)}),u.attributes.ssrcGroups.forEach(E=>{var I;se(I=f.map(T=>T.ssrcId)).call(I,E.ssrcIds[0])||m.push(E)}),u.attributes.ssrcs=p,u.attributes.ssrcGroups=m})}mute(d){let u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(d){let u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}receive(d,u,p){d.forEach((m,f)=>{let E=m._mediaStreamTrack,I=this.sessionDesc.mediaDescriptions.findIndex(R=>R.attributes.mid===E.kind),T=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[I],m);this.sessionDesc.mediaDescriptions[I]=T})}stopReceiving(d){}updateCandidates(d){d===Ji.TCP?this.candidates.forEach(u=>{this.candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===u.connectionAddress&&p.port===u.port)===-1&&this.candidates.push(QL(QL({},u),{},{foundation:"tcpcandidate",priority:Number(u.priority)-1+"",transport:"tcp",port:Number(u.port)+90+""}))}):this.candidates=this.candidates.filter(u=>u.transport!=="tcp");for(let u of this.sessionDesc.mediaDescriptions)u.attributes.candidates=this.candidates}restartICE(d){d=vt(d),this.iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=d.iceUfrag,u.attributes.icePwd=d.icePwd})}predictReceivingMids(d){let u=[];for(let p=0;p<d;p++)u.push((this.currentMidIndex+p+1).toString(10));return u}mungRecvMediaDsec(d,u){let p=vt(d);return la(p,u),u_(p,u),p}updateRecvMedia(d,u){let p=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d);if(p!==-1){let m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],u);this.sessionDesc.mediaDescriptions[p]=m}}bumpMid(d){this.currentMidIndex+=d}updateTrackLabel(d,u,p){let m=this.sessionDesc.mediaDescriptions.find(E=>d===me.VIDEO?E.attributes.mid==="video":E.attributes.mid==="audio");if(m){let E=m.attributes.ssrcs.find(I=>I.attributes.label===u);var f;E&&(E.attributes.label=p,(f=E.attributes.msid)===null||f===void 0||f.replace(u,p))}}mungMediaDesc(d){let u=vt(d);return d_(u),function(p){let m=p.attributes.extmaps.find(f=>f.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");m&&p.attributes.extmaps.splice(p.attributes.extmaps.indexOf(m),1),p.attributes.payloads.forEach(f=>{let E=f.rtcpFeedbacks.findIndex(I=>I.type==="transport-cc");E!==-1&&f.rtcpFeedbacks.splice(E,1)})}(u),u}getSSRC(d){for(let u of this.sessionDesc.mediaDescriptions)for(let p of u.attributes.ssrcs)if(p.attributes.label===d)return[p]}}({remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:n.send,remoteSetup:o,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:a});let l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new B(A.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,i){var r=this;return Vr(function*(){let n=yield xe(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=t.map(f=>r.peerConnection.addTrack(f._mediaStreamTrack)),a=yield xe(r.peerConnection.createOffer()),l=Nt.parse(a.sdp),d=t.map(f=>{let E=f._mediaStreamTrack,I=l.mediaDescriptions.find(T=>T.attributes.mid===E.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(T,R,w){let O=T.attributes.ssrcs.filter(M=>M.attributes.label===R),P=T.attributes.ssrcGroups;if(O.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(P&&O.length>1){let M=P.find(V=>V.ssrcIds.indexOf(O[0].ssrcId)!==-1);return M?[{ssrcId:M.ssrcIds[0],rtx:w?M.ssrcIds[1]:void 0}]:[{ssrcId:O[0].ssrcId}]}return[{ssrcId:O[0].ssrcId}]}(I,E.id,r.useRTX)}),u;try{u=yield d}catch(f){throw o.forEach(E=>{mi()&&E.replaceTrack(null),r.peerConnection.removeTrack(E)}),f}let p=r.mungSendOfferSDP(a.sdp,t);r.remoteSDP.receive(t,i,u);let m=r.remoteSDP.toString();return yield xe(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield xe(r.applySendEncodings(o,t)),yield xe(r.peerConnection.setRemoteDescription({type:"answer",sdp:m})),t.map((f,E)=>{let I=f._mediaStreamTrack.id;return{localSSRC:d[E],id:I}})}catch(o){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{n()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(o=>{mi()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:o,mslabel:a}=this.remoteSDP.send(t,i,n),l=new ne((p,m)=>{let f=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(o)))},1e4),E=I=>{let T=Xe();if((T.name==="Safari"&&Number(T.version)===11||ji())&&I.track.id!==o&&I.streams[0].id===a){var R;let w=I.streams[0].getTracks()[0];return(R=this.remoteSDP)===null||R===void 0||R.updateTrackLabel(t,o,I.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(f),void p(w)}if(I.track.id===o)return this.peerConnection.removeEventListener("track",E),clearTimeout(f),void p(I.track)};this.peerConnection.addEventListener("track",E)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await l,id:o}}catch(o){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(r=>{var n;return t.indexOf(((n=r.track)===null||n===void 0?void 0:n.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(r=>{if(mi()&&r.track)r.track.enabled=!1;else{let n=r.getParameters();n.encodings.forEach(o=>o.active=!1),r.setParameters(n)}})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async o=>{if(mi()&&o.track)o.track.enabled=!0;else{let a=o.getParameters();a.encodings.forEach(l=>l.active=!0),await o.setParameters(a)}});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Vr(function*(){let r=yield xe(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){let d=i.peerConnection.getConfiguration(),u=t===Ji.RELAY?"relay":"all";d.iceTransportPolicy!==u&&(S.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(d.iceTransportPolicy,"] to [").concat(u,"]")),d.iceTransportPolicy=u,i.peerConnection.setConfiguration(d))}else if(t===Ji.RELAY)return;t!==Ji.RELAY&&i.remoteSDP.updateCandidates(t);let n=yield xe(i.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=go(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;i.remoteSDP.restartICE(a);let l=i.remoteSDP.toString();yield xe(i.peerConnection.setLocalDescription(n)),yield xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(n){S.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),n)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new B(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getSenders().filter(n=>{var o;return((o=n.track)===null||o===void 0?void 0:o.id)===t});r.length===1&&await this.applySendEncodings(r,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getSenders().find(n=>{var o;return((o=n.track)===null||o===void 0?void 0:o.id)===i});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new B(A.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new B(A.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yl(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...yh.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...yh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(t,i){var r;if(i||(i=this.peerConnection.getSenders().find(u=>{var p;return((p=u.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id})),!i)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ye().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");let n={},o={};if(t instanceof Et)switch(t._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(N("DSCP_TYPE")&&qs()){var a;let u=N("DSCP_TYPE");se(a=["very-low","low","medium","high"]).call(a,u)&&(o.networkPriority=u)}let l=i.getParameters(),d=(r=l.encodings)===null||r===void 0?void 0:r[0];d&&Object.assign(d,o),Object.assign(l,n),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await i.setParameters(l)}async applySendEncodings(t,i){try{if(!Ye().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],o=i[r];n&&o&&await this.updateRtpSenderEncodings(o,n)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){let r=Nt.parse(t);return i.forEach((n,o)=>{let a=n._mediaStreamTrack,l=r.mediaDescriptions.find(d=>d.attributes.mid===a.kind);l&&la(l,n)}),Nt.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(t).map((o,a)=>{let{id:l,mslabel:d}=o,{kind:u}=t[a];return new ne((p,m)=>{let f=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),E=I=>{let T=Xe();if(T.name==="Safari"&&Number(T.version)===11&&I.track.id!==l&&I.streams[0].id===d){var R;let w=I.streams[0].getTracks()[0];return(R=this.remoteSDP)===null||R===void 0||R.updateTrackLabel(u,l,I.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(f),void p({track:w,id:l})}if(I.track.id===l)return this.peerConnection.removeEventListener("track",E),clearTimeout(f),void p({track:I.track,id:l})};this.peerConnection.addEventListener("track",E)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(n),await ne.all(i)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){let i=yh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},ie(gt.prototype,"connect",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"connect"),gt.prototype),ie(gt.prototype,"stopSending",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"stopSending"),gt.prototype),ie(gt.prototype,"receive",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"receive"),gt.prototype),ie(gt.prototype,"stopReceiving",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"stopReceiving"),gt.prototype),ie(gt.prototype,"muteRemote",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"muteRemote"),gt.prototype),ie(gt.prototype,"unmuteRemote",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"unmuteRemote"),gt.prototype),ie(gt.prototype,"muteLocal",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"muteLocal"),gt.prototype),ie(gt.prototype,"unmuteLocal",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"unmuteLocal"),gt.prototype),ie(gt.prototype,"close",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"close"),gt.prototype),ie(gt.prototype,"updateEncoderConfig",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"updateEncoderConfig"),gt.prototype),ie(gt.prototype,"updateSendParameters",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"updateSendParameters"),gt.prototype),ie(gt.prototype,"replaceTrack",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"replaceTrack"),gt.prototype),ie(gt.prototype,"getRemoteSSRC",[vn],Object.getOwnPropertyDescriptor(gt.prototype,"getRemoteSSRC"),gt.prototype),gt);function vn(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}function e1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function pa(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?e1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let ah="9",t1=4e4;function i1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ys(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?i1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let f_=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var sd=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(sd||{});let E_=new Map;function r1(e,t,i,r){let{scale:n}=e;if(n===0&&r===sd.UP||n>=t.length-1&&r===sd.DOWN)return e;let o=ys(ys({},e),{},{scale:r===sd.DOWN?++n:--n});switch(i){case"maintain-framerate":o=ys(ys({},o),t[n].motion);break;case"maintain-resolution":o=ys(ys({},o),t[n].detail);break;case"balanced":o=ys(ys({},o),t[n].balanced)}return o}function n1(e,t){if(t){let i={overUse:0,underUse:0,adaptationList:o1(t)};E_.set(e,i)}else E_.delete(e)}function o1(e){let t=ys({},e),{bitrateMax:i,frameRate:r,scaleResolutionDownBy:n,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:f,PERF_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:T,BALANCE_FRAMERATE_FACTOR:R,BALANCE_RESOLUTION_FACTOR:w,MOTION_RESOLUTION_FACTOR:O,MOTION_BITRATE_FACTOR:P,DETAIL_FRAMERATE_FACTOR:M,DETAIL_BITRATE_FACTOR:V}=GS,F=Math.min(t.frameRate,l),q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(f,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(E,1)*F),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:i,bitrateMin:o}}];for(let J=1;J<=d;J++){let Z={bwe_up:Math.round(Math.pow(m,J)*i),bwe_down:Math.round(Math.pow(f,J+1)*i),fps_up:Math.round(Math.pow(I,J)*F),fps_down:Math.round(Math.pow(E,J+1)*F)},pe={scaleResolutionDownBy:n/Math.pow(w,J),frameRate:Math.max(Math.round(Math.pow(R,J)*r),a),bitrateMax:Math.max(Math.round(Math.pow(T,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(T,J)*o),u)},ze={scaleResolutionDownBy:n/Math.pow(O,J),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(P,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(P,J)*o),u)},nt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(M,J)*r),a),bitrateMax:Math.max(Math.round(Math.pow(V,J)*i),p),bitrateMin:Math.max(Math.round(Math.pow(V,J)*o),u)};q.push({scale:J,threshold:Z,balanced:pe,motion:ze,detail:nt})}return q}function H9(e,t,i,r,n,o){let a=E_.get(e)||{overUse:0,underUse:0,adaptationList:o1(n)},{adaptationList:l}=a;E_.set(e,a);let{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:u}=GS,{scale:p}=r,m,f;return typeof t=="number"&&t>0&&function(E,I,T,R){if(I>=T.length)return!1;let{threshold:{fps_down:w}}=T[I];return N("FORCE_AG_HIGH_FRAMERATE")&&R==="maintain-framerate"&&(w=T[0].threshold.fps_down),E<w}(t,p,l,o)&&(a.overUse++,f=f_.CPU,a.overUse>d)||typeof i=="number"&&i>0&&function(E,I,T){if(I>=T.length)return!1;let{threshold:{bwe_down:R}}=T[I];return E<R}(i,p,l)&&(a.overUse++,f=f_.BANDWIDTH,a.overUse>d)?(a.overUse=0,a.underUse=0,m=r1(r,l,o,sd.DOWN),[m,f]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&function(E,I,T,R){if(I===0)return;let{threshold:{fps_up:w}}=T[I];return N("FORCE_AG_HIGH_FRAMERATE")&&R==="maintain-framerate"&&(w=T[1].threshold.fps_up),E>w}(t,p,l,o)&&function(E,I,T){if(I===0)return;let{threshold:{bwe_up:R}}=T[I];return E>R}(i,p,l)&&(a.underUse++,a.underUse>u&&(a.overUse=0,a.underUse=0,m=r1(r,l,o,sd.UP),m.scale===0&&(f=f_.NONE))),[m,f])}function s1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function bv(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?s1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function K9(e){var t;return!!N("ENABLE_AG_ADAPTATION")&&!!(e instanceof pv||se(t=e._hints).call(t,Rt.CUSTOM_TRACK))&&(!!N("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){let r=Xe();if(r.os!==pi.IOS||!r.osVersion)return!1;let n=r.osVersion.split(".");return Number(n[0])>=i}(14)&&fb(17,4)||_b(14)&&Eb(17,4)))}let g_=new Map;function S_(e){let t=g_.get(e);if(t){let{timer:i,adaptationFunc:r,originConfig:n}=t;window.clearTimeout(i),r(n),g_.delete(e)}n1(e)}var Qe;function a1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function ma(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?a1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Ro=(Qe=class Ih extends wm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return se(i=Object.keys(Al)).call(i,t)}))]}constructor(t,i){super(t,i),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"id",ft(5,"connection-")),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"transportEventReceiver",void 0),y(this,"statsFilter",void 0),y(this,"useXR",N("USE_XR")),y(this,"localCapabilities",void 0),y(this,"remoteCodecs",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"dataStreamChannelMap",new Map),y(this,"establishPromise",void 0),y(this,"recoveredDataChannelIds",[]),y(this,"currentDataChannelId",1),y(this,"mutex",new vi("P2PConnection-mutex")),y(this,"qualityLimitationReason",f_.NONE),this.store=i,this.peerConnection=new RTCPeerConnection(Ih.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=l_(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=go(t.sdp),r=await yv({filterRTX:!N("USE_PUB_RTX")&&!N("USE_SUB_RTX"),filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterVideoCodec:N("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=nd(r),this.initialOffer=t,ma(ma({},i),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new B(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,i,r,n,o,a){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return vt(this._localCapabilities)}get rtpCapabilities(){return vt(this._rtpCapabilities)}get candidates(){return vt(this._candidates)}get iceParameters(){return vt(this._iceParameters)}get dtlsParameters(){return vt(this._dtlsParameters)}constructor(E){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),y(this,"firefoxSsrcMidMap",new Map),E=vt(E);let{remoteIceParameters:I,remoteDtlsParameters:T,candidates:R,remoteRTPCapabilities:w,remoteSetup:O,localCapabilities:P,cname:M}=E,V=Nt.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=w,this._candidates=R,this._iceParameters=I,this._dtlsParameters=T,this._localCapabilities=P,this.setup=O,this.cname=M;let F=this.rtpCapabilities.send;for(let q of V.mediaDescriptions){if(q.attributes.iceUfrag=I.iceUfrag,q.attributes.icePwd=I.icePwd,q.attributes.fingerprints=T.fingerprints,q.attributes.candidates=R,q.attributes.setup=O,q.media.mediaType==="video"&&(q.media.fmts=F.videoCodecs.map(J=>J.payloadType.toString(10)),q.attributes.payloads=F.videoCodecs,q.attributes.extmaps=F.videoExtensions,N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:J,ssrcGroups:Z}=on([{ssrcId:t1,rtx:N("USE_SUB_RTX")?40001:void 0}],this.cname);q.attributes.ssrcs=J,q.attributes.ssrcGroups=Z}if(q.media.mediaType==="audio"&&(q.media.fmts=F.audioCodecs.map(J=>J.payloadType.toString(10)),q.attributes.payloads=F.audioCodecs,q.attributes.extmaps=F.audioExtensions,So(q),N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:J,ssrcGroups:Z}=on([{ssrcId:2e4}],this.cname);q.attributes.ssrcs=J,q.attributes.ssrcGroups=Z}}this.sessionDesc=V,this.currentMidIndex=V.mediaDescriptions.length-1}preloadRemoteMedia(){let E=N("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;let I=this.candidates,T=this.dtlsParameters,R=this.iceParameters,w=this.rtpCapabilities.send;for(let O=1;O<E;O++){let P=2*O+2e4,M=2*O+t1,{ssrcs:V,ssrcGroups:F}=on([{ssrcId:P}],this.cname),{ssrcs:q,ssrcGroups:J}=on([{ssrcId:M,rtx:N("USE_SUB_RTX")?M+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ah,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.videoCodecs.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:I,extmaps:w.videoExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:J,rtcpFeedbackWildcards:[],payloads:w.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*O)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ah,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.audioCodecs.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:I,extmaps:w.audioExtensions,fingerprints:T.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:V,ssrcGroups:F,rtcpFeedbackWildcards:[],payloads:w.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*O+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Nt.print(this.sessionDesc)}send(E,I,T,R){let{ssrcs:w,ssrcGroups:O}=on(I,this.cname,N("SYNC_GROUP")?T:void 0),P=this.findPreloadMediaDesc(w);if(P){if(mt()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,P.attributes.mid),R&&(R.twcc||R.remb)){let M=this.sessionDesc.mediaDescriptions.indexOf(P);return this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(P,R),{mid:P.attributes.mid,needExchangeSDP:!0}}return{mid:P.attributes.mid,needExchangeSDP:!1}}{let M=this.findAvailableMediaIndex(E,w),V;return M===-1||M===1&&(mi()||Sb())||M===0&&N("USE_SUB_RTX")||Tb()?(V=this.createOrRecycleSendMedia(E,w,O,"sendonly",R),this.updateBundleMids()):(V=vt(this.sessionDesc.mediaDescriptions[M]),V.attributes.direction="sendonly",V.attributes.ssrcs=w,V.attributes.ssrcGroups=O,this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(V,R)),mt()&&this.firefoxSsrcMidMap.set(w[0].ssrcId,V.attributes.mid),{mid:V.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:E,needExchangeSDP:I}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:I}}batchSend(E){let I=E.map(w=>{let{kind:O,ssrcMsg:P,mslabel:M}=w;return this.send(O,P,M)}),T=[],R=!1;return I.forEach(w=>{let{mid:O,needExchangeSDP:P}=w;P&&(R=!0),T.push(O)}),{mids:T,needExchangeSDP:R}}stopSending(E){let I=this.sessionDesc.mediaDescriptions.filter(T=>T.attributes.mid&&E.indexOf(T.attributes.mid)!==-1);if(I.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");I.forEach(T=>{T.attributes.mid==="0"||mt()||Tb()?T.attributes.ssrcs=[]:(T.attributes.ssrcs=[],T.attributes.direction="inactive",T.media.port="0")}),this.updateBundleMids()}mute(E){let I=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===E);if(!I)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));I.attributes.direction="inactive"}unmute(E){let I=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===E);if(!I)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));I.attributes.direction="sendonly"}muteRemote(E){let I=this.sessionDesc.mediaDescriptions.filter(T=>se(E).call(E,T.attributes.mid||""));if(I.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(T=>{T.attributes.direction="inactive"})}unmuteRemote(E){let I=this.sessionDesc.mediaDescriptions.filter(T=>se(E).call(E,T.attributes.mid||""));if(I.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");I.forEach(T=>{T.attributes.direction="recvonly"})}receive(E,I,T,R){E.forEach((w,O)=>{this.createOrRecycleRecvMedia(w,[],"recvonly",I,T,R[O])}),this.updateBundleMids()}stopReceiving(E){let I=this.sessionDesc.mediaDescriptions.filter(T=>E.indexOf(T.attributes.mid)!==-1);if(I.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");I.forEach(T=>{T.media.port="0",T.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(E){let I=this._candidates.filter(T=>T.transport==="udp");if(E===Ji.TCP){if(I.length===0)return;if(N("TCP_CANDIDATE_ONLY")){let T=this._candidates.filter(R=>R.transport==="tcp");I.forEach(R=>{T.findIndex(w=>w.connectionAddress===R.connectionAddress)===-1&&T.push(pa(pa({},R),{},{foundation:"tcpcandidate",priority:Number(R.priority)-1+"",transport:"tcp",port:Number(R.port)+90+""}))}),this._candidates=T}else{let T=[];I.forEach(R=>{T.push(pa(pa({},R),{},{foundation:"tcpcandidate",priority:Number(R.priority)-1+"",transport:"tcp",port:Number(R.port)+90+""}))}),this._candidates=[...I,...T]}}else if(E===Ji.RELAY){if(I.length!==0)return;{let T=this._candidates.filter(R=>R.transport==="tcp");T.forEach(R=>{I.push(pa(pa({},R),{},{foundation:"udpcandidate",priority:Number(R.priority)+1+"",transport:"udp",port:Number(R.port)-90+""}))}),this._candidates=[...I,...T]}}else I.length===0?(this._candidates.filter(T=>T.transport==="tcp").forEach(T=>{I.push(pa(pa({},T),{},{foundation:"udpcandidate",priority:Number(T.priority)+1+"",transport:"udp",port:Number(T.port)-90+""}))}),this._candidates=I):this._candidates=this._candidates.filter(T=>T.transport!=="tcp");for(let T of this.sessionDesc.mediaDescriptions)T.attributes.candidates=this.candidates}restartICE(E){E=vt(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(I=>{I.attributes.iceUfrag=E.iceUfrag,I.attributes.icePwd=E.icePwd})}predictReceivingMids(E){let I=[];for(let T=0;T<E;T++)I.push((this.currentMidIndex+T+1).toString(10));return I}findAvailableMediaIndex(E,I){return this.sessionDesc.mediaDescriptions.findIndex(T=>{let R=T.media.mediaType===E&&T.media.port!=="0"&&(T.attributes.direction==="sendonly"||T.attributes.direction==="sendrecv")&&T.attributes.ssrcs.length===0;if(mt()){if(R){let w=this.firefoxSsrcMidMap.get(I[0].ssrcId);return!(w||T.attributes.mid!=="0"&&T.attributes.mid!=="1")||!(!w||w!==T.attributes.mid)}return!1}return R})}createOrRecycleDataChannel(){for(let T of this.sessionDesc.mediaDescriptions)if(T.media.mediaType==="application")return{mediaDesc:T,needExchangeSDP:!1};this.currentMidIndex+=1;let E="".concat(this.currentMidIndex),I={media:{mediaType:"application",port:ah,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(I),{mediaDesc:I,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,I,T,R,w,O){let P=E._mediaStreamTrack.kind,M=this.rtpCapabilities.recv,V=yc(P,M,this.localCapabilities.send,P===me.VIDEO?R:w),F=P===me.VIDEO?M.videoExtensions:M.audioExtensions;this.currentMidIndex+=1;let q="".concat(this.currentMidIndex),J={media:{mediaType:P,port:ah,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:T,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};J=this.mungRecvMediaDsec(J,E,O);let Z=this.findFirstClosedMedia(P);if(Z){let pe=this.sessionDesc.mediaDescriptions.indexOf(Z);this.sessionDesc.mediaDescriptions[pe]=J}else this.sessionDesc.mediaDescriptions.push(J);return J}updateRemoteCodec(E,I,T){let R=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(J=>J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||"").filter(J=>{var Z;return se(Z=Object.keys(Al)).call(Z,J)}))],w=new Set(I);if(R.every(J=>w.has(J)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(I)),!1;let O=this._rtpCapabilities.recv.videoCodecs.filter(J=>I.some(Z=>{var pe;return se(pe=J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||"").call(pe,Z)}));if(O.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(R," codecs: ").concat(I)),!1;let P=[...new Set(O.map(J=>J.rtpMap&&J.rtpMap.encodingName.toLowerCase()||""))],M;if(S.debug("updateRemoteCodec, from ".concat(R," to ").concat(P)),E.length===0)M=this.sessionDesc.mediaDescriptions.filter(J=>J.media.mediaType==="video"&&J.attributes.direction==="recvonly");else if(M=this.sessionDesc.mediaDescriptions.filter(J=>J.attributes.mid&&se(E).call(E,J.attributes.mid)&&J.attributes.direction==="recvonly"),M.length!==E.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(I)),!1;if(N("USE_PUB_RTX")||N("USE_SUB_RTX")){let J=Iv(O,this.rtpCapabilities.recv.videoCodecs);O.push(...J)}this._rtpCapabilities.recv.videoCodecs=O;let V=this.localCapabilities.send,F=this.rtpCapabilities.recv,q=yc(me.VIDEO,F,V,T);return M.forEach(J=>{let Z=q.map(pe=>pe.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(J.attributes.mid,", from ").concat(J.attributes.payloads," to ").concat(q)),J.attributes.payloads=q,J.media.fmts=Z}),!0}createOrRecycleSendMedia(E,I,T,R,w){let O=this.rtpCapabilities.send,P=E===me.VIDEO?O.videoCodecs:O.audioCodecs,M=E===me.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;let V="".concat(this.currentMidIndex),F={media:{mediaType:E,port:ah,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:P,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};F=this.mungSendMediaDesc(F,w);let q=this.findFirstClosedMedia(E);if(q){let J=this.sessionDesc.mediaDescriptions.indexOf(q);this.sessionDesc.mediaDescriptions[J]=F}else this.sessionDesc.mediaDescriptions.push(F);return F}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,I,T){let R=vt(E);return d_(R),la(R,I),u_(R,I),Rv(R),rd(R,T,this.localCapabilities.send),R}mungSendMediaDesc(E,I){let T=vt(E);return rd(T,I,this.localCapabilities.recv),So(T),T}updateRecvMedia(E,I){let T=this.sessionDesc.mediaDescriptions.findIndex(R=>R.attributes.mid===E);if(T!==-1){let R=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[T],I);this.sessionDesc.mediaDescriptions[T]=R}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(I=>mt()?I.media.port==="0"&&I.media.mediaType===E:I.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(I=>{var T;return((T=I.attributes)===null||T===void 0||(T=T.ssrcs[0])===null||T===void 0?void 0:T.ssrcId)===E[0].ssrcId})}getSSRC(E){var I;return(I=this.sessionDesc.mediaDescriptions.find(T=>T.attributes.mid===E))===null||I===void 0?void 0:I.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:n,remoteSetup:o,localCapabilities:this.localCapabilities,cname:a}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let l=this.remoteSDP.toString(),d=Nt.parse(this.initialOffer.sdp),u=d.mediaDescriptions.find(E=>E.media.mediaType==="audio");u&&So(u),this.useXR&&h_(d);let p=Nt.print(d),m=this.logSDPExchange(p||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});let f=this.peerConnection.getTransceivers()[0];if(f!=null&&f.receiver&&this.tryBindTransportEvents(f.receiver),N("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();let E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});let I=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(I)}}catch(l){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,i,r){var n=this;return Vr(function*(){let o=yield xe(n.mutex.lock("From P2PConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let a=[];t.forEach(T=>{let R=n.peerConnection.addTransceiver(T._mediaStreamTrack,{direction:"sendonly"});a.push(R),T._updateRtpTransceiver(R)}),mt()&&N("SIMULCAST")===!0&&(yield xe(n.applySimulcastForFirefox(a,t)));let l=yield xe(n.peerConnection.createOffer()),d=n.remoteSDP.predictReceivingMids(t.length),u=n.mungSendOfferSDP(l.sdp,t,d),p=Nt.parse(u),m=d.map(T=>{let R=p.mediaDescriptions.find(w=>w.attributes.mid===T);if(!R)throw new Error("Cannot extract ssrc from mediaDescription.");return vv(R,N("USE_PUB_RTX"))}),f;try{f=yield m}catch(T){f=[],n.remoteSDP.receive(t,i,r,f);let R=n.remoteSDP.toString();throw yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:R})),yield xe(n.stopSending(d,!0)),T}n.remoteSDP.receive(t,i,r,f);let E=n.remoteSDP.toString(),I=n.logSDPExchange(u,"offer","local","send");return yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield xe(n.applySimulcastEncodings(a,t)),yield xe(n.applySendEncodings(a,t)),I==null||I(E),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:E})),a.map((T,R)=>{let w=d[R];return{localSSRC:m[R],id:w,transceiver:T}})}catch(a){throw a instanceof B?a:new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}i.forEach(o=>{o._updateOriginDataChannel(r)});let{needExchangeSDP:n}=this.remoteSDP.sendDataChannel();if(n){let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof B?r:new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof B?i:new B(A.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(d=>{var u;S_(this.id+d.mid),d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}finally{r&&r()}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,i,r,n);if(a){let d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,o,t);u==null||u(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}}catch(o){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){let n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return i.map(n=>{let o=this.peerConnection.getTransceivers().find(a=>a.mid===n);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:n,transceiver:o}})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(a=>{a.direction="inactive"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(a,l)=>{a.direction="sendonly"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new B(A.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Vr(function*(){let r=yield xe(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){let u=i.peerConnection.getConfiguration(),p=t===Ji.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(S.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,i.peerConnection.setConfiguration(u))}else if(t===Ji.RELAY)return;i.remoteSDP.updateCandidates(t);let n=yield xe(i.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=go(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;i.remoteSDP.restartICE(a);let l=i.remoteSDP.toString(),d=i.logSDPExchange(n.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield xe(i.peerConnection.setLocalDescription(n)),d==null||d(l),yield xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(n){S.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),n)}finally{r()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(i=>{S_(this.id+i.mid)}),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ma(ma({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let o=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new B(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(n=>n.mid===t);r.length===1&&(this.isVP8Simulcast(i)?mt()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(n=>n.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:r,remote:n}=i.getSelectedCandidatePair();return{local:ma(ma({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:ma(ma({},Zo),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yl(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...Ih.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...Ih.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&Ye().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!N("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(t){let i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var n;i!=null&&i.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,i.state))},i.onerror=n=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in n?n.error:n)};let r=i.iceTransport;r&&(r.onstatechange=()=>{let n=i==null?void 0:i.iceTransport.state;var o;n&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:n,remote:o}=r.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var r,n;if(i||(i=this.peerConnection.getSenders().find(T=>T.track===t._mediaStreamTrack)),!i)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ye().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},a={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}let l=function(T,R){return T.getTransceivers().find(w=>w.sender.track===R||w.receiver.track===R)}(this.peerConnection,t._mediaStreamTrack),d=m9(t);if(K9(t)&&l&&i&&d&&this.getLocalVideoStats&&se(r=["vp8","vp9"]).call(r,this.store.codec)){var u;let T=o.degradationPreference||(se(u=t._hints).call(u,Rt.CUSTOM_TRACK)?N("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(R,w,O,P,M,V){if(S_(R),P!=="balanced"&&P!=="maintain-framerate"&&P!=="maintain-resolution")return;let F=-1;n1(R,w);let q=window.setInterval(()=>{let Z=g_.get(R);if(!N("ENABLE_AG_ADAPTATION")||!Z)return void S_(R);let pe=V();if(pe.sendPackets>0&&pe.OutgoingAvailableBandwidth>0){if(F===-1)return void(F=Date.now());if(Date.now()-F<1e3)return;let ze=pe.sendFrameRate,nt=pe.OutgoingAvailableBandwidth,[Ct,$t]=H9(R,ze,nt,Z.adaptationConfig,w,P);$t&&(O.qualityLimitationReason=$t),Ct&&Z.adaptationConfig.scale!==Ct.scale&&(S.debug("[".concat(R,"] applyAdaptation: ").concat(O.qualityLimitationReason,`
           sendFps `).concat(ze,", bwe ").concat(nt,", switch from ").concat(Z.adaptationConfig.scale," to ").concat(Ct.scale," ")),Z.adaptationConfig=bv(bv({},Z.adaptationConfig),Ct),M(Ct))}},N("CHECK_LOCAL_STATS_INTERVAL")),J=bv({},w);g_.set(R,{timer:q,adaptationConfig:J,originConfig:w,adaptationFunc:M}),S.debug("[".concat(R,"] start adaptation, originConfig: ").concat(JSON.stringify(w),", degradationPreference: ").concat(P))})(this.id+l.mid,d,this,T,R=>{i&&this.updateAdaptation(i,R)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;let{bitrateMax:T,frameRate:R,scaleResolutionDownBy:w}=t._encoderConfig;T&&(a.maxBitrate=1e3*T),(se(p=t._hints).call(p,Rt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(R&&(a.maxFramerate=Cr(R)),w&&w>=1&&(a.scaleResolutionDownBy=w))}let{maxFramerate:m}=N("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,m):m),N("DSCP_TYPE")&&qs()){var f;let T=N("DSCP_TYPE");se(f=["very-low","low","medium","high"]).call(f,T)&&(a.networkPriority=T)}let E=i.getParameters(),I=(n=E.encodings)===null||n===void 0?void 0:n[0];mt()&&!I&&(o.encodings=[a]),I&&Object.assign(I,a),Object.assign(E,o),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(E.encodings))),await i.setParameters(E)}async updateAdaptation(t,i){var r,n;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!Ye().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let o={},{bitrateMax:a,frameRate:l,scaleResolutionDownBy:d}=i;a&&(o.maxBitrate=1e3*a),l&&(o.maxFramerate=Cr(l)),d&&d>=1&&se(r=["vp8","vp9"]).call(r,this.store.codec)&&(o.scaleResolutionDownBy=d);let u=t.getParameters(),p=(n=u.encodings)===null||n===void 0?void 0:n[0];p&&Object.assign(p,o),Object.assign(u,{});try{await t.setParameters(u),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings)))}catch(m){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!Ye().supportSetRtpSenderParameters||t.length!==i.length)return;for(let r=0;r<t.length;r++){let n=t[r],o=i[r];o instanceof Et&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,n.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,r){let n=Nt.parse(t);return i.forEach((o,a)=>{let l=r[a],d=n.mediaDescriptions.find(u=>u.attributes.mid===l);d&&(la(d,o),Cv(d,o,this.store.codec))}),Nt.print(n)}mungReceiveAnswerSDP(t,i,r){let n=Nt.parse(t),o=n.mediaDescriptions.find(a=>a.attributes.mid===i);return o&&(r===me.AUDIO&&o.media.mediaType==="audio"&&So(o),this.useXR&&h_(n)),Nt.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,n,o,a,l;let u=t[d],p=i[d];if(p instanceof Et&&!se(r=p._hints).call(r,Rt.LOW_STREAM)&&(n=p._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((o=p._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let m={},f={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:f.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:f.high}];let E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,m))}}}async applySimulcastEncodings(t,i){if(!mt()&&t.length===i.length)for(let r=0;r<t.length;r++){let n=i[r];if(n instanceof Et&&this.isVP8Simulcast(n)){let o=t[r],a={},l={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,a))}}}isVP8Simulcast(t){var i,r,n,o,a;return!!(t instanceof Et&&N("SIMULCAST")&&this.store.codec==="vp8"&&!se(i=t._hints).call(i,Rt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,i,r,n){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(i," SDP during P2PConnection.").concat(n,`
`),t),i==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",n)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){let i=Ih.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},ie(Qe.prototype,"updateRemoteRTPCapabilities",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"updateRemoteRTPCapabilities"),Qe.prototype),ie(Qe.prototype,"connect",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"connect"),Qe.prototype),ie(Qe.prototype,"createDataChannels",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"createDataChannels"),Qe.prototype),ie(Qe.prototype,"receive",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"receive"),Qe.prototype),ie(Qe.prototype,"batchReceive",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"batchReceive"),Qe.prototype),ie(Qe.prototype,"stopReceiving",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"stopReceiving"),Qe.prototype),ie(Qe.prototype,"muteRemote",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"muteRemote"),Qe.prototype),ie(Qe.prototype,"unmuteRemote",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteRemote"),Qe.prototype),ie(Qe.prototype,"muteLocal",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"muteLocal"),Qe.prototype),ie(Qe.prototype,"unmuteLocal",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteLocal"),Qe.prototype),ie(Qe.prototype,"close",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),ie(Qe.prototype,"updateEncoderConfig",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"updateEncoderConfig"),Qe.prototype),ie(Qe.prototype,"updateSendParameters",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"updateSendParameters"),Qe.prototype),ie(Qe.prototype,"replaceTrack",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"replaceTrack"),Qe.prototype),ie(Qe.prototype,"updateAdaptation",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"updateAdaptation"),Qe.prototype),ie(Qe.prototype,"getRemoteSSRC",[yr],Object.getOwnPropertyDescriptor(Qe.prototype,"getRemoteSSRC"),Qe.prototype),Qe);function yr(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}function c1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function l1(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?c1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let d1=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,T_="9",Nv=2e4,Dv=4e4;class z9{get localCapabilities(){return vt(this._localCapabilities)}get rtpCapabilities(){return vt(this._rtpCapabilities)}get candidates(){return vt(this._candidates)}get iceParameters(){return vt(this._iceParameters)}get dtlsParameters(){return vt(this._dtlsParameters)}constructor(t){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),y(this,"firefoxSsrcMidMap",new Map),t=vt(t);let{remoteIceParameters:i,remoteDtlsParameters:r,candidates:n,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:l,cname:d}=t,u=Nt.parse(d1);this._rtpCapabilities=o,this._candidates=n,this._iceParameters=i,this._dtlsParameters=r,this._localCapabilities=l,this.setup=a,this.cname=d;let p=this.rtpCapabilities.send;for(let m of u.mediaDescriptions){if(m.attributes.iceUfrag=i.iceUfrag,m.attributes.icePwd=i.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=n,m.attributes.setup=a,m.media.mediaType==="application"&&(m.attributes.sctpPort="5000"),m.media.mediaType==="video"&&(m.media.fmts=p.videoCodecs.map(f=>f.payloadType.toString(10)),m.attributes.payloads=p.videoCodecs,m.attributes.extmaps=p.videoExtensions,N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:f,ssrcGroups:E}=on([{ssrcId:Dv,rtx:N("USE_SUB_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=f,m.attributes.ssrcGroups=E}if(m.media.mediaType==="audio"&&(m.media.fmts=p.audioCodecs.map(f=>f.payloadType.toString(10)),m.attributes.payloads=p.audioCodecs,m.attributes.extmaps=p.audioExtensions,So(m),N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:f,ssrcGroups:E}=on([{ssrcId:Nv}],this.cname);m.attributes.ssrcs=f,m.attributes.ssrcGroups=E}}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){let i=Nt.parse(d1);this._rtpCapabilities=t;let r=this.rtpCapabilities.send;for(let n of i.mediaDescriptions){if(n.attributes.iceUfrag=this._iceParameters.iceUfrag,n.attributes.icePwd=this._iceParameters.icePwd,n.attributes.fingerprints=this._dtlsParameters.fingerprints,n.attributes.candidates=this._candidates,n.attributes.setup=this.setup,n.media.mediaType==="application"&&(n.attributes.sctpPort="5000"),n.media.mediaType==="video"&&(n.media.fmts=r.videoCodecs.map(o=>o.payloadType.toString(10)),n.attributes.payloads=r.videoCodecs,n.attributes.extmaps=r.videoExtensions,N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:o,ssrcGroups:a}=on([{ssrcId:Dv,rtx:N("USE_SUB_RTX")?40001:void 0}],this.cname);n.attributes.ssrcs=o,n.attributes.ssrcGroups=a}if(n.media.mediaType==="audio"&&(n.media.fmts=r.audioCodecs.map(o=>o.payloadType.toString(10)),n.attributes.payloads=r.audioCodecs,n.attributes.extmaps=r.audioExtensions,N("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:o,ssrcGroups:a}=on([{ssrcId:Nv}],this.cname);n.attributes.ssrcs=o,n.attributes.ssrcGroups=a}}this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;let i=this.candidates,r=this.dtlsParameters,n=this.iceParameters,o=this.rtpCapabilities.send;for(let a=1;a<t;a++){let l=2*a+Nv,d=2*a+Dv,{ssrcs:u,ssrcGroups:p}=on([{ssrcId:l}],this.cname),{ssrcs:m,ssrcGroups:f}=on([{ssrcId:d,rtx:N("USE_SUB_RTX")?d+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:T_,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.videoCodecs.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n.iceUfrag,icePwd:n.icePwd,unrecognized:[],candidates:i,extmaps:o.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:o.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:T_,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.audioCodecs.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n.iceUfrag,icePwd:n.icePwd,unrecognized:[],candidates:i,extmaps:o.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:o.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*a)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Nt.print(this.sessionDesc)}send(t,i,r,n){let{ssrcs:o,ssrcGroups:a}=on(i,this.cname,N("SYNC_GROUP")?r:void 0),l=this.findPreloadMediaDesc(o);if(l){if(mt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),n&&(n.twcc||n.remb)){let d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,n),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let d=this.findAvailableMediaIndex(t,o),u;return d===-1||mi()||ji()||Sb()||d===0&&N("USE_SUB_RTX")?(u=this.createOrRecycleSendMedia(t,o,a,"sendonly",n),this.updateBundleMids()):(u=vt(this.sessionDesc.mediaDescriptions[d]),u.attributes.direction="sendonly",u.attributes.ssrcs=o,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(u,n)),mt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}}batchSend(t){let i=t.map(o=>{let{kind:a,ssrcMsg:l,mslabel:d}=o;return this.send(a,l,d)}),r=[],n=!1;return i.forEach(o=>{let{mid:a,needExchangeSDP:l}=o;l&&(n=!0),r.push(a)}),{mids:r,needExchangeSDP:n}}stopSending(t){let i=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(r=>{r.attributes.mid==="0"||mt()||mi()||ji()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){let i=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){let i=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(t){let i=this.sessionDesc.mediaDescriptions.filter(r=>se(t).call(t,r.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){let i=this.sessionDesc.mediaDescriptions.filter(r=>se(t).call(t,r.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,i,r,n){t.forEach((o,a)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",i,r,n[a])}),this.updateBundleMids()}stopReceiving(t){let i=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===Ji.TCP?this._candidates.forEach(i=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===i.connectionAddress&&r.port===i.port)===-1&&this._candidates.push(l1(l1({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>i.transport!=="tcp");for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(t){t=vt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=t.iceUfrag,i.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let i=[];for(let r=0;r<t;r++)i.push((this.currentMidIndex+r+1).toString(10));return i}findAvailableMediaIndex(t,i){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let n=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(mt()){if(n){let o=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(o||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!o||o!==r.attributes.mid)}return!1}return n})}createOrRecycleRecvMedia(t,i,r,n,o,a){let l=t._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,u=yc(l,d,this.localCapabilities.send,l===me.VIDEO?n:o),p=l===me.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;let m="".concat(this.currentMidIndex),f={media:{mediaType:l,port:T_,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};f=this.mungRecvMediaDsec(f,t,a);let E=this.findFirstClosedMedia(l);if(E){let I=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[I]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateRemoteCodec(t,i,r){let n=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(f=>f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").filter(f=>{var E;return se(E=Object.keys(Al)).call(E,f)}))],o=new Set(i);if(n.every(f=>o.has(f)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(i)),!1;let a=this._rtpCapabilities.recv.videoCodecs.filter(f=>i.some(E=>{var I;return se(I=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(I,E)}));if(a.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n," codecs: ").concat(i)),!1;let l=[...new Set(a.map(f=>f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||""))],d;if(S.debug("updateRemoteCodec, from ".concat(n," to ").concat(l)),t.length===0)d=this.sessionDesc.mediaDescriptions.filter(f=>f.media.mediaType==="video"&&f.attributes.direction==="recvonly");else if(d=this.sessionDesc.mediaDescriptions.filter(f=>f.attributes.mid&&se(t).call(t,f.attributes.mid)&&f.attributes.direction==="recvonly"),d.length!==t.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(i)),!1;this._rtpCapabilities.recv.videoCodecs=a;let u=this.localCapabilities.send,p=this.rtpCapabilities.recv,m=yc(me.VIDEO,p,u,r);return d.forEach(f=>{let E=m.map(I=>I.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(f.attributes.mid,", from ").concat(f.attributes.payloads," to ").concat(m)),f.attributes.payloads=m,f.media.fmts=E}),!0}createOrRecycleSendMedia(t,i,r,n,o){let a=this.rtpCapabilities.send,l=t===me.VIDEO?a.videoCodecs:a.audioCodecs,d=t===me.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;let u="".concat(this.currentMidIndex),p={media:{mediaType:t,port:T_,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(f=>f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};p=this.mungSendMediaDesc(p,o);let m=this.findFirstClosedMedia(t);if(m){let f=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[f]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,i,r){let n=vt(t);return d_(n),la(n,i),u_(n,i),Rv(n),rd(n,r,this.localCapabilities.send),n}mungSendMediaDesc(t,i){let r=vt(t);return rd(r,i,this.localCapabilities.recv),So(r),r}updateRecvMedia(t,i){let r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===t);if(r!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],i);this.sessionDesc.mediaDescriptions[r]=n}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(i=>mt()?i.media.port==="0"&&i.media.mediaType===t:i.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(i=>{var r;return((r=i.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===t[0].ssrcId})}getSSRC(t){var i;return(i=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs}}var Ze;function u1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function v_(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?u1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Y9=(Ze=class df extends wm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let t;return this.localCapabilities&&(t=nd(this.localCapabilities)),[...new Set(t&&t.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var r;return se(r=Object.keys(Al)).call(r,i)}))]}constructor(t,i,r){super(t,i),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"transportEventReceiver",void 0),y(this,"statsFilter",void 0),y(this,"useXR",N("USE_XR")),y(this,"localCapabilities",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"remoteCodecs",void 0),y(this,"dataStreamChannelMap",new Map),y(this,"establishPromise",void 0),y(this,"mutex",new vi("NVExtentionsConnection-mutex")),y(this,"rtcMedia",void 0),this.store=i,this.peerConnection=r,this.statsFilter=l_(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,mt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=go(i.sdp),n=await yv({filterRTX:!N("USE_PUB_RTX")&&!N("USE_SUB_RTX"),filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterVideoCodec:N("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=n,this.initialOffer=i,v_(v_({},r),{},{rtpCapabilities:n,offerSDP:i.sdp})}catch(i){throw new U(A.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t,i,r,n,o,a){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new z9({remoteIceParameters:t,remoteDtlsParameters:i,candidates:r,remoteRTPCapabilities:n,remoteSetup:o,localCapabilities:nd(this.localCapabilities),cname:a});let l=this.remoteSDP.toString(),d=Nt.parse(this.initialOffer.sdp),u=d.mediaDescriptions.find(f=>f.media.mediaType==="audio");u&&So(u),this.useXR&&h_(d);let p=Nt.print(d),m=this.logSDPExchange(p||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new U(A.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var i,r,n,o;(i=this.remoteSDP)===null||i===void 0||i.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((o=this.remoteSDP)===null||o===void 0||o.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(r=this.remoteSDP)===null||r===void 0||r.preloadRemoteMedia(2);let a=(n=this.remoteSDP)===null||n===void 0?void 0:n.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),S.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,i,r){var n=this;return Vr(function*(){let o=yield xe(n.mutex.lock("From NVExtentionsConnection.send"));try{if(!n.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");let a=[];t.forEach(T=>{let R=n.peerConnection.addTransceiver(T._mediaStreamTrack,{direction:"sendonly"});a.push(R)}),mt()&&N("SIMULCAST")===!0&&(yield xe(n.applySimulcastForFirefox(a,t)));let l=yield xe(n.peerConnection.createOffer()),d=n.remoteSDP.predictReceivingMids(t.length),u=n.mungSendOfferSDP(l.sdp,t,d),p=Nt.parse(u),m=d.map(T=>{let R=p.mediaDescriptions.find(w=>w.attributes.mid===T);if(!R)throw new Error("Cannot extract ssrc from mediaDescription.");return vv(R,N("USE_PUB_RTX"))}),f;try{f=yield m}catch(T){f=[],n.remoteSDP.receive(t,i,r,f);let R=n.remoteSDP.toString();throw yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:R})),yield xe(n.stopSending(d,!0)),T}n.remoteSDP.receive(t,i,r,f);let E=n.remoteSDP.toString(),I=n.logSDPExchange(u,"offer","local","send");return yield xe(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield xe(n.applySimulcastEncodings(a,t)),yield xe(n.applySendEncodings(a,t)),I==null||I(E),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:E})),a.map((T,R)=>{let w=d[R];return{localSSRC:m[R],id:w,transceiver:T}})}catch(a){throw a instanceof U?a:new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t,i){let r=i?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");let n=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");n.map(d=>{var u;d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(n.toString()))}finally{r&&r()}}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);return r&&r.readyState==="open"?S.debug("[P2PConnection] Channels are already available and can be reused directly."):(r=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)),void i.forEach(n=>{n._updateOriginDataChannel(r)})}catch(r){throw r instanceof U?r:new U(A.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i==null||i.close(),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof U?i:new U(A.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(i.toString()))}}async receive(t,i,r,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:a}=this.remoteSDP.send(t,i,r,n);if(a){let d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,o,t);u==null||u(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),S.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else S.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o}}catch(o){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){let n=this.remoteSDP.toString(),o=this.logSDPExchange(n,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a),S.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else S.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return i.map(n=>{let o=this.peerConnection.getTransceivers().find(a=>a.mid===n);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:n}})}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),r=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let n=await this.peerConnection.createAnswer();r==null||r(n.sdp||""),await this.peerConnection.setLocalDescription(n)}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(a=>{a.direction="inactive"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(a,l)=>{a.direction="sendonly"});let r=await this.peerConnection.createOffer(),n=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();n==null||n(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new U(A.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Vr(function*(){let r=yield xe(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ye().supportPCSetConfiguration){let u=i.peerConnection.getConfiguration(),p=t===Ji.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(S.debug("restartICE change iceTransportPolicy from [".concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,i.peerConnection.setConfiguration(u))}else if(t===Ji.RELAY)return;t!==Ji.RELAY&&i.remoteSDP.updateCandidates(t);let n=yield xe(i.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=go(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;i.remoteSDP.restartICE(a);let l=i.remoteSDP.toString(),d=i.logSDPExchange(n.sdp||"","offer","local","restartICE");yield xe(i.peerConnection.setLocalDescription(n)),d==null||d(l),yield xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(n){S.warning("restart ICE failed, abort operation",n)}finally{r()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(r.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let o=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),a==null||a(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new U(A.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,i){let r=this.peerConnection.getTransceivers().filter(n=>n.mid===t);r.length===1&&(this.isVP8Simulcast(i)?mt()||await this.applySimulcastEncodings(r,[i]):await this.applySendEncodings(r,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let r=this.peerConnection.getTransceivers().find(n=>n.mid===i);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return v_(v_({},go(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yl(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...df.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...df.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!N("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}async applySendEncodings(t,i){try{if(!Ye().supportSetRtpSenderParameters||t.length!==i.length)return;for(let m=0;m<t.length;m++){let f=t[m],E=i[m];if(E&&E instanceof Et){var r,n,o;if(this.isVP8Simulcast(E))continue;let I={},T={};switch(E._optimizationMode){case"motion":I.degradationPreference="maintain-framerate";break;case"detail":I.degradationPreference="maintain-resolution";break;default:I.degradationPreference="balanced"}var a,l,d,u;if((r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(T.maxBitrate=1e3*((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),se(n=E._hints).call(n,Rt.LOW_STREAM)&&((l=E._encoderConfig)!==null&&l!==void 0&&l.frameRate&&(T.maxFramerate=Cr(E._encoderConfig.frameRate)),(d=E._encoderConfig)!==null&&d!==void 0&&d.scaleResolutionDownBy&&((u=E._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(T.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),N("DSCP_TYPE")&&qs()){var p;let O=N("DSCP_TYPE");se(p=["very-low","low","medium","high"]).call(p,O)&&(T.networkPriority=O)}let R=f.sender.getParameters(),w=(o=R.encodings)===null||o===void 0?void 0:o[0];mt()&&!w&&(I.encodings=[T]),w&&Object.assign(w,T),Object.assign(R,I),await f.sender.setParameters(R)}}}catch{S.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,i,r){let n=Nt.parse(t);return i.forEach((o,a)=>{let l=r[a],d=n.mediaDescriptions.find(u=>u.attributes.mid===l);d&&(la(d,o),Cv(d,o,this.store.codec))}),Nt.print(n)}mungReceiveAnswerSDP(t,i,r){let n=Nt.parse(t),o=n.mediaDescriptions.find(a=>a.attributes.mid===i);return o&&r===me.AUDIO&&o.media.mediaType==="audio"&&So(o),this.useXR&&h_(n),Nt.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,r)=>{var n;(n=this.onFirstVideoDecoded)===null||n===void 0||n.call(this,t,i,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let d=0;d<t.length;d++){var r,n,o,a,l;let u=t[d],p=i[d];if(p instanceof Et&&!se(r=p._hints).call(r,Rt.LOW_STREAM)&&(n=p._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((o=p._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let m={},f={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:f.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:f.high}];let E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,m))}}}async applySimulcastEncodings(t,i){if(!mt()&&t.length===i.length)for(let r=0;r<t.length;r++){let n=i[r];if(n instanceof Et&&this.isVP8Simulcast(n)){let o=t[r],a={},l={high:1e3*(n._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let d=o.sender.getParameters();await o.sender.setParameters(Object.assign(d,a))}}}isVP8Simulcast(t){var i,r,n,o,a;return!!(t instanceof Et&&N("SIMULCAST")&&this.store.codec==="vp8"&&!se(i=t._hints).call(i,Rt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,i,r,n){if(N("SDP_LOGGING"))return S.upload("exchanging ".concat(r," ").concat(i," SDP during NVExtentionsConnection.").concat(n,`
`),t),i==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",n)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(Ye().supportPCSetConfiguration){let i=df.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},ie(Ze.prototype,"connect",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"connect"),Ze.prototype),ie(Ze.prototype,"updateRemoteRTPCapabilities",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"updateRemoteRTPCapabilities"),Ze.prototype),ie(Ze.prototype,"updateRemoteConnect",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"updateRemoteConnect"),Ze.prototype),ie(Ze.prototype,"createDataChannels",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"createDataChannels"),Ze.prototype),ie(Ze.prototype,"receive",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"receive"),Ze.prototype),ie(Ze.prototype,"batchReceive",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"batchReceive"),Ze.prototype),ie(Ze.prototype,"stopReceiving",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"stopReceiving"),Ze.prototype),ie(Ze.prototype,"muteRemote",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"muteRemote"),Ze.prototype),ie(Ze.prototype,"unmuteRemote",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteRemote"),Ze.prototype),ie(Ze.prototype,"muteLocal",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"muteLocal"),Ze.prototype),ie(Ze.prototype,"unmuteLocal",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteLocal"),Ze.prototype),ie(Ze.prototype,"close",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"close"),Ze.prototype),ie(Ze.prototype,"updateEncoderConfig",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"updateEncoderConfig"),Ze.prototype),ie(Ze.prototype,"updateSendParameters",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"updateSendParameters"),Ze.prototype),ie(Ze.prototype,"replaceTrack",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"replaceTrack"),Ze.prototype),ie(Ze.prototype,"getRemoteSSRC",[Ir],Object.getOwnPropertyDescriptor(Ze.prototype,"getRemoteSSRC"),Ze.prototype),Ze);function Ir(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("From NVExtentionsConnection.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}var ct;function h1(e){var t,i,r,n=2;for(typeof Symbol<"u"&&(i=JL,r=Symbol.iterator);n--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new R_(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function R_(e){function t(i){if(Object(i)!==i)return ne.reject(new TypeError(i+" is not an object."));var r=i.done;return ne.resolve(i.value).then(function(n){return{value:n,done:r}})}return R_=function(i){this.s=i,this.n=i.next},R_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?ne.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?ne.reject(i):t(r.apply(this.s,arguments))}},new R_(e)}let _a=(ct=class uf extends wm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,i){super(t,i),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"cname",void 0),y(this,"mutex",new vi("DataChannelConnection-mutex")),y(this,"dataChannel",void 0),y(this,"_p2pConnection",void 0),y(this,"establishPromise",void 0),y(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(uf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Y9(t,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;let i=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(i)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,i,r,n,o,a){return this.cname=a,await this._p2pConnection.connect(t,i,r,n,o,a),await new ne((l,d)=>{let u=setTimeout(()=>{this.closeSignal(),d(new U(A.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(u),void l()},this.dataChannel.onerror=p=>{this.closeSignal(),d(p)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,i){return this._p2pConnection.updateRemoteRTPCapabilities(t,i)}send(t,i,r){var n=this;return Vr(function*(){let o=yield xe(n.mutex.lock("From DataChannelConnection.send"));try{return yield*__(h1(n._p2pConnection.send(t,i,r)))}finally{o()}})()}async stopSending(t,i){return this._p2pConnection.stopSending(t,i)}async createDataChannels(t,i){return this._p2pConnection.createDataChannels(t,i)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,i,r,n){return this._nvMedia?(S.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,i,this.cname)):(S.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,i,r,n))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var i=this;return Vr(function*(){return yield*__(h1(i._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var i;(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,i){return await this._p2pConnection.updateEncoderConfig(t,i)}async updateSendParameters(t,i){return await this._p2pConnection.updateSendParameters(t,i)}setStatsRemoteVideoIsReady(t,i){this._p2pConnection.setStatsRemoteVideoIsReady(t,i)}async replaceTrack(t,i){return await this._p2pConnection.replaceTrack(t,i)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,i,r,n){if(N("SDP_LOGGING"))return S.upload("exchanging ".concat(r," ").concat(i," SDP during DataChannelConnection.").concat(n,`
`),t),i==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",n)}:void 0}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(yl(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...uf.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...uf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(r=>{r.security?r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(ta(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!N("FORCE_TURN_TCP")&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&i.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,i,r)=>{var n;return(n=this.onFirstVideoDecoded)===null||n===void 0?void 0:n.call(this,t,i,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,i)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,i)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},ie(ct.prototype,"connect",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"connect"),ct.prototype),ie(ct.prototype,"updateRemoteRTPCapabilities",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"updateRemoteRTPCapabilities"),ct.prototype),ie(ct.prototype,"createDataChannels",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"createDataChannels"),ct.prototype),ie(ct.prototype,"receive",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"receive"),ct.prototype),ie(ct.prototype,"stopReceiving",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"stopReceiving"),ct.prototype),ie(ct.prototype,"muteRemote",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"muteRemote"),ct.prototype),ie(ct.prototype,"unmuteRemote",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteRemote"),ct.prototype),ie(ct.prototype,"muteLocal",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"muteLocal"),ct.prototype),ie(ct.prototype,"unmuteLocal",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteLocal"),ct.prototype),ie(ct.prototype,"close",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"close"),ct.prototype),ie(ct.prototype,"updateEncoderConfig",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"updateEncoderConfig"),ct.prototype),ie(ct.prototype,"updateSendParameters",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"updateSendParameters"),ct.prototype),ie(ct.prototype,"replaceTrack",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"replaceTrack"),ct.prototype),ie(ct.prototype,"getRemoteSSRC",[sn],Object.getOwnPropertyDescriptor(ct.prototype,"getRemoteSSRC"),ct.prototype),ct);function sn(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("From DataChannelConnection.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}var Fe;function p1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function $o(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?p1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function m1(e){var t,i,r,n=2;for(typeof Symbol<"u"&&(i=JL,r=Symbol.iterator);n--;){if(i&&(t=e[i])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new C_(t.call(e));i="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function C_(e){function t(i){if(Object(i)!==i)return ne.reject(new TypeError(i+" is not an object."));var r=i.done;return ne.resolve(i.value).then(function(n){return{value:n,done:r}})}return C_=function(i){this.s=i,this.n=i.next},C_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return r===void 0?ne.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return r===void 0?ne.reject(i):t(r.apply(this.s,arguments))}},new C_(e)}let y_=(Fe=class extends Ot{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Ie.StateChange,t,this._state)}constructor(e,t){super(),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"connection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"remoteDataChannelMap",new Map),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"pendingLocalDataChannels",[]),y(this,"pendingRemoteDataChannels",[]),y(this,"statsCollector",void 0),y(this,"isPlanB",!1),y(this,"shouldForwardP2PCreation",void 0),y(this,"iceFailedCount",0),y(this,"dtlsFailedCount",0),y(this,"mutex",new vi("P2PChannel-mutex")),y(this,"_state",at.Disconnected),y(this,"_pcStatsUploadType",N("NEW_ICE_RESTART")?_s.FIRST_CONNECTION:_s.OLD_FIRST_CONNECTION),y(this,"_isInRestartIce",!1),y(this,"_isStartRestartIce",!1),y(this,"_restartStates",["disconnected","failed"]),y(this,"_restartTimer",void 0),y(this,"_isFirstConnected",!0),y(this,"handleMuteLocalTrack",async(i,r,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==at.Connected)return void n(new B(A.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let a=this.filterTobeMutedTracks(i);if(a.length===0)return void r();let l=a.find(u=>u[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(a.map(u=>{let[,{id:p}]=u;return p}));let d=this.createMuteMessage(a);await _t(this,Ie.RequestMuteLocal,d),r()}catch(a){n(a)}finally{o()}}),y(this,"handleUnmuteLocalTrack",async(i,r,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==at.Connected)return void n(new B(A.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let a=this.filterTobeUnmutedTracks(i);if(a.length===0)return void r();let l=a.find(u=>u[0]==="videoLowTrack");if(l){let u=l[1];if(u.track._originMediaStreamTrack.stop(),!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding){let p=i._mediaStreamTrack.clone();u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}else{let p=wv(i,nc(this,Ie.RequestLowStreamParameter));u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}await new ne((p,m)=>{this.handleReplaceTrack(u.track,p,m,!0)})}await this.connection.unmuteLocal(a.map(u=>{let[,{id:p}]=u;return p}));let d=this.createUnmuteMessage(a);await _t(this,Ie.RequestUnmuteLocal,d),r()}catch(a){n(a)}finally{o()}}),y(this,"handleUpdateVideoEncoder",async(i,r,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let a=this.localTrackMap.get(X.LocalVideoTrack);if(!this.connection||!a||a.track!==i||this.state!==at.Connected)return void r();let{id:l,track:d}=a;await this.connection.updateSendParameters(l,d),await this.connection.updateEncoderConfig(l,d),this.emit(Ie.UpdateVideoEncoder,d),r()}catch(a){n(a)}finally{o()}}),y(this,"handleUpdateVideoSendParameters",async(i,r,n)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let a=this.localTrackMap.get(X.LocalVideoTrack);if(!this.connection||!a||a.track!==i||this.state!==at.Connected)return void r();let{id:l,track:d}=a;await this.connection.updateSendParameters(l,d),r()}catch(a){n(a)}finally{o()}}),y(this,"handleReplaceMixingTrack",async(i,r,n,o)=>{if(!this.connection||this.state!==at.Connected)return void r();let a=Ov([i]),l;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),typeof o=="boolean"&&o||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,a),r()}catch(u){n(u)}finally{var d;(d=l)===null||d===void 0||d()}}),y(this,"handleReplaceTrack",async(i,r,n,o)=>{let a;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;let u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return i===m});if(!this.connection||!u||this.state!==at.Connected)return void r();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(i,u[1].id)),this.isPlanB){let p=u[1];p.id=i._mediaStreamTrack.id,this.localTrackMap.set(u[0],p)}if(u[0]===X.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding){let p=this.localTrackMap.get(X.LocalVideoLowTrack);if(p){let m=i._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new ne((f,E)=>{this.handleReplaceTrack(p.track,f,E,!0)})}}r()}catch(u){n(u)}finally{var d;(d=a)===null||d===void 0||d()}}),y(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),y(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),y(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new DL(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ye().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&qs(),this.shouldForwardP2PCreation=N("FORWARD_P2P_CREATION")&&Ye().supportPCSetConfiguration&&DS(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new _a({},this.store):this.isPlanB?new od({},this.store):new Ro({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=at.New;let r=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new _a(e,this.store):this.isPlanB?new od(e,this.store):new Ro(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=N("NEW_ICE_RESTART")?_s.FIRST_CONNECTION:_s.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,i,r,n,o){if(!this.connection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof _a?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,i,r,n,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=at.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(n=>{var o;let[a]=n;return se(o=[X.LocalVideoLowTrack,X.LocalVideoTrack]).call(o,a)}),i=t.map(n=>{let[,{id:o}]=n;return o}),r=t.map(n=>{let[o]=n;return o});if(this.connection instanceof Ro){if(_e.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!se(e).call(e,this.store.codec)){let n=["vp9","vp8","h264"].find(o=>se(e).call(e,o));n&&(this.store.codec=n,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(n,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async preConnect(e,t,i,r,n,o){if(!this.connection)throw new B(A.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();let a=await this.connection.connect(e,t,i,r,n,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=at.Connected,a}getEstablishParams(){if(this.connection instanceof _a)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==at.Connected){if(this.state===at.Disconnected)throw new B(A.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(i=>{var r;se(r=this.pendingLocalDataChannels).call(r,i)||this.pendingLocalDataChannels.push(i)})}let t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(i=>{let r=Date.now();this.store.publish(i.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);let r=Date.now();this.store.publish(i.id+"","datachannel",void 0,r)}))}publish(e,t,i){var r=this;return Vr(function*(){let n=yield xe(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==at.Connected){if(r.state===at.Disconnected)throw new B(A.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let a=e.filter(l=>r.pendingLocalTracks.indexOf(l)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(a))}r.store.pubId=r.store.pubId+1,Gi.markPublishStart(r.store.clientId,r.store.pubId);let o=r.filterTobePublishedTracks(e,t,i);if(o.length===0)return void(yield xe(r.tryToUnmuteAudio(e)));yield*__(m1(r.doPublish(r.connection,o)))}finally{n()}})()}doPublish(e,t){var i=this;return Vr(function*(){t.forEach(m=>{let{track:f,type:E}=m,I=Date.now();i.store.publish(f.getTrackId(),E===X.LocalAudioTrack?"audio":"video",I)}),i.bindLocalTrackEvents(t);let r=t.map(m=>{let{track:f}=m;return f}),n=yield xe(e.send(t.map(m=>{let{track:f}=m;return f}),i.store.codec,i.store.audioCodec)),o=(yield xe(n.next())).value,a=i.createGatewayPublishMessage(t,o),l;try{l=yield a}catch(m){throw n.throw(m),(m==null?void 0:m.code)===A.WS_ABORT&&t.forEach(f=>{let{track:E}=f;i.pendingLocalTracks.indexOf(E)===-1&&i.pendingLocalTracks.push(E)}),i.unbindLocalTrackEvents(t),m}let d=i.mapPubResToRemoteConfig(a,l),u=(yield xe(n.next(d))).value,p=N("ENABLE_VIDEO_SEI");r.forEach(async m=>{let f=m.getRTCRtpTransceiver();f&&p&&(m.trackMediaType===me.VIDEO?await S9(f.sender,m):m.trackMediaType===me.AUDIO&&await async function(E){if(!Ye().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(s_.has(E)||!E.track)return;let I={track:E.track};if(Ys()){if(!E.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let R=null;try{R=E.createEncodedStreams()}catch(O){return void S.error("create audio-encoded-streams error",O&&O.message)}let w=new TransformStream({transform(O,P){I.controller||(I.controller=P),E.track&&E.track.id!==I.track.id&&(S.debug("audio track changed: ".concat(I.track.id," => ").concat(E.track.id)),I.track.removeEventListener("ended",T),I.track=E.track,I.track.addEventListener("ended",T)),P.enqueue(O)}});R.readable.pipeThrough(w).pipeTo(R.writable)}else if(mi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let R=o_(),w=new MessageChannel;await new ne(P=>R.onmessage=M=>{M.data==="registered"&&P(void 0)});let O=new RTCRtpScriptTransform(R,{name:"tx",port:w.port2},[w.port2]);E.transform=O,await new ne(P=>R.onmessage=M=>{M.data==="started"&&P(void 0)}),w.port1.onmessage=P=>{var M;P.data.transformed&&E.track&&((M=E.track)===null||M===void 0?void 0:M.id)!==I.track.id&&(S.debug("audio track changed: ".concat(I.track.id," => ").concat(E.track.id)),I.track.removeEventListener("ended",T),I.track=E.track,I.track.addEventListener("ended",T))},I.worker=R}function T(){if(E.track){if(this.id!==E.track.id)return;E.track.removeEventListener("ended",T)}let R=s_.get(E);if(R){s_.delete(E);try{var w,O;(w=R.controller)===null||w===void 0||w.terminate(),(O=R.worker)===null||O===void 0||O.terminate()}catch(P){S.warning(P&&P.message)}}}s_.set(E,I),E.track.addEventListener("ended",T)}(f.sender))}),t.forEach(m=>{let{type:f}=m;i.statsCollector.addLocalStats(f)}),i.assignLocalTracks(t,u),i.statsUploader.startUploadOutboundStats(),t.forEach(m=>{let{track:f,type:E}=m,I=Date.now();i.store.publish(f.getTrackId(),E===X.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(e,t){let i=this.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof Et))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Ro||this.connection instanceof od))return S.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:r}=i,n=function(o,a){let l={};return o.height&&o.width&&(l.scaleResolutionDownBy=iT(o,a)),l.maxFramerate=o.framerate?Cr(o.framerate):void 0,l.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,l}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==X.LocalVideoLowTrack||!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding)n.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=n.scaleResolutionDownBy);else{let o=r._originMediaStreamTrack;if(!o.canvas)return S.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(a,l){let d=a.canvas;l.width&&(d.width=Cr(l.width)),l.height&&(d.height=Cr(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=av(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},Cr(l.framerate)))})(o,e)}n.maxBitrate!=null&&(r._encoderConfig.bitrateMax=n.maxBitrate/1e3),n.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=n.maxFramerate:r._encoderConfig.frameRate={max:n.maxFramerate}),S.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Vr(function*(){if(!t.connection||t.state!==at.Connected)return;let i=yield xe(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let n=t.localTrackMap.get(X.LocalVideoTrack);if(!n)throw new B(A.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(X.LocalVideoLowTrack))throw new B(A.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let o=[{track:t.getLowVideoTrack(n.track,e),type:X.LocalVideoLowTrack}];if(yield*__(m1(t.doPublish(t.connection,o))),n.track.muted||!n.track.enabled){var r;let a=(r=t.localTrackMap.get(X.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;a!==void 0&&(yield xe(t.connection.muteLocal([a])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ii(this,Ie.RequestRePublish,this.pendingLocalTracks),this.emit(Ie.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ii(this,Ie.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:i,kind:r}=this.pendingRemoteTracks[t];(r!==me.AUDIO||i._audio_added_&&i._audioSSRC)&&(r!==me.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ii(this,Ie.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===me.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(Ie.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==at.Connected)return void e.forEach(r=>{let n=this.pendingLocalTracks.indexOf(r);n!==-1&&this.pendingLocalTracks.splice(n,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(r=>r[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==at.Connected)return void e.forEach(i=>{let r=this.pendingLocalDataChannels.indexOf(i);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{let r=this.localDataChannels.indexOf(i);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==at.Connected)return;let e=this.localTrackMap.get(X.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[X.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:n}]=r;return n})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[n,{track:o}]=r;return{type:n,track:o}})),t.forEach(r=>{let[n]=r;this.statsCollector.removeLocalStats(n)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==at.Connected)throw new B(A.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=t.filter(r=>{var n;return!((n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.get(r.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(r=>{var n;this.remoteDataChannelMap.has(e)?(n=this.remoteDataChannelMap.get(e))===null||n===void 0||n.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));let o=this.pendingRemoteDataChannels.findIndex(a=>{let{user:l,id:d}=a;return l.uid===e.uid&&d===r.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),i.map(r=>r.id)}async subscribe(e,t,i,r,n){var o;if(!this.connection||this.state!==at.Connected)throw new B(A.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let a,l,d;if(n){let m=n.find(E=>{let{stream_type:I}=E;return I===t});if(!m)throw new B(A.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let f=await this.connection.receive(t,m.ssrcs,String(e._uintid),m.attributes);this.connection instanceof Ro&&(d=f.transceiver),a=f.track,l=f.id}else{let m=await this.connection.receive(t,[{ssrcId:i,rtx:r}],String(e._uintid),void 0);this.connection instanceof Ro&&(d=m.transceiver),a=m.track,l=m.id}t===me.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new id(a,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new td(a,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack)),N("ENABLE_VIDEO_SEI")&&d&&(t==me.VIDEO?await T9(d.receiver,{onSei:m=>{var f;(f=e._videoTrack)===null||f===void 0||f._onSei(m)}}):t==me.AUDIO&&await async function(m){if(!Ye().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(a_.has(m))return;let f={track:m.track};if(Ys()){if(!m.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let I=null;try{I=m.createEncodedStreams()}catch(R){return void S.error("create audio-encoded-streams error",R&&R.message)}let T=new TransformStream({transform(R,w){f.controller||(f.controller=w),m.track&&m.track.id!==f.track.id&&(S.debug("audio track changed: ".concat(f.track.id," => ").concat(m.track.id)),f.track.removeEventListener("ended",E),f.track=m.track,f.track.addEventListener("ended",E)),w.enqueue(R)}});I.readable.pipeThrough(T).pipeTo(I.writable)}else if(mi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let I=o_(),T=new MessageChannel;await new ne(w=>I.onmessage=O=>{O.data==="registered"&&w(void 0)});let R=new RTCRtpScriptTransform(I,{name:"rx",port:T.port2},[T.port2]);m.transform=R,await new ne(w=>I.onmessage=O=>{O.data==="started"&&w(void 0)}),T.port1.onmessage=w=>{var O;w.data.transformed&&m.track&&((O=m.track)===null||O===void 0?void 0:O.id)!==f.track.id&&(S.debug("audio track changed: ".concat(f.track.id," => ").concat(m.track.id)),f.track.removeEventListener("ended",E),f.track=m.track,f.track.addEventListener("ended",E))},f.worker=I}function E(){m.track.removeEventListener("ended",E),function(I){let T=a_.get(I);if(T){a_.delete(I);try{var R,w;(R=T.controller)===null||R===void 0||R.terminate(),(w=T.worker)===null||w===void 0||w.terminate()}catch(O){S.warning(O&&O.message)}}}(m)}a_.set(m,f),m.track.addEventListener("ended",E)}(d.receiver));let u=this.remoteUserMap.get(e);u?u.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let p=this.pendingRemoteTracks.findIndex(m=>{let{user:f,kind:E}=m;return f.uid===e.uid&&t===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Ie.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==at.Connected)throw new B(A.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var r;let{user:n,mediaType:o}=i;return!((r=this.remoteUserMap.get(n))!==null&&r!==void 0&&r.has(o))});let t=await this.connection.batchReceive(e.map(i=>{let{user:r,mediaType:n,ssrcId:o,rtxSsrcId:a}=i;return{kind:n,ssrcMsg:[{ssrcId:o,rtx:a}],mslabel:String(r._uintid)}}));e.forEach((i,r)=>{let{user:n,mediaType:o}=i,{track:a,id:l,transceiver:d}=t[r];o===me.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(a):(n._audioTrack=new id(a,n.uid,n._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),d&&n._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(a):(n._videoTrack=new td(a,n.uid,n._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),d&&n._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(n,n._videoTrack));let u=this.remoteUserMap.get(n);u?u.set(o,l):this.remoteUserMap.set(n,new Map([[o,l]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();let p=this.pendingRemoteTracks.findIndex(m=>{let{user:f,kind:E}=m;return f.uid===n.uid&&o===E});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Ie.MediaReconnectEnd,n.uid))})}async unsubscribe(e,t,i){let r=this.pendingRemoteTracks.filter(a=>{let{user:l,kind:d}=a;return t!==void 0?l.uid===e.uid&&t===d:l.uid===e.uid});if(r.forEach(a=>{let l=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===at.Connected||i||r.forEach(a=>{let{kind:l}=a;var d;if(l===me.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(l===me.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==at.Connected)return;let n=this.filterTobeUnSubscribedTracks(e,t);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:l}]=a;return l}));let o=this.createUnsubscribeMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[l,{kind:d}]=a;var u,p;if(d===me.VIDEO&&l._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===me.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),i||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===me.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!i&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(n=>{let o=this.pendingRemoteDataChannels.findIndex(a=>a.id===n.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(n=>{n._close()});let r=this.remoteDataChannelMap.get(e);return i.forEach(n=>{r&&r.delete(n.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(n=>n.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:n,mediaType:o}of e){let a=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:u}=l;return o!==void 0?d.uid===n.uid&&o===u:d.uid===n.uid});a.forEach(l=>{let d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),t=t.concat(a)}if(!this.connection||this.state!==at.Connected)return void t.forEach(n=>{let{user:o,kind:a}=n;var l;if(a===me.AUDIO)(l=o._audioTrack)===null||l===void 0||l._destroy(),o._audioTrack=void 0;else if(a===me.VIDEO){var d;(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0}});let i=ao(e).call(e,(n,o)=>{let{user:a,mediaType:l}=o,d=this.filterTobeUnSubscribedTracks(a,l);return n.concat(d)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(n=>{let[,{id:o}]=n;return o}));let r=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(n=>{let[o,{kind:a}]=n;var l,d;if(a===me.VIDEO&&o._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===me.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(d=o._videoTrack)===null||d===void 0||d._destroy(),o._videoTrack=void 0;else if(a===me.AUDIO){var u;this.unbindRemoteTrackEvents(o._audioTrack),(u=o._audioTrack)===null||u===void 0||u._destroy(),o._audioTrack=void 0}}),r}async muteRemote(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===me.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(X.LocalAudioTrack);if((t==null?void 0:t.track)instanceof ci){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return n!==X.LocalAudioTrack}).filter(r=>{let[n]=r;return!(e&&n===X.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return!(e&&r===X.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,r,n){if(e){let a=this.localTrackMap.get(X.LocalAudioTrack),l=r?this.localTrackMap.get(X.LocalVideoLowTrack):this.localTrackMap.get(X.LocalVideoTrack);_e.publish(this.store.sessionId,{eventElapse:Gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!a,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;i||(i=[]);let a=i.find(d=>d instanceof jt),l=r?(o=this.localTrackMap.get(X.LocalVideoTrack))===null||o===void 0?void 0:o.track:i.find(d=>d instanceof Et);_e.publish(this.store.sessionId,{eventElapse:Gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Rt.SCREEN_TRACK))!==-1,audio:!!a,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,i,r){let n=r===me.VIDEO?i._videoSSRC:i._audioSSRC;n&&_e.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===me.VIDEO,audio:r===me.AUDIO,peerid:i.uid,subscribeRequestid:r===me.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Gi.measureFromSubscribeStart(this.store.clientId,n)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new vi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new _a({},this.store):this.isPlanB?new od({},this.store):new Ro({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(X.LocalAudioTrack);if((e==null?void 0:e.track)instanceof ci){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=at.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(X.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(X.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Et||t&&t.track instanceof jt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(Yr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[r]=i;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(X.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=ru(e).call(e,(i,r)=>i.level-r.level),e}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=at.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new _a({},this.store):this.isPlanB?new od({},this.store):new Ro({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:r}]=e;switch(i){case X.LocalVideoTrack:se(t=r._hints).call(t,Rt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case X.LocalAudioTrack:r instanceof ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case X.LocalVideoLowTrack:}}),this.emit(Ie.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Yr(i).call(i)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ie.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(Yr(i).call(i)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let i of this.pendingRemoteDataChannels){let{user:r,id:n}=i;if((e instanceof ha?e.uid:e)===r.uid&&n===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:r,kind:n}=i;if((e instanceof ha?e.uid:e)===r.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Vr(function*(){if(!t.connection||t.state!==at.Connected||t.connection instanceof _a)return;let i=yield xe(t.mutex.lock("From P2PChannel.restartICE")),r;try{r=yield xe(t.connection.restartICE(e));let o=yield xe(r.next());if(o.done)return;let a=o.value,l=yield a;switch(t.reportPCDisconnectedOrFailed(e),e){case Ji.TCP:t._pcStatsUploadType=_s.TCP_RESTART;break;case Ji.RELAY:t._pcStatsUploadType=_s.RELAY_RESTART;break;default:t._pcStatsUploadType=_s.OLD_RESTART}t._isInRestartIce=!0,r.next(l)}catch(o){var n;(n=r)===null||n===void 0||n.throw(o)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(X.LocalVideoTrack),i=this.localTrackMap.get(X.LocalAudioTrack),r=e.videoSend.find(E=>E.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),n=e.audioSend.find(E=>E.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!r||!n)return 1;let o=Ur(this,Ie.NeedSignalRTT),a=r?r.rttMs:void 0,l=n?n.rttMs:void 0,d=a&&l?(a+l)/2:a||l,u=(d&&o?(d+o)/2:d||o)||0,p=100*e.sendPacketLossRate*.7/50+.3*u/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,f=t==null?void 0:t.track;if(f&&f._encoderConfig&&f._hints.indexOf(Rt.SCREEN_TRACK)===-1){let E=f._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(E&&I){let T=(1e3*E-I)/(1e3*E);return Xb[T<.15?0:T<.3?1:T<.45?2:T<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r]=i,n=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find(I=>I.ssrc===n),l=e.videoRecv.find(I=>I.ssrc===o);if(!a&&!l)return void(t+=1);let d=Ur(this,Ie.NeedSignalRTT),u=e.rtt,p=(u&&d?(u+d)/2:u||d)||0,m=a?a.jitterMs:void 0,f=e.recvPacketLossRate,E=.7*f*100/50+.3*p/1500;m&&(E=.6*f*100/50+.2*p/1500+.2*m/400),t+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ne((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==at.Connected)return;let r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(!r)return;let n=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:n}]),this.bindLocalTrackEvents([{track:t,type:n}]),r[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,r[1].id)),this.isPlanB){let o=r[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(n,o)}if(n===X.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding){let o=this.localTrackMap.get(X.LocalVideoLowTrack);if(o){let a=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=a,o.track._originMediaStreamTrack=a,await new ne((l,d)=>{this.handleReplaceTrack(o.track,l,d,!0)})}}}filterTobePublishedTracks(e,t,i){let r=[],n=this.getAllTracks();e=Il(e=e.filter(d=>n.indexOf(d)===-1));let o,a=!1,l=this.localTrackMap.get(X.LocalAudioTrack);for(let d of e){if(d instanceof Et&&(this.localTrackMap.has(X.LocalVideoTrack)||a?new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:d,type:X.LocalVideoTrack}),a=!0),t)){let u=this.getLowVideoTrack(d,i);r.push({track:u,type:X.LocalVideoLowTrack})}if(d instanceof jt)if(l){let u=l.track;if(u instanceof ci)Av([d]),u.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{let p=Ov([u,d]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(u,p)}}else o instanceof ci?(Av([d]),o.addAudioTrack(d)):o||!d._useAudioElement&&Ye().webAudioMediaStreamDest&&!d._bypassWebAudio?o=Ov(o?[d,o]:[d]):o=d}return o&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:X.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=Il(e=e.filter(r=>i.indexOf(r)!==-1));for(let r of e){if(r instanceof jt){let n=this.localTrackMap.get(X.LocalAudioTrack);if(!n)continue;n.track instanceof ci?(n.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),n.track.trackList.length===0&&(t.push([X.LocalAudioTrack,n]),n.track.close())):t.push([X.LocalAudioTrack,n])}if(r instanceof Et){let n=this.localTrackMap.get(X.LocalVideoTrack);if(!n)continue;t.push([X.LocalVideoTrack,n]);let o=this.localTrackMap.get(X.LocalVideoLowTrack);o&&t.push([X.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=Il(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Il(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:r}=t;switch(r){case X.LocalVideoTrack:i.addListener(le.GET_STATS,this.handleGetLocalVideoStats),i.addListener(le.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case X.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ci?e.trackList.forEach(i=>{i.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(le.GET_STATS,this.handleGetLocalAudioStats),i.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(le.GET_STATS,this.handleGetLocalAudioStats),e.addListener(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(le.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:r}]=t;return{track:r,type:i}})),e.forEach(t=>{let{track:i,type:r}=t;switch(r){case X.LocalVideoTrack:i.off(le.GET_STATS,this.handleGetLocalVideoStats),i.off(le.GET_RTC_STATS,this.handleGetRTCStats),i.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(le.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case X.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ci?e.trackList.forEach(t=>{t.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(le.GET_STATS,this.handleGetLocalAudioStats),t.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(le.GET_STATS,this.handleGetLocalAudioStats),e.off(le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(le.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof td&&t.addListener(le.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof id&&t.addListener(le.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(le.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(me.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(me.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,r)=>{var n;let o,a,{track:l,type:d}=i;switch(d){case X.LocalAudioTrack:o=st.Audio,a={dtx:l instanceof n_&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case X.LocalVideoTrack:o=se(n=l._hints).call(n,Rt.SCREEN_TRACK)?st.Screen:st.High,a=$o($o({},_N(l)),{},{codec:this.store.codec});break;case X.LocalVideoLowTrack:o=st.Low,a=$o($o({},_N(l)),{},{codec:this.store.codec})}return{stream_type:o,attributes:a,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}assignLocalTracks(e,t){e.forEach((i,r)=>{let{track:n,type:o}=i;this.localTrackMap.set(o,{track:n,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ie.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),N("NEW_ICE_RESTART")){var i;if(se(i=this._restartStates).call(i,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let r=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),Ur(this,Ie.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ie.RequestRestartICE,a))},n=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ie.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=N("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ye().supportPCSetConfiguration)r(Ji.RELAY),this._restartTimer=window.setTimeout(n,o);else if(mt())r(Ji.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(r(Ji.TCP),Ye().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(Ji.RELAY),this._restartTimer=window.setTimeout(n,o)},o));this._restartTimer=window.setTimeout(n,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&N("ICE_RESTART")&&Ur(this,Ie.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ie.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Ie.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Ie.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),_e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:xt.TRACER}).onSuccess(),this.emit(Ie.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(o=>o._audioSSRC===t);var n;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(n=r.audioTrack)===null||n===void 0||n.emit(Ql.FIRST_FRAME_DECODED),_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_AUDIO_DECODE,kt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(n=>n._audioSSRC===t);r&&_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_AUDIO_RECEIVED,kt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,r)=>{this.reportVideoFirstFrameDecoded(t,i,r)},e.onFirstVideoReceived=t=>{var i;let r=Array.from(Yr(i=this.remoteUserMap).call(i)).find(n=>n._videoSSRC===t);r&&_e.firstRemoteFrame(this.store.sessionId,Ri.FIRST_VIDEO_RECEIVED,kt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let r=t.candidateType==="relay",n=i.candidateType==="relay";i.candidateType!=="unknown"&&r===n||this.emit(Ie.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ia(i))," -> ").concat(JSON.stringify(ia(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ia(i))," -> ").concat(JSON.stringify(ia(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return $o($o({},t),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(X.LocalAudioTrack);if(e instanceof jt&&(i==null?void 0:i.track)instanceof ci)return i.track.isActive||t.push([X.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(r&&(t.push(r),r[0]===X.LocalVideoTrack)){let n=this.localTrackMap.get(X.LocalVideoLowTrack);n&&t.push([X.LocalVideoLowTrack,n])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(X.LocalAudioTrack);if(e instanceof jt&&(i==null?void 0:i.track)instanceof ci)return i.track.isActive&&t.push([X.LocalAudioTrack,i]),t;let r=Array.from(this.localTrackMap.entries()).find(n=>{let[,{track:o}]=n;return e===o});if(r)if(r[0]===X.LocalVideoTrack){t.push(r);let n=this.localTrackMap.get(X.LocalVideoLowTrack);n&&t.push([X.LocalVideoLowTrack,n])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var i;let r,[n,{track:o,ssrcs:a,id:l}]=t;switch(n){case X.LocalAudioTrack:r=st.Audio;break;case X.LocalVideoTrack:r=se(i=o._hints).call(i,Rt.SCREEN_TRACK)?st.Screen:st.High;break;case X.LocalVideoLowTrack:r=st.Low}return{stream_type:r,ssrcs:a,mid:l}})}filterTobeUnSubscribedTracks(e,t){let i=[],r=this.remoteUserMap.get(e);if(!r)return i;if(t){let n=r.get(t);if(!n)return i;i.push([e,{kind:t,id:n}])}else Array.from(r.entries()).forEach(n=>{let[o,a]=n;i.push([e,{kind:o,id:a}])});return i}filterTobeUnSubscribedDataChannels(e,t){let i=[];return t.forEach(r=>{var n;(n=this.remoteDataChannelMap.get(e))!==null&&n!==void 0&&n.has(r.id)&&i.push(r)}),i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[r,{kind:n,id:o}]=i;switch(n){case me.VIDEO:return void(r._videoSSRC&&t.push({stream_type:me.VIDEO,ssrcId:r._videoSSRC}));case me.AUDIO:return void(r._audioSSRC&&t.push({stream_type:me.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(i=>{let[r,{kind:n}]=i;if(t.has(r)){let o=t.get(r);n===me.VIDEO?o|=fi.Video:o|=fi.Audio,t.set(r,o)}else n===me.VIDEO?t.set(r,fi.Video):t.set(r,fi.Audio)}),{users:Array.from(t.entries()).map(i=>{let[r,n]=i;return{stream_id:r.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:r}]=t,n=this.remoteUserMap.get(i);n&&(n.delete(r),Array.from(n.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(X.LocalVideoTrack),i=this.localTrackMap.get(X.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((i,r)=>{var n;let{stream_type:o}=i;return(n=t.find(a=>{let{stream_type:l}=a;return o===l}))===null||n===void 0?void 0:n.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof jt){var t;let r=this.filterTobeUnmutedTracks(e[i]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(o=>{let[,{id:a}]=o;return a})));let n=this.createUnmuteMessage(r);return void await _t(this,Ie.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ie.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ie.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _i(Em(this.dtlsFailedCount,Xt)),this.emit(Ie.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ii(this,Ie.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ie.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(X.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Et)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Et).length>1)throw new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof jt).length>1&&(e.some(t=>t instanceof jt&&t._bypassWebAudio)||!Ye().webAudioMediaStreamDest))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Et&&this.pendingLocalTracks.some(i=>i instanceof Et))throw new B(A.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof jt&&this.pendingLocalTracks.some(i=>i instanceof jt)&&(!Ye().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jt&&i._bypassWebAudio)))throw new B(A.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ye().supportDualStreamEncoding,r=$o($o({},{width:160,height:120,framerate:15,bitrate:50}),t),n;n=i?e._mediaStreamTrack.clone():wv(e,r);let o=ft(8,"track-low-"),a=new Et(n,$o($o({},i&&{scaleResolutionDownBy:iT(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return a.on(Tc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Jl.LOW_STREAM)}),a._hints.push(Rt.LOW_STREAM),e.on("sei-to-send",l=>{a.emit("sei-to-send",l)}),e.addListener(le.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ro){var n,o,a,l;let d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:f,remote:E}=await this.connection.getSelectedCandidatePair();_e.pcStats(this.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:u,dtlsstate:p,connectionstate:m,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(n=f==null?void 0:f.protocol)!==null&&n!==void 0?n:"",selectedLocalCandidateType:(o=f.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(f.address,":").concat(f.port),selectedRemoteCandidateProtocol:(a=E.protocol)!==null&&a!==void 0?a:"",selectedRemoteCandidateType:(l=E.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(E.address,":").concat(E.port),restartCnt:i})}}reportVideoFirstFrameDecoded(e,t,i,r){var n;let o=Array.from(Yr(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===e);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let a=this.store.keyMetrics,l=a.subscribe.find(d=>d.userId===o.uid&&d.type==="video");_e.firstRemoteVideoDecode(this.store.sessionId,Ri.FIRST_VIDEO_DECODE,kt.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:i,subscribeElapse:Gi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let n=r.get(t);if(!n)return!1;let o=await this.connection.getRemoteSSRC(n);return o!==void 0&&o!==i}resetConnection(e){S.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===at.Connected?(S.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===oN.datachannel?new _a({},this.store):this.isPlanB?new od({},this.store):new Ro({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===X.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Jl.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Ro&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===_s.TCP_RESTART&&e===Ji.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,_s.DISCONNECTED_OR_FAILED)))}},ie(Fe.prototype,"startP2PConnection",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"startP2PConnection"),Fe.prototype),ie(Fe.prototype,"connect",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"connect"),Fe.prototype),ie(Fe.prototype,"updateRemoteRTPCapabilities",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"updateRemoteRTPCapabilities"),Fe.prototype),ie(Fe.prototype,"preConnect",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"preConnect"),Fe.prototype),ie(Fe.prototype,"publishDataChannel",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"publishDataChannel"),Fe.prototype),ie(Fe.prototype,"unpublish",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unpublish"),Fe.prototype),ie(Fe.prototype,"unpublishDataChannel",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unpublishDataChannel"),Fe.prototype),ie(Fe.prototype,"unpublishLowStream",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unpublishLowStream"),Fe.prototype),ie(Fe.prototype,"subscribeDataChannel",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"subscribeDataChannel"),Fe.prototype),ie(Fe.prototype,"subscribe",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"subscribe"),Fe.prototype),ie(Fe.prototype,"massSubscribe",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"massSubscribe"),Fe.prototype),ie(Fe.prototype,"unsubscribe",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unsubscribe"),Fe.prototype),ie(Fe.prototype,"unsubscribeDataChannel",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unsubscribeDataChannel"),Fe.prototype),ie(Fe.prototype,"massUnsubscribe",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"massUnsubscribe"),Fe.prototype),ie(Fe.prototype,"muteRemote",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"muteRemote"),Fe.prototype),ie(Fe.prototype,"unmuteRemote",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"unmuteRemote"),Fe.prototype),ie(Fe.prototype,"hasRemoteMediaWithLock",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"hasRemoteMediaWithLock"),Fe.prototype),ie(Fe.prototype,"disconnectForReconnect",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"disconnectForReconnect"),Fe.prototype),ie(Fe.prototype,"updateBitrateLimit",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"updateBitrateLimit"),Fe.prototype),ie(Fe.prototype,"remoteMediaSsrcChanged",[zi],Object.getOwnPropertyDescriptor(Fe.prototype,"remoteMediaSsrcChanged"),Fe.prototype),Fe);function zi(e,t,i){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this.mutex,o=await n.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];return await r.apply(this,l)}finally{o()}},i}function q9(e){let t=E1();return function(i,r){let n=i.appId;n!==void 0&&(lt(r,10),es(r,n));let o=i.cid;o!==void 0&&(lt(r,16),lt(r,o));let a=i.cname;a!==void 0&&(lt(r,26),es(r,a));let l=i.deviceId;l!==void 0&&(lt(r,34),es(r,l));let d=i.elapse;d!==void 0&&(lt(r,40),fa(r,d));let u=i.fileSize;u!==void 0&&(lt(r,48),fa(r,ad(u)));let p=i.height;p!==void 0&&(lt(r,56),fa(r,ad(p)));let m=i.jpg;m!==void 0&&(lt(r,66),lt(r,m.length),function($n,z){let re=cd($n,z.length);$n.bytes.set(z,re)}(r,m));let f=i.networkType;f!==void 0&&(lt(r,72),fa(r,ad(f)));let E=i.osType;E!==void 0&&(lt(r,80),fa(r,ad(E)));let I=i.requestId;I!==void 0&&(lt(r,90),es(r,I));let T=i.sdkVersion;T!==void 0&&(lt(r,98),es(r,T));let R=i.sequence;R!==void 0&&(lt(r,104),fa(r,ad(R)));let w=i.sid;w!==void 0&&(lt(r,114),es(r,w));let O=i.timestamp;O!==void 0&&(lt(r,120),fa(r,O));let P=i.uid;P!==void 0&&(lt(r,128),lt(r,P));let M=i.vid;M!==void 0&&(lt(r,136),lt(r,M));let V=i.width;V!==void 0&&(lt(r,144),fa(r,ad(V)));let F=i.service;F!==void 0&&(lt(r,152),lt(r,F));let q=i.callbackData;q!==void 0&&(lt(r,162),es(r,q));let J=i.jpgEncryption;J!==void 0&&(lt(r,168),lt(r,J));let Z=i.requestType;Z!==void 0&&(lt(r,176),lt(r,Z));let pe=i.scorePorn;pe!==void 0&&(lt(r,185),Uv(r,pe));let ze=i.scoreSexy;ze!==void 0&&(lt(r,193),Uv(r,ze));let nt=i.scoreNeutral;nt!==void 0&&(lt(r,201),Uv(r,nt));let Ct=i.scene;Ct!==void 0&&(lt(r,208),lt(r,Ct));let $t=i.ossFilePrefix;$t!==void 0&&(lt(r,218),es(r,$t));let Mt=i.serviceVendor;if(Mt!==void 0)for(let $n of Mt){lt(r,226);let z=E1();Q9($n,z),lt(r,z.limit),t7(r,z),e7(z)}}(e,t),function(i){let r=i.bytes,n=i.limit;return r.length===n?r:r.subarray(0,n)}(t)}function J9(e){return function(i){let r={};e:for(;!g1(i);){let n=ts(i);switch(n>>>3){case 0:break e;case 1:r.code=ts(i);break;case 2:r.msg=S1(i,ts(i));break;case 3:{let o=Z9(i);r.data=X9(i),i.limit=o;break}default:_1(i,7&n)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function X9(e){let t={};e:for(;!g1(e);){let i=ts(e);switch(i>>>3){case 0:break e;case 1:t.requestId=S1(e,ts(e));break;case 2:t.requestType=ts(e)>>>0;break;case 3:t.scorePorn=Mv(e);break;case 4:t.scoreSexy=Mv(e);break;case 5:t.scoreNeutral=Mv(e);break;case 6:t.requestScene=ts(e)>>>0;break;case 7:t.scene=ts(e)>>>0;break;default:_1(e,7&i)}}return t}function Q9(e,t){let i=e.service;i!==void 0&&(lt(t,8),lt(t,i));let r=e.vendor;r!==void 0&&(lt(t,16),lt(t,r));let n=e.token;n!==void 0&&(lt(t,26),es(t,n));let o=e.callbackUrl;o!==void 0&&(lt(t,34),es(t,o))}function Z9(e){let t=ts(e),i=e.limit;return e.limit=e.offset+t,i}function _1(e,t){switch(t){case 0:for(;128&T1(e););break;case 2:kv(e,ts(e));break;case 5:kv(e,4);break;case 1:kv(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let $9=new Float32Array(1);new Uint8Array($9.buffer);let Pv=new Float64Array(1),wr=new Uint8Array(Pv.buffer);function ad(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let f1=[];function E1(){let e=f1.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function e7(e){f1.push(e)}function kv(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function g1(e){return e.offset>=e.limit}function cd(e,t){let i=e.bytes,r=e.offset,n=e.limit,o=r+t;if(o>i.length){let a=new Uint8Array(2*o);a.set(i),e.bytes=a}return e.offset=o,o>n&&(e.limit=o),r}function Lv(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function S1(e,t){let i=Lv(e,t),r=String.fromCharCode,n=e.bytes,o="�",a="";for(let l=0;l<t;l++){let d,u,p,m,f=n[l+i];128&f?(224&f)==192?l+1>=t?a+=o:(d=n[l+i+1],(192&d)!=128?a+=o:(m=(31&f)<<6|63&d,m<128?a+=o:(a+=r(m),l++))):(240&f)==224?l+2>=t?a+=o:(d=n[l+i+1],u=n[l+i+2],(49344&(d|u<<8))!=32896?a+=o:(m=(15&f)<<12|(63&d)<<6|63&u,m<2048||m>=55296&&m<=57343?a+=o:(a+=r(m),l+=2))):(248&f)==240?l+3>=t?a+=o:(d=n[l+i+1],u=n[l+i+2],p=n[l+i+3],(12632256&(d|u<<8|p<<16))!=8421504?a+=o:(m=(7&f)<<18|(63&d)<<12|(63&u)<<6|63&p,m<65536||m>1114111?a+=o:(m-=65536,a+=r(55296+(m>>10),56320+(1023&m)),l+=3))):a+=o:a+=r(f)}return a}function es(e,t){let i=t.length,r=0;for(let a=0;a<i;a++){let l=t.charCodeAt(a);l>=55296&&l<=56319&&a+1<i&&(l=(l<<10)+t.charCodeAt(++a)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}lt(e,r);let n=cd(e,r),o=e.bytes;for(let a=0;a<i;a++){let l=t.charCodeAt(a);l>=55296&&l<=56319&&a+1<i&&(l=(l<<10)+t.charCodeAt(++a)-56613888),l<128?o[n++]=l:(l<2048?o[n++]=l>>6&31|192:(l<65536?o[n++]=l>>12&15|224:(o[n++]=l>>18&7|240,o[n++]=l>>12&63|128),o[n++]=l>>6&63|128),o[n++]=63&l|128)}}function t7(e,t){let i=cd(e,t.limit),r=e.bytes,n=t.bytes;for(let o=0,a=t.limit;o<a;o++)r[o+i]=n[o]}function T1(e){return e.bytes[Lv(e,1)]}function v1(e,t){let i=cd(e,1);e.bytes[i]=t}function Mv(e){let t=Lv(e,8),i=e.bytes;return wr[0]=i[t++],wr[1]=i[t++],wr[2]=i[t++],wr[3]=i[t++],wr[4]=i[t++],wr[5]=i[t++],wr[6]=i[t++],wr[7]=i[t++],Pv[0]}function Uv(e,t){let i=cd(e,8),r=e.bytes;Pv[0]=t,r[i++]=wr[0],r[i++]=wr[1],r[i++]=wr[2],r[i++]=wr[3],r[i++]=wr[4],r[i++]=wr[5],r[i++]=wr[6],r[i++]=wr[7]}function ts(e){let t,i=0,r=0;do t=T1(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function lt(e,t){for(t>>>=0;t>=128;)v1(e,127&t|128),t>>>=7;v1(e,t)}function fa(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=n===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10,a=cd(e,o),l=e.bytes;switch(o){case 10:l[a+9]=n>>>7&1;case 9:l[a+8]=o!==9?128|n:127&n;case 8:l[a+7]=o!==8?r>>>21|128:r>>>21&127;case 7:l[a+6]=o!==7?r>>>14|128:r>>>14&127;case 6:l[a+5]=o!==6?r>>>7|128:r>>>7&127;case 5:l[a+4]=o!==5?128|r:127&r;case 4:l[a+3]=o!==4?i>>>21|128:i>>>21&127;case 3:l[a+2]=o!==3?i>>>14|128:i>>>14&127;case 2:l[a+1]=o!==2?i>>>7|128:i>>>7&127;case 1:l[a]=o!==1?128|i:127&i}}function R1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}let i7=new Map([["moderation",1],["supervise",2]]);class I_ extends Ot{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(yi.CONNECTION_STATE_CHANGE,i,t)}get inspectType(){return this._inspectType}set inspectType(t){var i;this._inspectMode=ao(i=t.map(r=>i7.get(r)||0)).call(i,(r,n)=>r+n),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),y(this,"name","AgoraRTCVideoContentInspect"),y(this,"_connectionState",xn.CONNECTING),y(this,"_innerConnectionState",void 0),y(this,"sequence",0),y(this,"inspectStartTime",void 0),y(this,"workerManagerConnection",void 0),y(this,"workerConnection",void 0),y(this,"workerMessageLengthLimit",void 0),y(this,"inspectIntervalMinimum",void 0),y(this,"qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",hr.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"wmSequence",0),y(this,"inspectInterval",void 0),y(this,"inspectTimer",null),y(this,"ossFilePrefix",void 0),y(this,"extraInfo",void 0),y(this,"_inspectType",void 0),y(this,"_inspectMode",void 0),y(this,"_quality",1),y(this,"qualityTimer",null),y(this,"_inspectId",void 0),y(this,"_needWorkUrlOnly",!1),y(this,"inspectImage",()=>{if(this.connectionState!==xn.CONNECTED)throw new U(A.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===xn.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ft(5,"inspect-"),this.workerMessageLengthLimit=N("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=N("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=N("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new wu("worker-manager-"+this._inspectId,Xt),this.on(yi.STATE_CHANGE,(i,r)=>{this._innerConnectionState=i,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Vn[i]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new wu("worker-"+this._inspectId,Xt),this.handleWorkerEvents()}async init(t,i){this.emit(yi.STATE_CHANGE,Vn.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=i,new ne((n,o)=>{this.on(yi.CONNECTION_STATE_CHANGE,(a,l)=>{l===xn.CONNECTED&&n()}),this.requestAP(t,r,i).then(a=>{this.connectWorkerManager(a)}).catch(a=>{o(a)})})}async requestAP(t,i,r){let n=N("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),o=await function(l,d,u,p){let{appId:m,areaCode:f,cname:E,sid:I,token:T,uid:R}=d;Ll++;let w="image_moderation_api",O={service_name:w,json_body:JSON.stringify({appId:m,areaCode:f,cname:E,command:"allocateEdge",requestId:Ll,seq:Ll,sid:I,token:T,ts:Date.now(),uid:R+""})},P,M,V=l[0];return uo(async()=>{P=Date.now();let F=await _o(V,{data:O,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(M=Date.now()-P,F.code!==0){let pe=new U(A.UNEXPECTED_RESPONSE,"image inspect ap error, code"+F.code,{retry:!0,responseTime:M});throw S.error(pe.toString()),pe}let q=JSON.parse(F.json_body);if(q.code!==200){let pe=new U(A.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:M});throw S.error(pe.toString()),pe}if(!q.servers||!Array.isArray(q.servers)||q.servers.length===0){let pe=new U(A.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:q.code,responseTime:M});throw S.error(pe.toString()),pe}let J=N("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Z=N("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:q.servers.map(pe=>{let{address:ze,wss:nt}=pe;if(ze&&nt)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(J,":").concat(Z||nt)}).filter(pe=>!!pe),workerToken:q.workerToken,vid:q.vid,responseTime:M}},(F,q)=>(_e.apworkerEvent(I,{success:!0,sc:200,serviceName:w,responseDetail:JSON.stringify(F.addressList),firstSuccess:q===0,responseTime:M,serverIp:l[q%l.length]}),!1),(F,q)=>(_e.apworkerEvent(I,{success:!1,sc:F.data&&F.data.code||200,serviceName:w,responseTime:M,serverIp:l[q%l.length]}),!!(F.code!==A.OPERATION_ABORTED&&F.code!==A.UNEXPECTED_RESPONSE||F.data&&F.data.retry)&&(V=l[(q+1)%l.length],!0)),p)}(n,t,i,r);this.emit(yi.STATE_CHANGE,Vn.AP_CONNECTED);let{addressList:a}=o;return this.wmSequence++,a}async connectWorkerManager(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(yi.STATE_CHANGE,Vn.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Oe.CONNECTED,async()=>{this.emit(yi.STATE_CHANGE,Vn.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Oe.CLOSED,()=>{this._innerConnectionState<Vn.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Oe.FAILED,()=>{this._innerConnectionState<Vn.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Oe.RECONNECTING,()=>{this._innerConnectionState<Vn.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Oe.ON_MESSAGE,async t=>{this.emit(yi.STATE_CHANGE,Vn.GET_WORKER_MANAGER_RESPONSE);let i=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(t.data);if(r.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new U(A.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&i))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new U(A.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let n=N("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,o=i.replace(/:\d+\/?$/,":".concat(n));this.emit(yi.STATE_CHANGE,Vn.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(yi.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(Oe.WILL_RECONNECT,(t,i,r)=>{r(t)}),this.workerManagerConnection.on(Oe.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Oe.CONNECTED,async()=>{this.emit(yi.STATE_CHANGE,Vn.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=xn.CONNECTED}),this.workerConnection.on(Oe.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=J9(new Uint8Array(t.data));if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(yi.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var i;let n={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},o=ao(i=Object.keys(n)).call(i,(l,d)=>n[l]>n[d]?l:d,"porn"),a=Object.keys(n).find(l=>l===o);this.emit(yi.INSPECT_RESULT,a)}else this.emit(yi.INSPECT_RESULT,void 0,new U(A.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(yi.INSPECT_RESULT,void 0,new U(A.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(yi.INSPECT_RESULT,void 0,new U(A.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Oe.CLOSED,()=>{this.connectionState=xn.CLOSED}),this.workerConnection.on(Oe.FAILED,()=>{this.connectionState=xn.CLOSED}),this.workerConnection.on(Oe.RECONNECTING,()=>{this.connectionState=this.connectionState===xn.CONNECTED?xn.RECONNECTING:xn.CONNECTING}),this.workerConnection.on(Oe.WILL_RECONNECT,(t,i,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Oe.REQUEST_NEW_URLS,(t,i)=>{this.workerManagerConnection.close(),this.once(yi.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{i(r)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;let t=Ur(this,yi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(yi.INSPECT_RESULT,void 0,new U(A.INVALID_OPERATION,"Only the track being played can be inspected"));let r=await this.generateRequestData(t,i);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(yi.INSPECT_RESULT,void 0,new U(A.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,i){let{appId:r,cname:n,cid:o,vid:a,sid:l,uid:d}=i,u=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await CP(p,r,n),f=this.sequence+"-"+o+"-"+d+"-"+u+"-"+ft(12,""),E={appId:r,cid:o,cname:n,deviceId:"",elapse:I_.intToLong(Number(u-this.inspectStartTime)),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:f,sdkVersion:"4.21.0",sequence:this.sequence,sid:l,timestamp:I_.intToLong(u),uid:d,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete E.callbackData,this.ossFilePrefix===void 0&&delete E.ossFilePrefix;let I=q9(E);if(I.byteLength<this.workerMessageLengthLimit){if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let T=function(R){for(var w=1;w<arguments.length;w++){var O=arguments[w]!=null?arguments[w]:{};w%2?R1(Object(O),!0).forEach(function(P){y(R,P,O[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(O)):R1(Object(O)).forEach(function(P){Object.defineProperty(R,P,Object.getOwnPropertyDescriptor(O,P))})}return R}({},E);delete T.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(T))}return I}{let T=this.quality*this.qualityRatio;return this.quality=T,await this.generateRequestData(t,{appId:r,cname:n,cid:o,vid:a,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=hr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=xn.CLOSED,this.emit(yi.STATE_CHANGE,Vn.CLOSED)}}function r7(e){let t=function(){let i=s7.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,r){let n=i.appId;n!==void 0&&(Zt(r,10),Ea(r,n));let o=i.cid;o!==void 0&&(Zt(r,16),Zt(r,o));let a=i.cname;a!==void 0&&(Zt(r,26),Ea(r,a));let l=i.deviceId;l!==void 0&&(Zt(r,34),Ea(r,l));let d=i.elapse;d!==void 0&&(Zt(r,40),ga(r,d));let u=i.fileSize;u!==void 0&&(Zt(r,48),ga(r,ld(u)));let p=i.height;p!==void 0&&(Zt(r,56),ga(r,ld(p)));let m=i.jpg;m!==void 0&&(Zt(r,66),Zt(r,m.length),y1(r,m));let f=i.networkType;f!==void 0&&(Zt(r,72),ga(r,ld(f)));let E=i.osType;E!==void 0&&(Zt(r,80),ga(r,ld(E)));let I=i.requestId;I!==void 0&&(Zt(r,90),Ea(r,I));let T=i.sdkVersion;T!==void 0&&(Zt(r,98),Ea(r,T));let R=i.sequence;R!==void 0&&(Zt(r,104),ga(r,ld(R)));let w=i.sid;w!==void 0&&(Zt(r,114),Ea(r,w));let O=i.timestamp;O!==void 0&&(Zt(r,120),ga(r,O));let P=i.uid;P!==void 0&&(Zt(r,128),Zt(r,P));let M=i.vid;M!==void 0&&(Zt(r,136),Zt(r,M));let V=i.width;V!==void 0&&(Zt(r,144),ga(r,ld(V)));let F=i.service;F!==void 0&&(Zt(r,152),Zt(r,F));let q=i.callbackData;q!==void 0&&(Zt(r,162),Zt(r,q.length),y1(r,q));let J=i.ticket;J!==void 0&&(Zt(r,170),Ea(r,J));let Z=i.vendorConfigs;Z!==void 0&&(Zt(r,178),Ea(r,Z))}(e,t),function(i){let r=i.bytes,n=i.limit;return r.length===n?r:r.subarray(0,n)}(t)}function n7(e){return function(i){let r={};e:for(;!a7(i);){let n=ch(i);switch(n>>>3){case 0:break e;case 1:r.code=ch(i);break;case 2:r.msg=I1(i,ch(i));break;case 3:r.requestId=I1(i,ch(i));break;case 4:r.timestamp=c7(i,!1);break;default:o7(i,7&n)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function o7(e,t){switch(t){case 0:for(;128&Zn(e););break;case 2:xv(e,ch(e));break;case 5:xv(e,4);break;case 1:xv(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function ld(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let s7=[];function xv(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function a7(e){return e.offset>=e.limit}function w_(e,t){let i=e.bytes,r=e.offset,n=e.limit,o=r+t;if(o>i.length){let a=new Uint8Array(2*o);a.set(i),e.bytes=a}return e.offset=o,o>n&&(e.limit=o),r}function C1(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function y1(e,t){let i=w_(e,t.length);e.bytes.set(t,i)}function I1(e,t){let i=C1(e,t),r=String.fromCharCode,n=e.bytes,o="�",a="";for(let l=0;l<t;l++){let d,u,p,m,f=n[l+i];128&f?(224&f)==192?l+1>=t?a+=o:(d=n[l+i+1],(192&d)!=128?a+=o:(m=(31&f)<<6|63&d,m<128?a+=o:(a+=r(m),l++))):(240&f)==224?l+2>=t?a+=o:(d=n[l+i+1],u=n[l+i+2],(49344&(d|u<<8))!=32896?a+=o:(m=(15&f)<<12|(63&d)<<6|63&u,m<2048||m>=55296&&m<=57343?a+=o:(a+=r(m),l+=2))):(248&f)==240?l+3>=t?a+=o:(d=n[l+i+1],u=n[l+i+2],p=n[l+i+3],(12632256&(d|u<<8|p<<16))!=8421504?a+=o:(m=(7&f)<<18|(63&d)<<12|(63&u)<<6|63&p,m<65536||m>1114111?a+=o:(m-=65536,a+=r(55296+(m>>10),56320+(1023&m)),l+=3))):a+=o:a+=r(f)}return a}function Ea(e,t){let i=t.length,r=0;for(let a=0;a<i;a++){let l=t.charCodeAt(a);l>=55296&&l<=56319&&a+1<i&&(l=(l<<10)+t.charCodeAt(++a)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Zt(e,r);let n=w_(e,r),o=e.bytes;for(let a=0;a<i;a++){let l=t.charCodeAt(a);l>=55296&&l<=56319&&a+1<i&&(l=(l<<10)+t.charCodeAt(++a)-56613888),l<128?o[n++]=l:(l<2048?o[n++]=l>>6&31|192:(l<65536?o[n++]=l>>12&15|224:(o[n++]=l>>18&7|240,o[n++]=l>>12&63|128),o[n++]=l>>6&63|128),o[n++]=63&l|128)}}function Zn(e){return e.bytes[C1(e,1)]}function w1(e,t){let i=w_(e,1);e.bytes[i]=t}function ch(e){let t,i=0,r=0;do t=Zn(e),i<32&&(r|=(127&t)<<i),i+=7;while(128&t);return r}function Zt(e,t){for(t>>>=0;t>=128;)w1(e,127&t|128),t>>>=7;w1(e,t)}function c7(e,t){let i,r=0,n=0,o=0;return i=Zn(e),r=127&i,128&i&&(i=Zn(e),r|=(127&i)<<7,128&i&&(i=Zn(e),r|=(127&i)<<14,128&i&&(i=Zn(e),r|=(127&i)<<21,128&i&&(i=Zn(e),n=127&i,128&i&&(i=Zn(e),n|=(127&i)<<7,128&i&&(i=Zn(e),n|=(127&i)<<14,128&i&&(i=Zn(e),n|=(127&i)<<21,128&i&&(i=Zn(e),o=127&i,128&i&&(i=Zn(e),o|=(127&i)<<7))))))))),{low:r|n<<28,high:n>>>4|o<<24,unsigned:t}}function ga(e,t){let i=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=n===0?r===0?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10,a=w_(e,o),l=e.bytes;switch(o){case 10:l[a+9]=n>>>7&1;case 9:l[a+8]=o!==9?128|n:127&n;case 8:l[a+7]=o!==8?r>>>21|128:r>>>21&127;case 7:l[a+6]=o!==7?r>>>14|128:r>>>14&127;case 6:l[a+5]=o!==6?r>>>7|128:r>>>7&127;case 5:l[a+4]=o!==5?128|r:127&r;case 4:l[a+3]=o!==4?i>>>21|128:i>>>21&127;case 3:l[a+2]=o!==3?i>>>14|128:i>>>14&127;case 2:l[a+1]=o!==2?i>>>7|128:i>>>7&127;case 1:l[a]=o!==1?128|i:127&i}}let A1={},O1={},A_=4294967296,l7=A_*A_,b1=l7/2;D1(0,!0);let N1=D1(0),d7=lh(0,-2147483648,!1),u7=lh(-1,2147483647,!1);function D1(e,t){let i,r,n;return t?(n=0<=(e>>>=0)&&e<256)&&(r=O1[e],r)?r:(i=lh(e,0,!0),n&&(O1[e]=i),i):(n=-128<=(e|=0)&&e<128)&&(r=A1[e],r)?r:(i=lh(e,e<0?-1:0,!1),n&&(A1[e]=i),i)}function lh(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function h7(e,t){if(isNaN(e))return N1;{if(e<=-b1)return d7;if(e+1>=b1)return u7}return e<0?N1:lh(e%A_|0,e/A_|0,t)}function P1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}class Vv extends Ot{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(po.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var i;super(),y(this,"name","AgoraRTCImageModeration"),y(this,"_connectionState",fn.CONNECTING),y(this,"_sequence",0),y(this,"_moderationStartTime",void 0),y(this,"_workerConnection",void 0),y(this,"_workerMessageLengthLimit",void 0),y(this,"_qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",hr.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"_moderationInterval",void 0),y(this,"_moderationTimer",null),y(this,"_moderationMode",1),y(this,"_quality",1),y(this,"_qualityTimer",null),y(this,"_ticket",void 0),y(this,"_moderationIntervalMinimum",void 0),y(this,"_uploadFailedNum",0),y(this,"_uploadNum",0),y(this,"_uploadTimer",null),y(this,"_extraInfo",void 0),y(this,"_vendor",""),y(this,"_encoder",new TextEncoder),y(this,"_moderationId",void 0),y(this,"inspectImage",()=>{if(this.connectionState!==fn.CONNECTED)throw new U(A.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fn.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ft(5,"image-moderation-"),this._workerMessageLengthLimit=N("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=N("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=N("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new wu("worker-"+this._moderationId,Xt),this.on(po.STATE_CHANGE,(r,n)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Dl[r]," ").concat(n||""))}),this.handleWorkerEvents()}async init(t,i){this.emit(po.STATE_CHANGE,Dl.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=i,new ne((n,o)=>{this.on(po.CONNECTION_STATE_CHANGE,(a,l)=>{a===fn.CONNECTED&&n()}),this.requestAP(t,r,i).then(a=>{this.connectWorker(a)}).catch(a=>{o(a)})})}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===fn.CONNECTED&&this.inspectImage()}async requestAP(t,i,r){let n=N("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),o=await function(d,u,p,m){let{appId:f,areaCode:E,cname:I,sid:T,token:R,uid:w}=u;Ll++;let O="moderation_plugin",P={service_name:O,json_body:JSON.stringify({appId:f,areaCode:E,cname:I,command:"allocateEdge",requestId:Ll,seq:Ll,sid:T,appToken:R,ts:Date.now(),uid:w+""})},M,V,F=d[0];return uo(async()=>{M=Date.now();let q=await _o(F,{data:P,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(V=Date.now()-M,q.code!==0){let pe=new U(A.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+q.code,{retry:!0,responseTime:V});throw S.error(pe.toString()),pe}let J=JSON.parse(q.json_body);if(J.code!==200){let pe=new U(A.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:V});throw S.error(pe.toString()),pe}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){let pe=new U(A.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:V});throw S.error(pe.toString()),pe}if(!J.servers.some(pe=>!!pe.wss)){let pe=new U(A.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:V});throw S.error(pe.toString()),pe}let Z=N("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(pe=>{let{address:ze,wss:nt}=pe;if(ze&&nt)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(Z,":").concat(nt,"/moderation")}).filter(pe=>!!pe),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:V}},(q,J)=>(_e.apworkerEvent(T,{success:!0,sc:200,serviceName:O,responseDetail:JSON.stringify(q.addressList),firstSuccess:J===0,responseTime:V,serverIp:d[J%d.length]}),!1),(q,J)=>(_e.apworkerEvent(T,{success:!1,sc:q.data&&q.data.code||200,serviceName:O,responseTime:V,serverIp:d[J%d.length]}),!!(q.code!==A.OPERATION_ABORTED&&q.code!==A.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(F=d[(J+1)%d.length],!0)),m)}(n,t,i,r);this.emit(po.STATE_CHANGE,Dl.AP_CONNECTED);let{addressList:a,ticket:l}=o;return this._ticket=l,a}async connectWorker(t){this.emit(po.STATE_CHANGE,Dl.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Oe.CONNECTED,async()=>{this.emit(po.STATE_CHANGE,Dl.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fn.CONNECTED}),this._workerConnection.on(Oe.CLOSED,()=>{this.connectionState=fn.CLOSED}),this._workerConnection.on(Oe.FAILED,()=>{this.connectionState=fn.CLOSED}),this._workerConnection.on(Oe.RECONNECTING,()=>{this.connectionState=this.connectionState===fn.CONNECTED?fn.RECONNECTING:fn.CONNECTING}),this._workerConnection.on(Oe.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=n7(new Uint8Array(t.data));N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{_e.reportApiInvoke(this._connectInfo.sid||null,{name:ti.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:xt.TRACER}).onError(new U(A.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},N("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Oe.WILL_RECONNECT,(t,i,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Oe.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Ur(this,po.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;let r=await this.generateRequestData(t,i);this._workerConnection.sendMessage(r,!0,!0)}else N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:r,cname:n,cid:o,vid:a,sid:l,uid:d}=i,u=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await CP(p,r,n),f=this._sequence+"-"+o+"-"+d+"-"+u+"-"+ft(12,""),E={appId:r,cid:o,cname:n,deviceId:"",elapse:Vv.intToLong(Number(u-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:f,sdkVersion:"4.21.0",sequence:this._sequence,sid:l,timestamp:h7(u),uid:d,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete E.callbackData;let I=r7(E);if(I.byteLength<this._workerMessageLengthLimit){if(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let T=function(R){for(var w=1;w<arguments.length;w++){var O=arguments[w]!=null?arguments[w]:{};w%2?P1(Object(O),!0).forEach(function(P){y(R,P,O[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(O)):P1(Object(O)).forEach(function(P){Object.defineProperty(R,P,Object.getOwnPropertyDescriptor(O,P))})}return R}({},E);delete T.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(T))}return I}{let T=this.quality*this._qualityRatio;return this.quality=T,await this.generateRequestData(t,{appId:r,cname:n,cid:o,vid:a,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=hr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fn.CLOSED,this.emit(po.STATE_CHANGE,Dl.CLOSED)}}function k1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function L1(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?k1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let p7=Date.now(),m7=20,Fv=new Map,O_=new Map;async function M1(e){let t=Fv.get(e),i=Array.isArray(t)&&t[t.length-1],r=O_.get(e);if(!i)return void(r.isSyncing=!1);let n={uid:i.uid,payload:i.payload};r.firstRecvTs===0&&(r.firstRecvTs=i.recvTs,r.firstSendTs=i.sendTs);let o=i.sendTs-r.firstSendTs,a=o-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-o);let l=i.mediaDelay+a;l<=0?(t.pop(),U1(i.context,n),l=0):l=Math.min(l,m7),setTimeout(()=>t.length&&M1(e),l)}function U1(e,t){e.safeEmit(He.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function _7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return U1(i,{uid:e.uid,payload:e.payload});let r="".concat(i.id,"-").concat(e.uid),n=Fv.get(r)||[],o=n.findIndex(u=>e.sendTs>=u.sendTs),a=L1(L1({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});o===-1?n.push(a):n.splice(o,0,a),Fv.set(r,n);let l=!1;var d;O_.has(r)?l=!((d=O_.get(r))===null||d===void 0||!d.isSyncing):O_.set(r,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||M1(r)}let f7=Xe().name;function x1(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function V1(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?x1(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let dd="websdk_ng_cache_parameter",E7=N("MAX_PRELOAD_ASYNC_LENGTH"),g7=1e4,bc=new Map,Nc=[],jv=null,Bv=0,Gv=0,b_=new Map,S7=function(e,t){let i=[],r=0,n=async()=>{let o=i.shift();o&&await o(),i.length>0&&r<t?n():r--};return async function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return new ne(async(d,u)=>{i.push(async()=>{try{let p=await e(...a);d(p)}catch(p){u(p)}}),r<t&&(r++,n())})}}(F1,E7),Wv=hr.CancelToken.source();async function F1(e,t,i,r,n){try{if(!N("ENABLE_PRELOAD"))return;if(!Ye().supportWebCrypto)return void Js(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new B(A.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Ai(i,"token",1,2047),Ai(e,"appid",1,2047),Rm(t),r&&Cm(r);let o=vu();S.debug("preload channel ".concat(t,", uid is ").concat(r));let a={appId:e,cname:t,token:i||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:n},l,d;typeof r=="string"?(a.stringUid=r,[d,l]=await ne.all([jz(r,{sid:o,appId:e},Wv.token),DN(V1(V1({},a),{},{token:i||e,uid:0}),Wv.token)]),a.uid=d.uid,l.gatewayInfo.uid=a.uid,l.gatewayInfo.res.uid=a.uid):l=await DN(a,Wv.token);let u={sid:o,appId:e,cname:t,token:i||e,uid:a.stringUid||r,intUid:a.uid||l.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:d,ap:l};await async function(p){let m;try{p.uid&&B1({appId:p.appId,cname:p.cname,token:p.token,uid:p.uid,stringUid:p.stringUid});let f=K1(p),E=await async function(T,R){try{let w=await window.crypto.subtle.importKey("raw",Mb(R),"AES-GCM",!1,["encrypt"]),O=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},w,sc(window.btoa(JSON.stringify(T))));return Xs(new Uint8Array(O))}catch{return}}(p,p.token||p.appId);if(!E)return;m=H1(dd);let I=m?JSON.parse(m):[];I.push({[f]:E}),I.length>N("AP_CACHE_NUM")&&I.shift(),N_(dd,JSON.stringify(I))}catch(f){S.warn("Error caching server parameters:",f.message),N_(dd,"")}}(u),Bv++}catch(o){throw Gv++,function(a){jv||(jv=window.setTimeout(()=>{let d="";b_.forEach((u,p)=>{d+="".concat(p,": ").concat(u," ;")}),_e.reportApiInvoke(null,{name:ti.PRELOAD,options:{success:Bv,failed:Gv,err:d}}).onError(a),Bv=0,Gv=0,b_.clear(),jv=null},g7));let l=b_.get(a.code)||0;b_.set(a.code,l+1)}(o),o}}async function j1(e){try{let t=B1(e);if(!t||e.cloudProxyServer!=="disabled")return;let i=await async function(r,n){try{let o=await window.crypto.subtle.importKey("raw",Mb(n),"AES-GCM",!1,["decrypt"]),a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,sc(r));return JSON.parse(window.atob(Xs(new Uint8Array(a))))}catch{return}}(t,e.token||e.appId);if(!i||!function(r,n){return r.cname===n.cname&&r.appId===n.appId&&r.token===n.token?n.stringUid?r.stringUid===n.stringUid:typeof n.uid=="number"?r.uid===n.uid:r.uid==n.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<N("AP_CACHE_LIFETIME"))return i}catch(t){S.warn("Error get preloadInfo",t.message)}}function B1(e){let t;try{if(t=H1(dd),!t)return;let i=JSON.parse(t),r=K1(e),n=function(a,l){for(let d=a.length-1;d>=0;d--)if(l(a[d]))return d;return-1}(i,a=>r in a);if(n===-1)return;let o=i.splice(n,1)[0];return N_(dd,JSON.stringify(i)),o[r]}catch(i){S.warn("Error delete preload info: ".concat(t),i.message),N_(dd,"")}}function Hv(e){if(e){let t=bc.get(e);t&&(window.clearTimeout(t),t=null,bc.delete(e)),se(Nc).call(Nc,e)||e.cloudProxyServer!=="disabled"||Nc.push(e)}if(bc.size<N("AP_CACHE_NUM")&&Nc.length>0){let t=Nc.shift();bc.set(t,window.setTimeout(async()=>{let{appId:i,cname:r,token:n,uid:o,proxyServer:a}=t;try{await S7(i,r,n,o,a),bc.has(t)&&Hv(t)}catch(l){S.warn("update preload failed",l.message),G1(t)}},N("AP_UPDATE_INTERVAL")))}}function G1(e){let t=Nc.indexOf(e);t!==-1&&Nc.splice(t,1);let i=bc.get(e);i&&(window.clearTimeout(i),i=null,bc.delete(e),Hv())}function W1(e,t){let i=e.sua,r=e.ap;t&&i&&_e.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),_e.reportResourceTiming(e.ap.url,e.sid),_e.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(n=>n.ip).join(","),eventType:"disabled",unilbsServerIds:[Qt.CHOOSE_SERVER,Qt.CLOUD_PROXY_FALLBACK].toString()}),_e.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(n=>n.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Qt.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function H1(e){return window.atob(window.localStorage.getItem(e)||"")}function N_(e,t){window.localStorage.setItem(e,window.btoa(t))}function K1(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Gb(t)}var z1,Y1,q1,J1,X1,Q1,Z1,$1,eM,tM,iM,rM,nM,oM,sM,aM,cM,lM,dM,uM,hM,pM,mM,_M,fM,EM,gM,SM,TM,vM,RM,CM,yM,IM,wM,AM,OM,bM,NM,DM,PM,kM,ae;function LM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Rn(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?LM(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):LM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}vi.setLogger(S);let T7=(z1=ye(),Y1=ye({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Zl))return[t];t=[t]}return t.map(i=>i?Object(i).toString():"null")}}),q1=ye({argsMap:(e,t)=>(t||(t=[]),t instanceof rL?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(i=>i.getTrackId())))}),J1=ye({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),X1=ye({argsMap:(e,t,i)=>[t,i]}),Q1=ye({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:n}=i;return[r==null?void 0:r.uid,n]})}),Z1=ye({argsMap:(e,t,i,r)=>[typeof t=="object"?t.uid:t,i,r]}),$1=ye({argsMap:(e,t)=>t.map(i=>{let{user:r,mediaType:n}=i;return{uid:r==null?void 0:r.uid,mediaType:n}})}),eM=ye(),tM=ye(),iM=ye(),rM=ye(),nM=ye(),oM=ye(),sM=ye(),aM=ye(),cM=ye(),lM=ye(),dM=ye(),uM=ye(),hM=ye(),pM=ye(),mM=ye({argsMap:(e,t)=>[t]}),_M=ye(),fM=ye(),EM=ye(),gM=ye(),SM=ye(),TM=ye(),vM=ye(),RM=ye(),CM=ye(),yM=ye(),IM=ye({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),wM=ye(),AM=ye(),OM=ye(),bM=ye(),NM=ye(),DM=ye(),PM=ye({reportResult:!0}),kM=ye(),ae=class extends Ot{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),y(this,"store",void 0),y(this,"_uid",void 0),y(this,"_channelName",void 0),y(this,"_uintUid",void 0),y(this,"_users",[]),y(this,"_config",void 0),y(this,"_clientId",void 0),y(this,"_appId",void 0),y(this,"_sessionId",null),y(this,"_key",void 0),y(this,"_rtmConfig",{}),y(this,"_joinInfo",void 0),y(this,"_gateway",void 0),y(this,"_statsCollector",void 0),y(this,"_configDistribute",void 0),y(this,"_leaveMutex",new vi("client-leave")),y(this,"_publishMutex",new vi("client-publish")),y(this,"_renewTokenMutex",new vi("client-renewtoken")),y(this,"_subscribeMutex",new vi("client-subscribe")),y(this,"_encryptionMode","none"),y(this,"_encryptionSecret",null),y(this,"_encryptionSalt",null),y(this,"_encryptDataStream",!1),y(this,"_encryptDataStreamKey",null),y(this,"_encryptDataStreamIv",null),y(this,"_proxyServer",void 0),y(this,"_turnServer",{servers:[],mode:"auto"}),y(this,"_cloudProxyServerMode","disabled"),y(this,"_isDualStreamEnabled",!1),y(this,"_defaultStreamFallbackType",void 0),y(this,"_lowStreamParameter",void 0),y(this,"_streamFallbackTypeCacheMap",new Map),y(this,"_remoteStreamTypeCacheMap",new Map),y(this,"_axiosCancelSource",hr.CancelToken.source()),y(this,"_audioVolumeIndicationInterval",void 0),y(this,"_networkQualityInterval",void 0),y(this,"_userOfflineTimeout",void 0),y(this,"_streamRemovedTimeout",void 0),y(this,"_injectStreamingClient",void 0),y(this,"_liveTranscodeStreamingClient",void 0),y(this,"_liveRawStreamingClient",void 0),y(this,"_channelMediaRelayClient",void 0),y(this,"_networkQualitySensitivity","normal"),y(this,"_p2pChannel",void 0),y(this,"_useLocalAccessPoint",!1),y(this,"_setLocalAPVersion",void 0),y(this,"_joinAndNotLeaveYet",!1),y(this,"_numberOfJoinCount",0),y(this,"_remoteDefaultVideoStreamType",void 0),y(this,"_inspect",void 0),y(this,"_moderation",void 0),y(this,"_license",void 0),y(this,"_pendingPublishedUsers",[]),y(this,"ntpAlignErrorCount",0),y(this,"remoteInboundOffset",0),y(this,"_handleLocalTrackEnable",(i,r,n)=>{this.publish(i,!1).then(r).catch(n)}),y(this,"_handleLocalTrackDisable",(i,r,n)=>{this.unpublish(i).then(r).catch(n)}),y(this,"_handleUserOnline",i=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(i.uid,this.channelName))return void S.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let r=this._users.find(n=>n.uid===i.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(He.USER_JOINED,r));else{let n=new ha(i.uid,i.uint_id||i.uid);this._users.push(n),S.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(He.USER_JOINED,n)}}),y(this,"_handleUserOffline",i=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(i.uid,this.channelName))return;let r=this._users.find(n=>n.uid===i.uid);r&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:pm(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),S.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(He.USER_LEAVED,r,i.reason))}),y(this,"_handleAddAudioOrVideoStream",(i,r,n,o,a,l,d)=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(r,this.channelName))return;let u=this._users.find(m=>m.uid===r);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(u.uid,i,void 0,void 0,void 0,Date.now());let p=i==="audio"?u.hasAudio:u.hasVideo;u._uintid||(u._uintid=a||r),i==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,i==="audio"?(u._audio_added_=!0,n!==void 0&&(u._audioSSRC=n),o!==void 0&&(u._cname=o),l&&(u._audioOrtc=l)):(u._video_added_=!0,n!==void 0&&(u._videoSSRC=n),o!==void 0&&(u._cname=o),d!==void 0&&(u._rtxSsrcId=d),l&&(u._videoOrtc=l)),(i==="audio"?u.hasAudio:u.hasVideo)&&!p&&(S.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(i)),this.safeEmit(He.USER_PUBLISHED,u,i)),i==="video"?_e.onGatewayStream(this._sessionId,Ri.ON_ADD_VIDEO_STREAM,kt.ON_ADD_VIDEO_STREAM,{peer:a||r,ssrc:u._videoSSRC}):_e.onGatewayStream(this._sessionId,Ri.ON_ADD_AUDIO_STREAM,kt.ON_ADD_AUDIO_STREAM,{peer:a||r,ssrc:u._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(u,i,n).then(m=>{if(m&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(u.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof y_))return this._p2pChannel.unsubscribe(u,i,!0).then(()=>this._subscribe(u,i,!0).catch(f=>{S.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(u,i)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,i,!0).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),y(this,"_handleRemoveStream",i=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(i.uid,this.channelName))return;let r=this._users.find(o=>o.uid===i.uid);if(!r)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let n=()=>{};r.hasAudio&&r.hasVideo?n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(He.USER_UNPUBLISHED,r,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(He.USER_UNPUBLISHED,r,"video")}:r.hasVideo?n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(He.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(He.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof y_&&this._p2pChannel.unsubscribe(r).then(o=>{if(o)return this._gateway.unsubscribe(o,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),_e.onGatewayStream(this._sessionId,Ri.ON_REMOVE_STREAM,kt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),n()}),y(this,"_handleSetStreamLocalEnable",(i,r,n)=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(r,this.channelName))return;let o=this._users.find(d=>d.uid===r);if(!o)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(n?"enabled":"disabled"," with uid ").concat(r));let a=i==="audio"?o.hasAudio:o.hasVideo;if(i==="audio"){o._trust_audio_enabled_state_=!0;let d=o._audio_enabled_;if(o._audio_enabled_=n,o._audio_enabled_===d)return;{let u=o._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(u)),this.safeEmit(He.USER_INFO_UPDATED,r,u)}}else{o._trust_video_enabled_state_=!0;let d=o._video_enabled_;if(o._video_enabled_=n,o._video_enabled_===d)return;{let u=o._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(u)),this.safeEmit(He.USER_INFO_UPDATED,r,u)}}let l=i==="audio"?o.hasAudio:o.hasVideo;return a!==l?!a&&l?(S.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(He.USER_PUBLISHED,o,i)):(i==="video"&&o._videoTrack&&o._videoTrack._destroy(),i==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,i),S.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),void this.safeEmit(He.USER_UNPUBLISHED,o,i)):void 0}),y(this,"_handleMuteStream",(i,r,n)=>{if(N("BLOCK_LOCAL_CLIENT")&&cc(i,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),i,r,n);let o=this._users.find(d=>d.uid===i);if(!o)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let a=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_mute_state_=!0;let d=o._audio_muted_;if(o._audio_muted_=n,o._audio_muted_===d)return;{let u=o._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(u)),this.safeEmit(He.USER_INFO_UPDATED,i,u)}}else{o._trust_video_mute_state_=!0;let d=o._video_muted_;if(o._video_muted_=n,o._video_muted_===d)return;{let u=o._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(u)),this.safeEmit(He.USER_INFO_UPDATED,i,u)}}let l=r==="audio"?o.hasAudio:o.hasVideo;if(a!==l){if(!a&&l)return(r==="audio"?o._audioSSRC:o._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(He.USER_PUBLISHED,o,r)):void S.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),S.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),this.safeEmit(He.USER_UNPUBLISHED,o,r)}}),y(this,"_handleP2PLost",async i=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),y(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(He.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),y(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),y(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(He.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(He.NETWORK_QUALITY,i)}),y(this,"_handleP2PAddAudioOrVideoStream",(i,r,n,o)=>{let a=this._users.find(d=>d.uid===r);if(!a)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(a.uid,i,void 0,void 0,void 0,Date.now());let l=i==="audio"?a.hasAudio:a.hasVideo;i==="audio"?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,i==="audio"?(a._audio_added_=!0,n!==void 0&&(a._audioSSRC=n),o!==void 0&&(a._audioMid=o)):(a._video_added_=!0,n!==void 0&&(a._videoSSRC=n),o!==void 0&&(a._videoMid=o)),(i==="audio"?a.hasAudio:a.hasVideo)&&!l&&(S.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(i)),this.safeEmit(He.USER_PUBLISHED,a,i)),this._p2pChannel.hasPendingRemoteMedia(a,i)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,i,!0).catch(d=>{S.error("[".concat(this._clientId,"] resubscribe error"),d.toString())}))}),this._config=e,this._clientId=ft(5,"client-"),this.store=new y8(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(mn," build: ").concat(WS,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{kb(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(i){S.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new oh(this.store),this._statsCollector.onStatsException=(i,r,n)=>{S.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(r,", uid: ").concat(n)),this.safeEmit(He.EXCEPTION,{code:i,msg:r,uid:n})},this._statsCollector.onUploadPublishDuration=(i,r,n,o)=>{let a=this._users.find(l=>l.uid===i);a&&_e.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:r,videoPublishDuration:n,peer:a._uintid})},this.store.useDataChannel=Ye().supportDataChannel&&N("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new Lz(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Xt,httpRetryConfig:e.httpRetryConfig||Xt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new Hz,this.store.useP2P?(this._p2pChannel=new Fr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new y_(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,r,n){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];pt("JOIN_GATEWAY_USE_443PORT_ONLY",o),pt("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let l=this._gateway.signal.websocket;return l instanceof Iu&&(l.use443PortOnly=o,l.tryDoubleDomain=a),async function(d,u,p){cm.get(d)||cm.set(d,[]),lm.get(d)||lm.set(d,u),jo.get(d)||jo.set(d,0);let m=cm.get(d),f=lm.get(d);if(!m||!f)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(jo.get(d)===f){let w=Eu();m.push(w),await w.promise}jo.set(d,jo.get(d)+1);for(var E=arguments.length,I=new Array(E>3?E-3:0),T=3;T<E;T++)I[T-3]=arguments[T];let R=await p(...I);return jo.set(d,jo.get(d)-1),jo.get(d)===f-1&&m.length>0&&(m[0].resolve(),m.shift()),jo.get(d)===0&&(cm.set(d,[]),lm.set(d,0),jo.set(d,0)),R}("client.join",N("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,r,n)}async join(e,t,i,r,n){let o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let a=(gm||gm||(gm=(window.location.protocol.split(":")[0]||"").toUpperCase(),gm))==="HTTPS",l=Wb()?window.isSecureContext:"Browser Not Support";(!Wb()&&!a||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),S.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),_e.setAppId(e);try{if(!i&&i!==null)throw new U(A.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Ai(i,"token",1,2047),Ai(e,"appid",1,2047),Rm(t),r&&Cm(r),n&&Ai(n,"optionalInfo",1,2047)}catch(T){throw _e.reportApiInvoke(vu(),{name:ti.JOIN,options:[e,t,i,r],states:{isHttps:a,isSecureContext:l},tag:xt.TRACER}).onError(T),T}let d=await j1({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode}),u=(d==null?void 0:d.sid)||vu(),p=_e.reportApiInvoke(u,{name:ti.JOIN,options:[e,t,i,r],states:{isHttps:a,isSecureContext:l},tag:xt.TRACER});if(S.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let T=new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw p.onError(T),T}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";let m=Rn(Rn({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:n,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(m.stringUid=r,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async T=>{let R=function(M){let V=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),F=new Uint8Array(new ArrayBuffer(V.length));for(let q=0;q<V.length;q+=1)F[q]=V.charCodeAt(q);return F}(),w=await window.crypto.subtle.importKey("spki",R,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),O=LS(T),P=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},w,O);return function(M){let V="";for(let F=0;F<M.length;F+=1)V+=String.fromCharCode(M[F]);return window.btoa(V)}(new Uint8Array(P))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let T=new TextEncoder,R=N("USE_PURE_ENCRYPTION_MASTER_KEY")?T.encode(m.appId+this._encryptionSecret+this._encryptionSecret):T.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(w,O,P){let M=await window.crypto.subtle.importKey("raw",O,"PBKDF2",!1,["deriveBits","deriveKey"]),V=w==="aes-128-gcm2"?128:256,F=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Kb,hash:"SHA-256",salt:P},M,V+I8);return new Uint8Array(F).subarray(V/8)}(this._encryptionMode,R,sc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(w,O,P){let M=await window.crypto.subtle.importKey("raw",O,"PBKDF2",!1,["deriveBits","deriveKey"]),V=w==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Kb,hash:"SHA-256",salt:P},M,{name:"AES-GCM",length:V},!0,["encrypt","decrypt"])}(this._encryptionMode,R,sc(this._encryptionSalt))}else l?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:m.stringUid,preload:m.preload});let f=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&f===this._sessionId&&_e.joinChannelTimeout(this._sessionId,5)},5e3);try{var E;let T,R=m.cloudProxyServer;if(se(E=["proxy3","proxy4","proxy5"]).call(E,R)){let V=N("PROXY_SERVER_TYPE3");Array.isArray(V)?m.proxyServer=V[0]:m.proxyServer=V}if(_e.setProxyServer(m.proxyServer),S.setProxyServer(m.proxyServer),this.store.requestAPStart(),d){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(d.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=d.intUid),T={gatewayInfo:d.ap.gatewayInfo},N("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let V=(await EN(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Li.tcpport,udpport:F.udpport||Li.udpport,username:F.username||Li.username,password:F.password||Li.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:V}}W1(d,m.stringUid)}else{if(m.stringUid&&!m.uid){let V;[V,T]=await ne.all([NN(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Xt,this.store),bN(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Xt,!0,this.store)]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(V)),m.uid=V,T.gatewayInfo.uid=V,T.gatewayInfo.res.uid=V}else T=await bN(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Xt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on($S.UPDATE_BITRATE_LIMIT,V=>{this._p2pChannel.updateBitrateLimit(V)})},0),this._key=i||e;let w=T.gatewayInfo,O=m.uid?m.uid:w.uid;this._joinInfo=Rn(Rn({},m),{},{cid:w.cid,uid:O,vid:w.vid,apResponse:w.res,uni_lbs_ip:w.uni_lbs_ip,gatewayAddrs:w.gatewayAddrs}),this.store.intUid=O;let P=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(P),this._appId=e,this._channelName=m.cname,this._uid=P,this.store.uid=P,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(mi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let M=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(M)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),I=this,se(Zs).call(Zs,I)||Zs.push(I),this._cloudProxyServerMode==="disabled"&&Ye().supportWebCrypto&&N("ENABLE_PRELOAD")&&Hv(this._joinInfo),P}catch(T){let R=Array.isArray(T)?T[0]:T;throw R&&R.code===A.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),R):S.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),R),R.code!==A.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(R),R}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new U(A.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!N("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===A.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,We.FALLBACK),e;if(e.code===A.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,We.FALLBACK),e;throw e}).then(e=>{if(e instanceof U){if(e.code===A.INIT_WEBSOCKET_TIMEOUT){if(S.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new U(A.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";let t=N("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){let r=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=r.slice(r.length-2).join(".");t.forEach(o=>{this._joinInfo&&se(o).call(o,n)&&(this._joinInfo.proxyServer=o)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;let i=N("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&S.setProxyServer(this._joinInfo.proxyServer),N("STATS_COLLECTOR_PORT").toString()!=="443"&&_e.setProxyServer(this._joinInfo.proxyServer),_e.reportApiInvoke(this._sessionId,{name:ti.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:xt.TRACER}).onSuccess(),this.safeEmit(He.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(r=>{"forceturn"in r&&(r.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(S.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new U(A.INVALID_OPERATION);return _e.reportApiInvoke(this._sessionId,{name:ti.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:xt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(mi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let i=Zs.indexOf(t);i!==-1&&Zs.splice(i,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Zl))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new U(A.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new U(A.INVALID_OPERATION,"audience can not publish stream");for(let n of i){if(!(n instanceof Zl))throw new U(A.INVALID_PARAMS,"parameter is not local track");if(!n._enabled&&t)throw new U(A.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(n=>"".concat(n.getTrackId()," "))));let r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(n=>{let o=this._configDistribute.getBitrateLimit();n instanceof Et&&o&&n.setBitrateLimit(o.uplink)});try{await this._publishHighStream(i),S.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(n=>"".concat(n.getTrackId()," "))))}catch(n){throw S.error("[".concat(this._clientId,"] publish error"),n.toString()),n}finally{r()}}async _publishDataChannel(e){ht(e.id,"id",0,65535,!0),hs(e.ordered,"ordered"),Ai(e.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new U(A.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new U(A.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new U(A.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=new rL(e);if(await this._p2pChannel.publishDataChannel([i]),!this._p2pChannel.isP2PDisconnected()){if(typeof i._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new U(A.CREATE_DATACHANNEL_ERROR);try{let r={streamId:e.id,ordered:e.ordered,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,r,!0),await i._waitTillOpen()}catch(r){if(r.code!==A.DISCONNECT_P2P)throw r}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw S.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new U(A.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Zl))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Fr){let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Kt.UNPUBLISH,{unpubMsg:r},!0)}else{let r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(n=>"".concat(n.getTrackId()))))}}catch(r){throw S.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let t=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(i){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof ha)){let r=this.remoteUsers.find(n=>n.uid===e);if(!r)throw new U(A.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(li(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Fr)throw new U(A.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new U(A.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=t===me.AUDIO,r=t===me.VIDEO,n=await this._subscribeMutex.lock();try{let{ssrcId:o,ortc:a,rtxSsrcId:l,cname:d,uint_id:u}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new U(A.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(f=>f.uid===e);p||(p=new ha(e,u||e),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=u||e),i&&(p._audioSSRC=o,p._audio_pre_subscribed=!0,a&&(p._audioOrtc=a)),r&&(p._videoSSRC=o,p._video_pre_subscribed=!0,a&&(p._videoOrtc=a),l!=null&&(p._rtxSsrcId=l)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(p,t,o,l,a);let m=i?p._audioTrack:p._videoTrack;if(!m)throw new U(A.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(o){throw S.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{n()}}async _subscribeDataChannel(e,t){var i;if(ht(t,"channelId",0,65535,!0),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new U(A.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new U(A.INVALID_REMOTE_USER,"user is not published");let r=(i=e._dataChannels)===null||i===void 0?void 0:i.find(a=>a.id===t);if(!r)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new U(A.REMOTE_USER_IS_NOT_PUBLISHED);let n=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let a=await this._p2pChannel.subscribeDataChannel(e,[r]);if(a&&se(a).call(a,r.id))try{var o;if(typeof r._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new U(A.CREATE_DATACHANNEL_ERROR);let l={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(o=r.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await r._waitTillOpen()}catch(l){if((l==null?void 0:l.code)!==A.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),l;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{n()}}async _p2pSubscribe(e,t,i){if(li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(n=>n===e)){let n=new U(A.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),n}if(!e.hasAudio&&!e.hasVideo){let n=new U(A.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),n}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let n=new U(A.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Fr&&await this._p2pChannel.subscribe(e,t,o,a)}catch(o){throw o}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});let n=t==="audio"?e._audioTrack:e._videoTrack;if(!n)throw new U(A.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(n){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),n),n}finally{r()}}async _subscribe(e,t,i){if(this._p2pChannel instanceof Fr)return this._p2pSubscribe(e,t);if(li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e)){let d=new U(A.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){let d=new U(A.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let d=new U(A.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}let r=t==="audio"?e._audioSSRC:e._videoSSRC,n=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?me.AUDIO:me.VIDEO,ssrcId:r},l=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let u=t==="audio"?e._audioSSRC:e._videoSSRC;u!==void 0&&u!==r&&(r=u,n=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,a={stream_type:t==="audio"?me.AUDIO:me.VIDEO,ssrcId:r}),Gi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,n);try{await this._gateway.subscribe(e.uid,a,!0)}catch(p){if((p==null?void 0:p.code)!==A.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),p;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(u){throw this._p2pChannel.reportSubscribeEvent(!1,u==null?void 0:u.code,e,t),u}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});let d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new U(A.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{l()}}async massSubscribe(e){if(ps(e,"subscribeList"),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),i=new Map,r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:d,mediaType:u}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(u)}).join("; ")));let n=(e=[...e]).map(l=>{let{user:d,mediaType:u}=l;return{user:d,mediaType:u}}),o=await this._p2pChannel.globalLock();try{var a;for(let d=e.length-1;d>=0;d--){let u=e[d],{user:p,mediaType:m}=u;if(li(m,"mediaType",["audio","video"]),!p){let I=new U(A.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===p)){let I=new U(A.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),n[d].error=I,e.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){let I=new U(A.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),n[d].error=I,e.splice(d,1);continue}let f=fi.Video|fi.LwoVideo,E=i.get(p);if(E){if(m==="video"?E&f:E&fi.Audio){e.splice(d,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}i.set(p,E|(m==="video"?f:fi.Audio))}else i.set(p,m==="video"?f:fi.Audio)}for(let d=e.length-1;d>=0;d--){let u=e[d],{user:p,mediaType:m}=u,f=fi.Video|fi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);let E=i.get(p);i.set(p,m==="video"?E^f:E^fi.Audio),e.splice(d,1)}}this.store.massSubscribe(e.map(d=>({userId:d.user.uid,type:d.mediaType})),t);let l=ao(a=Array.from(i.entries())).call(a,(d,u)=>{let[p,m]=u;if(m===0)return d;let f={stream_id:p.uid,stream_type:m};return m&fi.Audio&&(f.audio_ssrc=p._audioSSRC),m&fi.Video&&(f.video_ssrc=p._videoSSRC),d.push(f),d},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(u=>{let{user:p,mediaType:m}=u;return{user:p,mediaType:m,ssrcId:m===me.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===me.VIDEO?p._rtxSsrcId:void 0}}));let d=new Map;if(l.length>0){let u=await this._gateway.subscribeAll(l,!0);((u==null?void 0:u.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:f,audio_error_code:E,error_code:I}=p;(f||E||I)&&d.set(m,{video_error_code:f,audio_error_code:E,error_code:I})})}if(Array.from(d.entries()).length>0){let u=[];Array.from(d.entries()).forEach(p=>{let[m,f]=p,E=this.remoteUsers.find(I=>I.uid===m);if(E){let I;f.error_code||f.video_error_code&&f.audio_error_code?I=void 0:f.video_error_code?I=me.VIDEO:f.audio_error_code&&(I=me.AUDIO),u.push({user:E,mediaType:I})}}),u.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u)}for(let u of n){let p=d.get(u.user.uid);if(p){let m=p.error_code||u.mediaType==="audio"&&p.audio_error_code||u.mediaType==="video"&&p.video_error_code;if(m){let f=dc(m);S.error("user:".concat(u.user.uid," mediaType:").concat(u.mediaType," has massSubscribe error ").concat(f.desc)),u.error=new U(A.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(f.desc))}}u.error||(u.mediaType==="video"?u.track=u.user.videoTrack:u.track=u.user.audioTrack)}return this.store.massSubscribe(n.filter(u=>!u.error).map(u=>({userId:u.user.uid,type:u.mediaType})),void 0,Date.now()),n.forEach(u=>{var p;_e.subscribe(this.store.sessionId,{succ:!!u.error,ec:((p=u.error)===null||p===void 0?void 0:p.code)||null,video:u.mediaType===me.VIDEO,audio:u.mediaType===me.AUDIO,peerid:u.user.uid,subscribeRequestid:u.mediaType===me.VIDEO?u.user._videoSSRC:u.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(u=>{let{user:p,mediaType:m}=u;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),n}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(e),d}}finally{o(),r()}}async unsubscribe(e,t,i){if(!(e instanceof ha)){let n=this.remoteUsers.find(o=>o.uid===e);if(!n)throw new U(A.INVALID_REMOTE_USER,"user is not in the channel");e=n}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&li(t,"mediaType",["audio","video"]),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new U(A.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Fr)await this._p2pChannel.unsubscribe(e,t);else{let n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&pm(this._users,e),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(n){if(n.code===A.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&ht(t,"id",0,65535,!0),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===e)){let r=new U(A.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}let i;if(typeof t=="number"){let r=e._dataChannels.find(n=>n.id===t);r&&(i=[r])}else i=e._dataChannels;if(i===void 0){let r=new U(A.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{let r=await this._p2pChannel.unsubscribeDataChannel(e,i);r&&await this._gateway.unsubscribeDataChannel(r,e.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===A.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(ps(e,"unsubscribeList"),!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:r,mediaType:n}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];let t=new Map;for(let i=e.length-1;i>=0;i--){let{user:r,mediaType:n}=e[i];if(!r){let a=new U(A.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(li(n,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===r)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(i,1);continue}let o=fi.Video|fi.LwoVideo;if(t.has(r)){let a=t.get(r),l;switch(n){case"video":l=a&o;break;case"audio":l=a&fi.Audio;break;default:l=a&(fi.Audio|o)}if(l){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(n," twice.")),e.splice(i,1);continue}n?n==="audio"?t.set(r,a|fi.Audio):n==="video"&&t.set(r,a|o):t.set(r,a|fi.Audio|o)}else n?n==="audio"?t.set(r,fi.Audio):n==="video"&&t.set(r,o):t.set(r,fi.Audio|o)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:n,mediaType:o}=r;return"user: ".concat(n==null?void 0:n.uid,", mediaType: ").concat(o,";")}).join()))}catch(i){if(i.code===A.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new B(A.INVALID_PARAMS);Ut(i.width)||PS(i.width,"streamParameter.width"),Ut(i.height)||PS(i.height,"streamParameter.height"),Ut(i.framerate)||PS(i.framerate,"streamParameter.framerate"),Ut(i.bitrate)||ht(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,X.LocalVideoLowTrack)}async enableDualStream(){if(!Ye().supportDualStream)throw _e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new U(A.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new U(A.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw _e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,_e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new U(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(X.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw _e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,_e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){li(i,"role",["audience","host"])}(e),t&&kb(t),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new U(A.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new U(A.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new U(A.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,S.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Ai(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new U(A.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new U(A.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,_e.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new U(A.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new U(A.INVALID_OPERATION,"You have already set the proxy")}if(yl(e))return this._turnServer={servers:e,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>Pb(i)),this._turnServer={servers:e,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new U(A.INVALID_OPERATION,"you should set license before join channel");if(Ai(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new U(A.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,S.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new U(A.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new U(A.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new U(A.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new U(A.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new U(A.INVALID_OPERATION,"Stop proxy server after leave channel");_e.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new U(A.INVALID_PARAMS,"accessPoints is required.");ps(e.accessPoints.serverList,"accessPoints.serverList"),Ai(e.accessPoints.domain,"accessPoints.domain");let t=(f,E)=>{ht(f,E,0,65535,!0)},i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new U(A.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");N("CLOSE_AFB_FOR_LOCAL_AP")&&(pt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),pt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=e.accessPoints.domain,o=e.accessPoints.serverList.map(f=>r.test(f)?"".concat(f.replace(/\./g,"-"),".").concat(n):f),a=o.map(f=>"".concat(f,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,pt("WEBCS_DOMAIN",a),pt("WEBCS_DOMAIN_BACKUP_LIST",a),pt("GATEWAY_DOMAINS",[n]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ps(e.report.hostname,"report.hostname"),pt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),pt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(pt("EVENT_REPORT_DOMAIN",o[0]),pt("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),pt("STATS_COLLECTOR_PORT",l),e.report?pt("ENABLE_EVENT_REPORT",!0):pt("ENABLE_EVENT_REPORT",!1);let d="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ps(e.log.hostname,"log.hostname"),d=e.log.hostname[0]):d=o[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),pt("LOG_UPLOAD_SERVER","".concat(d,":").concat(u));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ps(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=o;let m=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),m=e.cds.port),pt("CDS_AP",p.map(f=>"".concat(f,":").concat(m))),e.cds?pt("ENABLE_CONFIG_DISTRIBUTE",!0):pt("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ps(e,"serverList"),Ai(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new U(A.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>i.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,pt("WEBCS_DOMAIN",e),pt("WEBCS_DOMAIN_BACKUP_LIST",e),pt("GATEWAY_DOMAINS",[t]),pt("EVENT_REPORT_DOMAIN",e[0]),pt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),pt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(li(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){li(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let i=this._users.find(r=>r.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}S.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){li(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw S.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}S.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,r){(function(o){li(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Ai(t,"secret");let n=["aes-128-gcm2","aes-256-gcm2"];if(se(n).call(n,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new U(A.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new U(A.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(hs(r,"encryptDataStream"),!se(n).call(n,e))throw new U(A.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=Xs(i))}async renewToken(e){if(Ai(e,"token",1,2047),!this._key||!this._joinInfo)throw new U(A.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(N("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let r=await Wz(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Xt);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,S.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(He.VOLUME_INDICATOR,e)},N("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new U(A.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new U(A.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new U(A.LIVE_STREAMING_TASK_CONFLICT);let i=t?Ci.TRANSCODE:Ci.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Ci.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new U(A.INVALID_PARAMS,"can not find live streaming url to stop");await ne.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new U(A.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let i=this._createLiveStreamingClient(Ci.INJECT);i.setInjectStreamConfig(t,0),await i.startLiveStreamingTask(e,Ci.INJECT)}async removeInjectStreamUrl(){var e;let t=this._createLiveStreamingClient(Ci.INJECT),i=Array.from(ho(e=t.streamingTasks).call(e)).find(r=>r.mode===Ci.INJECT);if(!this._joinInfo||!i)throw new U(A.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(e){qL(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){qL(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new U(A.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let n=new TextEncoder;e.payload=n.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&se(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(n,o,a){var l;let d=ao(l=Array.from(a)).call(l,(T,R)=>T+R,0),u={serverTs:0,seq:w8++,length:a.length,checkSum:d},p=new Uint8Array(Bb(d,2)),m=new ArrayBuffer(Ol),f=new DataView(m);f.setUint32(0,u.serverTs),f.setUint16(4,u.seq),f.setUint16(6,u.length),f.setUint16(8,u.checkSum);let E=16-a.length%16;a=Ub(a,new Uint8Array(E));let I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:Hb,additionalData:p},o,a);return Ub(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new U(A.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Se.DATA_STREAM,{payload:Xs(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-p7},!i)}sendMetadata(e){if(!this._joinInfo)throw new U(A.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new U(A.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Se.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Xs(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(O8),!this._joinInfo)throw new U(A.INVALID_OPERATION,"can not send custom report, not joined");await _e.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){li(t.spatialLayer,"spatialLayer",[0,1,2,3]),li(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:i}=e;if(hs(t,"apRTM"),ht(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=hr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&G1(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new vi("client-publish"),this._subscribeMutex=new vi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;let r=e||vu();e?S.debug("[".concat(this._clientId,"] new Session ").concat(r)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let n=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;let o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:n,clientRole:this.role==="audience"?2:1};t?_e.sessionInit(this._sessionId,Rn({cname:t.channel,appid:t.appId,preload:t.preload},o)):this._joinInfo?_e.sessionInit(this._sessionId,Rn({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},o)):this._gateway.joinInfo&&_e.sessionInit(this._sessionId,Rn({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new U(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new U(A.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Fr){let r=(await i.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Kt.PUBLISH,r,!0)}catch(n){throw i.throw(n),n}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let r=(await i.next()).value;if(r){var t;let n;try{n=await this._gateway.publish(this._uid,r,!0)}catch(o){if(o.code!==A.DISCONNECT_P2P)throw i.throw(o),o}await i.next(((t=n)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let n of e)n instanceof Et&&n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig),!n.muted&&n.enabled||await this._p2pChannel.muteLocalTrack(n)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===A.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new U(A.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new U(A.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await i.next()).value;if(r){var t;let n;try{n=await this._gateway.publish(this._uid,r,!0)}catch(o){if(o.code!==A.DISCONNECT_P2P)throw i.throw(o),o}i.next(((t=n)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===A.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new U(A.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new B9(this._joinInfo,this._config.websocketRetryConfig||Xt,this._config.httpRetryConfig||Xt),i=r=>{r.onLiveStreamError=(n,o)=>{_e.reportApiInvoke(this._sessionId,{name:ti.ON_LIVE_STREAM_ERROR,options:[n,o],tag:xt.TRACER}).onSuccess(),this.safeEmit(He.LIVE_STREAMING_ERROR,n,o)},r.onLiveStreamWarning=(n,o)=>{_e.reportApiInvoke(this._sessionId,{name:ti.ON_LIVE_STREAM_WARNING,options:[n,o],tag:xt.TRACER}).onSuccess(),this.safeEmit(He.LIVE_STREAMING_WARNING,n,o)},r.on(ym.REQUEST_WORKER_MANAGER_LIST,(n,o,a)=>{if(!this._joinInfo)return a(new U(A.INVALID_OPERATION,"can not find join info to get worker manager"));kN(n,this._joinInfo,this._axiosCancelSource.token,Xt).then(o).catch(a)})};switch(e){case Ci.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Ci.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Ci.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(ym.REQUEST_WORKER_MANAGER_LIST,(r,n,o)=>{if(!this._joinInfo)return o(new U(A.INVALID_OPERATION,"can not find join info to get worker manager"));kN(r,this._joinInfo,this._axiosCancelSource.token,Xt).then(n).catch(o)}),this._injectStreamingClient.onInjectStatusChange=(r,n,o)=>{this.safeEmit(He.INJECT_STREAM_STATUS,r,n,o)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new U(A.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),i={width:e,height:t};this._channelMediaRelayClient=new W9(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Xt,this._config.httpRetryConfig||Xt,i),this._channelMediaRelayClient.on("state",r=>{r===Rr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(He.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.safeEmit(He.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._statsCollector.onStatsChanged=(r,n)=>{var o;r==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(n))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:i,deleted:r}=e,n=[];Array.isArray(i)&&i.length>0&&i.forEach(o=>{let{uid:a,stream_id:l,ordered:d,max_retrans_times:u,metadata:p}=o,m=this._users.find(f=>f._uintid===a);if(!m)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(a)),se(n).call(n,m)||n.push(m),m._uintid||(m._uintid=a),m._dataChannels.findIndex(f=>f.id===o.stream_id)===-1){let f={id:l,ordered:!!d,maxRetransmits:u,metadata:p},E=new g9(f);m._dataChannels.push(E),S.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),t||this.safeEmit(He.USER_PUBLISHED,m,"datachannel",f)}this._p2pChannel.hasPendingRemoteDataChannel(m,o.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,o.stream_id).catch(f=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),f.toString())}))}),t&&(this.safeEmit(He.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(o=>{let{uid:a,stream_id:l}=o,d=this._users.find(p=>p._uintid===a);if(!d)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let u=d._dataChannels.find(p=>p.id===o.stream_id);u&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(a)),this._p2pChannel.unsubscribeDataChannel(d,[u]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==u),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished datachannel ,id:").concat(u.id)),this.safeEmit(He.USER_UNPUBLISHED,d,"datachannel",u._config))})}_handleRemoveDataChannels(e){let t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(He.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),i()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ht.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ht.CONNECTION_STATE_CHANGE,(e,t,i)=>{var r;if(i===We.FALLBACK)return;let n=()=>{this.safeEmit(He.CONNECTION_STATE_CHANGE,e,t,i)};if(_e.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:ti.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:xt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),S.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void n();if(e==="RECONNECTING")this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((a,l)=>{this._gateway.setStreamFallbackOption(l,a).catch(d=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((a,l)=>{this._gateway.setRemoteVideoStreamType(l,a).catch(d=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,me.AUDIO,!1)),a._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,me.VIDEO,!1)),a._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}n()}),this._gateway.on(Ht.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new U(A.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;this._joinInfo.recoverPreloadCache?(i=this._joinInfo.recoverPreloadCache.ap,W1(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):i=await hT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Xt,this.store),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let r=[];i.gatewayInfo.gatewayAddrs.forEach(n=>{let{address:o}=n,[a,l]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:a,port:l}):r.push({host:a,port:l})}),e(r)}catch(i){t(i)}}),this._gateway.on(Ht.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(He.NETWORK_QUALITY,e)}),this._gateway.on(Ht.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(He.STREAM_TYPE_CHANGED,e,t),_e.reportApiInvoke(this._sessionId,{name:ti.STREAM_TYPE_CHANGE,options:[e,t],tag:xt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Ht.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Ht.NEED_RENEW_SESSION,async e=>{if(e==="recover"&&this._joinInfo){let t=await j1(Rn(Rn({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=t,this._startSession(t==null?void 0:t.sid)}else this._startSession()}),this._gateway.on(Ht.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){i(r)}}),this._gateway.on(Ht.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let{dtlsParameters:i,iceParameters:r,candidates:n,rtpCapabilities:o,setup:a,cname:l}=RL(e.ortc,t);this._p2pChannel.connect(r,i,n,o,a,l)}),this._gateway.on(Ht.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Ht.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Ht.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Ht.DATACHANNEL_PRECONNECT,async(e,t,i,r)=>{var n,o,a,l,d,u;await this._p2pChannel.startP2PConnection({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},!0);let p=function(m,f){let E;return f&&f.ip&&typeof f.port=="number"?(E=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:f.ip,port:f.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(f.ip,":").concat(f.port)),f.ip6&&(E.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:f.ip6,port:f.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(f.ip6,":").concat(f.port)))):E=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:m.ip,port:m.port.toString(),type:"host",extension:{}}],E}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((o=this._joinInfo)===null||o===void 0?void 0:o.apResponse.cid,"_").concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(u=N("FINGERPRINT"))!==null&&u!==void 0?u:e.fingerprint}]},p,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(r)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ne.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ne.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ne.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Ne.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ne.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Ne.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Ne.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ne.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ne.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,me.AUDIO,!0)),this._gateway.signal.on(Ne.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,me.AUDIO,!1)),this._gateway.signal.on(Ne.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,me.VIDEO,!0)),this._gateway.signal.on(Ne.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,me.VIDEO,!1)),this._gateway.signal.on(Ne.RECEIVE_METADATA,e=>{let t=sc(e.metadata);this.safeEmit(He.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ne.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=sc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&se(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Ol)throw new U(A.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Ol));i=await async function(n,o,a){let l=a.subarray(0,Ol),d=l.slice(8,Ol),u=(d[0]<<8)+d[1],p=(l[6]<<8)+l[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:Hb,additionalData:new Uint8Array(Bb(u,2))},o,a.subarray(Ol));return new Uint8Array(m).subarray(0,p)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let r=0;if(e.ordered||e.syncWithAudio){let n=this._p2pChannel.getStats(),o=this.remoteUsers.find(l=>l.uid===e.uid),a=n==null?void 0:n.audioRecv.find(l=>l.ssrc===(o==null?void 0:o._audioSSRC));r=a==null?void 0:a.jitterBufferMs}r==null&&(r=0),_7(Rn(Rn({},e),{},{payload:i}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ne.ON_CRYPT_ERROR,()=>{Js(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(He.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,We.TOKEN_EXPIRE),this.safeEmit(He.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ne.ON_STREAM_FALLBACK_UPDATE,e=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(He.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ne.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ne.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ne.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Se.PUBLISH:{if(!t)return;let n=t.ortc;if(n){var i,r;let o=n.some(d=>{let{stream_type:u}=d;return u===st.Audio}),a=n.some(d=>{let{stream_type:u}=d;return u!==st.Audio}),l=n.some(d=>{let{stream_type:u}=d;return u===st.Screen||u===st.ScreenLow});t.state==="offer"&&_e.publish(this._joinInfo.sid,{eventElapse:Gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:A.TIMEOUT,audio:o,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:o?(i=n.find(d=>{let{stream_type:u}=d;return u===st.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:a?(r=n.find(d=>{let{stream_type:u}=d;return u!==st.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Se.SUBSCRIBE:t&&_e.subscribe(this._joinInfo.sid,{succ:!1,ec:A.TIMEOUT,audio:t.stream_type===me.AUDIO,video:t.stream_type===me.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Gi.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Ne.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ne.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;N("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!cc(r.string_id||r.stream_id,this.channelName)));let t=[],i=[];for(let r of e.users){let n=this._users.find(p=>p._uintid===r.stream_id);n?n._trust_in_room_=!0:(n=new ha(r.string_id||r.stream_id,r.stream_id),this._users.push(n),this.getListeners(He.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(He.USER_JOINED,n)));let o=fi.Audio&r.stream_type,a=(fi.Video|fi.LwoVideo)&r.stream_type,l=(65280&r.stream_type)!=0,d=o&&n.hasAudio,u=a&&n.hasVideo;a&&(n._trust_video_stream_added_state_=!0,n._video_added_=!0,n._videoSSRC=r.video_ssrc,n._rtxSsrcId=r.video_rtx),o&&(n._trust_audio_stream_added_state_=!0,n._audio_added_=!0,n._audioSSRC=r.audio_ssrc),o&&!d&&this.getListeners(He.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published audio")),this.safeEmit(He.USER_PUBLISHED,n,"audio")),a&&!u&&this.getListeners(He.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published video")),this.safeEmit(He.USER_PUBLISHED,n,"video")),(o&&!d||a&&!u||l)&&t.push(n),a&&this._p2pChannel.hasPendingRemoteMedia(n,"video")&&i.push({user:n,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(n,"audio")&&i.push({user:n,mediaType:"audio"})}i.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(r=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(He.PUBLISHED_USER_LIST).length>0?N("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(He.PUBLISHED_USER_LIST,t)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Ne.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof y_&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var r;return se(r=Object.keys(Al)).call(r,i)}))})}_handleP2PEvents(){this._gateway.signal.on(Ne.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Kt.PUBLISH,(e,t,i)=>{let{uid:r}=e;e.forEach(n=>{let{kind:o,ssrcs:a,mid:l,isMuted:d}=n;this._handleP2PAddAudioOrVideoStream(o,r,a[0].ssrcId,l);let u=this._users.find(p=>p.uid===r);return u&&this._p2pChannel instanceof Fr?this._p2pChannel.mockSubscribe(u,o,a[0].ssrcId,l).then(()=>{t()}).catch(i):t(),this._handleMuteStream(r,o,!!d)})}),this._gateway.signal.on(Kt.CALL,async(e,t,i)=>{if(this._p2pChannel instanceof Fr)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(n){i(n)}}),this._gateway.signal.on(de.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Fr&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(Kt.UNPUBLISH,async(e,t,i)=>{if(this._p2pChannel instanceof Fr){let{unpubMsg:r,uid:n}=e,o=this._users.find(a=>a.uid===n);if(!o)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n)),void t();try{r.forEach(async a=>{let{stream_type:l}=a,d=l===st.Audio?me.AUDIO:me.VIDEO;await this._p2pChannel.unsubscribe(o,d),this._handleMuteStream(n,d,!0)}),t()}catch(a){i(a)}}}),this._gateway.signal.on(Kt.CONTROL,async(e,t)=>{let{action:i}=e;switch(i){case ea.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,me.VIDEO,!0);break;case ea.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,me.AUDIO,!0);break;case ea.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,me.VIDEO,!1);break;case ea.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,me.AUDIO,!1)}}),this._gateway.signal.on(Kt.RESTART_ICE,async(e,t,i)=>{if(this._p2pChannel instanceof Fr)try{let{direction:r,iceParameter:n}=e;r!==nr.SEND_ONLY||n?t(await this._p2pChannel.restartICE(r,n)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){i(r)}}),this._gateway.signal.on(Kt.CANDIDATE,e=>{if(this._p2pChannel instanceof Fr){let{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(Ie.RequestP2PRestartICE,async(e,t,i)=>{try{let{direction:r}=e;t(await this._gateway.sendExtensionMessage(Kt.RESTART_ICE,e,r===nr.SEND_ONLY))}catch(r){i(r)}}),this._p2pChannel.on(Ie.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Kt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ie.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage(Kt.CONTROL,e,!0),t()}catch(r){i(r)}}),this._p2pChannel.on(Ie.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Ie.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Ie.StateChange,(e,t)=>{t===at.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ie.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Ie.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===A.DISCONNECT_P2P?t():i(r)}else t()}),this._p2pChannel.on(Ie.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(Ie.RequestRePublishDataChannel,(e,t,i)=>{ne.all(e.map(async r=>{await this._p2pChannel.publishDataChannel([r]);let n={streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,n,!0)}catch(o){if(o.code!==A.DISCONNECT_P2P)throw o}})).then(t).catch(i)}),this._p2pChannel.on(Ie.RequestReSubscribe,async(e,t,i)=>{try{for(let{user:r,kind:n}of e)n===me.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){i(r)}}),this._p2pChannel.on(Ie.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ie.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ie.MediaReconnectStart,e=>{this.safeEmit(He.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ie.MediaReconnectEnd,e=>{this.safeEmit(He.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ie.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ie.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Fr)return;let t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;let r=i.value,n;try{n=await this._gateway.restartICE({iceParameters:r})}catch(a){return void t.throw(a)}let{iceParameters:o}=function(a){let l=a.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(n);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(Ie.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ie.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:i,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:n,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:r}),{dtlsParameters:a,iceParameters:l,candidates:d,rtpCapabilities:u,setup:p,cname:m}=RL(n,o);await this._p2pChannel.connect(l,a,d,u,p,m),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ie.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(Ie.P2PLost,()=>{this.safeEmit(He.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ie.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ie.ConnectionTypeChange,e=>{this.safeEmit(He.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ie.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ie.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{let t=[...new Set(e.inspectType)];t.forEach(i=>{var r;if(!se(r=["supervise","moderation"]).call(r,i))throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{let t=new I_(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Xt)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(hs(e,"enabled"),e){if(!t)throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(ht(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new U(A.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);let i=new Vv(t);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Xt)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new U(A.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}setP2PTransport(e){if(function(t){li(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new U(A.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(po.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(He.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===fn.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new U(A.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(po.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(yi.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(He.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===xn.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(He.CONTENT_INSPECT_ERROR,new U(A.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(yi.INSPECT_RESULT,(t,i)=>{var r;if((i==null?void 0:i.code)===A.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(He.CONTENT_INSPECT_RESULT,t,i)}),e.on(yi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){hs(e,"enabled"),pt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ie(ae.prototype,"leave",[z1],Object.getOwnPropertyDescriptor(ae.prototype,"leave"),ae.prototype),ie(ae.prototype,"publish",[Y1],Object.getOwnPropertyDescriptor(ae.prototype,"publish"),ae.prototype),ie(ae.prototype,"unpublish",[q1],Object.getOwnPropertyDescriptor(ae.prototype,"unpublish"),ae.prototype),ie(ae.prototype,"subscribe",[J1],Object.getOwnPropertyDescriptor(ae.prototype,"subscribe"),ae.prototype),ie(ae.prototype,"presubscribe",[X1],Object.getOwnPropertyDescriptor(ae.prototype,"presubscribe"),ae.prototype),ie(ae.prototype,"massSubscribe",[Q1],Object.getOwnPropertyDescriptor(ae.prototype,"massSubscribe"),ae.prototype),ie(ae.prototype,"unsubscribe",[Z1],Object.getOwnPropertyDescriptor(ae.prototype,"unsubscribe"),ae.prototype),ie(ae.prototype,"massUnsubscribe",[$1],Object.getOwnPropertyDescriptor(ae.prototype,"massUnsubscribe"),ae.prototype),ie(ae.prototype,"setLowStreamParameter",[eM],Object.getOwnPropertyDescriptor(ae.prototype,"setLowStreamParameter"),ae.prototype),ie(ae.prototype,"enableDualStream",[tM],Object.getOwnPropertyDescriptor(ae.prototype,"enableDualStream"),ae.prototype),ie(ae.prototype,"disableDualStream",[iM],Object.getOwnPropertyDescriptor(ae.prototype,"disableDualStream"),ae.prototype),ie(ae.prototype,"setClientRole",[rM],Object.getOwnPropertyDescriptor(ae.prototype,"setClientRole"),ae.prototype),ie(ae.prototype,"setProxyServer",[nM],Object.getOwnPropertyDescriptor(ae.prototype,"setProxyServer"),ae.prototype),ie(ae.prototype,"setTurnServer",[oM],Object.getOwnPropertyDescriptor(ae.prototype,"setTurnServer"),ae.prototype),ie(ae.prototype,"setLicense",[sM],Object.getOwnPropertyDescriptor(ae.prototype,"setLicense"),ae.prototype),ie(ae.prototype,"startProxyServer",[aM],Object.getOwnPropertyDescriptor(ae.prototype,"startProxyServer"),ae.prototype),ie(ae.prototype,"stopProxyServer",[cM],Object.getOwnPropertyDescriptor(ae.prototype,"stopProxyServer"),ae.prototype),ie(ae.prototype,"setLocalAccessPointsV2",[lM],Object.getOwnPropertyDescriptor(ae.prototype,"setLocalAccessPointsV2"),ae.prototype),ie(ae.prototype,"setLocalAccessPoints",[dM],Object.getOwnPropertyDescriptor(ae.prototype,"setLocalAccessPoints"),ae.prototype),ie(ae.prototype,"setRemoteDefaultVideoStreamType",[uM],Object.getOwnPropertyDescriptor(ae.prototype,"setRemoteDefaultVideoStreamType"),ae.prototype),ie(ae.prototype,"setRemoteVideoStreamType",[hM],Object.getOwnPropertyDescriptor(ae.prototype,"setRemoteVideoStreamType"),ae.prototype),ie(ae.prototype,"setStreamFallbackOption",[pM],Object.getOwnPropertyDescriptor(ae.prototype,"setStreamFallbackOption"),ae.prototype),ie(ae.prototype,"setEncryptionConfig",[mM],Object.getOwnPropertyDescriptor(ae.prototype,"setEncryptionConfig"),ae.prototype),ie(ae.prototype,"renewToken",[_M],Object.getOwnPropertyDescriptor(ae.prototype,"renewToken"),ae.prototype),ie(ae.prototype,"enableAudioVolumeIndicator",[fM],Object.getOwnPropertyDescriptor(ae.prototype,"enableAudioVolumeIndicator"),ae.prototype),ie(ae.prototype,"startLiveStreaming",[EM],Object.getOwnPropertyDescriptor(ae.prototype,"startLiveStreaming"),ae.prototype),ie(ae.prototype,"setLiveTranscoding",[gM],Object.getOwnPropertyDescriptor(ae.prototype,"setLiveTranscoding"),ae.prototype),ie(ae.prototype,"stopLiveStreaming",[SM],Object.getOwnPropertyDescriptor(ae.prototype,"stopLiveStreaming"),ae.prototype),ie(ae.prototype,"addInjectStreamUrl",[TM],Object.getOwnPropertyDescriptor(ae.prototype,"addInjectStreamUrl"),ae.prototype),ie(ae.prototype,"removeInjectStreamUrl",[vM],Object.getOwnPropertyDescriptor(ae.prototype,"removeInjectStreamUrl"),ae.prototype),ie(ae.prototype,"startChannelMediaRelay",[RM],Object.getOwnPropertyDescriptor(ae.prototype,"startChannelMediaRelay"),ae.prototype),ie(ae.prototype,"updateChannelMediaRelay",[CM],Object.getOwnPropertyDescriptor(ae.prototype,"updateChannelMediaRelay"),ae.prototype),ie(ae.prototype,"stopChannelMediaRelay",[yM],Object.getOwnPropertyDescriptor(ae.prototype,"stopChannelMediaRelay"),ae.prototype),ie(ae.prototype,"sendCustomReportMessage",[IM],Object.getOwnPropertyDescriptor(ae.prototype,"sendCustomReportMessage"),ae.prototype),ie(ae.prototype,"pickSVCLayer",[wM],Object.getOwnPropertyDescriptor(ae.prototype,"pickSVCLayer"),ae.prototype),ie(ae.prototype,"setRTMConfig",[AM],Object.getOwnPropertyDescriptor(ae.prototype,"setRTMConfig"),ae.prototype),ie(ae.prototype,"enableContentInspect",[OM],Object.getOwnPropertyDescriptor(ae.prototype,"enableContentInspect"),ae.prototype),ie(ae.prototype,"disableContentInspect",[bM],Object.getOwnPropertyDescriptor(ae.prototype,"disableContentInspect"),ae.prototype),ie(ae.prototype,"setImageModeration",[NM],Object.getOwnPropertyDescriptor(ae.prototype,"setImageModeration"),ae.prototype),ie(ae.prototype,"setP2PTransport",[DM],Object.getOwnPropertyDescriptor(ae.prototype,"setP2PTransport"),ae.prototype),ie(ae.prototype,"getJoinChannelServiceRecords",[PM],Object.getOwnPropertyDescriptor(ae.prototype,"getJoinChannelServiceRecords"),ae.prototype),ie(ae.prototype,"setPublishAudioFilterEnabled",[kM],Object.getOwnPropertyDescriptor(ae.prototype,"setPublishAudioFilterEnabled"),ae.prototype),ae);class dh{constructor(t,i){y(this,"id",0),y(this,"element",void 0),y(this,"peerPair",void 0),y(this,"context",void 0),y(this,"audioPlayerElement",void 0),y(this,"audioTrack",void 0),dh.count+=1,this.id=dh.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let t=async(r,n)=>{let o=n==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(o),r.iceGatheringState==="complete"?r.localDescription:new ne(a=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&a(r.localDescription)}})},i=async(r,n)=>await r.setRemoteDescription(n);try{let r=await t(this.peerPair[0],"offer");await i(this.peerPair[1],r);let n=await t(this.peerPair[1],"answer");await i(this.peerPair[0],n)}catch(r){throw new U(A.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(n){throw new U(A.LOCAL_AEC_ERROR,n.toString()).print()}if(!i)throw new U(A.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=i.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var MM,D_;y(dh,"count",0);let v7=window.AudioContext||window.webkitAudioContext,R7=new(MM=ye({report:_e}),ie((D_=class{constructor(){y(this,"units",[]),y(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new v7);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new dh(e,this.context),this.units.push(t)),t.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Xe().name!==ot.SAFARI}}).prototype,"processExternalMediaAEC",[MM],Object.getOwnPropertyDescriptor(D_.prototype,"processExternalMediaAEC"),D_.prototype),D_);function UM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function xM(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UM(Object(i),!0).forEach(function(r){y(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}let Kv=window||document;function VM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Kv)return;let i=ni._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);let r=n=>{if(!(n&&n.blockedURI&&(ni.onSecurityPolicyViolation||ni.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0)))return;let o=n.blockedURI;N("CSP_DETECTED_HOSTNAME_LIST").some(a=>se(o).call(o,a))&&(ni.onSecurityPolicyViolation&&typeof ni.onSecurityPolicyViolation=="function"&&ni.onSecurityPolicyViolation(n),ni.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0&&ni.safeEmit(Wo.SECURITY_POLICY_VIOLATION,n))};i&&Kv.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||ni.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0)&&Kv.addEventListener("securitypolicyviolation",r),ni._cspEventHandlerPointer=r}pt("PROCESS_ID","process-".concat(ft(8,""),"-").concat(ft(4,""),"-").concat(ft(4,""),"-").concat(ft(4,""),"-").concat(ft(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();S.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(si,r)){let{value:n,expires:o}=t[r];if(o&&o<=i)return;Qs[r]=n,si[r]=n}})}catch(t){S.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Qs.AREAS)&&Qs.AREAS.length>0&&sT(Qs.AREAS,!0);let FM=(e,t,i)=>{S.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),pt(e,t,i)},ni=function(e){let t=new Ot,i=e,r={getListeners:t.getListeners.bind(t),on:(n,o)=>(function(a,l){a===Wo.SECURITY_POLICY_VIOLATION&&VM(l,!0)}(n,o),t.on.bind(t)(n,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return xM(xM({},i),r)}({__TRACK_LIST__:ql,VERSION:mn,BUILD:WS,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:FM,getParameter:N,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,i=await async function(r){let n;return Ye().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),n=(await r.createOffer()).sdp):n=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,n}(t);if(!i)return e;t.close(),t=null,e=function(r){let n={video:[],audio:[]};return r.match(/ VP8/i)&&n.video.push("VP8"),r.match(/ VP9/i)&&n.video.push("VP9"),r.match(/ AV1/i)&&n.video.push("AV1"),r.match(/ H264/i)&&n.video.push("H264"),r.match(/ H265/i)&&n.video.push("H265"),r.match(/ opus/i)&&n.audio.push("OPUS"),r.match(/ PCMU/i)&&n.audio.push("PCMU"),r.match(/ PCMA/i)&&n.audio.push("PCMA"),r.match(/ G722/i)&&n.audio.push("G722"),n}(i)}catch(t){throw new U(A.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=_e.reportApiInvoke(null,{name:ti.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xt.TRACER}),t=!1;try{let o=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(o&&a&&l),t&&DS()&&function(d){let u=Xe();return!(u.name!==ot.CHROME||!u.osVersion)&&Number(u.version)<d}(75)&&new o().close()}catch(o){return S.error("check system requirement failed: ",o),!1}let i=!1,r=Xe();r.name===ot.CHROME&&Number(r.version)>=58&&(lo.engine.name!=="WebKit"||function(){let o=Xe();if(um()){if(o.os===pi.MAC_OS)return!0;if(o.os===pi.IOS){let a=lo.os.version&&lo.os.version.split(".");if(a&&Number(a[0])===14&&a[1]&&Number(a[1])>=3||a&&Number(a[0])>14)return!0}}return!1}())&&(i=!0),(r.name===ot.FIREFOX&&Number(r.version)>=56||r.name===ot.OPERA&&Number(r.version)>=45||r.name===ot.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ji()||Mn())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||Rb()||Xe().name===ot.QQ)&&(i=!0),S.debug("checkSystemRequirements, api:",t,"browser",i);let n=t&&i;return e.onSuccess(n),n},getDevices:function(e){return tn.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return tn.getRecordingDevices(e)},getCameras:function(e){return tn.getCamerasDevices(e)},getElectronScreenSources:hP,getPlaybackDevices:function(e){return tn.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=_e.reportApiInvoke(null,{name:ti.CREATE_CLIENT,options:[t],tag:xt.TRACER});try{(function(r){li(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),li(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&li(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ai(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&Pb(r.turnServer),r.httpRetryConfig!==void 0&&Db(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&Db(r.websocketRetryConfig)})(t)}catch(r){throw i.onError(r),r}return(fb(16,0)||Eb(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",S.debug("browser not support vp9, force use vp8")),pt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new T7(Rn(Rn({forceWaitGatewayResponse:!0},t),{},{role:se(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=N("CAMERA_CAPTURE_CONFIG"),i=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_CAM_VIDEO_TRACK,options:[bt({},e),t]});t&&(e.encoderConfig=t);let r=r_(e),n=ft(8,"track-cam-"),o=null,a=e.encoderConfig==="720p_auto";S.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await en({video:r},n)).getVideoTracks()[0]||null}catch(d){throw i.onError(d),d}if(!o){let d=new B(A.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(d),d.throw(S)}e.optimizationMode&&mv(n,o,e,Jo(e.encoderConfig));let l=new pv(o,e,r,e.scalabiltyMode?$m(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return a&&l.startMonitorStats(),i.onSuccess(l.getTrackId()),S.info("create camera video success, trackId:",n),l},createCustomVideoTrack:function(e){let t=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new Et(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?$m(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ft(8,"track-cus-"),[Rt.CUSTOM_TRACK]);return t.onSuccess(i.getTrackId()),S.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_SCREEN_VIDEO_TRACK,options:[bt({},e),t]}),r=e.encoderConfig==="720p_auto";e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let n=function(m){let f={};m.screenSourceType&&(f.mediaSource=m.screenSourceType),m.extensionId&&Ys()&&(f.extensionId=m.extensionId);let{displaySurface:E,selfBrowserSurface:I,surfaceSwitching:T,systemAudio:R}=m;(bS(107)||mb(107)||gb(93))&&(E&&(li(E,"displaySurface",["browser","window","monitor"]),f.displaySurface=E),I?(li(I,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=I):f.selfBrowserSurface="include",T&&(li(T,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=T)),(bS(105)||mb(105)||gb(91))&&R&&(li(R,"systemAudio",["exclude","include"]),f.systemAudio=R),m.electronScreenSourceId&&(f.sourceId=m.electronScreenSourceId);let w=m.encoderConfig?iv(m.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:w?w.width:void 0,maxHeight:w?w.height:void 0},w&&(w.frameRate&&(typeof w.frameRate=="number"?(f.mandatory.maxFrameRate=w.frameRate,f.mandatory.minFrameRate=w.frameRate):(f.mandatory.maxFrameRate=w.frameRate.max||w.frameRate.ideal||w.frameRate.exact||void 0,f.mandatory.minFrameRate=w.frameRate.min||w.frameRate.ideal||w.frameRate.exact||void 0),f.frameRate=w.frameRate),w.width&&(f.width=w.width),w.height&&(f.height=w.height)),f}(e),o=ft(8,"track-scr-v-"),a=null,l=null,d=Ye();if(!d.supportShareAudio&&t==="enable"){let m=new B(A.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(m),m.throw(S)}S.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{let m=await en({screen:n,screenAudio:t==="auto"?d.supportShareAudio:t==="enable"},o);a=m.getVideoTracks()[0]||null,l=m.getAudioTracks()[0]||null}catch(m){throw i.onError(m),m}if(!a){let m=new B(A.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(m),m.throw(S)}if(!l&&t==="enable"){a&&a.stop();let m=new B(A.SHARE_AUDIO_NOT_ALLOWED);return i.onError(m),m.throw(S)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(mv(o,a,e,e.encoderConfig&&iv(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let u=new Et(a,e.encoderConfig?iv(e.encoderConfig):{},e.scalabiltyMode?$m(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Rt.SCREEN_TRACK]);if(r&&u.startMonitorStats(),!l)return i.onSuccess(u.getTrackId()),S.info("create screen video track success","video:",u.getTrackId()),u;let p=new jt(l,void 0,ft(8,"track-scr-a-"),!1);return i.onSuccess([u.getTrackId(),p.getTrackId()]),S.info("create screen video track success","video:",u.getTrackId(),"audio:",p.getTrackId()),[u,p]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=N("CAMERA_CAPTURE_CONFIG"),r=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);let n=t.encoderConfig==="720p_auto",o=r_(t),a=RP(e),l=ft(8,"track-mic-"),d=ft(8,"track-cam-"),u=null,p=null;S.info("start create camera video track(".concat(d,") and microphone audio track(").concat(l,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let E=await en({audio:a,video:o},"".concat(l,"-").concat(d));u=E.getAudioTracks()[0],p=E.getVideoTracks()[0]}catch(E){throw r.onError(E),E}if(!u||!p){let E=new B(A.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(E),E.throw(S)}t.optimizationMode&&mv(d,p,t,Jo(t.encoderConfig));let m=new n_(u,e,a,l),f=new pv(p,t,o,t.scalabiltyMode?$m(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,d);return n&&f.startMonitorStats(),r.onSuccess([m.getTrackId(),f.getTrackId()]),S.info("create camera video track(".concat(d,") and microphone audio track(").concat(l,") success")),[m,f]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=RP(e),r=ft(8,"track-mic-"),n=null;S.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{n=(await en({audio:i},r)).getAudioTracks()[0]||null}catch(a){throw t.onError(a),a}if(!n){let a=new B(A.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(a),a.throw(S)}let o=new n_(n,e,i,r);return t.onSuccess(o.getTrackId()),S.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){let t=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new jt(e.mediaStreamTrack,e.encoderConfig?e_(e.encoderConfig):{},ft(8,"track-cus-"),!1);return S.info("create custom audio track success with config",e,"trackId",i.getTrackId()),t.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:i,encoderConfig:r}=e,{source:n}=e,o={source:n instanceof AudioBuffer?"AudioBuffer":n instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":n,cacheOnlineFile:i,encoderConfig:r},a=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(N("DISABLE_WEBAUDIO"))throw new B(A.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let l=ft(8,"track-buf-");S.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",l);let d=n;if(!(n instanceof AudioBuffer))try{n=await async function(m,f){let E=null;if(typeof m=="string"){let T=ck.get(m);if(T)return S.debug("use cached audio resource: ",m),T;try{E=(await uo(()=>hr.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(R){throw new B(A.FETCH_AUDIO_FILE_FAILED,R.toString())}}else E=await new ne((T,R)=>{let w=new FileReader;w.onload=O=>{O.target?T(O.target.result):R(new B(A.READ_LOCAL_AUDIO_FILE_ERROR))},w.onerror=()=>{R(new B(A.READ_LOCAL_AUDIO_FILE_ERROR))},w.readAsArrayBuffer(m)});let I=await function(T){let R=$l();return new ne((w,O)=>{R.decodeAudioData(T,P=>{w(P)},P=>{O(new B(A.DECODE_AUDIO_FILE_FAILED,P.toString()))})})}(E);return typeof m=="string"&&f&&ck.set(m,I),I}(n,i)}catch(m){return a.onError(m),m.throw(S)}let u=new f9(n),p=new _9(d,u,r?e_(r):{},l);return S.info("create buffer source audio track success, trackId:",l),a.onSuccess(p.getTrackId()),p},setAppType:function(e){if(S.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw S.debug("Invalid appType"),new U(A.INVALID_PARAMS,"invalid app type",e);pt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){S.setLogLevel(e)},enableLogUpload:function(){N("USE_NEW_LOG")?pt("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){N("USE_NEW_LOG")?pt("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new YL},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof jt||e instanceof id)){let d=new U(A.INVALID_TRACK,"the parameter is not a audio track");return i.onError(d),d.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof jt?e.getTrackLabel():"remote_track",n=e.getVolumeLevel(),o=n,a=n,l=Date.now();return new ne(d=>{let u=setInterval(()=>{let p=e.getVolumeLevel();o=p>o?p:o,a=p<a?p:a;let m=o-a>1e-4,f=Date.now()-l;if(m||f>t){clearInterval(u);let E=m,I={duration:f,deviceLabel:r,maxVolumeLevel:o,result:E};S.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),i.onSuccess(I),d(E)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=_e.reportApiInvoke(null,{tag:xt.TRACER,name:ti.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Et||e instanceof td)){let m=new U(A.INVALID_TRACK,"the parameter is not a video track");return i.onError(m),m.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof Et?e.getTrackLabel():"remote_track",n=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(mi()||um())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([n]),o.play();let a=document.createElement("canvas");a.width=160,a.height=120;let l=0,d=0;try{let m=Date.now();l=await function(f,E,I,T){let R,w=0,O=null;return new ne((P,M)=>{function V(){w>T&&R&&(R(),P(w));let F=I.getContext("2d");if(!F){let Z=new U(A.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(Z.toString()),void M(Z)}F.drawImage(f,0,0,160,120);let q=F.getImageData(0,0,I.width,I.height),J=Math.floor(q.data.length/3);if(O){for(let Z=0;Z<J;Z+=3)if(q.data[Z]!==O[Z])return w+=1,void(O=q.data);O=q.data}else O=q.data}setTimeout(()=>{R&&(R(),P(w))},E),R=av(()=>{V()},30)})}(o,t,a,4),d=Date.now()-m}catch(m){throw i.onError(m),m}f7===ot.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let u=l>4,p={duration:d,changedPicNum:l,deviceLabel:r,result:u};return S.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),i.onSuccess(p),u},setArea:sT,audioElementPlayCenter:mr,resumeAudioContext:function(){mr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){R7.processExternalMediaAEC(e)},registerExtensions:function(e){let t=N("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!se(t).call(t,i.name)&&t.push(i.name);let r=i;r.__registered__=!0,r.logger.hookLog=S.extLog,r.reporter.hookApiInvoke=_e.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(n=>{r.parameters[n]=N(n)})}),FM("PLUGIN_INFO",t)},ChannelMediaRelayError:Nl,ChannelMediaRelayEvent:ms,ChannelMediaRelayState:Rr,RemoteStreamFallbackType:c9,RemoteStreamType:a9,ConnectionDisconnectedReason:We,AudienceLatencyLevelType:T8,AREAS:tt,preload:async function(e,t,i,r){return F1(e,t,i,r)}});return Object.defineProperties(ni,{onAudioAutoplayFailed:{get:()=>rn.onAudioAutoplayFailed,set:e=>{rn.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>rn.onAutoplayFailed,set:e=>{rn.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ni._onSecurityPolicyViolation,set(e){ni._onSecurityPolicyViolation=e,VM(e)}},__CLIENT_LIST__:{get:()=>N("SHOW_GLOBAL_CLIENT_LIST")?Zs:[]}}),tn.on(vc.CAMERA_DEVICE_CHANGED,e=>{S.info("camera device changed",JSON.stringify(e)),ni.onCameraChanged&&ni.onCameraChanged(e),ni.safeEmit(Wo.CAMERA_CHANGED,e)}),tn.on(vc.RECORDING_DEVICE_CHANGED,e=>{S.info("microphone device changed",JSON.stringify(e)),ni.onMicrophoneChanged&&ni.onMicrophoneChanged(e),ni.safeEmit(Wo.MICROPHONE_CHANGED,e)}),tn.on(vc.PLAYOUT_DEVICE_CHANGED,e=>{S.debug("playout device changed",JSON.stringify(e)),ni.onPlaybackDeviceChanged&&ni.onPlaybackDeviceChanged(e),ni.safeEmit(Wo.PLAYBACK_DEVICE_CHANGED,e)}),mr.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),rn.onAudioAutoplayFailed&&rn.onAudioAutoplayFailed()},ut.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),rn.onAudioAutoplayFailed&&rn.onAudioAutoplayFailed(),ni.safeEmit(Wo.AUTOPLAY_FAILED)}),ut.on(Oi.STATE_CHANGE,(e,t)=>{S.info("audio context state changed: ".concat(t," => ").concat(e)),ni.onAudioContextStateChanged&&ni.onAudioContextStateChanged(e,t),ni.safeEmit(Wo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Vt.on(rc.NETWORK_STATE_CHANGE,(e,t)=>{S.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=ni),ni})}),hV={};oQ(hV,{AgoraRTCProvider:()=>_V,AgoraRTCReactError:()=>Wr,AgoraRTCScreenShareProvider:()=>fQ,LocalAudioTrack:()=>RV,LocalUser:()=>AV,LocalVideoTrack:()=>IV,RemoteAudioTrack:()=>OV,RemoteUser:()=>NV,RemoteVideoTrack:()=>bV,TrackBoundary:()=>NQ,VERSION:()=>MQ,default:()=>DV,useAutoPlayAudioTrack:()=>dy,useAutoPlayVideoTrack:()=>ly,useClientEvent:()=>pQ,useConnectionState:()=>gQ,useCurrentUID:()=>SQ,useIsConnected:()=>cs,useJoin:()=>EV,useLocalCameraTrack:()=>TV,useLocalMicrophoneTrack:()=>SV,useLocalScreenTrack:()=>OQ,useNetworkQuality:()=>TQ,usePublish:()=>gV,useRTCClient:()=>Do,useRTCScreenShareClient:()=>EQ,useRemoteAudioTracks:()=>IQ,useRemoteUserTrack:()=>uC,useRemoteUsers:()=>vV,useRemoteVideoTracks:()=>wQ,useTrackEvent:()=>mQ,useVolumeLevel:()=>RQ});var aQ=Kc(zc());function Pr(s,c,h){return s.on(c,h),()=>s.off(c,h)}function cQ(s){try{return s()}catch(c){console.error(c)}}function Yc(s){return()=>s.forEach(cQ)}function lQ(s,c){let h=setInterval(s,c);return()=>clearInterval(h)}function Zf(s,c){let h=setTimeout(s,c);return()=>clearTimeout(h)}function ay(){let s,c,h;function _(){if(c){let W=c;c=void 0,W()}}async function g(){if(h){let W=h;h=void 0;try{await W()}catch($){console.error($)}}}async function v(W){s=!0,await g();try{h=await W()}catch($){console.error($)}s=!1,_()}async function b(){s=!0,await g(),s=!1,_()}function L(W){s?c=()=>v(W):v(W)}function x(){s?c=b:b()}return{run:L,dispose:x}}var $f=typeof document<"u"?we.useLayoutEffect:we.useEffect;function dQ(s){return s!=null&&typeof s.then=="function"}function Wa(){let s=we.useRef(!1);return we.useEffect(()=>(s.current=!1,()=>{s.current=!0}),[]),s}function uQ(){let s=Wa();function c(h,_){return new Promise(async(g,v)=>{try{let b=await h;s.current||g(b)}catch(b){s.current?_&&_(b):v(b)}})}return we.useCallback(c,[s])}function pV(s){let c=uQ(),[h,_]=we.useState();return $f(()=>{dQ(s)?c(s).then(_):_(s)},[s,c]),h}function qc(s,c){let h=we.useRef();we.useEffect(()=>{let{run:_,dispose:g}=h.current||(h.current=ay());return _(s),g},c)}function hQ(s,c){let h=s.split("."),_=c.split("."),g=Math.max(h.length,_.length);for(let v=0;v<g;v++){let b=parseInt(h[v]||"0"),L=parseInt(_[v]||"0");if(b>L)return 1;if(b<L)return-1}return 0}function pQ(s,c,h){let _=we.useRef(h);$f(()=>{_.current=h},[h]),we.useEffect(()=>{if(s)return Pr(s,c,(...g)=>{_.current&&_.current(...g)})},[c,s])}function mQ(s,c,h){let _=we.useRef(h);$f(()=>{_.current=h},[h]),we.useEffect(()=>{if(s)return Pr(s,c,(...g)=>{_.current&&_.current(...g)})},[c,s])}var mV=we.createContext(null);function _V({client:s,children:c}){return $e.jsx(mV.Provider,{value:s,children:c})}function _Q(s){let c=we.useContext(mV);return s||c}function Do(s){let c=_Q(s);if(!c)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return c}var fV=we.createContext(null);function fQ({client:s,children:c}){return $e.jsx(fV.Provider,{value:s,children:c})}function EQ(s){let c=we.useContext(fV);return s||c}function gQ(s){let c=Do(s),[h,_]=we.useState(c?c.connectionState:"DISCONNECTED");return we.useEffect(()=>{if(c){_(c.connectionState);let g;return Yc([Pr(c,"connection-state-change",v=>{g==null||g(),v==="CONNECTED"?g=Zf(()=>_(v),0):_(v)}),()=>g==null?void 0:g()])}else _("DISCONNECTED")},[c]),h}function cs(s){let c=Do(s),[h,_]=we.useState(c?c.connectionState==="CONNECTED":!1);return we.useEffect(()=>{if(c){_(c.connectionState==="CONNECTED");let g;return Yc([Pr(c,"connection-state-change",v=>{g==null||g(),g=Zf(()=>_(v==="CONNECTED"),0)}),()=>g==null?void 0:g()])}else _(!1)},[c]),h}function SQ(s){let c=Do(s),[h,_]=we.useState(c==null?void 0:c.uid);return we.useEffect(()=>{if(c)return Pr(c,"connection-state-change",g=>{if(g==="CONNECTED")return Zf(()=>_(c.uid),0);g==="DISCONNECTED"&&_(void 0)})},[c]),h}var Wr=class extends Error{constructor(c,h){var s=(...args)=>{super(...args);uh(this,"rtcMethod");uh(this,"rtcError");uh(this,"name","AgoraRTCReactException")};s(typeof h=="string"?h:h.message),this.rtcMethod=c,this.rtcError=h}log(c){console[c](this)}};function EV(s,c=!0,h){let _=Do(h),g=cs(h),v=we.useRef(),[b,L]=we.useState(!1),[x,W]=we.useState(0),[$,K]=we.useState(null),Q=Wa();return qc(async()=>{if(Q.current||(K(null),W(0),L(!1)),c&&_){try{Q.current||L(!0);let{appid:ce,channel:te,token:ve,uid:H}=typeof s=="function"?await s():s,j=await _.join(ce,te,ve,H);Q.current||W(j)}catch(ce){console.error(ce),Q.current||K(new Wr("IAgoraRTCClient.join",ce))}Q.current||L(!1);let Ee=v.current||(v.current=ay());return Yc([()=>{Ee.dispose()},()=>{Ee.run(()=>_.unpublish(_.localTracks))},()=>{for(let ce of _.localTracks)ce.isPlaying&&ce.stop(),ce.close();Ee.run(()=>_.leave())}])}},[c,h]),{data:x,isLoading:b,isConnected:g,error:$}}var XU=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function TQ(s){let c=Do(s),[h,_]=we.useState(XU);return we.useEffect(()=>{if(c)return Pr(c,"network-quality",g=>_({uplinkNetworkQuality:g.uplinkNetworkQuality,downlinkNetworkQuality:g.downlinkNetworkQuality,delay:c.getRTCStats().RTT??0}));_(XU())},[c]),h}var vQ=Kc(zc());function gV(s,c=!0,h){let _=Do(h),g=cs(h),v=we.useRef([]),[b,L]=we.useState(!1),[x,W]=we.useState(null),$=Wa();return qc(async()=>{if($.current||(L(!1),W(null)),!_||!g||!c)return;let K=s.filter(Boolean),Q=te=>{let ve=hQ(vQ.default.VERSION,"4.18.2")>=0;return ve||new Wr("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),ve?_.mode!=="live"||_.role!=="audience":!0},Ee=te=>v.current.some(ve=>ve&&ve.getTrackId()===te.getTrackId()),ce=te=>Q()&&te.enabled&&c&&!Ee(te);for(let te=0;te<K.length;te++){let ve=K[te];if(ve&&ce(ve)){await _.unpublish(v.current.filter(H=>(H==null?void 0:H.trackMediaType)===ve.trackMediaType));try{$.current||L(!0),await _.publish(ve)}catch(H){console.error(H),$.current||W(new Wr("IAgoraRTCClient.publish",H))}$.current||L(!1)}}v.current=K},[g,c,_,s]),{isLoading:b,error:x}}function RQ(s){let[c,h]=we.useState(0);return we.useEffect(()=>{if(s)return lQ(()=>{h(s.getVolumeLevel())},1e3)},[s]),c}var CQ=Kc(zc());function SV(s=!0,c={ANS:!0,AEC:!0},h){let _=cs(h),[g,v]=we.useState(null),[b,L]=we.useState(!1),[x,W]=we.useState(null),$=Wa();return qc(async()=>{if($.current||(L(!1),W(null)),_&&s&&!g){try{$.current||L(!0);let K=await CQ.default.createMicrophoneAudioTrack(c);$.current||v(K)}catch(K){console.error(K),$.current||W(new Wr("IAgoraRTC.createMicrophoneAudioTrack",K))}$.current||L(!1)}!_&&!$.current&&v(null)},[_,s]),{localMicrophoneTrack:g,isLoading:b,error:x}}var yQ=Kc(zc());function TV(s=!0,c,h){let _=cs(h),[g,v]=we.useState(null),[b,L]=we.useState(!1),[x,W]=we.useState(null),$=Wa();return qc(async()=>{if($.current||(L(!1),W(null)),_&&s&&!g){try{$.current||L(!0);let K=await yQ.default.createCameraVideoTrack(c);$.current||v(K)}catch(K){console.error(K),$.current||W(new Wr("IAgoraRTC.createCameraVideoTrack",K))}$.current||L(!1)}!_&&!$.current&&v(null)},[_,s]),{localCameraTrack:g,isLoading:b,error:x}}function IQ(s,c){let h=Do(c),[_,g]=we.useState([]),v=cs(),b=we.useRef([]),[L,x]=we.useState(!1),[W,$]=we.useState(null),K=Wa();return qc(async()=>{if(K.current||$(null),!Array.isArray(s)||!v)return;let Q=async te=>{if(!te.audioTrack&&s.some(({uid:ve})=>te.uid===ve)){try{K.current||x(!0),await h.subscribe(te,"audio")}catch(ve){console.error(ve),K.current||$(new Wr("IAgoraRTCClient.subscribe",ve))}te.audioTrack&&!b.current.some(ve=>ve.getUserId()===te.uid)&&b.current.push(te.audioTrack),b.current=b.current.map(ve=>te.audioTrack&&ve.getUserId()===te.uid&&ve.getTrackId()!==te.audioTrack.getTrackId()?te.audioTrack:ve),K.current||(g([...b.current]),x(!1))}},Ee=async te=>{if(s.some(({uid:ve})=>te.uid===ve)){K.current||(b.current=b.current.filter(ve=>ve.getUserId()!==te.uid),g([...b.current]));try{K.current||x(!0),await h.unsubscribe(te,"audio")}catch(ve){console.error(ve),K.current||$(new Wr("IAgoraRTCClient.unsubscribe",ve))}K.current||x(!1)}};s.map(te=>{!te.audioTrack&&te.hasAudio&&Q(te)});let ce=[];for(let te=0;te<b.current.length;te++){let ve=b.current[te];if(!s.some(H=>H.uid===ve.getUserId())){let H=h.remoteUsers.find(j=>j.uid===ve.getUserId());H&&ce.push({user:H,mediaType:"audio"}),b.current.splice(te,1),te--}}if(ce.length>0){try{K.current||x(!0),await h.massUnsubscribe(ce)}catch(te){console.error(te),K.current||$(new Wr("IAgoraRTCClient.massUnsubscribe",te))}K.current||(g(b.current.slice()),x(!1))}return Yc([Pr(h,"user-published",(te,ve)=>{s.find(H=>H.uid===te.uid)&&ve==="audio"&&Q(te)}),Pr(h,"user-unpublished",(te,ve)=>{s.find(H=>H.uid===te.uid)&&ve==="audio"&&Ee(te)})])},[v,h,s]),{audioTracks:_,isLoading:L,error:W}}function wQ(s,c){let h=Do(c),[_,g]=we.useState([]),v=cs(),b=we.useRef([]),[L,x]=we.useState(!1),[W,$]=we.useState(null),K=Wa();return qc(async()=>{if(K.current||$(null),!Array.isArray(s)||!v)return;let Q=async te=>{if(!te.videoTrack&&s.some(({uid:ve})=>te.uid===ve)){try{K.current||x(!0),await h.subscribe(te,"video")}catch(ve){console.error(ve),K.current||$(new Wr("IAgoraRTCClient.subscribe",ve))}te.videoTrack&&!b.current.some(ve=>ve.getUserId()===te.uid)&&b.current.push(te.videoTrack),b.current=b.current.map(ve=>te.videoTrack&&ve.getUserId()===te.uid&&ve.getTrackId()!==te.videoTrack.getTrackId()?te.videoTrack:ve),K.current||(g([...b.current]),x(!1))}},Ee=async te=>{if(s.some(({uid:ve})=>te.uid===ve)){K.current||(b.current=b.current.filter(ve=>ve.getUserId()!==te.uid),g([...b.current]));try{K.current||x(!0),await h.unsubscribe(te,"video")}catch(ve){console.error(ve),K.current||$(new Wr("IAgoraRTCClient.unsubscribe",ve))}K.current||x(!1)}};s.map(te=>{!te.videoTrack&&te.hasVideo&&Q(te)});let ce=[];for(let te=0;te<b.current.length;te++){let ve=b.current[te];if(!s.some(H=>H.uid===ve.getUserId())){let H=h.remoteUsers.find(j=>j.uid===ve.getUserId());H&&ce.push({user:H,mediaType:"video"}),b.current.splice(te,1),te--}}if(ce.length>0){try{K.current||x(!0),await h.massUnsubscribe(ce)}catch(te){console.error(te),K.current||$(new Wr("IAgoraRTCClient.massUnsubscribe",te))}K.current||(g(b.current.slice()),x(!1))}return Yc([Pr(h,"user-published",(te,ve)=>{s.find(H=>H.uid===te.uid)&&ve==="video"&&Q(te)}),Pr(h,"user-unpublished",(te,ve)=>{s.find(H=>H.uid===te.uid)&&ve==="video"&&Ee(te)})])},[v,h,s]),{videoTracks:_,isLoading:L,error:W}}function uC(s,c,h){let _=Do(h),g=c==="audio"?"audioTrack":"videoTrack",[v,b]=we.useState(s&&s[g]),L=cs(),x=we.useRef(),[W,$]=we.useState(!1),[K,Q]=we.useState(null);return we.useEffect(()=>{if(!s||!L)return;let Ee=!1;Ee||Q(null);let ce=c==="audio"?"hasAudio":"hasVideo",te=s.uid,ve=async(Y,ge)=>{if(Y[g]&&_.remoteUsers.some(({uid:Te})=>Y.uid===Te))try{Ee||$(!0),await _.unsubscribe(Y,ge)}catch(Te){Ee||Q(new Wr("IAgoraRTCClient.unsubscribe",Te)),console.error(Te)}Ee||(b(void 0),$(!1))},H=async(Y,ge)=>{try{!Y[g]&&_.remoteUsers.some(({uid:Te})=>Y.uid===Te)&&(Ee||$(!0),await _.subscribe(Y,ge)),Ee||b(Y[g])}catch(Te){Ee||Q(new Wr("IAgoraRTCClient.subscribe",Te)),console.error(Te)}Ee||$(!1)},j=x.current||(x.current=ay());return!s[g]&&s[ce]?j.run(()=>H(s,c)):b(s[g]),Yc([()=>{Ee=!0,j.dispose()},Pr(_,"user-published",(Y,ge)=>{Y.uid===te&&ge===c&&j.run(()=>H(Y,c))}),Pr(_,"user-unpublished",(Y,ge)=>{Y.uid===te&&ge===c&&j.run(()=>ve(Y,c))})])},[L,_,s,c,g]),{track:v,isLoading:W,error:K}}function vV(s){let c=Do(s),[h,_]=we.useState(c?c.remoteUsers:[]);return we.useEffect(()=>{if(c){let g=()=>_(c.remoteUsers.slice());return Yc([Pr(c,"user-joined",g),Pr(c,"user-left",g),Pr(c,"user-published",g),Pr(c,"user-unpublished",g)])}},[c]),h}var AQ=Kc(zc());function OQ(s=!0,c,h,_){let g=cs(_),[v,b]=we.useState(null),[L,x]=we.useState(!1),[W,$]=we.useState(null),K=Wa();return qc(async()=>{if(K.current||(x(!1),$(null)),g&&s&&!v){try{K.current||x(!0);let Q=await AQ.default.createScreenVideoTrack(c,h);K.current||b(Q)}catch(Q){console.error(Q),K.current||$(new Wr("IAgoraRTC.createScreenVideoTrack",Q))}K.current||x(!1)}(!g||!s)&&!K.current&&b(null)},[g,s]),{screenTrack:v,isLoading:L,error:W}}function bQ(){let s=new Map,c=1500;return{onMount:h=>{let _=s.get(h);_&&(_(),s.delete(h))},onUnmount:h=>{let _=s.get(h);_&&_(),s.set(h,Zf(()=>{h.isPlaying&&h.stop(),s.delete(h)},c))},dispose:()=>{for(let[h,_]of s)h.isPlaying&&h.stop(),_&&_();s.clear()}}}var cy=we.createContext(void 0);function NQ({children:s}){let[c]=we.useState(bQ);return we.useEffect(()=>c.dispose,[c]),$e.jsx(cy.Provider,{value:c,children:s})}function ly(s,c,h,_){let g=we.useContext(cy);we.useEffect(()=>{if(s)return _&&c?s.play(_,h||void 0):s.stop(),g?(g.onMount(s),()=>g.onUnmount(s)):()=>{s.isPlaying&&s.stop()}},[s,_,c,g,h])}function dy(s,c){let h=we.useContext(cy);$f(()=>{if(s)return c?s.play():s.stop(),h?(h.onMount(s),()=>h.onUnmount(s)):()=>{s.isPlaying&&s.stop()}},[s,c,h])}function RV({track:s,play:c=!1,volume:h,disabled:_,muted:g,children:v}){let b=pV(s);return dy(b,c),we.useEffect(()=>{b&&h!=null&&b.setVolume(h)},[b,h]),we.useEffect(()=>{b&&_!=null&&b.setEnabled(!_).catch(console.warn)},[_,b]),we.useEffect(()=>{b&&g!=null&&b.setMuted(g).catch(console.warn)},[g,b]),v?$e.jsx($e.Fragment,{children:v}):null}var CV={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},yV={width:"100%",height:"100%"},uy={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},eE=(s,c)=>we.useMemo(()=>({...s,...c}),[s,c]);function IV({track:s,play:c,disabled:h,muted:_,style:g,videoPlayerConfig:v,...b}){let L=eE(yV,g),[x,W]=we.useState(null),$=pV(s);return ly($,c,v,x),we.useEffect(()=>{$&&h!=null&&$.setEnabled(!h).catch(console.warn)},[h,$]),we.useEffect(()=>{$&&_!=null&&$.setMuted(_).catch(console.warn)},[_,$]),$e.jsx("div",{...b,ref:W,style:L})}var DQ={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},PQ={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function wV({cover:s}){return $e.jsx("div",{style:uy,children:typeof s=="string"?$e.jsxs($e.Fragment,{children:[$e.jsx("div",{style:{...DQ,backgroundImage:`url(${s})`}}),$e.jsx("img",{src:s,style:PQ})]}):s()})}function AV({micOn:s,cameraOn:c,audioTrack:h,videoTrack:_,playAudio:g,playVideo:v,volume:b,cover:L,children:x,style:W,...$}){let K=eE(CV,W);return v=v??!!c,g=g??!!s,$e.jsxs("div",{...$,style:K,children:[$e.jsx(IV,{disabled:!c,play:v,track:_}),$e.jsx(RV,{disabled:!s,play:g,track:h,volume:b}),L&&!c&&$e.jsx(wV,{cover:L}),$e.jsx("div",{style:uy,children:x})]})}function OV({track:s,play:c=!1,playbackDeviceId:h,volume:_,children:g}){return dy(s,c),we.useEffect(()=>{s&&h!=null&&s.setPlaybackDevice(h).catch(console.warn)},[s,h]),we.useEffect(()=>{s&&_!=null&&s.setVolume(_)},[s,_]),g?$e.jsx($e.Fragment,{children:g}):null}function bV({track:s,play:c,style:h,videoPlayerConfig:_,...g}){let v=eE(yV,h),[b,L]=we.useState(null);return ly(s,c,_,b),$e.jsx("div",{...g,ref:L,style:v})}function NV({user:s,playVideo:c,playAudio:h,playbackDeviceId:_,volume:g,cover:v,style:b,children:L,videoPlayerConfig:x,...W}){let $=eE(CV,b),{track:K}=uC(s,"video"),{track:Q}=uC(s,"audio");return c=c??(s==null?void 0:s.hasVideo),h=h??(s==null?void 0:s.hasAudio),$e.jsxs("div",{...W,style:$,children:[$e.jsx(bV,{play:c,track:K,videoPlayerConfig:x}),$e.jsx(OV,{play:h,playbackDeviceId:_,track:Q,volume:g}),v&&!c&&$e.jsx(wV,{cover:v}),$e.jsx("div",{style:uy,children:L})]})}var kQ=Kc(zc()),LQ=class{constructor(){uh(this,"appType",1001);kQ.default.setAppType(this.appType)}};new LQ;var MQ="2.2.0";sQ(hV,Kc(zc()));var DV=aQ.default;/*! Bundled license information:

agora-rtc-sdk-ng/AgoraRTC_N-production.js:
  (*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> *)
*/const UQ="5634944c8a88556f84e824bf36fcf12a",xQ=new TextEncoder;function VQ(s){const c=UQ.split(""),h=xQ.encode(s);return Array.from({length:32},(_,g)=>{const v=h[g]?h[g]%c.length:0,b=c[v];return c.splice(v,1),b}).join("")}const Ra=400,Ca=400,FQ=()=>{const[s,c]=we.useState(!1),h=cs(),[_,g]=we.useState(""),[v,b]=we.useState("123"),L=s?VQ(_):"";EV({appid:L,channel:v,token:null},s);const[x,W]=we.useState(!0),[$,K]=we.useState(!0),{localMicrophoneTrack:Q}=SV(x),{localCameraTrack:Ee}=TV($);gV([Q,Ee]);const ce=vV(),[te,ve]=we.useState({}),H=we.useRef(()=>{});H.current=()=>{console.log(te);const Te=Ee==null?void 0:Ee.getStats();if(console.log(Ee,Te),Te&&Te.sendResolutionWidth){let[be,Ae]=[Te.sendResolutionWidth,Te.sendResolutionHeight];be>Ra&&([be,Ae]=[Ra,Ae*Ra/be]),Ae>Ca&&([be,Ae]=[be*Ca/Ae,Ca]),ve(Ve=>Object.assign(Ve,{0:[be,Ae]}))}ce.forEach(be=>{var Ve;console.log("User:",be);const Ae=(Ve=be.videoTrack)==null?void 0:Ve.getStats();if(Ae&&Ae.receiveResolutionWidth){let[Bt,et]=[Ae.receiveResolutionWidth,Ae.receiveResolutionHeight];Bt>Ra&&([Bt,et]=[Ra,et*Ra/Bt]),et>Ca&&([Bt,et]=[Bt*Ca/et,Ca]),console.log(Bt,et),ve(dr=>Object.assign(dr,{[be.uid]:[Bt,et]}))}})},we.useEffect(()=>{const Te=setInterval(H.current,500);return()=>clearInterval(Te)},[]);const j=te[0],[Y,ge]=j||[Ra,Ca];return $e.jsxs($e.Fragment,{children:[$e.jsx("div",{className:"room",children:h?$e.jsxs("div",{className:"user-list",children:[$e.jsx("div",{className:"user",style:{width:Y,height:ge},children:$e.jsx(AV,{audioTrack:Q,cameraOn:$,micOn:x,videoTrack:Ee,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:$e.jsx("samp",{className:"user-name",children:"You"})})}),ce.map(Te=>{const be=te[Te.uid],[Ae,Ve]=be||[Ra,Ca];return $e.jsx("div",{className:"user",style:{width:Ae,height:Ve},children:$e.jsx(NV,{cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",user:Te})},Te.uid)})]}):$e.jsxs("div",{className:"join-room",children:[$e.jsx("input",{onChange:Te=>b(Te.target.value),placeholder:"<Your channel Name>",value:v}),$e.jsx("input",{onChange:Te=>g(Te.target.value),placeholder:"芝麻开门!",value:_}),$e.jsx("button",{className:`join-channel ${!_||!v?"disabled":""}`,disabled:!_||!v,onClick:()=>c(!0),children:$e.jsx("span",{children:"Join Channel"})})]})}),h&&$e.jsxs("div",{className:"control",children:[$e.jsxs("div",{className:"left-control",children:[$e.jsx("button",{className:"btn",onClick:()=>W(Te=>!Te),children:$e.jsx("i",{className:`i-microphone ${x?"":"off"}`})}),$e.jsx("button",{className:"btn",onClick:()=>K(Te=>!Te),children:$e.jsx("i",{className:`i-camera ${$?"":"off"}`})})]}),$e.jsx("button",{className:`btn btn-phone ${s?"btn-phone-active":""}`,onClick:()=>c(Te=>!Te),children:s?$e.jsx("i",{className:"i-phone-hangup"}):$e.jsx("i",{className:"i-mdi-phone"})})]})]})},jQ=DV.createClient({mode:"rtc",codec:"vp8"});gR.createRoot(document.getElementById("root")).render($e.jsx(B7.StrictMode,{children:$e.jsx(_V,{client:jQ,children:$e.jsx(FQ,{})})}));
